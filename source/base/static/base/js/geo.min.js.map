{"version":3,"file":"geo.min.js","sources":["../src/vgl/vgl/src/init.js","../src/vgl/vgl/src/GL.js","../src/vgl/vgl/src/timestamp.js","../src/vgl/vgl/src/object.js","../src/vgl/vgl/src/event.js","../src/vgl/vgl/src/boundingObject.js","../src/vgl/vgl/src/node.js","../src/vgl/vgl/src/groupNode.js","../src/vgl/vgl/src/actor.js","../src/vgl/vgl/src/freezeObject.js","../src/vgl/vgl/src/defaultValue.js","../src/vgl/vgl/src/geojsonReader.js","../src/vgl/vgl/src/data.js","../src/vgl/vgl/src/geomData.js","../src/vgl/vgl/src/mapper.js","../src/vgl/vgl/src/groupMapper.js","../src/vgl/vgl/src/materialAttribute.js","../src/vgl/vgl/src/blend.js","../src/vgl/vgl/src/material.js","../src/vgl/vgl/src/renderer.js","../src/vgl/vgl/src/renderWindow.js","../src/vgl/vgl/src/camera.js","../src/vgl/vgl/src/interactorStyle.js","../src/vgl/vgl/src/trackballInteractorStyle.js","../src/vgl/vgl/src/pvwInteractorStyle.js","../src/vgl/vgl/src/viewer.js","../src/vgl/vgl/src/shader.js","../src/vgl/vgl/src/shaderProgram.js","../src/vgl/vgl/src/texture.js","../src/vgl/vgl/src/uniform.js","../src/vgl/vgl/src/vertexAttribute.js","../src/vgl/vgl/src/source.js","../src/vgl/vgl/src/planeSource.js","../src/vgl/vgl/src/pointSource.js","../src/vgl/vgl/src/lineSource.js","../src/vgl/vgl/src/utils.js","../src/vgl/vgl/src/picker.js","../src/vgl/vgl/src/shapefileReader.js","../src/vgl/vgl/src/vtkReader.js","../src/vgl/vgl/src/DataBuffers.js","../src/core/init.js","../src/core/version.js","../src/core/object.js","../src/core/sceneObject.js","../src/core/timestamp.js","../src/core/ellipsoid.js","../src/core/mercator.js","../src/core/latlng.js","../src/core/layer.js","../src/core/featureLayer.js","../src/core/event.js","../src/core/time.js","../src/core/fileReader.js","../src/core/jsonReader.js","../src/core/map.js","../src/core/feature.js","../src/core/pointFeature.js","../src/core/lineFeature.js","../src/core/pathFeature.js","../src/core/polygonFeature.js","../src/core/planeFeature.js","../src/core/geomFeature.js","../src/core/graphFeature.js","../src/core/transform.js","../src/core/renderer.js","../src/core/osmLayer.js","../src/gl/init.js","../src/gl/renderer.js","../src/gl/lineFeature.js","../src/gl/pointFeature.js","../src/gl/geomFeature.js","../src/gl/planeFeature.js","../src/gl/mapInteractorStyle.js","../src/gl/vglRenderer.js","../src/d3/init.js","../src/d3/object.js","../src/d3/pointFeature.js","../src/d3/lineFeature.js","../src/d3/pathFeature.js","../src/d3/graphFeature.js","../src/d3/d3Renderer.js"],"names":["inherit","C","P","F","prototype","uber","constructor","ogs","namespace","ns_string","i","parts","split","parent","slice","length","vgl","Object","size","obj","key","hasOwnProperty","GL","ColorBufferBit","DepthBufferBit","m_globalModifiedTime","timestamp","this","m_modifiedTime","modified","getMTime","object","event","call","keyPress","mousePress","mouseRelease","contextMenu","configure","enable","mouseWheel","keyRelease","middleButtonPress","startInteraction","enter","rightButtonPress","middleButtonRelease","char","disable","endInteraction","mouseMove","mouseOut","expose","timer","leftButtonPress","leave","rightButtonRelease","leftButtonRelease","click","dblClick","boundingObject","m_bounds","m_computeBoundsTimestamp","m_boundsDirtyTimestamp","bounds","hasValidBounds","Number","MAX_VALUE","setBounds","minX","maxX","minY","maxY","minZ","maxZ","resetBounds","computeBounds","computeBoundsTimestamp","boundsDirtyTimestamp","ReferenceFrame","Relative","Absolute","node","m_parent","m_material","m_visible","m_overlay","accept","visitor","visit","material","setMaterial","visible","setVisible","flag","setParent","removeChild","overlay","setOverlay","ascend","traverse","boundsModified","groupNode","m_children","b_setVisible","addChild","childNode","indexOf","push","index","splice","removeChildren","children","hasChild","child","type","UpdateVisitor","traverseChildrenAndUpdateBounds","CullVisitor","traverseChildren","mode","TraverseAllChildren","updateBounds","vesVisitor","childBounds","istep","jstep","actor","m_transformMatrix","mat4","create","m_referenceFrame","m_mapper","matrix","setMatrix","tmatrix","referenceFrame","setReferenceFrame","mapper","setMapper","computeLocalToWorldMatrix","computeWorldToLocalMatrix","undefined","mapperBounds","minPt","maxPt","newBounds","vec3","transformMat4","freezeObject","freezedObject","freeze","o","defaultValue","a","b","EMPTY_OBJECT","geojsonReader","readScalars","coordinates","geom","size_estimate","idx","array","s","r","g","m_scalarFormat","sourceData","vertexAttributeKeys","Scalar","sourceDataSf","m_scalarRange","setScalarRange","data","addSource","pushBack","insertAt","Color","sourceDataC3fv","readPoint","geometryData","vglpoints","points","vglcoords","sourceDataP3fv","indices","Uint16Array","x","y","z","setIndices","addPrimitive","setName","readMultiPoint","pntcnt","estpntcnt","readLineString","vglline","lineStrip","setIndicesPerPrimitive","readMultiLineString","j","thisLineLength","readPolygon","thisPolyLength","vl","vgltriangle","triangles","readMultiPolygon","ccount","numPolys","indexes","vf","flip","flipped","tcount","readGJObjectInt","properties","ScalarFormat","ScalarRange","ret","next","nextset","geometries","readGJObject","geometry","features","console","log","linearizeGeoms","geoms","toString","readGeomObject","getPrimitives","buffer","JSON","parse","scalarFormat","scalarRange","raster","point","lineString","polygon","Position","Normal","TextureCoordinate","primitive","m_indicesPerPrimitive","m_primitiveType","m_indicesValueType","m_indices","createIndices","numberOfIndices","sizeInBytes","BYTES_PER_ELEMENT","primitiveType","setPrimitiveType","indicesPerPrimitive","count","indicesValueType","setIndicesValueType","indicesArray","triangleStrip","gl","TRIANGLE_STRIP","UNSIGNED_SHORT","TRIANGLES","lines","LINES","LINE_STRIP","POINTS","vertexDataP3f","m_position","vertexDataP3N3f","m_normal","vertexDataP3T3f","m_texCoordinate","m_attributesMap","m_data","vglAttributeData","m_numberOfComponents","m_dataType","m_dataTypeSize","m_normalized","m_stride","m_offset","getData","setData","Array","addAttribute","dataType","sizeOfDataType","offset","stride","noOfComponents","normalized","newAttr","sizeOfArray","lengthOfArray","keys","numberOfComponents","sizeOfAttributeDataType","hasKey","numberOfAttributes","attributeNumberOfComponents","attributeDataType","attributeOffset","attributeStride","insert","sourceDataAnyfv","FLOAT","value","sourceDataP3T3f","sourceDataP3N3f","sourceDataT2fv","m_min","m_max","m_fixedmin","m_fixedmax","min","max","sourceDataDf","m_name","m_primitives","m_sources","name","source","numberOfSources","numberOfPrimitives","vertexIndex","attr","ib","jb","findClosestVertex","vi","vPos","dx","dy","dz","dist","minDist","minIndex","Math","sqrt","getPosition","getScalar","deleteVertexBufferObjects","m_buffers","deleteBuffer","createVertexBufferObjects","m_geomData","k","ks","bufferId","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","m_bufferVertexAttributeMap","m_glCompileTimestamp","cleanUpDrawObjects","setupDrawObjects","m_dirty","m_color","geomBounds","color","setColor","setGeometryData","render","renderState","vertexAttrib3fv","bufferIndex","noOfPrimitives","bindVertexData","drawArrays","groupMapper","m_createMappersTimestamp","m_mappers","m_geomDataArray","geometryDataArray","setGeometryDataArray","materialAttributeType","Undefined","ShaderProgram","Texture","Blend","Depth","materialAttribute","m_type","m_enabled","enabled","setup","bind","undoBind","setupVertexData","undoBindVertexData","blendFunction","destination","m_source","m_destination","apply","blendFuncSeparate","ONE","ONE_MINUS_SRC_ALPHA","blend","m_wasEnabled","m_blendFunction","SRC_ALPHA","isEnabled","BLEND","m_shaderProgram","shaderProgram","m_binNumber","m_textureAttributes","m_attributes","binNumber","setBinNumber","binNo","exists","uniform","attribute","setAttribute","textureUnit","remove","RenderBin","Base","Default","Opaque","Transparent","Overlay","m_modelViewMatrix","m_normalMatrix","m_projectionMatrix","renderer","m_sceneRoot","m_camera","camera","m_nearClippingPlaneTolerance","m_x","m_y","m_width","m_height","m_resizable","m_resetScene","m_layer","m_resetClippingRange","width","height","layer","setLayer","layerNo","isResizable","setResizable","backgroundColor","clearColor","setBackgroundColor","setClearColor","sceneRoot","renSt","sortedActors","mvMatrixInv","DEPTH_TEST","depthFunc","LEQUAL","clearMask","clearDepth","clear","viewport","resetCamera","sort","multiply","viewMatrix","projectionMatrix","ortho","invert","transpose","vn","directionOfProjection","visibleBounds","center","diagonals","radius","aspect","viewAspect","angle","viewAngle","distance","vup","atan","tan","sin","viewUpDirection","abs","dot","setViewUpDirection","setFocalPoint","setPosition","resetCameraClippingRange","viewPlaneNormal","position","c","d","range","vec2","getParameter","DEPTH_BITS","setClippingRange","resize","positionAndResize","setViewAspect","addActor","hasActor","addActors","actors","removeActor","removeActors","removeAllActors","worldToDisplay","worldPt","viewProjectionMatrix","winX","winY","winZ","winW","clipPt","vec4","fromValues","displayToWorld","displayPt","viewProjectionInverse","focusDisplayPoint","focalPoint","focusWorldPt","resetScene","setResetScene","reset","resetClippingRange","setResetClippingRange","renderWindow","canvas","m_canvas","m_activeRender","m_renderers","windowSize","setWindowSize","windowPosition","setWindowPosition","renderers","activeRenderer","addRenderer","ren","hasRenderer","setClearMask","removeRenderer","getRenderer","createWindow","getContext","e","deleteWindow","m_viewAngle","PI","m_focalPoint","m_centerOfRotation","m_viewUp","m_rightDir","m_near","m_far","m_viewAspect","m_directionOfProjection","m_viewPlaneNormal","m_viewMatrix","m_computeModelViewMatrixTime","m_computeProjectMatrixTime","m_left","m_right","m_top","m_bottom","m_enableTranslation","m_enableRotation","m_enableScale","m_enableParallelProjection","m_clearColor","m_clearDepth","m_clearMask","setViewAngleDegrees","setViewAngle","centerOfRotation","setCenterOfRotation","clippingRange","near","far","enableScale","setEnableScale","enableRotation","setEnableRotation","enableTranslation","setEnableTranslation","isEnabledParallelProjection","enableParallelProjection","setEnnableParallelProjection","setParallelProjection","left","right","top","bottom","computeDirectionOfProjection","computeViewPlaneNormal","computeViewMatrix","computeProjectionMatrix","mask","setClearDepth","depth","subtract","normalize","zoom","dir","pan","computeOrthogonalAxes","cross","rotate","mat","inverseCenterOfRotation","identity","translate","lookAt","perspective","interactorStyle","m_that","m_viewer","viewer","setViewer","$","on","handleMouseDown","handleMouseUp","handleMouseMove","handleMouseOut","handleMouseWheel","handleKeyPress","mouseContextMenu","handleContextMenu","handleClick","handleDoubleClick","trackballInteractorStyle","m_outsideCanvas","m_leftMouseBtnDown","m_rightMouseBtnDown","m_midMouseBtnDown","m_currPos","m_lastPos","fp","fdp","fwp","dp1","dp2","wp1","wp2","coords","m_zTrans","cam","relMouseCoords","button","view","originalEvent","wheelDelta","pvwInteractorStyle","m_renderer","m_coords","m_currentMousePos","m_focusWorldPt","m_focusDisplayPt","m_displayPt1","m_displayPt2","m_worldPt1","m_worldPt2","m_dx","m_dy","m_dz","m_leftMouseButtonDown","m_rightMouseButtonDown","m_middleMouseButtonDown","m_mouseLastPos","rens","secCameras","deltaxy","m_ready","m_interactorStyle","m_renderWindow","init","setInteractorStyle","style","fixedEvent","fix","window","preventDefault","state","trigger","pageX","pageY","totalOffsetX","totalOffsetY","canvasX","canvasY","currentElement","offsetLeft","scrollLeft","offsetTop","scrollTop","offsetParent","bindEventHandlers","unbindEventHandlers","off","_init","shader","m_shaderHandle","m_compileTimestamp","m_shaderType","m_shaderSource","shaderHandle","shaderType","shaderSource","setShaderSource","compile","deleteShader","createShader","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","attachShader","programHandle","m_programHandle","m_shaders","m_uniforms","m_vertexAttributes","m_uniformNameToLocation","m_vertexAttributeNameToLocation","queryUniformLocation","getUniformLocation","queryAttributeLocation","getAttribLocation","addShader","addUniform","addVertexAttribute","uniformLocation","attributeLocation","updateUniforms","callGL","link","linkProgram","getProgramParameter","LINK_STATUS","use","useProgram","cleanUp","deleteVertexAndFragment","deleteProgram","createProgram","bindAttributes","bindUniforms","update","bindAttribLocation","texture","activateTextureUnit","m_textureUnit","activeTexture","TEXTURE0","TEXTURE1","TEXTURE2","TEXTURE3","TEXTURE4","TEXTURE5","TEXTURE6","TEXTURE7","TEXTURE8","TEXTURE9","TEXTURE10","TEXTURE11","TEXTURE12","TEXTURE13","TEXTURE14","TEXTURE15","m_depth","m_textureHandle","m_pixelFormat","m_pixelDataType","m_internalFormat","m_image","m_setupTimestamp","deleteTexture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","pixelStorei","UNPACK_ALIGNMENT","UNPACK_FLIP_Y_WEBGL","updateDimensions","computeInternalFormatUsingImage","texImage2D","image","setImage","setTextureUnit","unit","setWidth","setDepth","textureHandle","internalFormat","setInternalFormat","pixelFormat","setPixelFormat","pixelDataType","setPixelDataType","RGBA","UNSIGNED_BYTE","lookupTable","m_range","m_colorTable","map","Uint8Array","colorTable","setColorTable","colors","setRange","updateRange","getTypeNumberOfComponents","INT","BOOL","FLOAT_VEC2","INT_VEC2","BOOL_VEC2","FLOAT_VEC3","INT_VEC3","BOOLT_VEC3","FLOAT_VEC4","INT_VEC4","BOOL_VEC4","FLOAT_MAT3","FLOAT_MAT4","m_dataArray","get","set","location","m_numberElements","uniform1iv","uniform1fv","uniform2fv","uniform3fv","uniform4fv","uniformMatrix3fv","FALSE","uniformMatrix4fv","modelViewUniform","projectionUniform","floatUniform","normalMatrixUniform","CountAttributeIndex","vertexAttributeKeysIndexed","Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","vertexAttribute","program","vertexAttribPointer","enableVertexAttribArray","disableVertexAttribArray","planeSource","m_origin","m_point1","m_point2","m_xresolution","m_yresolution","m_geom","setOrigin","setPoint1","setPoint2","ii","numPts","sourceTexCoords","tc","v1","v2","pts","posIndex","normIndex","colorIndex","texCoordIndex","positions","normals","texCoords","tristrip","sourcePositions","sourceColors","pointSource","m_this","m_positions","m_colors","m_textureCoords","m_size","getPositions","setPositions","getColors","setColors","getSize","setSize","setTextureCoordinates","texcoords","pointsPrimitive","sourceSize","lineSource","linesPrimitive","utils","computePowerOfTwo","pow","createTextureVertexShader","vertexShaderSource","join","VERTEX_SHADER","createTextureFragmentShader","fragmentShaderSource","FRAGMENT_SHADER","createRgbaTextureFragmentShader","createVertexShader","createPointVertexShader","createVertexShaderSolidColor","createVertexShaderColorMap","createFragmentShader","createPhongVertexShader","createPhongFragmentShader","createFragmentShaderSolidColor","context","createFragmentShaderColorMap","createPointSpritesVertexShader","createPointSpritesFragmentShader","createTextureMaterial","isRgba","prog","vertexShader","fragmentShader","posVertAttr","texCoordVertAttr","pointsizeUniform","samplerUniform","opacityUniform","createGeometryMaterial","pointSize","opacity","colorVertAttr","createPointGeometryMaterial","sizeVertAttr","createPhongMaterial","normalVertAttr","normalUniform","createColorMaterial","createColorMappedMaterial","lut","scalarVertAttr","lutMinUniform","lutMaxUniform","updateColorMappedMaterial","lutMin","lutMax","createSolidColorMaterial","createPointSpritesMaterial","heightUniform","vertexColorWeightUniform","scalarsToColors","useScalarsToColors","useVertexColors","createPlane","originX","originY","originZ","point1X","point1Y","point1Z","point2X","point2Y","point2Z","createTexturePlane","createPoints","createPointSprites","createLines","createColorLegend","varname","origin","countMajor","countMinor","createLabels","pt1","pt2","delta","axisLabelOffset","create2DTexture","toFixed","createTicksAndLabels","pt1X","pt1Y","pt1Z","pt2X","pt2Y","pt2Z","heightMajor","concat","group","textToWrite","textSize","font","alignment","baseline","bold","document","getElementById","ctx","createElement","display","fillStyle","fillRect","textAlign","textBaseline","fillText","picker","m_actors","getActors","pick","selectionX","selectionY","bb","tmin","tmax","tymin","tymax","tzmin","tzmax","fpoint","focusDisplayPt","cameraPos","ray","shapefileReader","SHP_NULL","SHP_POINT","SHP_POLYGON","SHP_POLYLINE","int8","charCodeAt","bint32","lint32","bint16","lint16","ldbl64","b0","b1","b2","b3","b4","b5","b6","b7","sign","exp","frac","lfloat32","str","chars","readHeader","code","version","shapetype","xmin","ymin","xmax","ymax","Box","vect","loadShx","appendIndex","Shapefile","options","path","ajax","url","mimeType","success","dbf_data","loadShp","localShapefile","shxFile","shx","shpFile","shp","dbfFile","dbf","shxReader","FileReader","onloadend","result","shpReader","shpData","dbfReader","dbfData","readAsBinaryString","loadDBF","level","num_entries","header_size","record_size","FIELDS_START","HEADER_LENGTH","header_offset","headers","records","record_offset","declare","record","header","trim","parseFloat","readRing","start","end","ring","readRecord","geom_type","num_parts","num_points","parts_start","points_start","rings","feature","vtkReader","m_base64Chars","m_reverseBase64Chars","m_vtkRenderedList","m_vtkObjectCount","m_vtkScene","m_node","END_OF_INPUT","m_base64Str","m_base64Count","m_pos","ntos","n","unN","unescape","readReverseBase64","nextCharacter","charAt","decode64","inBuffer","done","readNumber","ss","v","readF3Array","numberOfPoints","test","Int8Array","readColorArray","vglcolors","tmp","parseObject","vtkObject","shaderProg","atob","String","fromCharCode","parseLineData","parseMeshData","parsePointData","parseColorMapData","hasTransparency","numberOfIndex","temp","m","vgllines","p","copy","tcoord","vgltriangles","pn","vglVertexes","parseSceneMetadata","bgc","localWidth","localHeight","sceneRenderer","Renderers","LookAt","Background1","initScene","createViewer","deleteViewer","updateCanvas","numObjects","setVtkScene","scene","DataBuffers","initialSize","current","copyArray","dst","src","min_expand","new_size","newArray","len","oldArray","dirty","alloc","num","write","repeat","elem","geo","fileReaders","registerFileReader","func","createFileReader","opts","registerRenderer","createRenderer","registerFeature","category","createFeature","arg","api","extend","registerLayer","layers","createLayer","util","isFunction","f","ensureFunction","m_eventHandlers","m_idleHandlers","m_deferredCount","onIdle","handler","addDeferred","defer","forEach","isArray","args","filter","sceneObject","s_trigger","s_addDeferred","s_onIdle","draw","childrenOnly","geoArgs","_triggeredBy","stopPropagation","ellipsoid","m_radii","m_radiiSquared","m_minimumRadius","m_maximumRadius","radii","radiiSquared","maximumRadius","minimumRadius","computeGeodeticSurfaceNormal","lat","lon","cosLatitude","cos","transformPoint","elev","gamma","scale","add","transformGeometry","sourceDataArray","WGS84","UNIT_SPHERE","mercator","r_major","r_minor","spherical","long2tilex","rad","floor","lat2tiley","long2tilex2","lat2tiley2","tilex2long","tiley2lat","y2lat","lat2y","deg2rad","rad2deg","ll2m","es","eccent","phi","sinphi","con","com","con2","ts","m2ll","pjPhi2","dphi","N_ITER","HALFPI","TOL","eccnth","Phi","latlng","arg1","arg2","m_lat","m_lng","lng","val","layerOptions","showAttribution","newLayerId","currentId","id","m_style","bin","m_id","m_gcs","m_timeRange","m_map","m_isReference","m_initialized","m_rendererName","m_dataTime","m_updateTime","m_drawTime","m_sticky","sticky","gcs","transform","transformLayer","baseLayer","timeRange","append","dataTime","updateTime","drawTime","query","referenceLayer","initialized","toLocal","input","fromLocal","css","_exit","_update","_resize","w","h","featureLayer","m_features","s_init","s_update","s_draw","featureName","newFeature","deleteFeature","_render","curr_zoom","request","opacityUpdate","layerAdd","layerRemove","layerToggle","layerSelect","layerUnselect","animate","drawEnd","animationPause","animationStop","animationComplete","time","incrementTime","setDate","getDate","setMonth","getMonth","setYear","getYear","fileReader","newFileReader","progress","reader","onprogress","error","canRead","read","file","_getString","readAsText","_getArrayBuffer","jsonReader","File","match","_featureArray","_readObject","onDone","fileString","spec","_featureType","_getCoordinates","isFinite","_getStyle","_done","allFeatures","_addFeature","_style","toMillis","calculateGlobalAnimationRange","cloneTimestep","m_pause","m_stop","m_uigcs","uigcs","m_center","m_zoom","m_baseLayer","m_animationState","timestep","m_intervalMap","m_fileReader","milliseconds","seconds","minutes","hours","days","weeks","months","years","deltaLowercase","toLowerCase","deltaUnits","layerTimeRange","layerDelta","indexTimestep","smallestDeltaInMillis","Date","getTime","layerName","newLayer","target","deleteLayer","toggle","gcsToDisplay","world","output","displayToGcs","animationRange","_animate","pauseAnimation","stopAnimation","stepAnimationForward","_stepAnimationForward","stepAnimationBackward","_stepAnimationBackward","renderTimestep","clearInterval","_animateTimestep","nextTimestep","setInterval","each","previousTimestep","readerType","addLayer","evt","dataTransfer","dropEffect","files","m_bin","m_buildTime","drawables","_drawables","buildTime","_build","pointFeature","defaultStyle","stroke","strokeColor","strokeWidth","strokeOpacity","fillColor","fill","fillOpacity","sprites","sprites_image","lineFeature","strokeStyle","pathFeature","polygonFeature","fill_color","planeFeature","ul","lr","m_upperLeft","m_lowerRight","m_defaultDepth","m_drawOnAsyncResourceLoad","drawOnAsyncResourceLoad","upperLeft","lowerRight","geomFeature","point_sprites","point_sprites_image","graphFeature","s_style","m_nodes","m_points","m_links","s_exit","nodes","links","linkType","out","l","nodeFeature","linkFeatures","nLinks","osmTransformFeature","destGcs","inplace","yCoord","pointOffset","inPos","outPos","srcGcs","transformFeature","projPoint","projSrcGcs","proj4","Proj","projDestGcs","Point","osmLayer","transformCoordinates","handleLatLngCoordinates","xAcc","yAcc","writer","handleArrayCoordinates","zAcc","handleObjectCoordinates","xCoord","zCoord","worldToGcs","_connectMouseEvents","getModifiedMapZoom","isTileVisible","tile","m_visibleTilesRange","index_x","startX","endX","index_y","startY","endY","drawTiles","_removeTiles","m_pendingNewTilesStat","m_updateTimerId","updateOSMTiles","m_lastVisibleZoom","_addTiles","m_tiles","m_hiddenBinNumber","m_lastVisibleBinNumber","m_visibleBinNumber","m_pendingNewTiles","m_pendingInactiveTiles","m_numberOfCachedTiles","m_tileCacheSize","m_baseUrl","m_imageFormat","m_updateDefer","baseUrl","imageFormat","tileCacheSize","_hasTile","_addTile","noOfTilesX","noOfTilesY","totalLatDegrees","lonPerTile","latPerTile","llx","lly","urx","ury","Image","LOADING","LOADED","REMOVED","REMOVING","crossOrigin","lastused","currZoom","lastZoom","tileOnLoad","Deferred","updateTimerId","total","resolve","lastStartX","lastStartY","lastEndX","lastEndY","currStartX","currStartY","currEndX","currEndY","tile1x","tile1y","tile2x","tile2y","invJ","worldPt1","worldPt2","onload","_updateTiles","clearTimeout","setTimeout","ggl","contextRenderer","vglRenderer","createGLLines","posFunc","strokeWidthFunc","strokeColorFunc","strokeOpacityFunc","buffers","sourceStokeWidth","sourceStrokeColor","sourceStrokeOpacity","posAttr","stokeWidthAttr","strokeColorAttr","strokeOpacityAttr","item","m_actor","createGLPoints","radFunc","fillColorFunc","fillFunc","strokeFunc","fillOpacityFunc","strokeOpactityFunc","rect","sourceUnits","sourceRadius","sourceFillColor","sourceFill","sourceStroke","sourceAlpha","trianglesPrimitive","unitAttr","radAttr","fillColorAttr","fillAttr","strokeAttr","fillOpacityAttr","pixelWidthUniform","aspectUniform","verts","m_scalar","m_noOfPrimitives","m_onloadCallback","or","img","complete","_draw","mapInteractorStyle","computeZoomLevel","pos","computeCameraDistance","zoomLevel","deg","m_drawRegionLayer","m_clickLatLng","m_focusDisplayPoint","m_middileMouseButtonDown","m_initRightBtnMouseDown","m_drawRegionMode","m_lastMousePos","m_useLastDirection","m_lastDirection","m_picker","m_updateRenderParamsTime","drawRegionMode","_panCamera","mouseWorldPoint","lastWorldPos","currWorldPos","updateRenderParams","_computeCurrentMousePos","displayToMap","setDrawRegion","last_display_pos","curr_display_pos","last_world_pos","curr_world_pos","deltaIsPositive","wheelDeltaY","speed","_syncZoom","clipRange","gap","minGap","_syncReset","_syncPan","zoomOut","newZoomLevel","oldZoomLevel","cameraFp","newPos","clickedWorldPoint","direction","maxZoomedOutDist","maxZoomedOut","last_zoom","lastMousePosition","newPosition","leftMouseDown","newValue","lat1","lon1","lat2","lon2","plane","removeLayer","jQuery","Event","updateDrawRegionEvent","command","getDrawRegion","getCoords","_vglViewerInstance","vglViewerInstance","m_contextRenderer","_connectMapEvents","wheel","onmousewheel","deltaY","deltaMode","detail","gd3","strLength","uniqueID","strArray","random","d3Rescale","_d3id","select","_removeFeature","pos_func","attributes","_convertScale","cx","cy","classes","_drawFeatures","line","d3","svg","diag","diagonal","trg","selection","d3Renderer","setAttrs","attrs","setStyles","styles","returnNone","_convertColor","getMap","getGroup","m_svg","initCorners","m_corners","setTransform","m_scale","baseToLocal","pt","localToBase","rgb","_convertPosition","scaleFactor","dataIndex","exit","selectAll"],"mappings":"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","sourcesContent":["//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\nif(typeof ogs === 'undefined') {\n  var ogs = {};\n}\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create namespace for the given name\n *\n * @param ns_string\n * @returns {*|{}}\n */\n//////////////////////////////////////////////////////////////////////////////\nogs.namespace = function(ns_string) {\n  'use strict';\n\n  var parts = ns_string.split('.'), parent = ogs, i;\n\n  // strip redundant leading global\n  if (parts[0] === \"ogs\") {\n    parts = parts.slice(1);\n  }\n  for (i = 0; i < parts.length; i += 1) {\n    // create a property if it doesn't exist\n    if (typeof parent[parts[i]] === \"undefined\") {\n      parent[parts[i]] = {};\n    }\n    parent = parent[parts[i]];\n  }\n  return parent;\n};\n\n/** vgl namespace */\nvar vgl = ogs.namespace(\"gl\");\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convenient function to define JS inheritance\n *\n * @param C\n * @param P\n */\n//////////////////////////////////////////////////////////////////////////////\nfunction inherit(C, P) {\n  \"use strict\";\n\n  var F = function() {\n  };\n  F.prototype = P.prototype;\n  C.prototype = new F();\n  C.uber = P.prototype;\n  C.prototype.constructor = C;\n}\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convenient function to get size of an object\n *\n * @param obj\n * @returns {number} *\n */\n//////////////////////////////////////////////////////////////////////////////\nObject.size = function(obj) {\n  \"use strict\";\n\n  var size = 0, key = null;\n  for (key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      size++;\n    }\n  }\n  return size;\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2, bitwise: true*/\n\n/*global vgl, gl, ogs, vec3, vec4, mat4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Wrap GL enums. Currently to get values of the enums we need to create\n * or access the context.\n *\n * Using enums from here:\n * https://github.com/toji/dart-gl-enums/blob/master/lib/gl_enums.dart\n *\n * @class\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.GL = {\n   ColorBufferBit : 0x00004000,\n   DepthBufferBit : 0x00000100\n};","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class timestamp\n *\n * @class\n * @returns {vgl.timestamp}\n */\n//////////////////////////////////////////////////////////////////////////////\nvar m_globalModifiedTime = 0;\n\nvgl.timestamp = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.timestamp)) {\n    return new vgl.timestamp();\n  }\n\n  var m_modifiedTime = 0;\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update modified time\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.modified = function() {\n    ++m_globalModifiedTime;\n    m_modifiedTime = m_globalModifiedTime;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get modified time\n   *\n   * @returns {number}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.getMTime = function() {\n    return m_modifiedTime;\n  };\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class object\n *\n * @class\n * @returns {vgl.object}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.object = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.object)) {\n    return new vgl.object();\n  }\n\n  /** @private */\n  var m_modifiedTime = vgl.timestamp();\n  m_modifiedTime.modified();\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Mark the object modified\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.modified = function() {\n    m_modifiedTime.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return modified time of the object\n   *\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getMTime = function() {\n    return m_modifiedTime.getMTime();\n  };\n\n  return this;\n};","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class event\n *\n * @class event\n * @returns {vgl.event}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.event = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.event)) {\n    return new vgl.event();\n  }\n  vgl.object.call(this);\n\n  return this;\n};\n\ninherit(vgl.event, vgl.object);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n *  types\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.event.keyPress = \"vgl.event.keyPress\";\nvgl.event.mousePress = \"vgl.event.mousePress\";\nvgl.event.mouseRelease = \"vgl.event.mouseRelease\";\nvgl.event.contextMenu = \"vgl.event.contextMenu\";\nvgl.event.configure = \"vgl.event.configure\";\nvgl.event.enable = \"vgl.event.enable\";\nvgl.event.mouseWheel = \"vgl.event.mouseWheel\";\nvgl.event.keyRelease = \"vgl.event.keyRelease\";\nvgl.event.middleButtonPress = \"vgl.event.middleButtonPress\";\nvgl.event.startInteraction = \"vgl.event.startInteraction\";\nvgl.event.enter = \"vgl.event.enter\";\nvgl.event.rightButtonPress = \"vgl.event.rightButtonPress\";\nvgl.event.middleButtonRelease = \"vgl.event.middleButtonRelease\";\nvgl.event.char = \"vgl.event.char\";\nvgl.event.disable = \"vgl.event.disable\";\nvgl.event.endInteraction = \"vgl.event.endInteraction\";\nvgl.event.mouseMove = \"vgl.event.mouseMove\";\nvgl.event.mouseOut = \"vgl.event.mouseOut\";\nvgl.event.expose = \"vgl.event.expose\";\nvgl.event.timer = \"vgl.event.timer\";\nvgl.event.leftButtonPress = \"vgl.event.leftButtonPress\";\nvgl.event.leave = \"vgl.event.leave\";\nvgl.event.rightButtonRelease = \"vgl.event.rightButtonRelease\";\nvgl.event.leftButtonRelease = \"vgl.event.leftButtonRelease\";\nvgl.event.click = \"vgl.event.click\";\nvgl.event.dblClick = \"vgl.event.dblClick\";\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class boundingObject\n *\n * @class\n * @return {vgl.boundingObject}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.boundingObject = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.boundingObject)) {\n    return new vgl.boundingObject();\n  }\n  vgl.object.call(this);\n\n  /** @private */\n  var m_bounds = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0],\n      m_computeBoundsTimestamp = vgl.timestamp(),\n      m_boundsDirtyTimestamp = vgl.timestamp();\n\n  m_computeBoundsTimestamp.modified();\n  m_boundsDirtyTimestamp.modified();\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get current bounds of the object\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bounds = function() {\n    return m_bounds;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if bounds are valid\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.hasValidBounds = function(bounds) {\n    if (bounds[0] == Number.MAX_VALUE ||\n        bounds[1] == -Number.MAX_VALUE ||\n        bounds[2] == Number.MAX_VALUE ||\n        bounds[3] == -Number.MAX_VALUE ||\n        bounds[4] == Number.MAX_VALUE ||\n        bounds[5] == -Number.MAX_VALUE)  {\n      return false;\n    }\n\n    return true;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set current bounds of the object\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setBounds = function(minX, maxX, minY, maxY, minZ, maxZ) {\n    if (!this.hasValidBounds([minX, maxX, minY, maxY, minZ, maxZ])) {\n      return;\n    }\n\n    m_bounds[0] = minX;\n    m_bounds[1] = maxX;\n    m_bounds[2] = minY;\n    m_bounds[3] = maxY;\n    m_bounds[4] = minZ;\n    m_bounds[5] = maxZ;\n\n    this.modified();\n    m_computeBoundsTimestamp.modified();\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Reset bounds to default values\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resetBounds = function() {\n    m_bounds[0] = Number.MAX_VALUE;\n    m_bounds[1] = -Number.MAX_VALUE;\n    m_bounds[2] = Number.MAX_VALUE;\n    m_bounds[3] = -Number.MAX_VALUE;\n    m_bounds[4] = Number.MAX_VALUE;\n    m_bounds[5] = -Number.MAX_VALUE;\n\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute bounds of the object\n   *\n   * Should be implemented by the concrete class\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBounds = function() {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return bounds computation modification time\n   *\n   * @returns {vgl.timestamp}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBoundsTimestamp = function() {\n    return m_computeBoundsTimestamp;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return bounds dirty timestamp\n   *\n   * @returns {vgl.timestamp}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.boundsDirtyTimestamp = function() {\n    return m_boundsDirtyTimestamp;\n  };\n\n  this.resetBounds();\n\n  return this;\n};\n\nvgl.boundingObject.ReferenceFrame = {\n  \"Relative\" : 0,\n  \"Absolute\" : 1\n};\n\ninherit(vgl.boundingObject, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class node\n *\n * @class\n * @returns {vgl.node}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.node = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.node)) {\n    return new vgl.node();\n  }\n  vgl.boundingObject.call(this);\n\n  /** @private */\n  var m_parent = null,\n      m_material = null,\n      m_visible = true,\n      m_overlay = false;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Accept visitor for scene traversal\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.accept = function(visitor) {\n    visitor.visit(this);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return active material used by the node\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.material = function() {\n    return m_material;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set material to be used the node\n   *\n   * @param material\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setMaterial = function(material) {\n    if (material !== m_material) {\n      m_material = material;\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if the node is visible or node\n   *\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.visible = function() {\n    return m_visible;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Turn ON/OFF visibility of the node\n   *\n   * @param flag\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setVisible = function(flag) {\n    if (flag !== m_visible) {\n      m_visible = flag;\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return current parent of the node\n   *\n   * @returns {null}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parent = function() {\n    return m_parent;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set parent of the node\n   *\n   * @param parent\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setParent = function(parent) {\n    if (parent !== m_parent) {\n      if (m_parent !== null) {\n        m_parent.removeChild(this);\n      }\n      m_parent = parent;\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if the node is an overlay node\n   *\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.overlay = function() {\n    return m_overlay;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set if the node is an overlay node or not\n   *\n   * @param flag\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setOverlay = function(flag) {\n    if (m_overlay !== flag) {\n      m_overlay = flag;\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /*\n   * Traverse parent and their parent and so on\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.ascend = function(visitor) {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Traverse children\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.traverse = function(visitor) {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Mark that the bounds are modified\n   *\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.boundsModified = function() {\n    // @todo Implement this\n    this.boundsDirtyTimestamp().modified();\n\n    if (m_parent !== null) {\n      m_parent.boundsModified();\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.node, vgl.boundingObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class groupNode\n *\n * @class\n * @returns {vgl.groupNode}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.groupNode = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.groupNode)) {\n    return new vgl.groupNode();\n  }\n  vgl.node.call(this);\n\n  var m_children = [];\n\n  // Reference to base class methods\n  this.b_setVisible = this.setVisible;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Turn on / off visibility\n   *\n   * @param flag\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setVisible = function(flag) {\n    var i;\n\n    if (this.b_setVisible(flag) !== true) {\n      return false;\n    }\n\n    for (i = 0; i < m_children.length; ++i) {\n      m_children[i].setVisible(flag);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Make the incoming node as child of the group node\n   *\n   * @param childNode\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addChild = function(childNode) {\n    if (childNode instanceof vgl.node) {\n      if (m_children.indexOf(childNode) === -1) {\n        childNode.setParent(this);\n        m_children.push(childNode);\n        this.boundsDirtyTimestamp().modified();\n        return true;\n      }\n      return false;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove parent-child relationship between the group and incoming node\n   *\n   * @param childNode\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.removeChild = function(childNode) {\n    if (childNode.parent() === this) {\n      var index = m_children.indexOf(childNode);\n      m_children.splice(index, 1);\n      this.boundsDirtyTimestamp().modified();\n      return true;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove parent-child relationship between child nodes and the group node\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.removeChildren = function() {\n    var i;\n    for (i = 0; i < m_children.length; ++i) {\n      this.removeChild(m_children[i]);\n    }\n\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return children of this group node\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.children = function() {\n    return m_children;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return true if this group node has node as a child, false otherwise.\n   *\n   * @param node\n   * @returns {bool}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.hasChild = function(node) {\n    var i = 0, child = false;\n\n    for (i = 0; i < m_children.length; i++) {\n      if (m_children[i] === node) {\n        child = true;\n        break;\n      }\n    }\n\n    return child;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Accept a visitor and traverse the scene tree\n   *\n   * @param visitor\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.accept = function(visitor) {\n    visitor.visit(this);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Traverse the scene\n   *\n   * @param visitor\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.traverse = function(visitor) {\n    switch (visitor.type()) {\n      case visitor.UpdateVisitor:\n        this.traverseChildrenAndUpdateBounds(visitor);\n        break;\n      case visitor.CullVisitor:\n        this.traverseChildren(visitor);\n        break;\n      default:\n        break;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Traverse all of the children and update the bounds for each\n   *\n   * @param visitor\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.traverseChildrenAndUpdateBounds = function(visitor) {\n    var i;\n\n    if (this.m_parent && this.boundsDirtyTimestamp().getMTime() >\n      this.computeBoundsTimestamp().getMTime()) {\n      // Flag parents bounds dirty.\n      this.m_parent.boundsDirtyTimestamp.modified();\n    }\n\n    this.computeBounds();\n\n    if (visitor.mode() === visitor.TraverseAllChildren) {\n      for (i = 0; i < m_children.length(); ++i) {\n        m_children[i].accept(visitor);\n        this.updateBounds(m_children[i]);\n      }\n    }\n\n    this.computeBoundsTimestamp().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Traverse children of the group node\n   *\n   * @param visitor\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.traverseChildren = function(visitor) {\n    var i;\n\n    if (visitor.mode() === vgl.vesVisitor.TraverseAllChildren) {\n      for (i = 0; i < m_children.length(); ++i) {\n        m_children[i].accept(visitor);\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute bounds for the group node\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBounds = function() {\n    var i = 0;\n\n    if (this.computeBoundsTimestamp().getMTime() >\n        this.boundsDirtyTimestamp().getMTime()) {\n      return;\n    }\n\n    for (i = 0; i < m_children.length; ++i) {\n      this.updateBounds(m_children[i]);\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update bounds for the group node\n   *\n   * This method is used internally to update bounds of the group node by\n   * traversing each of its child.\n   *\n   * @param child\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.updateBounds = function(child) {\n    // FIXME: This check should not be required and possibly is incorrect\n    if (child.overlay()) {\n      return;\n    }\n\n    // Make sure that child bounds are upto date\n    child.computeBounds();\n\n    var bounds = this.bounds(),\n        childBounds = child.bounds(),\n        istep = 0,\n        jstep = 0,\n        i;\n\n    for (i = 0; i < 3; ++i) {\n      istep = i * 2;\n      jstep = i * 2 + 1;\n      if (childBounds[istep] < bounds[istep]) {\n        bounds[istep] = childBounds[istep];\n      }\n      if (childBounds[jstep] > bounds[jstep]) {\n        bounds[jstep] = childBounds[jstep];\n      }\n    }\n\n    this.setBounds(bounds[0], bounds[1], bounds[2], bounds[3],\n                   bounds[4], bounds[5]);\n  };\n\n  return this;\n};\n\ninherit(vgl.groupNode, vgl.node);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec3, vec4, mat4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class actor\n *\n * @class\n * @returns {vgl.actor}\n */\n////////////////////////////////////////////////////////////////////////////\nvgl.actor = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.actor)) {\n    return new vgl.actor();\n  }\n  vgl.node.call(this);\n\n  /** @private */\n  var m_transformMatrix = mat4.create(),\n      m_referenceFrame = vgl.boundingObject.ReferenceFrame.Relative,\n      m_mapper = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get transformation matrix used by the actor\n   *\n   * @returns {mat4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.matrix = function() {\n    return m_transformMatrix;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set transformation matrix for the actor\n   *\n   * @param {mat4} 4X4 transformation matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setMatrix = function(tmatrix) {\n    if (tmatrix !== m_transformMatrix) {\n      m_transformMatrix = tmatrix;\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get reference frame for the transformations\n   *\n   * @returns {String} Possible values are Absolute or Relative\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.referenceFrame = function() {\n    return m_referenceFrame;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set reference frame for the transformations\n   *\n   * @param {vgl.boundingObject.ReferenceFrame}\n   * referenceFrame Possible values are (Absolute | Relative)\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setReferenceFrame = function(referenceFrame) {\n    if (referenceFrame !== m_referenceFrame) {\n      m_referenceFrame = referenceFrame;\n      this.modified();\n      return true;\n    }\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return mapper where actor gets it behavior and data\n   *\n   * @returns {vgl.mapper}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.mapper = function() {\n    return m_mapper;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Connect an actor to its data source\n   *\n   * @param {vgl.mapper}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setMapper = function(mapper) {\n    if (mapper !== m_mapper) {\n      m_mapper = mapper;\n      this.boundsModified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @todo\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.accept = function(visitor) {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @todo\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.ascend = function(visitor) {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute object space to world space matrix\n   * @todo\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeLocalToWorldMatrix = function(matrix, visitor) {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute world space to object space matrix\n   * @todo\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeWorldToLocalMatrix = function(matrix, visitor) {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute actor bounds\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBounds = function() {\n    if (m_mapper === null || m_mapper === undefined) {\n      this.resetBounds();\n      return;\n    }\n\n    var computeBoundsTimestamp = this.computeBoundsTimestamp(),\n        mapperBounds, minPt, maxPt, actorMatrix, newBounds;\n\n    if (this.boundsDirtyTimestamp().getMTime() > computeBoundsTimestamp.getMTime() ||\n      m_mapper.boundsDirtyTimestamp().getMTime() > computeBoundsTimestamp.getMTime()) {\n\n      m_mapper.computeBounds();\n      mapperBounds = m_mapper.bounds();\n\n      minPt = [mapperBounds[0], mapperBounds[2], mapperBounds[4]];\n      maxPt = [mapperBounds[1], mapperBounds[3], mapperBounds[5]];\n\n      vec3.transformMat4(minPt, minPt, m_transformMatrix);\n      vec3.transformMat4(maxPt, maxPt, m_transformMatrix);\n\n      newBounds = [\n        minPt[0] > maxPt[0] ? maxPt[0] : minPt[0],\n        minPt[0] > maxPt[0] ? minPt[0] : maxPt[0],\n        minPt[1] > maxPt[1] ? maxPt[1] : minPt[1],\n        minPt[1] > maxPt[1] ? minPt[1] : maxPt[1],\n        minPt[2] > maxPt[2] ? maxPt[2] : minPt[2],\n        minPt[2] > maxPt[2] ? minPt[2] : maxPt[2]\n      ];\n\n      this.setBounds(newBounds[0], newBounds[1],\n                     newBounds[2], newBounds[3],\n                     newBounds[4], newBounds[5]);\n\n      computeBoundsTimestamp.modified();\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.actor, vgl.node);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Freeze javascript object\n *\n * @param obj\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.freezeObject = function(obj) {\n  'use strict';\n\n  /**\n   * Freezes an object, using Object.freeze if available, otherwise returns\n   * the object unchanged.  This function should be used in setup code to prevent\n   * errors from completely halting JavaScript execution in legacy browsers.\n   *\n   * @exports freezeObject\n   */\n  var freezedObject = Object.freeze(obj);\n  if (typeof freezedObject === 'undefined') {\n    freezedObject = function(o) {\n      return o;\n    };\n  }\n\n  return freezedObject;\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Returns the first parameter if not undefined,\n * otherwise the second parameter.\n *\n * @class\n * @returns {vgl.defaultValue}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.defaultValue = function(a, b) {\n  'use strict';\n\n  if (typeof a !== 'undefined') {\n    return a;\n  }\n  return b;\n};\n\nvgl.defaultValue.EMPTY_OBJECT = vgl.freezeObject({});\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $, Uint16Array*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of geojson reader\n *\n * This contains code that reads a geoJSON file and produces rendering\n * primitives from it.\n *\n * @class\n * @returns {vgl.geojsonReader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.geojsonReader = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.geojsonReader)) {\n    return new vgl.geojsonReader();\n  }\n\n  var m_scalarFormat = \"none\",\n      m_scalarRange = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read scalars\n   *\n   * @param coordinates\n   * @param geom\n   * @param size_estimate\n   * @param idx\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readScalars = function(coordinates, geom, size_estimate, idx) {\n    var array = null,\n        s = null,\n        r  = null,\n        g = null,\n        b = null;\n\n    if (this.m_scalarFormat === \"values\" && coordinates.length === 4)\n    {\n      s = coordinates[3];\n      array = geom.sourceData(vgl.vertexAttributeKeys.Scalar);\n\n      if (!array) {\n        array = new vgl.sourceDataSf();\n        if (this.m_scalarRange) {\n          array.setScalarRange(this.m_scalarRange[0],this.m_scalarRange[1]);\n        }\n        if (size_estimate !== undefined) {\n          //array.length = size_estimate; //no, slow on Safari\n          array.data().length = size_estimate;\n        }\n        geom.addSource(array);\n      }\n      if (size_estimate === undefined) {\n        array.pushBack(s);\n      } else {\n        array.insertAt(idx, s);\n      }\n    } else if (this.m_scalarFormat === \"rgb\" && coordinates.length === 6) {\n      array = geom.sourceData(vgl.vertexAttributeKeys.Color);\n      if (!array) {\n        array = new vgl.sourceDataC3fv();\n        if (size_estimate !== undefined) {\n          array.length = size_estimate*3;\n        }\n        geom.addSource(array);\n      }\n      r = coordinates[3];\n      g = coordinates[4];\n      b = coordinates[5];\n      if (size_estimate === undefined) {\n        array.pushBack([r,g,b]);\n      } else {\n        array.insertAt(idx, [r,g,b]);\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read point data\n   *\n   * @param coordinates\n   * @returns {vgl.geometryData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readPoint = function(coordinates) {\n    var geom = new vgl.geometryData(),\n        vglpoints = new vgl.points(),\n        vglcoords = new vgl.sourceDataP3fv(),\n        indices = new Uint16Array(1),\n        x = null,\n        y = null,\n        z = null,\n        i = null;\n\n    geom.addSource(vglcoords);\n    for (i = 0; i < 1; i++) {\n      indices[i] = i;\n\n      x = coordinates[0];\n      y = coordinates[1];\n      z = 0.0;\n      if (coordinates.length>2) {\n        z = coordinates[2];\n      }\n\n      //console.log(\"read \" + x + \",\" + y + \",\" + z);\n      vglcoords.pushBack([x,y,z]);\n\n      //attributes\n      this.readScalars(coordinates, geom);\n    }\n\n    vglpoints.setIndices(indices);\n    geom.addPrimitive(vglpoints);\n    geom.setName(\"aPoint\");\n    return geom;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read multipoint data\n   *\n   * @param coordinates\n   * @returns {vgl.geometryData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readMultiPoint = function(coordinates) {\n    var geom = new vgl.geometryData(),\n        vglpoints = new vgl.points(),\n        vglcoords = new vgl.sourceDataP3fv(),\n        indices = new Uint16Array(coordinates.length),\n        pntcnt = 0,\n        estpntcnt = coordinates.length,\n        x = null,\n        y = null,\n        z = null,\n        i;\n\n    //preallocate with size estimate\n    vglcoords.data().length = estpntcnt * 3; //x,y,z\n\n    for (i = 0; i < coordinates.length; i++) {\n      indices[i] = i;\n      x = coordinates[i][0];\n      y = coordinates[i][1];\n      z = 0.0;\n      if (coordinates[i].length>2) {\n        z = coordinates[i][2];\n      }\n\n      //console.log(\"read \" + x + \",\" + y + \",\" + z);\n      vglcoords.insertAt(pntcnt, [x,y,z]);\n\n      //attributes\n      this.readScalars(coordinates[i], geom, estpntcnt, pntcnt);\n\n      pntcnt++;\n    }\n\n    vglpoints.setIndices(indices);\n    geom.addPrimitive(vglpoints);\n    geom.addSource(vglcoords);\n    geom.setName(\"manyPoints\");\n    return geom;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read line string data\n   *\n   * @param coordinates\n   * @returns {vgl.geometryData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readLineString = function(coordinates) {\n    var geom = new vgl.geometryData(),\n        vglline = new vgl.lineStrip(),\n        vglcoords = new vgl.sourceDataP3fv(),\n        indices = [],\n        i = null,\n        x = null,\n        y = null,\n        z = null;\n\n    vglline.setIndicesPerPrimitive(coordinates.length);\n\n    for (i = 0; i < coordinates.length; i++) {\n      indices.push(i);\n      x = coordinates[i][0];\n      y = coordinates[i][1];\n      z = 0.0;\n      if (coordinates[i].length>2) {\n        z = coordinates[i][2];\n      }\n\n      //console.log(\"read \" + x + \",\" + y + \",\" + z);\n      vglcoords.pushBack([x,y,z]);\n\n      //attributes\n      this.readScalars(coordinates[i], geom);\n    }\n\n    vglline.setIndices(indices);\n    geom.addPrimitive(vglline);\n    geom.addSource(vglcoords);\n    geom.setName(\"aLineString\");\n    return geom;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read multi line string\n   *\n   * @param coordinates\n   * @returns {vgl.geometryData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readMultiLineString = function(coordinates) {\n    var geom = new vgl.geometryData(),\n        vglcoords = new vgl.sourceDataP3fv(),\n        pntcnt = 0,\n        //lines should be at least 2 verts long, underest OK\n        estpntcnt = coordinates.length * 2,\n        i = null,\n        j = null,\n        x = null,\n        y = null,\n        z = null,\n        indices = null,\n        vglline = null,\n        thisLineLength = null;\n\n    // Preallocate with size estimate\n    vglcoords.data().length = estpntcnt*3; //x,y,z\n\n    for (j = 0; j < coordinates.length; j++) {\n      indices = [];\n      //console.log(\"getting line \" + j);\n      vglline = new vgl.lineStrip();\n      thisLineLength = coordinates[j].length;\n      vglline.setIndicesPerPrimitive(thisLineLength);\n      for (i = 0; i < thisLineLength; i++) {\n        indices.push(pntcnt);\n        x = coordinates[j][i][0];\n        y = coordinates[j][i][1];\n        z = 0.0;\n        if (coordinates[j][i].length>2) {\n          z = coordinates[j][i][2];\n        }\n\n        //console.log(\"read \" + x + \",\" + y + \",\" + z);\n        vglcoords.insertAt(pntcnt, [x,y,z]);\n\n        //attributes\n        this.readScalars(coordinates[j][i], geom, estpntcnt*2, pntcnt);\n\n        pntcnt++;\n      }\n\n      vglline.setIndices(indices);\n      geom.addPrimitive(vglline);\n    }\n\n    geom.setName(\"aMultiLineString\");\n    geom.addSource(vglcoords);\n    return geom;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read polygon data\n   *\n   * @param coordinates\n   * @returns {vgl.geometryData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readPolygon = function(coordinates) {\n    //TODO: ignoring holes given in coordinates[1...]\n    //TODO: ignoring convex\n    //TODO: implement ear clipping in VGL instead of this to handle both\n    var geom = new vgl.geometryData(),\n        vglcoords = new vgl.sourceDataP3fv(),\n        x = null,\n        y = null,\n        z  = null,\n        thisPolyLength = coordinates[0].length,\n        vl = 1,\n        i = null,\n        indices = null,\n        vgltriangle = null;\n\n\n    for (i = 0; i < thisPolyLength; i++) {\n      x = coordinates[0][i][0];\n      y = coordinates[0][i][1];\n      z = 0.0;\n      if (coordinates[0][i].length>2) {\n        z = coordinates[0][i][2];\n      }\n\n      //console.log(\"read \" + x + \",\" + y + \",\" + z);\n      vglcoords.pushBack([x,y,z]);\n\n      //attributes\n      this.readScalars(coordinates[0][i], geom);\n\n      if (i > 1) {\n        //console.log(\"Cutting new triangle 0,\"+ vl+ \",\"+ i);\n        indices = new Uint16Array([0,vl,i]);\n        vgltriangle = new vgl.triangles();\n        vgltriangle.setIndices(indices);\n        geom.addPrimitive(vgltriangle);\n        vl = i;\n      }\n    }\n\n    geom.setName(\"POLY\");\n    geom.addSource(vglcoords);\n    return geom;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read multi polygon data\n   *\n   * @param coordinates\n   * @returns {vgl.geometryData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readMultiPolygon = function(coordinates) {\n    var geom = new vgl.geometryData(),\n        vglcoords = new vgl.sourceDataP3fv(),\n        ccount = 0,\n        numPolys = coordinates.length,\n        pntcnt = 0,\n        estpntcnt = numPolys* 3, // assume triangles, underest is fine\n        vgltriangle = new vgl.triangles(),\n        indexes = [],\n        i = null,\n        j = null,\n        x = null,\n        y = null,\n        z  = null,\n        thisPolyLength = null,\n        vf = null,\n        vl = null,\n        flip = null,\n        flipped = false,\n        tcount = 0;\n\n\n    //var time1 = new Date().getTime()\n    //var a = 0;\n    //var b = 0;\n    //var c = 0;\n    //var d = 0;\n\n    //preallocate with size estimate\n    vglcoords.data().length = numPolys*3; //x,y,z\n    for (j = 0; j < numPolys; j++) {\n      //console.log(\"getting poly \" + j);\n\n      thisPolyLength = coordinates[j][0].length;\n      vf = ccount;\n      vl = ccount+1;\n      flip = [false,false,false];\n      for (i = 0; i < thisPolyLength; i++) {\n        //var timea = new Date().getTime()\n\n        x = coordinates[j][0][i][0];\n        y = coordinates[j][0][i][1];\n        z = 0.0;\n        if (coordinates[j][0][i].length>2) {\n          z = coordinates[j][0][i][2];\n        }\n        flipped = false;\n        if (x > 180) {\n          flipped = true;\n          x = x - 360;\n        }\n        if (i === 0) {\n          flip[0] = flipped;\n        } else {\n          flip[1+(i-1)%2] = flipped;\n        }\n        //var timeb = new Date().getTime();\n        //console.log(\"read \" + x + \",\" + y + \",\" + z);\n\n        vglcoords.insertAt(pntcnt, [x,y,z]);\n        //var timec = new Date().getTime();\n\n        //attributes\n        this.readScalars(coordinates[j][0][i], geom, estpntcnt, pntcnt);\n        pntcnt++;\n        //var timed = new Date().getTime()\n\n        if (i > 1) {\n          //if (vl < 50) {\n            //console.log(\"Cutting new triangle \" + tcount + \":\" + vf + \",\" + vl + \",\" + ccount);\n            //console.log(indexes);\n          //}\n          if (flip[0] === flip[1] && flip[1] === flip[2]) {\n              //indexes = indexes.concat([vf,vl,ccount]); //no, very slow in Safari\n              indexes[tcount*3+0] = vf\n              indexes[tcount*3+1] = vl\n              indexes[tcount*3+2] = ccount\n              tcount++;\n          }\n          //else {\n          //  //TODO: duplicate triangles that straddle boundary on either side\n          //}\n\n          vl = ccount;\n        }\n        ccount++;\n        //var timee = new Date().getTime()\n        //a = a + (timeb-timea)\n        //b = b + (timec-timeb)\n        //c = c + (timed-timec)\n        //d = d + (timee-timed)\n      }\n    }\n    vgltriangle.setIndices(indexes);\n    geom.addPrimitive(vgltriangle);\n\n    //console.log(\"NUMPOLYS \" + pntcnt);\n    //console.log(\"RMP: \", a, \",\", b, \",\", c, \",\", d)\n    //var time2 = new Date().getTime()\n\n    geom.setName(\"aMultiPoly\");\n    geom.addSource(vglcoords);\n    //var time3 = new Date().getTime()\n    //console.log(\"RMP: \", time2-time1, \",\", time3-time2)\n\n    return geom;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @param object\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readGJObjectInt = function(object) {\n    if (!object.hasOwnProperty('type')) {\n      //console.log(\"uh oh, not a geojson object\");\n      return null;\n    }\n\n    //look for properties type annotation\n    if (object.properties &&\n        object.properties.ScalarFormat &&\n        object.properties.ScalarFormat === \"values\") {\n      this.m_scalarFormat = \"values\";\n      if (object.properties.ScalarRange) {\n        this.m_scalarRange = object.properties.ScalarRange;\n      }\n    }\n    if (object.properties &&\n        object.properties.ScalarFormat &&\n        object.properties.ScalarFormat === \"rgb\") {\n      this.m_scalarFormat = \"rgb\";\n    }\n\n    //TODO: ignoring \"crs\" and \"bbox\" and misc meta data on all of these,\n    //best to handle as references into original probably\n    var ret,\n        type = object.type,\n        next = null,\n        nextset = null,\n        i = null;\n\n    switch (type) {\n      case \"Point\":\n        //console.log(\"parsed Point\");\n        ret = this.readPoint(object.coordinates);\n        break;\n      case \"MultiPoint\":\n        //console.log(\"parsed MultiPoint\");\n        ret = this.readMultiPoint(object.coordinates);\n        break;\n      case \"LineString\":\n        //console.log(\"parsed LineString\");\n        ret = this.readLineString(object.coordinates);\n        break;\n      case \"MultiLineString\":\n        //console.log(\"parsed MultiLineString\");\n        ret = this.readMultiLineString(object.coordinates);\n        break;\n      case \"Polygon\":\n        //console.log(\"parsed Polygon\");\n        ret = this.readPolygon(object.coordinates);\n        break;\n      case \"MultiPolygon\":\n        //console.log(\"parsed MultiPolygon\");\n        ret = this.readMultiPolygon(object.coordinates);\n        break;\n      case \"GeometryCollection\":\n        //console.log(\"parsed GeometryCollection\");\n        nextset = [];\n        for (i = 0; i < object.geometries.length; i++) {\n          next = this.readGJObject(object.geometries[i]);\n          nextset.push(next);\n        }\n        ret = nextset;\n        break;\n      case \"Feature\":\n        //console.log(\"parsed Feature\");\n        next = this.readGJObject(object.geometry);\n        ret = next;\n        break;\n      case \"FeatureCollection\":\n        //console.log(\"parsed FeatureCollection\");\n        nextset = [];\n        for (i = 0; i < object.features.length; i++) {\n          next = this.readGJObject(object.features[i]);\n          nextset.push(next);\n        }\n        ret = nextset;\n        break;\n      default:\n        console.log(\"Don't understand type \" + type);\n        ret = null;\n      break;\n    }\n    return ret;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @param object\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readGJObject = function(object) {\n    //var time1, time2;\n    var ret;\n    //time1 = new Date().getTime()\n    ret = this.readGJObjectInt(object);\n    //time2 = new Date().getTime()\n    //console.log(\"ELAPSED: \", time2-time1)\n    return ret;\n  };\n\n  /**\n   * Linearize geometries\n   *\n   * @param geoms\n   * @param geom\n   */\n  this.linearizeGeoms = function(geoms, geom) {\n    var i = null;\n\n    if( Object.prototype.toString.call( geom ) === '[object Array]' ) {\n      for (i = 0; i < geom.length; i++) {\n        this.linearizeGeoms(geoms, geom[i]);\n      }\n    }\n    else {\n     geoms.push(geom);\n   }\n };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Read geometries from geojson object\n   *\n   * @param object\n   * @returns {Array}\n   */\n ////////////////////////////////////////////////////////////////////////////\n this.readGeomObject = function(object) {\n    var geom,\n        geoms = [];\n\n    geom = this.readGJObject(object);\n    this.linearizeGeoms(geoms, geom);\n    return geoms;\n };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Given a buffer get rendering primitives\n   *\n   * @param buffer\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getPrimitives = function(buffer) {\n    //console.log(\"Parsing geoJSON\");\n    if (!buffer) {\n      return [];\n    }\n\n    var obj = JSON.parse(buffer),\n      geom = this.readGJObject(obj),\n      geoms = [];\n\n    this.m_scalarFormat = \"none\";\n    this.m_scalarRange = null;\n\n    this.linearizeGeoms(geoms, geom);\n\n    return { \"geoms\":geoms,\n             \"scalarFormat\":this.m_scalarFormat,\n             \"scalarRange\":this.m_scalarRange };\n  };\n\n  return this;\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\nvgl.data = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.data)) {\n    return new vgl.data();\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return data type. Should be implemented by the derived class\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.type = function() {\n  };\n};\n\nvgl.data.raster = 0;\nvgl.data.point = 1;\nvgl.data.lineString = 2;\nvgl.data.polygon = 3;\nvgl.data.geometry = 10;","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, Uint16Array, gl, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Vertex attribute keys\n *\n * @type {{Position: number, Normal: number, TextureCoordinate: number,\n *         Color: number, Scalar: number}}\n */\n//////////////////////////////////////////////////////////////////////////////\nvar vertexAttributeKeys = {\n  \"Position\" : 0,\n  \"Normal\" : 1,\n  \"TextureCoordinate\" : 2,\n  \"Color\" : 3,\n  \"Scalar\" : 4\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class primitive\n *\n * @class\n * @return {vgl.primitive}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.primitive = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.primitive)) {\n    return new vgl.primitive();\n  }\n\n  /** @private */\n  var m_indicesPerPrimitive = 0,\n      m_primitiveType = 0,\n      m_indicesValueType = 0,\n      m_indices = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get indices of the primitive\n   *\n   * @returns {null}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.indices = function() {\n    return m_indices;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create indices array for the primitive\n   * @param type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.createIndices = function(type) {\n    // TODO Check for the type\n    m_indices = new Uint16Array();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the number of indices\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.numberOfIndices = function() {\n    return m_indices.length;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return size of indices in bytes\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.sizeInBytes = function() {\n    return m_indices.length * Uint16Array.BYTES_PER_ELEMENT;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /*\n   * Return primitive type g\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.primitiveType = function() {\n    return m_primitiveType;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set primitive type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setPrimitiveType = function(type) {\n    m_primitiveType = type;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return count of indices that form a primitives\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.indicesPerPrimitive = function() {\n    return m_indicesPerPrimitive;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set count of indices that form a primitive\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setIndicesPerPrimitive = function(count) {\n    m_indicesPerPrimitive = count;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return indices value type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.indicesValueType = function() {\n    return m_indicesValueType;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set indices value type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setIndicesValueType = function(type) {\n    m_indicesValueType = type;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set indices from a array\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setIndices = function(indicesArray) {\n    // TODO Check for the type\n    m_indices = new Uint16Array(indicesArray);\n  };\n\n  return this;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class triangleStrip\n *\n * @returns {vgl.triangleStrip}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.triangleStrip = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.triangleStrip)) {\n    return new vgl.triangleStrip();\n  }\n\n  vgl.primitive.call(this);\n\n  this.setPrimitiveType(gl.TRIANGLE_STRIP);\n  this.setIndicesValueType(gl.UNSIGNED_SHORT);\n  this.setIndicesPerPrimitive(3);\n\n  return this;\n};\n\ninherit(vgl.triangleStrip, vgl.primitive);\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class triangles\n *\n * @returns {vgl.triangles}\n */\n////////////////////////////////////////////////////////////////////////////\nvgl.triangles = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.triangles)) {\n    return new vgl.triangles();\n  }\n  vgl.primitive.call(this);\n\n  this.setPrimitiveType(gl.TRIANGLES);\n  this.setIndicesValueType(gl.UNSIGNED_SHORT);\n  this.setIndicesPerPrimitive(3);\n\n  return this;\n};\n\ninherit(vgl.triangles, vgl.primitive);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * create a instance of lines primitive type\n *\n * @returns {vgl.lines}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.lines = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.lines)) {\n    return new vgl.lines();\n  }\n  vgl.primitive.call(this);\n\n  this.setPrimitiveType(gl.LINES);\n  this.setIndicesValueType(gl.UNSIGNED_SHORT);\n  this.setIndicesPerPrimitive(2);\n\n  return this;\n};\ninherit(vgl.lines, vgl.primitive);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * create a instance of line strip primitive type\n *\n * @returns {vgl.lineStrip}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.lineStrip = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.lineStrip)) {\n    return new vgl.lineStrip();\n  }\n  vgl.primitive.call(this);\n\n  this.setPrimitiveType(gl.LINE_STRIP);\n  this.setIndicesValueType(gl.UNSIGNED_SHORT);\n  this.setIndicesPerPrimitive(2);\n\n  return this;\n};\ninherit(vgl.lineStrip, vgl.primitive);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class points\n *\n * @returns {vgl.points}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.points = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.points)) {\n    return new vgl.points();\n  }\n  vgl.primitive.call(this);\n\n  this.setPrimitiveType(gl.POINTS);\n  this.setIndicesValueType(gl.UNSIGNED_SHORT);\n  this.setIndicesPerPrimitive(1);\n\n  return this;\n};\n\ninherit(vgl.points, vgl.primitive);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class vertexDataP3f\n *\n * @returns {vgl.vertexDataP3f}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.vertexDataP3f = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.vertexDataP3f)) {\n    return new vgl.vertexDataP3f();\n  }\n\n  /** @private */\n  this.m_position = [];\n\n  return this;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class vertexDataP3N3f\n *\n * @class\n * @returns {vgl.vertexDataP3N3f}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.vertexDataP3N3f = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.vertexDataP3N3f)) {\n    return new vgl.vertexDataP3N3f();\n  }\n\n  this.m_position = [];\n  this.m_normal = [];\n\n  return this;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class vertexDataP3T3f\n *\n * @class\n * @returns {vgl.vertexDataP3T3f}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.vertexDataP3T3f = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.vertexDataP3T3f)) {\n    return new vgl.vertexDataP3T3f();\n  }\n\n  this.m_position = [];\n  this.m_texCoordinate = [];\n\n  return this;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceData\n * @class\n * @returns {vgl.sourceData}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceData = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceData)) {\n    return new vgl.sourceData();\n  }\n\n  var m_attributesMap = {},\n      m_data = [],\n\n      ////////////////////////////////////////////////////////////////////////////\n      /**\n       * Attribute data for the source\n       */\n      ////////////////////////////////////////////////////////////////////////////\n      vglAttributeData = function() {\n        // Number of components per group\n        // Type of data type (GL_FLOAT etc)\n        this.m_numberOfComponents = 0;\n            // Size of data type\n        this.m_dataType = 0;\n        this.m_dataTypeSize = 0;\n        // Specifies whether fixed-point data values should be normalized\n        // (true) or converted directly as fixed-point values (false)\n        // when they are accessed.\n        this.m_normalized = false;\n        // Strides for each attribute.\n        this.m_stride = 0;\n        // Offset\n        this.m_offset = 0;\n      };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return raw data for this source\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.data = function() {\n    return m_data;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n /**\n   * Return raw data for this source\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getData = function() {\n    return data();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set data for this source\n   *\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setData = function(data) {\n    if (!(data instanceof Array)) {\n      console.log(\"[error] Requires array\");\n      return;\n    }\n    m_data = data.slice(0);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add new attribute data to the source\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addAttribute = function(key, dataType, sizeOfDataType, offset, stride,\n                               noOfComponents, normalized) {\n\n    if (!m_attributesMap.hasOwnProperty(key)) {\n      var newAttr = new vglAttributeData();\n      newAttr.m_dataType = dataType;\n      newAttr.m_dataTypeSize = sizeOfDataType;\n      newAttr.m_offset = offset;\n      newAttr.m_stride = stride;\n      newAttr.m_numberOfComponents = noOfComponents;\n      newAttr.m_normalized = normalized;\n      m_attributesMap[key] = newAttr;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return size of the source data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.sizeOfArray = function() {\n    return Object.size(m_data);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return length of array\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.lengthOfArray = function() {\n    return m_data.length;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return size of the source data in bytes\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  /*\n    * TODO: code below is probably wrong.\n    *   Example:\n    *            format P3N3f\n    *            m_data = [ 1, 2, 3, 4, 5, 6 ]; // contains one vertex, one normal, m_data.length == 6\n    *\n    *       The inner loop computes:\n    *             sizeInBytes += 3 * 4; // for position\n    *             sizeInBytes += 3 * 4; // for normal\n    *\n    *        Then sizeInBytes *= 6; // m_data.length == 6\n    *        which gives sizeInBytes == 144 bytes when it should have been 4*6 = 24\n    */\n  this.sizeInBytes = function() {\n    var sizeInBytes = 0,\n        keys = this.keys(), i;\n\n    for (i = 0; i < keys.length(); ++i) {\n      sizeInBytes += this.numberOfComponents(keys[i])\n                     * this.sizeOfAttributeDataType(keys[i]);\n    }\n\n    sizeInBytes *= this.sizeOfArray();\n\n    return sizeInBytes;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if there is attribute exists of a given key type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.hasKey = function(key) {\n    return m_attributesMap.hasOwnProperty(key);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return keys of all attributes\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.keys = function() {\n    return Object.keys(m_attributesMap);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return number of attributes of source data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.numberOfAttributes = function() {\n    return Object.size(m_attributesMap);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return number of components of the attribute data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.attributeNumberOfComponents = function(key) {\n    if (m_attributesMap.hasOwnProperty(key)) {\n      return m_attributesMap[key].m_numberOfComponents;\n    }\n\n    return 0;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return if the attribute data is normalized\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.normalized = function(key) {\n    if (m_attributesMap.hasOwnProperty(key)) {\n      return m_attributesMap[key].m_normalized;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return size of the attribute data type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.sizeOfAttributeDataType = function(key) {\n    if (m_attributesMap.hasOwnProperty(key)) {\n      return m_attributesMap[key].m_dataTypeSize;\n    }\n\n    return 0;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return attribute data type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.attributeDataType = function(key) {\n    if (m_attributesMap.hasOwnProperty(key)) {\n      return m_attributesMap[key].m_dataType;\n    }\n\n    return undefined;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return attribute offset\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.attributeOffset = function(key) {\n    if (m_attributesMap.hasOwnProperty(key)) {\n      return m_attributesMap[key].m_offset;\n    }\n\n    return 0;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return attribute stride\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.attributeStride = function(key) {\n    if (m_attributesMap.hasOwnProperty(key)) {\n      return m_attributesMap[key].m_stride;\n    }\n\n    return 0;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Virtual function to insert new vertex data at the end\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.pushBack = function(vertexData) {\n    // Should be implemented by the base class\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Insert new data block to the raw data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.insert = function(data) {\n    var i;\n\n    //m_data = m_data.concat(data); //no, slow on Safari\n    if (!data.length) {\n      m_data[m_data.length] = data;\n    } else {\n      for (i = 0; i < data.length; i++) {\n        m_data[m_data.length] = data[i];\n      }\n    }\n  };\n\n  this.insertAt = function(index, data) {\n    var i;\n\n    if (!data.length) {\n      m_data[index] = data;\n    } else {\n      for (i = 0; i < data.length; i++) {\n        m_data[index*data.length+i] = data[i];\n      }\n    }\n  };\n\n  return this;\n};\n\n\nvgl.sourceDataAnyfv = function(size, key) {\n  if (!(this instanceof vgl.sourceDataAnyfv)) {\n      return new vgl.sourceDataAnyfv(size, key);\n    }\n\n    vgl.sourceData.call(this);\n    this.addAttribute(key, gl.FLOAT,\n                      4, 0, size * 4, size, false);\n\n    this.pushBack = function(value) {\n      this.insert(value);\n    };\n\n    return this;\n};\ninherit(vgl.sourceDataAnyfv, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataP3T3f\n *\n * @returns {vgl.sourceDataP3T3f}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataP3T3f = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataP3T3f)) {\n    return new vgl.sourceDataP3T3f();\n  }\n  vgl.sourceData.call(this);\n\n  this.addAttribute(vgl.vertexAttributeKeys.Position, gl.FLOAT, 4, 0, 6 * 4, 3,\n                    false);\n  this.addAttribute(vgl.vertexAttributeKeys.TextureCoordinate, gl.FLOAT, 4, 12,\n                    6 * 4, 3, false);\n\n  this.pushBack = function(value) {\n    this.insert(value.m_position);\n    this.insert(value.m_texCoordinate);\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataP3T3f, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataP3N3f\n *\n * @returns {vgl.sourceDataP3N3f}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataP3N3f = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataP3N3f)) {\n    return new vgl.sourceDataP3N3f();\n  }\n\n  vgl.sourceData.call(this);\n\n  this.addAttribute(vgl.vertexAttributeKeys.Position, gl.FLOAT, 4, 0, 6 * 4, 3,\n                    false);\n  this.addAttribute(vgl.vertexAttributeKeys.Normal, gl.FLOAT, 4, 12, 6 * 4, 3,\n                    false);\n\n  this.pushBack = function(value) {\n    this.insert(value.m_position);\n    this.insert(value.m_normal);\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataP3N3f, vgl.sourceData);\n\n/////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataP3fv\n *\n * @returns {vgl.sourceDataP3fv}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataP3fv = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataP3fv)) {\n    return new vgl.sourceDataP3fv();\n  }\n\n  vgl.sourceData.call(this);\n\n  this.addAttribute(vgl.vertexAttributeKeys.Position, gl.FLOAT, 4, 0, 3 * 4, 3,\n                    false);\n\n  this.pushBack = function(value) {\n    this.insert(value);\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataP3fv, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataT2fv\n *\n * @returns {vgl.sourceDataT2fv}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataT2fv = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataT2fv)) {\n    return new vgl.sourceDataT2fv();\n  }\n\n  vgl.sourceData.call(this);\n\n  this.addAttribute(vgl.vertexAttributeKeys.TextureCoordinate, gl.FLOAT, 4, 0,\n                    2 * 4, 2, false);\n\n  this.pushBack = function(value) {\n    this.insert(value);\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataT2fv, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataC3fv\n *\n * @returns {vgl.sourceDataC3fv}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataC3fv = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataC3fv)) {\n    return new vgl.sourceDataC3fv();\n  }\n\n  vgl.sourceData.call(this);\n\n  this.addAttribute(vgl.vertexAttributeKeys.Color, gl.FLOAT, 4, 0, 3 * 4, 3, false);\n\n  this.pushBack = function(value) {\n    this.insert(value);\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataC3fv, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataSf meant to hold scalar float values\n *\n * @class\n * @returns {vgl.sourceDataSf}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataSf = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataSf)) {\n    return new vgl.sourceDataSf();\n  }\n\n  var m_min = null,\n      m_max = null,\n      m_fixedmin = null,\n      m_fixedmax = null;\n\n  vgl.sourceData.call(this);\n\n  this.addAttribute(vgl.vertexAttributeKeys.Scalar, gl.FLOAT, 4, 0, 4, 1, false);\n\n  this.pushBack = function(value) {\n    if (m_max === null || value > m_max) {\n      m_max = value;\n    }\n    if (m_min === null || value < m_min) {\n      m_min = value;\n    }\n    //this.insert(value); //no, slow on Safari\n    this.data()[this.data().length] = value;\n  };\n\n  this.insertAt = function(index, value) {\n    if (m_max === null || value > m_max) {\n      m_max = value;\n    }\n    if (m_min === null || value < m_min) {\n      m_min = value;\n    }\n    //call superclass ??\n    //vgl.sourceData.insertAt.call(this, index, value);\n    this.data()[index] = value;\n  };\n\n  this.scalarRange = function() {\n    if (m_fixedmin === null || m_fixedmax === null) {\n      return [m_min, m_max];\n    }\n\n    return [m_fixedmin, m_fixedmax];\n  };\n\n  this.setScalarRange = function(min, max) {\n    m_fixedmin = min;\n    m_fixedmax = max;\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataSf, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sourceDataDf meant to hold data float values\n *\n * This source array is the best way to pass a array of floats to the shader\n * that has one entry for each of the vertices.\n *\n * @class\n * @returns {vgl.sourceDataDf}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.sourceDataDf = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.sourceDataDf)) {\n    return new vgl.sourceDataDf();\n  }\n\n  var m_min = null,\n      m_max = null,\n      m_fixedmin = null,\n      m_fixedmax = null;\n\n  vgl.sourceData.call(this);\n\n  this.addAttribute(vgl.vertexAttributeKeys.Scalar, gl.FLOAT,\n                    4, 0, 4, 1, false);\n\n  this.pushBack = function(value) {\n    this.data()[this.data().length] = value;\n  };\n\n  this.insertAt = function(index, value) {\n    this.data()[index] = value;\n  };\n\n  return this;\n};\n\ninherit(vgl.sourceDataDf, vgl.sourceData);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class geometryData\n *\n * @class\n * @returns {vgl.geometryData}\n */\n /////////////////////////////////////////////////////////////////////////////\nvgl.geometryData = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.geometryData)) {\n    return new vgl.geometryData();\n  }\n  vgl.data.call(this);\n\n  /** @private */\n  var m_name = \"\",\n      m_primitives = [],\n      m_sources = [],\n      m_bounds = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0],\n      m_computeBoundsTimestamp = vgl.timestamp(),\n      m_boundsDirtyTimestamp = vgl.timestamp();\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return type\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.type = function() {\n    return vgl.data.geometry;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return ID of the geometry data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.name = function() {\n    return m_name;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set name of the geometry data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setName = function(name) {\n    m_name = name;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add new source\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addSource = function(source) {\n    // @todo Check if the incoming source has duplicate keys\n\n    // NOTE This might not work on IE8 or lower\n    if (m_sources.indexOf(source) === -1) {\n      m_sources.push(source);\n\n      if (source.hasKey(vgl.vertexAttributeKeys.Position)) {\n        m_boundsDirtyTimestamp.modified();\n      }\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return source for a given index. Returns 0 if not found.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.source = function(index) {\n    if (index < m_sources.length) {\n      return m_sources[index];\n    }\n\n    return 0;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return number of sources\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.numberOfSources = function() {\n    return m_sources.length;\n  };\n\n  /**\n   * Return source data given a key\n   */\n  this.sourceData = function(key) {\n    var i;\n\n    for (i = 0; i < m_sources.length; ++i) {\n      if (m_sources[i].hasKey(key)) {\n        return m_sources[i];\n      }\n    }\n\n    return null;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add new primitive\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addPrimitive = function(primitive) {\n    m_primitives.push(primitive);\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return primitive for a given index. Returns null if not found.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.primitive = function(index) {\n    if (index < m_primitives.length) {\n      return m_primitives[index];\n    }\n\n    return null;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return number of primitives\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.numberOfPrimitives = function() {\n    return m_primitives.length;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return bounds [minX, maxX, minY, maxY, minZ, maxZ]\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bounds = function() {\n    if (m_boundsDirtyTimestamp.getMTime() > m_computeBoundsTimestamp.getMTime()) {\n      this.computeBounds();\n    }\n    return m_bounds;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Reset bounds\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resetBounds = function() {\n    m_bounds[0] = 0.0;\n    m_bounds[1] = 0.0;\n    m_bounds[2] = 0.0;\n    m_bounds[3] = 0.0;\n    m_bounds[4] = 0.0;\n    m_bounds[5] = 0.0;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set bounds\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setBounds = function(minX, maxX, minY, maxY, minZ, maxZ) {\n    m_bounds[0] = minX;\n    m_bounds[1] = maxX;\n    m_bounds[2] = minY;\n    m_bounds[3] = maxY;\n    m_bounds[4] = minZ;\n    m_bounds[5] = maxZ;\n\n    m_computeBoundsTimestamp.modified();\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute bounds\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBounds = function() {\n    if (m_boundsDirtyTimestamp.getMTime() > m_computeBoundsTimestamp.getMTime()) {\n      var attr = vgl.vertexAttributeKeys.Position,\n          sourceData = this.sourceData(attr),\n          data = sourceData.data(),\n          numberOfComponents = sourceData.attributeNumberOfComponents(attr),\n          stride = sourceData.attributeStride(attr),\n          offset = sourceData.attributeOffset(attr),\n          sizeOfDataType = sourceData.sizeOfAttributeDataType(attr),\n          count = data.length,\n          ib = 0,\n          jb = 0,\n          value = null,\n          vertexIndex,\n          j;\n\n      // We advance by index, not by byte\n      stride /= sizeOfDataType;\n      offset /= sizeOfDataType;\n\n      this.resetBounds();\n\n      for (vertexIndex = offset; vertexIndex < count; vertexIndex += stride) {\n        for (j = 0; j < numberOfComponents; ++j) {\n          value = data[vertexIndex + j];\n          ib = j * 2;\n          jb = j * 2 + 1;\n\n          if (vertexIndex === offset) {\n            m_bounds[ib] = value;\n            m_bounds[jb] = value;\n          } else {\n            if (value > m_bounds[jb]) {\n              m_bounds[jb] = value;\n            }\n            if (value < m_bounds[ib]) {\n              m_bounds[ib] = value;\n            }\n          }\n        }\n      }\n\n      m_computeBoundsTimestamp.modified();\n    }\n  };\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Returns the vertex closest to a given position\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.findClosestVertex = function(point) {\n    var attr = vgl.vertexAttributeKeys.Position,\n        sourceData = this.sourceData(attr),\n        sizeOfDataType = sourceData.sizeOfAttributeDataType(attr),\n        numberOfComponents = sourceData.attributeNumberOfComponents(attr),\n        data = sourceData.data(),\n        stride = sourceData.attributeStride(attr) / sizeOfDataType,\n        offset = sourceData.attributeOffset(attr) / sizeOfDataType,\n        minDist = Number.MAX_VALUE,\n        minIndex = null,\n        vi, vPos, dx, dy, dz, dist, i;\n\n    // assume positions are always triplets\n    if (numberOfComponents !== 3) {\n      console.log('[warning] Find closest vertex assumes three' +\n        'component vertex ');\n    }\n\n    if (!point.z) {\n      point = {x:point.x, y:point.y, z:0};\n    }\n\n    for (vi = offset, i = 0; vi < data.length; vi += stride, i++) {\n      vPos = [data[vi],\n              data[vi + 1],\n              data[vi + 2]];\n\n      dx = vPos[0] - point.x;\n      dy = vPos[1] - point.y;\n      dz = vPos[2] - point.z;\n      dist = Math.sqrt(dx*dx + dy*dy + dz*dz);\n      if (dist < minDist) {\n        minDist = dist;\n        minIndex = i;\n      }\n    }\n    return minIndex;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Returns the requested vertex position\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getPosition = function(index) {\n    var attr = vgl.vertexAttributeKeys.Position,\n        sourceData = this.sourceData(attr),\n        sizeOfDataType = sourceData.sizeOfAttributeDataType(attr),\n        numberOfComponents = sourceData.attributeNumberOfComponents(attr),\n        data = sourceData.data(),\n        stride = sourceData.attributeStride(attr) / sizeOfDataType,\n        offset = sourceData.attributeOffset(attr) / sizeOfDataType;\n\n    // assume positions are always triplets\n    if (numberOfComponents !== 3) {\n      console.log(\"[warning] getPosition assumes three component data\");\n    }\n\n    return [ data[offset + index*stride],\n             data[offset + index*stride + 1],\n             data[offset + index*stride + 2] ];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Returns the scalar corresponding to a given vertex index\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getScalar = function(index) {\n    var attr = vgl.vertexAttributeKeys.Scalar,\n        sourceData = this.sourceData(attr),\n        numberOfComponents, sizeOfDataType, data, stride, offset;\n\n    if (!sourceData) {\n      return null;\n    }\n\n    numberOfComponents = sourceData.attributeNumberOfComponents(attr);\n    sizeOfDataType = sourceData.sizeOfAttributeDataType(attr);\n    data = sourceData.data();\n    stride = sourceData.attributeStride(attr) / sizeOfDataType;\n    offset = sourceData.attributeOffset(attr) / sizeOfDataType;\n\n    //console.log(\"index for scalar is \" + index);\n    //console.log(\"offset for scalar is \" + offset);\n    //console.log(\"stride for scalar is \" + stride);\n\n    //console.log(\"have \" + data.length + \" scalars\");\n\n    if (index * stride + offset >= data.length) {\n      console.log(\"access out of bounds in getScalar\");\n    }\n\n    return data[index * stride + offset];\n  };\n\n  return this;\n};\n\ninherit(vgl.geometryData, vgl.data);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, gl, ogs, vec4, Float32Array, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class mapper\n *\n * @class\n * @returns {vgl.mapper}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.mapper = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.mapper)) {\n    return new vgl.mapper();\n  }\n  vgl.boundingObject.call(this);\n\n  /** @private */\n  var m_dirty = true,\n      m_color = [ 0.0, 1.0, 1.0 ],\n      m_geomData = null,\n      m_buffers = [],\n      m_bufferVertexAttributeMap = {},\n      m_glCompileTimestamp = vgl.timestamp();\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Delete cached VBO if any\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function deleteVertexBufferObjects() {\n    var i;\n    for (i = 0; i < m_buffers.length; ++i) {\n      gl.deleteBuffer(m_buffers[i]);\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create new VBO for all its geometryData sources and primitives\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function createVertexBufferObjects() {\n    if (m_geomData) {\n      var numberOfSources = m_geomData.numberOfSources(),\n          i, j, k, bufferId = null, keys, ks, numberOfPrimitives;\n\n      for (i = 0; i < numberOfSources; ++i) {\n        bufferId = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, bufferId);\n        gl.bufferData(gl.ARRAY_BUFFER,\n          new Float32Array(m_geomData.source(i).data()), gl.STATIC_DRAW);\n\n        keys = m_geomData.source(i).keys();\n        ks = [];\n\n        for (j = 0; j < keys.length; ++j) {\n          ks.push(keys[j]);\n        }\n\n        m_bufferVertexAttributeMap[i] = ks;\n        m_buffers[i] = bufferId;\n      }\n\n      numberOfPrimitives = m_geomData.numberOfPrimitives();\n      for (k = 0; k < numberOfPrimitives; ++k) {\n        bufferId = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, bufferId);\n        gl.bufferData(gl.ARRAY_BUFFER, m_geomData.primitive(k)\n            .indices(), gl.STATIC_DRAW);\n        m_buffers[i++] = bufferId;\n      }\n\n      m_glCompileTimestamp.modified();\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Clear cache related to buffers\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function cleanUpDrawObjects() {\n    m_bufferVertexAttributeMap = {};\n    m_buffers = [];\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Setup draw objects; Delete old ones and create new ones\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function setupDrawObjects() {\n    // Delete buffer objects from past if any.\n    deleteVertexBufferObjects();\n\n    // Clear any cache related to buffers\n    cleanUpDrawObjects();\n\n    // Now construct the new ones.\n    createVertexBufferObjects();\n\n    m_dirty = false;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute bounds of the data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBounds = function() {\n    if (m_geomData === null || typeof m_geomData === 'undefined') {\n      this.resetBounds();\n      return;\n    }\n\n    var computeBoundsTimestamp = this.computeBoundsTimestamp(),\n        boundsDirtyTimestamp = this.boundsDirtyTimestamp(),\n        geomBounds = null;\n\n    if (boundsDirtyTimestamp.getMTime() > computeBoundsTimestamp.getMTime()) {\n      geomBounds = m_geomData.bounds();\n\n      this.setBounds(geomBounds[0], geomBounds[1], geomBounds[2],\n        geomBounds[3], geomBounds[4], geomBounds[5]) ;\n\n      computeBoundsTimestamp.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get solid color of the geometry\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.color = function() {\n    return m_color;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set solid color of the geometry. Default is teal [1.0, 1.0, 1.0]\n   *\n   * @param r Red component of the color [0.0 - 1.0]\n   * @param g Green component of the color [0.0 - 1.0]\n   * @param b Blue component of the color [0.0 - 1.0]\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setColor = function(r, g, b) {\n    m_color[0] = r;\n    m_color[1] = g;\n    m_color[2] = b;\n\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return stored geometry data if any\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.geometryData = function() {\n    return m_geomData;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Connect mapper to its geometry data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setGeometryData = function(geom) {\n    if (m_geomData !== geom) {\n      m_geomData = geom;\n\n      this.modified();\n      this.boundsDirtyTimestamp().modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render the mapper\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.render = function(renderState) {\n    if (this.getMTime() > m_glCompileTimestamp.getMTime()) {\n      setupDrawObjects(renderState);\n    }\n\n    // Fixed vertex color\n    gl.vertexAttrib3fv(vgl.vertexAttributeKeys.Color, this.color());\n\n    // TODO Use renderState\n    var bufferIndex = 0,\n        j = 0, i, noOfPrimitives = null, primitive = null;\n\n    for (i in m_bufferVertexAttributeMap) {\n      if (m_bufferVertexAttributeMap.hasOwnProperty(i)) {\n        gl.bindBuffer(gl.ARRAY_BUFFER, m_buffers[bufferIndex]);\n        for (j = 0; j < m_bufferVertexAttributeMap[i].length; ++j) {\n          renderState.m_material\n              .bindVertexData(renderState, m_bufferVertexAttributeMap[i][j]);\n        }\n        ++bufferIndex;\n      }\n    }\n\n    noOfPrimitives = m_geomData.numberOfPrimitives();\n    for (j = 0; j < noOfPrimitives; ++j) {\n      gl.bindBuffer(gl.ARRAY_BUFFER, m_buffers[bufferIndex++]);\n      primitive = m_geomData.primitive(j);\n      switch(primitive.primitiveType()) {\n        case gl.POINTS:\n          gl.drawArrays (gl.TRIANGLES, 0, primitive.numberOfIndices());\n          break;\n        case gl.LINES:\n          gl.drawArrays (gl.LINES, 0, primitive.numberOfIndices());\n          break;\n        case gl.LINE_STRIP:\n          gl.drawArrays (gl.LINE_STRIP, 0, primitive.numberOfIndices());\n          break;\n        case gl.TRIANGLES:\n          gl.drawArrays (gl.TRIANGLES, 0, primitive.numberOfIndices());\n          break;\n        case gl.TRIANGLE_STRIP:\n          gl.drawArrays (gl.TRIANGLE_STRIP, 0, primitive.numberOfIndices());\n          break;\n      }\n      gl.bindBuffer (gl.ARRAY_BUFFER, null);\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.mapper, vgl.boundingObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\nvgl.groupMapper = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.groupMapper)) {\n    return new vgl.groupMapper();\n  }\n  vgl.mapper.call(this);\n\n  /** @private */\n  var m_createMappersTimestamp = vgl.timestamp(),\n      m_mappers = [],\n      m_geomDataArray = [];\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return stored geometry data if any\n   *\n   * @param index optional\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.geometryData = function(index) {\n    if (index !== undefined && index < m_geomDataArray.length ) {\n      return m_geomDataArray[index];\n    }\n\n    if (m_geomDataArray.length > 0) {\n      return m_geomDataArray[0];\n    }\n\n    return null;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Connect mapper to its geometry data\n   *\n   * @param geom {vgl.geomData}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setGeometryData = function(geom) {\n    if (m_geomDataArray.length === 1) {\n      if (m_geomDataArray[0] === geom) {\n        return;\n      }\n    }\n    m_geomDataArray = [];\n    m_geomDataArray.push(geom);\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return stored geometry data array if any\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.geometryDataArray = function() {\n    return m_geomDataArray;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Connect mapper to its geometry data\n   *\n   * @param geoms {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setGeometryDataArray = function(geoms) {\n    if (geoms instanceof Array) {\n      if (m_geomDataArray !== geoms) {\n        m_geomDataArray = [];\n        m_geomDataArray = geoms;\n        this.modified();\n        return true;\n      }\n    } else {\n      console.log('[error] Requies array of geometry data');\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute bounds of the data\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeBounds = function() {\n    if (m_geomDataArray === null ||\n        m_geomDataArray === undefined) {\n      this.resetBounds();\n      return;\n    }\n\n    var computeBoundsTimestamp = this.computeBoundsTimestamp(),\n        boundsDirtyTimestamp = this.boundsDirtyTimestamp(),\n        m_bounds = this.bounds(),\n        geomBounds = null,\n        i = null;\n\n    if (boundsDirtyTimestamp.getMTime() >\n        computeBoundsTimestamp.getMTime()) {\n\n      for (i = 0; i < m_geomDataArray.length; ++i) {\n        geomBounds = m_geomDataArray[i].bounds();\n\n        if (m_bounds[0] > geomBounds[0]) {\n          m_bounds[0] = geomBounds[0];\n        }\n        if (m_bounds[1] < geomBounds[1]) {\n          m_bounds[1] = geomBounds[1];\n        }\n        if (m_bounds[2] > geomBounds[2]) {\n          m_bounds[2] = geomBounds[2];\n        }\n        if (m_bounds[3] < geomBounds[3]) {\n          m_bounds[3] = geomBounds[3];\n        }\n        if (m_bounds[4] > geomBounds[4]) {\n          m_bounds[4] = geomBounds[4];\n        }\n        if (m_bounds[5] < geomBounds[5]) {\n          m_bounds[5] = geomBounds[5];\n        }\n      }\n\n      this.modified();\n      computeBoundsTimestamp.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render the mapper\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.render = function(renderState) {\n    var i = null;\n\n    if (this.getMTime() > m_createMappersTimestamp.getMTime()) {\n      // NOTE Hoping that it will release the graphics resources\n      for (i = 0; i < m_geomDataArray.length; ++i) {\n        m_mappers.push(vgl.mapper());\n        m_mappers[i].setGeometryData(m_geomDataArray[i]);\n      }\n        m_createMappersTimestamp.modified();\n    }\n\n    for (i = 0; i < m_mappers.length; ++i) {\n      m_mappers[i].render(renderState);\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.groupMapper, vgl.mapper);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\nvgl.materialAttributeType = {\n  \"Undefined\" : 0x0,\n  \"ShaderProgram\" : 0x1,\n  \"Texture\" : 0x2,\n  \"Blend\" : 0x3,\n  \"Depth\" : 0x4\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class materialAttribute\n *\n * @class\n * @param type\n * @returns {vgl.materialAttribute}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.materialAttribute = function(type) {\n  'use strict';\n\n  if (!(this instanceof vgl.materialAttribute)) {\n    return new vgl.materialAttribute();\n  }\n  vgl.object.call(this);\n\n  /** @private */\n  var m_type = type,\n      m_enabled = true;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return tyep of the material attribute\n   *\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.type = function() {\n    return m_type;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return if material attribute is enabled or not\n   *\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.enabled = function() {\n    return m_enabled;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Setup (initialize) the material attribute\n   *\n   * @param renderState\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setup = function(renderState) {\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind and activate the material attribute\n   *\n   * @param renderState\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bind = function(renderState) {\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo bind and deactivate the material\n   *\n   * @param renderState\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.undoBind = function(renderState) {\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize vertex data for the material attribute\n   *\n   * @param renderState\n   * @param key\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setupVertexData = function(renderState, key) {\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind and activate vertex specific data\n   *\n   * @param renderState\n   * @param key\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bindVertexData = function(renderState, key) {\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo bind and deactivate vertex specific data\n   *\n   * @param renderState\n   * @param key\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.undoBindVertexData = function(renderState, key) {\n    return false;\n  };\n\n  return this;\n};\n\ninherit(vgl.materialAttribute, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, gl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of clas blendFunction\n *\n * @class\n * @param source\n * @param destination\n * @returns {vgl.blendFunction}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.blendFunction = function(source, destination) {\n  'use strict';\n\n  if (!(this instanceof vgl.blendFunction)) {\n    return new vgl.blendFunction(source, destination);\n  }\n\n  /** @private */\n  var m_source = source,\n      m_destination = destination;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Apply blend function to the current state\n   *\n   * @param {vgl.renderState}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.apply = function(renderState) {\n    gl.blendFuncSeparate(m_source, m_destination, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n  };\n\n  return this;\n};\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class blend\n *\n * @returns {vgl.blend}\n */\n////////////////////////////////////////////////////////////////////////////\nvgl.blend = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.blend)) {\n    return new vgl.blend();\n  }\n  vgl.materialAttribute.call(\n    this, vgl.materialAttributeType.Blend);\n\n  /** @private */\n  var m_wasEnabled = false,\n      m_blendFunction = vgl.blendFunction(gl.SRC_ALPHA,\n                                                gl.ONE_MINUS_SRC_ALPHA);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind blend attribute\n   *\n   * @param {vgl.renderState}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bind = function(renderState) {\n    m_wasEnabled = gl.isEnabled(gl.BLEND);\n\n    if (this.enabled()) {\n      gl.enable(gl.BLEND);\n      m_blendFunction.apply(renderState);\n    }\n    else {\n      gl.disable(gl.BLEND);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo bind blend attribute\n   *\n   * @param {vgl.renderState}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.undoBind = function(renderState) {\n    if (m_wasEnabled) {\n      gl.enable(gl.BLEND);\n    }\n    else {\n      gl.disable(gl.BLEND);\n    }\n\n    return true;\n  };\n\n  return this;\n};\n\ninherit(vgl.blend, vgl.materialAttribute);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class material\n *\n * @class\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.material = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.material)) {\n    return new vgl.material();\n  }\n  vgl.object.call(this);\n\n  // / Private member variables\n  var m_shaderProgram = new vgl.shaderProgram(),\n      m_binNumber = 100,\n      m_textureAttributes = {},\n      m_attributes = {};\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return bin number for the material\n   *\n   * @default 100\n   * @returns {number}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.binNumber = function() {\n    return m_binNumber;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set bin number for the material\n   *\n   * @param binNo\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setBinNumber = function(binNo) {\n    m_binNumber = binNo;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if incoming attribute already exists in the material\n   *\n   * @param attr\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.exists = function(attr) {\n    if (attr.type() === vgl.materialAttribute.Texture) {\n      return m_textureAttributes.hasOwnProperty(attr);\n    }\n\n    return m_attributes.hasOwnProperty(attr);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get uniform given a name\n\n   * @param name Uniform name\n   * @returns {vgl.uniform}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.uniform = function(name) {\n    if (m_shaderProgram) {\n      return m_shaderProgram.uniform(name);\n    }\n\n    return null;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get material attribute\n\n   * @param attr Attribute name\n   * @returns {vgl.materialAttribute}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.attribute = function(name) {\n    if (m_attributes.hasOwnProperty(name)) {\n      return m_attributes[name];\n    }\n\n    if (m_textureAttributes.hasOwnProperty(name)) {\n      return m_textureAttributes[name];\n    }\n\n    return null;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set a new attribute for the material\n   *\n   * This method replace any existing attribute except for textures as\n   * materials can have multiple textures.\n   *\n   * @param attr\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setAttribute = function(attr) {\n    if (attr.type() === vgl.materialAttributeType.Texture &&\n        m_textureAttributes[attr.textureUnit()] !== attr) {\n      m_textureAttributes[attr.textureUnit()] = attr;\n      this.modified();\n      return true;\n    }\n\n    if (m_attributes[attr.type()] === attr) {\n      return false;\n    }\n\n    // Shader is a very special attribute\n    if (attr.type() === vgl.materialAttributeType.ShaderProgram) {\n      m_shaderProgram = attr;\n    }\n\n    m_attributes[attr.type()] = attr;\n    this.modified();\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add a new attribute to the material.\n   *\n   * @param attr\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addAttribute = function(attr) {\n    if (this.exists(attr)) {\n      return false;\n    }\n\n    if (attr.type() === vgl.materialAttributeType.Texture) {\n      // TODO Currently we don't check if we are replacing or not.\n      // It would be nice to have a flag for it.\n      m_textureAttributes[attr.textureUnit()] = attr;\n      this.modified();\n      return true;\n    }\n\n    // Shader is a very special attribute\n    if (attr.type() === vgl.materialAttributeType.ShaderProgram) {\n      m_shaderProgram = attr;\n    }\n\n    m_attributes[attr.type()] = attr;\n    this.modified();\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return shader program used by the material\n   *\n   * @returns {vgl.shaderProgram}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.shaderProgram = function() {\n    return m_shaderProgram;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Activate the material\n   *\n   * @param renderState\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.render = function(renderState) {\n    this.bind(renderState);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Deactivate the material\n   *\n   * @param renderState\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.remove = function(renderState) {\n    this.undoBind(renderState);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind and activate material states\n   *\n   * @param renderState\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bind = function(renderState) {\n    var key = null;\n\n    for (key in m_attributes) {\n      if (m_attributes.hasOwnProperty(key)) {\n        m_attributes[key].bind(renderState);\n      }\n    }\n\n    for (key in m_textureAttributes) {\n      if (m_textureAttributes.hasOwnProperty(key)) {\n        m_textureAttributes[key].bind(renderState);\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo-bind and de-activate material states\n   *\n   * @param renderState\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.undoBind = function(renderState) {\n    var key = null;\n    for (key in m_attributes) {\n      if (m_attributes.hasOwnProperty(key)) {\n        m_attributes[key].undoBind(renderState);\n      }\n    }\n\n    for (key in m_textureAttributes) {\n      if (m_textureAttributes.hasOwnProperty(key)) {\n        m_textureAttributes[key].undoBind(renderState);\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind vertex data\n   *\n   * @param renderState\n   * @param key\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bindVertexData = function(renderState, key) {\n    var i = null;\n\n    for (i in m_attributes) {\n      if (m_attributes.hasOwnProperty(i)) {\n        m_attributes[i].bindVertexData(renderState, key);\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo bind vertex data\n   *\n   * @param renderState\n   * @param key\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.undoBindVertexData = function(renderState, key) {\n    var i = null;\n\n    for (i in m_attributes) {\n      if (m_attributes.hasOwnProperty(i)) {\n        m_attributes.undoBindVertexData(renderState, key);\n      }\n    }\n  };\n\n  return this;\n};\n\nvgl.material.RenderBin = {\n  \"Base\" : 0,\n  \"Default\" : 100,\n  \"Opaque\" : 100,\n  \"Transparent\" : 1000,\n  \"Overlay\" : 10000\n};\n\ninherit(vgl.material, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, bitwise:true, indent: 2*/\n\n/*global vgl, gl, ogs, vec2, vec3, vec4, mat4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class renderState\n *\n * @returns {vgl.renderState}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.renderState = function() {\n  'use strict';\n\n  this.m_modelViewMatrix = mat4.create();\n  this.m_normalMatrix = mat4.create();\n  this.m_projectionMatrix = null;\n  this.m_material = null;\n  this.m_mapper = null;\n};\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class renderer *\n *\n * @returns {vgl.renderer}\n */\n////////////////////////////////////////////////////////////////////////////\nvgl.renderer = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.renderer)) {\n    return new vgl.renderer();\n  }\n  vgl.object.call(this);\n\n  /** @private */\n  var m_sceneRoot = new vgl.groupNode(),\n      m_camera = new vgl.camera(),\n      m_nearClippingPlaneTolerance = null,\n      m_x = 0,\n      m_y = 0,\n      m_width = 0,\n      m_height = 0,\n      m_resizable = true,\n      m_resetScene = true,\n      m_layer = 0,\n      m_resetClippingRange = true;\n\n  m_camera.addChild(m_sceneRoot);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get width of the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.width = function() {\n    return m_width;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get height of the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.height = function() {\n    return m_height;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get layer this renderer is associated with\n   *\n   * @return {Number}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.layer = function () {\n     return m_layer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set the layer this renderer is associated with.\n   *\n   * @param layerNo\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setLayer = function(layerNo) {\n    m_layer = layerNo;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   *\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.isResizable = function() {\n    return m_resizable;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   *\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setResizable = function(r) {\n    m_resizable = r;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get background color\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.backgroundColor = function() {\n    return m_camera.clearColor();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set background color of the renderer\n   *\n   * @param r\n   * @param g\n   * @param b\n   * @param a\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setBackgroundColor = function(r, g, b, a) {\n    m_camera.setClearColor(r, g, b, a);\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get scene root\n   *\n   * @returns {vgl.groupNode}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.sceneRoot = function() {\n    return m_sceneRoot;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get main camera of the renderer\n   *\n   * @returns {vgl.camera}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.camera = function() {\n    return m_camera;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render the scene\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.render = function() {\n    var i, renSt, children, actor = null, sortedActors = [],\n        mvMatrixInv = mat4.create(), clearColor = null;\n\n    gl.enable(gl.DEPTH_TEST);\n    gl.depthFunc(gl.LEQUAL);\n\n    if (m_camera.clearMask() & vgl.GL.ColorBufferBit) {\n      clearColor = m_camera.clearColor();\n      gl.clearColor(clearColor[0], clearColor[1], clearColor[2], clearColor[3]);\n    }\n\n    if (m_camera.clearMask() & vgl.GL.DepthBufferBit) {\n      gl.clearDepth(m_camera.clearDepth());\n    }\n\n    gl.clear(m_camera.clearMask());\n\n    // Set the viewport for this renderer\n    gl.viewport(m_x, m_y, m_width, m_height);\n\n    renSt = new vgl.renderState();\n    children = m_sceneRoot.children();\n\n    if (children.length > 0 && m_resetScene) {\n      this.resetCamera();\n      m_resetScene = false;\n    }\n\n    for ( i = 0; i < children.length; ++i) {\n      actor = children[i];\n      actor.computeBounds();\n      if (!actor.visible()) {\n        continue;\n      }\n\n      sortedActors.push([actor.material().binNumber(), actor]);\n    }\n\n    // Now perform sorting\n    sortedActors.sort(function(a, b) {return a[0] - b[0];});\n\n    for ( i = 0; i < sortedActors.length; ++i) {\n      actor = sortedActors[i][1];\n\n      if (actor.referenceFrame() ===\n          vgl.boundingObject.ReferenceFrame.Relative) {\n        mat4.multiply(renSt.m_modelViewMatrix, m_camera.viewMatrix(),\n          actor.matrix());\n        renSt.m_projectionMatrix = m_camera.projectionMatrix();\n      } else {\n        renSt.m_modelViewMatrix = actor.matrix();\n        renSt.m_projectionMatrix = mat4.create();\n        mat4.ortho(renSt.m_projectionMatrix, 0, m_width, 0, m_height, -1, 1);\n      }\n\n      mat4.invert(mvMatrixInv, renSt.m_modelViewMatrix);\n      mat4.transpose(renSt.m_normalMatrix, mvMatrixInv);\n      renSt.m_material = actor.material();\n      renSt.m_mapper = actor.mapper();\n\n      // TODO Fix this shortcut\n      renSt.m_material.render(renSt);\n      renSt.m_mapper.render(renSt);\n      renSt.m_material.remove(renSt);\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Automatically set up the camera based on visible actors\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resetCamera = function() {\n    m_camera.computeBounds();\n\n    var vn = m_camera.directionOfProjection(),\n        visibleBounds = m_camera.bounds(),\n        center = [\n          (visibleBounds[0] + visibleBounds[1]) / 2.0,\n          (visibleBounds[2] + visibleBounds[3]) / 2.0,\n          (visibleBounds[4] + visibleBounds[5]) / 2.0\n        ],\n        diagonals = [\n          visibleBounds[1] - visibleBounds[0],\n          visibleBounds[3] - visibleBounds[2],\n          visibleBounds[5] - visibleBounds[4]\n        ],\n        radius = 0.0,\n        aspect = m_camera.viewAspect(),\n        angle = m_camera.viewAngle(),\n        distance = null,\n        vup = null;\n\n    if (diagonals[0] > diagonals[1]) {\n      if (diagonals[0] > diagonals[2]) {\n        radius = diagonals[0] / 2.0;\n      } else {\n        radius = diagonals[2] / 2.0;\n      }\n    } else {\n      if (diagonals[1] > diagonals[2]) {\n        radius = diagonals[1] / 2.0;\n      } else {\n        radius = diagonals[2] / 2.0;\n      }\n    }\n\n    // @todo Need to figure out what's happening here\n    if (aspect >= 1.0) {\n      angle = 2.0 * Math.atan(Math.tan(angle * 0.5) / aspect);\n    } else {\n      angle = 2.0 * Math.atan(Math.tan(angle * 0.5) * aspect);\n    }\n\n    distance = radius / Math.sin(angle * 0.5);\n    vup = m_camera.viewUpDirection();\n\n    if (Math.abs(vec3.dot(vup, vn)) > 0.999) {\n      m_camera.setViewUpDirection(-vup[2], vup[0], vup[1]);\n    }\n\n    m_camera.setFocalPoint(center[0], center[1], center[2]);\n    m_camera.setPosition(center[0] + distance * -vn[0],\n      center[1] + distance * -vn[1], center[2] + distance * -vn[2]);\n\n    this.resetCameraClippingRange(visibleBounds);\n  };\n\n  this.hasValidBounds = function(bounds) {\n    if (bounds[0] == Number.MAX_VALUE ||\n        bounds[1] == -Number.MAX_VALUE ||\n        bounds[2] == Number.MAX_VALUE ||\n        bounds[3] == -Number.MAX_VALUE ||\n        bounds[4] == Number.MAX_VALUE ||\n        bounds[5] == -Number.MAX_VALUE)  {\n      return false;\n    }\n\n    return true;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Recalculate camera's clipping range\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resetCameraClippingRange = function(bounds) {\n    if (typeof bounds === 'undefined') {\n      m_camera.computeBounds();\n      bounds = m_camera.bounds();\n    }\n\n    if (!this.hasValidBounds(bounds)) {\n      return;\n    }\n\n    var vn = m_camera.viewPlaneNormal(),\n        position = m_camera.position(),\n        a = -vn[0],\n        b = -vn[1],\n        c = -vn[2],\n        d = -(a*position[0] + b*position[1] + c*position[2]),\n        range = vec2.create(),\n        dist = null,\n        i = null,\n        j = null,\n        k = null;\n\n    if (!m_resetClippingRange) {\n        return;\n    }\n\n    // Set the max near clipping plane and the min far clipping plane\n    range[0] = a * bounds[0] + b * bounds[2] + c * bounds[4] + d;\n    range[1] = 1e-18;\n\n    // Find the closest / farthest bounding box vertex\n    for (k = 0; k < 2; k++ ) {\n      for (j = 0; j < 2; j++) {\n        for (i = 0; i < 2; i++) {\n          dist = a * bounds[i] + b * bounds[2 + j] + c * bounds[4 + k] + d;\n          range[0] = (dist < range[0]) ? (dist) : (range[0]);\n          range[1] = (dist > range[1]) ? (dist) : (range[1]);\n        }\n      }\n    }\n\n    // Do not let the range behind the camera throw off the calculation.\n    if (range[0] < 0.0) {\n      range[0] = 0.0;\n    }\n\n    // Give ourselves a little breathing room\n    range[0] = 0.99 * range[0] - (range[1] - range[0]) * 0.5;\n    range[1] = 1.01 * range[1] + (range[1] - range[0]) * 0.5;\n\n    // Make sure near is not bigger than far\n    range[0] = (range[0] >= range[1]) ? (0.01 * range[1]) : (range[0]);\n\n    // Make sure near is at least some fraction of far - this prevents near\n    // from being behind the camera or too close in front. How close is too\n    // close depends on the resolution of the depth buffer.\n    if (!m_nearClippingPlaneTolerance) {\n      m_nearClippingPlaneTolerance = 0.01;\n\n      if (gl !== null && gl.getParameter(gl.DEPTH_BITS) > 16) {\n        m_nearClippingPlaneTolerance = 0.001;\n      }\n    }\n\n    // make sure the front clipping range is not too far from the far clippnig\n    // range, this is to make sure that the zbuffer resolution is effectively\n    // used.\n    if (range[0] < m_nearClippingPlaneTolerance*range[1]) {\n       range[0] = m_nearClippingPlaneTolerance*range[1];\n    }\n\n    m_camera.setClippingRange(range[0], range[1]);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Resize viewport given a width and height\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resize = function(width, height) {\n    // @note: where do m_x and m_y come from?\n    this.positionAndResize(m_x, m_y, width, height);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Resize viewport given a position, width and height\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.positionAndResize = function(x, y, width, height) {\n    // TODO move this code to camera\n    if (x < 0 || y < 0 || width < 0 || height < 0) {\n      console.log('[error] Invalid position and resize values',\n        x, y, width, height);\n    }\n\n    //If we're allowing this renderer to resize ...\n    if (m_resizable) {\n      m_width = width;\n      m_height = height;\n\n      m_camera.setViewAspect(m_width / m_height);\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add new actor to the collection\n   *\n   * @param actor\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addActor = function(actor) {\n    if (actor instanceof vgl.actor) {\n      m_sceneRoot.addChild(actor);\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return true if this renderer has this actor attached, false otherwise.\n   *\n   * @param actor\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.hasActor = function(actor) {\n      return m_sceneRoot.hasChild(actor);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add an array of actors to the collection\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addActors = function(actors) {\n    var i = null;\n    if (actors instanceof Array) {\n      for (i = 0; i < actors.length; ++i) {\n        m_sceneRoot.addChild(actors[i]);\n      }\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove the actor from the collection\n   *\n   * @param actor\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.removeActor = function(actor) {\n    if (m_sceneRoot.children().indexOf(actor) !== -1) {\n      m_sceneRoot.removeChild(actor);\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove actors from the collection\n   *\n   * @param actors\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.removeActors = function(actors) {\n    if (!(actors instanceof Array)) {\n      return false;\n    }\n\n    var i;\n    for (i = 0; i < actors.length; ++i) {\n      m_sceneRoot.removeChild(actors[i]);\n    }\n    this.modified();\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove all actors for a renderer\n   *\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.removeAllActors = function() {\n    return m_sceneRoot.removeChildren();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point in the world space to display space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.worldToDisplay = function(worldPt, viewMatrix, projectionMatrix, width,\n                                 height) {\n    var viewProjectionMatrix = mat4.create(),\n        winX = null,\n        winY = null,\n        winZ = null,\n        winW = null,\n        clipPt = null;\n\n\n    mat4.multiply(viewProjectionMatrix, projectionMatrix, viewMatrix);\n\n    // Transform world to clipping coordinates\n    clipPt = vec4.create();\n    vec4.transformMat4(clipPt, worldPt, viewProjectionMatrix);\n\n    if (clipPt[3] !== 0.0) {\n      clipPt[0] = clipPt[0] / clipPt[3];\n      clipPt[1] = clipPt[1] / clipPt[3];\n      clipPt[2] = clipPt[2] / clipPt[3];\n      clipPt[3] = 1.0;\n    }\n\n    winX = (((clipPt[0]) + 1) / 2.0) * width;\n    // We calculate -point3D.getY() because the screen Y axis is\n    // oriented top->down\n    winY = ((1 - clipPt[1]) / 2.0) * height;\n    winZ = clipPt[2];\n    winW = clipPt[3];\n\n    return vec4.fromValues(winX, winY, winZ, winW);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point in display space to world space\n   * @param displayPt\n   * @param viewMatrix\n   * @param projectionMatrix\n   * @param width\n   * @param height\n   * @returns {vec4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToWorld = function(displayPt, viewMatrix, projectionMatrix,\n                                 width, height) {\n    var x = (2.0 * displayPt[0] / width) - 1,\n        y = -(2.0 * displayPt[1] / height) + 1,\n        z = displayPt[2],\n        viewProjectionInverse = mat4.create(),\n        worldPt = null;\n\n    mat4.multiply(viewProjectionInverse, projectionMatrix, viewMatrix);\n    mat4.invert(viewProjectionInverse, viewProjectionInverse);\n\n    worldPt = vec4.fromValues(x, y, z, 1);\n    vec4.transformMat4(worldPt, worldPt, viewProjectionInverse);\n    if (worldPt[3] !== 0.0) {\n      worldPt[0] = worldPt[0] / worldPt[3];\n      worldPt[1] = worldPt[1] / worldPt[3];\n      worldPt[2] = worldPt[2] / worldPt[3];\n      worldPt[3] = 1.0;\n    }\n\n    return worldPt;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the focusDisplayPoint\n   * @returns {vec4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.focusDisplayPoint = function() {\n    var focalPoint = m_camera.focalPoint(),\n      focusWorldPt = vec4.fromValues(\n        focalPoint[0], focalPoint[1], focalPoint[2], 1);\n\n    return this.worldToDisplay(\n      focusWorldPt, m_camera.viewMatrix(),\n      m_camera.projectionMatrix(), m_width, m_height);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Will the scene be reset.\n   * @returns {bool}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resetScene = function() {\n    return m_resetScene;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * If true the scene will be reset, otherwise the scene will not be\n   * automatically reset.\n   *\n   * @param reset\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setResetScene = function(reset) {\n     if (m_resetScene !== reset) {\n       m_resetScene = reset;\n       this.modified()\n     }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Will the clipping range be reset\n   * @returns {bool}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resetClippingRange = function() {\n    return m_resetClippingRange;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * If true the camera clipping range will be reset, otherwise the scene will\n   * not be automatically reset.\n   *\n   * @param reset\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setResetClippingRange = function(reset) {\n     if (m_resetClippingRange !== reset) {\n       m_resetClippingRange = reset;\n       this.modified()\n     }\n  };\n\n  return this;\n};\n\ninherit(vgl.renderer, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n// TODO Current we support only one context\nvar gl = null;\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class renderWindow\n *\n * @class\n * @returns {vgl.renderWindow}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.renderWindow = function(canvas) {\n  'use strict';\n\n  if (!(this instanceof vgl.renderWindow)) {\n    return new vgl.renderWindow(canvas);\n  }\n  vgl.object.call(this);\n\n  /** @private */\n  var m_x = 0,\n      m_y = 0,\n      m_width = 400,\n      m_height = 400,\n      m_canvas = canvas,\n      m_activeRender = null,\n      m_renderers = [];\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get size of the render window\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.windowSize = function() {\n    return [ m_width, m_height ];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set size of the render window\n   *\n   * @param width\n   * @param height\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setWindowSize = function(width, height) {\n\n    if (m_width !== width || m_height !== height) {\n      m_width = width;\n      m_height = height;\n\n      this.modified();\n\n      return true;\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get window position (top left coordinates)\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.windowPosition = function() {\n    return [ m_x, m_y ];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set window position (top left coordinates)\n   *\n   * @param x\n   * @param y\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setWindowPosition = function(x, y) {\n    if ((m_x !== x) || (m_y !== y)) {\n      m_x = x;\n      m_y = y;\n      this.modified();\n      return true;\n    }\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return all renderers contained in the render window\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.renderers = function() {\n    return m_renderers;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get active renderer of the the render window\n   *\n   * @returns vgl.renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.activeRenderer = function() {\n    return m_activeRender;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add renderer to the render window\n   *\n   * @param ren\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.addRenderer = function(ren) {\n    if (this.hasRenderer(ren) === false) {\n      m_renderers.push(ren);\n      if (m_activeRender === null) {\n        m_activeRender = ren;\n      }\n      if (ren.layer() !== 0) {\n        ren.camera().setClearMask(vgl.GL.DepthBufferBit);\n      }\n      this.modified();\n      return true;\n    }\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove renderer from the render window\n   *\n   * @param ren\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.removeRenderer = function(ren) {\n    var index = m_renderers.indexOf(ren);\n    if (index !== -1) {\n      if (m_activeRender === ren) {\n        m_activeRender = null;\n      }\n      m_renderers.splice(index, 1);\n      this.modified();\n      return true;\n    }\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return a renderer at a given index\n   *\n   * @param index\n   * @returns {vgl.renderer}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getRenderer = function(index) {\n    if (index < m_renderers.length) {\n      return m_renderers[index];\n    }\n\n    console.log(\"[WARNING] Out of index array\");\n    return null;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if the renderer exists\n   *\n   * @param ren\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.hasRenderer = function(ren) {\n    var i;\n    for (i = 0; i < m_renderers.length; ++i) {\n      if (ren === m_renderers[i]) {\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Resize window\n   *\n   * @param width\n   * @param height\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resize = function(width, height) {\n    this.positionAndResize(m_x, m_y, width, height);\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Resize and reposition the window\n   *\n   * @param x\n   * @param y\n   * @param width\n   * @param height\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.positionAndResize = function(x, y, width, height) {\n    m_x = x;\n    m_y = y;\n    m_width = width;\n    m_height = height;\n    var i;\n    for (i = 0; i < m_renderers.length; ++i) {\n      m_renderers[i].positionAndResize(m_x, m_y, m_width, m_height);\n    }\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create the window\n   *\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.createWindow = function() {\n    // Initialize the global variable gl to null.\n    gl = null;\n\n    try {\n      // Try to grab the standard context. If it fails, fallback to\n      // experimental.\n      gl = m_canvas.getContext(\"webgl\")\n           || m_canvas.getContext(\"experimental-webgl\");\n\n      // Set width and height of renderers if not set already\n      var i;\n      for (i = 0; i < m_renderers.length; ++i) {\n        if ((m_renderers[i].width() > m_width) || m_renderers[i].width() === 0\n            || (m_renderers[i].height() > m_height)\n            || m_renderers[i].height() === 0) {\n          m_renderers[i].resize(m_x, m_y, m_width, m_height);\n        }\n      }\n\n      return true;\n    }\n    catch (e) {\n    }\n\n    // If we don't have a GL context, give up now\n    if (!gl) {\n      console(\"[ERROR] Unable to initialize WebGL. Your browser may not support it.\");\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Delete this window and release any graphics resources\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.deleteWindow = function() {\n    // TODO\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render the scene\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.render = function() {\n    var i;\n    m_renderers.sort(function(a, b) {return a.layer() - b.layer();});\n    for (i = 0; i < m_renderers.length; ++i) {\n      m_renderers[i].render();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the focusDisplayPoint from the activeRenderer\n   * @returns {vec4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.focusDisplayPoint = function() {\n    return m_activeRender.focusDisplayPoint();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point in display space to world space\n   * @param {Number} x\n   * @param {Number} y\n   * @param {vec4} focusDisplayPoint\n   * @returns {vec4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToWorld = function(x, y, focusDisplayPoint, ren) {\n    ren = ren === undefined ? ren = m_activeRender : ren;\n\n    var camera = ren.camera();\n    if(!focusDisplayPoint) {\n      focusDisplayPoint = ren.focusDisplayPoint();\n    }\n\n    return ren.displayToWorld(\n      vec4.fromValues(x, y, focusDisplayPoint[2], 1.0), camera.viewMatrix(),\n      camera.projectionMatrix(), m_width, m_height);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point in display space to world space\n   * @param {Number} x\n   * @param {Number} y\n   * @param {vec4} focusDisplayPoint\n   * @returns {vec4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.worldToDisplay = function(x, y, z, ren) {\n    ren = ren === undefined ? ren = m_activeRender : ren;\n\n    var camera = ren.camera();\n\n    return ren.worldToDisplay(\n      vec4.fromValues(x, y, z, 1.0), camera.viewMatrix(),\n      camera.projectionMatrix(), m_width, m_height);\n  };\n\n  return this;\n};\n\ninherit(vgl.renderWindow, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2, bitwise: true*/\n\n/*global vgl, gl, ogs, vec3, vec4, mat4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class camera\n *\n * @class\n * @returns {vgl.camera}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.camera = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.camera)) {\n    return new vgl.camera();\n  }\n  vgl.groupNode.call(this);\n\n  /** @private */\n  var m_viewAngle = (Math.PI * 30) / 180.0,\n      m_position = vec4.fromValues(0.0, 0.0, 1.0, 1.0),\n      m_focalPoint = vec4.fromValues(0.0, 0.0, 0.0, 1.0),\n      m_centerOfRotation = vec3.fromValues(0.0, 0.0, 0.0),\n      m_viewUp = vec4.fromValues(0.0, 1.0, 0.0, 0.0),\n      m_rightDir = vec4.fromValues(1.0, 0.0, 0.0, 0.0),\n      m_near = 0.01,\n      m_far = 10000.0,\n      m_viewAspect = 1.0,\n      m_directionOfProjection = vec4.fromValues(0.0, 0.0, -1.0, 0.0),\n      m_viewPlaneNormal = vec4.fromValues(0.0, 0.0, 1.0, 0.0),\n      m_viewMatrix = mat4.create(),\n      m_projectionMatrix = mat4.create(),\n      m_computeModelViewMatrixTime = vgl.timestamp(),\n      m_computeProjectMatrixTime = vgl.timestamp(),\n      m_left = -1.0,\n      m_right = 1.0,\n      m_top = +1.0,\n      m_bottom = -1.0,\n      m_enableTranslation = true,\n      m_enableRotation = true,\n      m_enableScale = true,\n      m_enableParallelProjection = false,\n      m_clearColor = [1.0, 1.0, 1.0, 1.0],\n      m_clearDepth = 1.0,\n      m_clearMask = vgl.GL.ColorBufferBit |\n                    vgl.GL.DepthBufferBit;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get view angle of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewAngle = function() {\n    return m_viewAngle;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set view angle of the camera in degrees, which is converted to radians.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setViewAngleDegrees = function(a) {\n    m_viewAngle = (Math.PI * a) / 180.0;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set view angle of the camera in degrees, which is converted to radians.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setViewAngle = function(a) {\n    if (m_enableScale) {\n      m_viewAngle = a;\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get position of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.position = function() {\n    return m_position;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set position of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setPosition = function(x, y, z) {\n    if (m_enableTranslation) {\n      m_position = vec4.fromValues(x, y, z, 1.0);\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get focal point of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.focalPoint = function() {\n    return m_focalPoint;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set focal point of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setFocalPoint = function(x, y, z) {\n    if (m_enableRotation && m_enableTranslation) {\n      m_focalPoint = vec4.fromValues(x, y, z, 1.0);\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get view-up direction of camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewUpDirection = function() {\n    return m_viewUp;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set view-up direction of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setViewUpDirection = function(x, y, z) {\n    m_viewUp = vec4.fromValues(x, y, z, 0);\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get center of rotation for camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.centerOfRotation = function() {\n    return m_centerOfRotation;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set center of rotation for camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setCenterOfRotation = function(centerOfRotation) {\n    m_centerOfRotation = centerOfRotation;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get clipping range of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.clippingRange = function() {\n    return [m_near, m_far];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set clipping range of the camera\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setClippingRange = function(near, far) {\n    m_near = near;\n    m_far = far;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get view aspect\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewAspect = function() {\n    return m_viewAspect;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set view aspect\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setViewAspect = function(aspect) {\n    m_viewAspect = aspect;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return active mode for scaling (enabled / disabled)\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.enableScale = function(flag) {\n    return m_enableScale;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Enable/disable scaling\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setEnableScale = function(flag) {\n    if (flag !== m_enableScale) {\n      m_enableScale = flag;\n      this.modified();\n      return true;\n    }\n\n    return m_enableScale;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return active mode for rotation (enabled / disabled)\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.enableRotation = function(f) {\n    return m_enableRotation;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Enable / disable rotation\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setEnableRotation = function(flag) {\n    if (flag !== m_enableRotation) {\n      m_enableRotation = flag;\n      this.modified();\n      return true;\n    }\n\n    return m_enableRotation;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return active mode for translation (enabled/disabled)\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.enableTranslation = function(flag) {\n    return m_enableTranslation;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Enable / disable translation\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setEnableTranslation = function(flag) {\n    if (flag !== m_enableTranslation) {\n      m_enableTranslation = flag;\n      this.modified();\n      return true;\n    }\n\n    return m_enableTranslation;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return if parallel projection is enabled\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.isEnabledParallelProjection = function() {\n    return m_enableParallelProjection;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Enable / disable parallel projection\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.enableParallelProjection = function(flag) {\n    if (flag !== m_enableParallelProjection) {\n      m_enableParallelProjection = flag;\n      this.modified();\n      return true;\n    }\n\n    return m_enableParallelProjection;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Enable / disable parallel projection\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setEnnableParallelProjection = function(flag) {\n    return enableParallelProjection();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set parallel projection parameters\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setParallelProjection = function(left, right, top, bottom) {\n    m_left = left;\n    m_right = right;\n    m_top = top;\n    m_bottom = bottom;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return direction of projection\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.directionOfProjection = function() {\n    this.computeDirectionOfProjection();\n    return m_directionOfProjection;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return view plane normal direction\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewPlaneNormal = function() {\n    this.computeViewPlaneNormal();\n    return m_viewPlaneNormal;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return view-matrix for the camera This method does not compute the\n   * view-matrix for the camera. It is assumed that a call to computeViewMatrix\n   * has been made earlier.\n   *\n   * @returns {mat4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewMatrix = function() {\n    return this.computeViewMatrix();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return camera projection matrix This method does not compute the\n   * projection-matrix for the camera. It is assumed that a call to\n   * computeProjectionMatrix has been made earlier.\n   *\n   * @returns {mat4}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.projectionMatrix = function() {\n    return this.computeProjectionMatrix();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return clear mask used by this camera\n   *\n   * @returns {number}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.clearMask = function() {\n    return m_clearMask;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set clear mask for camera\n   *\n   * @param mask\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setClearMask = function(mask) {\n    m_clearMask = mask;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get clear color (background color) of the camera\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.clearColor = function() {\n    return m_clearColor;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set clear color (background color) for the camera\n   *\n   * @param color RGBA\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setClearColor = function(r, g, b, a) {\n    m_clearColor[0] = r;\n    m_clearColor[1] = g;\n    m_clearColor[2] = b;\n    m_clearColor[3] = a;\n\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   *\n   * @returns {{1.0: null}}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.clearDepth = function() {\n    return m_clearDepth;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   *\n   * @param depth\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setClearDepth = function(depth) {\n    m_clearDepth = depth;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute direction of projection\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeDirectionOfProjection = function() {\n    vec3.subtract(m_directionOfProjection, m_focalPoint, m_position);\n    vec3.normalize(m_directionOfProjection, m_directionOfProjection);\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute view plane normal\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeViewPlaneNormal = function() {\n    m_viewPlaneNormal[0] = -m_directionOfProjection[0];\n    m_viewPlaneNormal[1] = -m_directionOfProjection[1];\n    m_viewPlaneNormal[2] = -m_directionOfProjection[2];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Move camera closer or further away from the scene\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.zoom = function(d, dir) {\n    if (d === 0) {\n      return;\n    }\n\n    if (!m_enableTranslation) {\n      return;\n    }\n\n    d = d * vec3.distance(m_focalPoint, m_position);\n    if (!dir) {\n      dir = m_directionOfProjection;\n      m_position[0] = m_focalPoint[0] - d * dir[0];\n      m_position[1] = m_focalPoint[1] - d * dir[1];\n      m_position[2] = m_focalPoint[2] - d * dir[2];\n    } else {\n      m_position[0] = m_position[0]  + d * dir[0];\n      m_position[1] = m_position[1]  + d * dir[1];\n      m_position[2] = m_position[2]  + d * dir[2];\n    }\n\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Move camera sideways\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.pan = function(dx, dy, dz) {\n    if (!m_enableTranslation) {\n      return;\n    }\n\n    m_position[0] += dx;\n    m_position[1] += dy;\n    m_position[2] += dz;\n\n    m_focalPoint[0] += dx;\n    m_focalPoint[1] += dy;\n    m_focalPoint[2] += dz;\n\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute camera coordinate axes\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeOrthogonalAxes = function() {\n    this.computeDirectionOfProjection();\n    vec3.cross(m_rightDir, m_directionOfProjection, m_viewUp);\n    vec3.normalize(m_rightDir, m_rightDir);\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Rotate camera around center of rotation\n   * @param dx Rotation around vertical axis in degrees\n   * @param dy Rotation around horizontal axis in degrees\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.rotate = function(dx, dy) {\n    if (!m_enableRotation) {\n      return;\n    }\n\n    // Convert degrees into radians\n    dx = 0.5 * dx * (Math.PI / 180.0);\n    dy = 0.5 * dy * (Math.PI / 180.0);\n\n    var mat = mat4.create(),\n        inverseCenterOfRotation = new vec3.create();\n\n    mat4.identity(mat);\n\n    inverseCenterOfRotation[0] = -m_centerOfRotation[0];\n    inverseCenterOfRotation[1] = -m_centerOfRotation[1];\n    inverseCenterOfRotation[2] = -m_centerOfRotation[2];\n\n    mat4.translate(mat, mat, m_centerOfRotation);\n    mat4.rotate(mat, mat, dx, m_viewUp);\n    mat4.rotate(mat, mat, dy, m_rightDir);\n    mat4.translate(mat, mat, inverseCenterOfRotation);\n\n    vec4.transformMat4(m_position, m_position, mat);\n    vec4.transformMat4(m_focalPoint, m_focalPoint, mat);\n\n    // Update viewup vector\n    vec4.transformMat4(m_viewUp, m_viewUp, mat);\n    vec4.normalize(m_viewUp, m_viewUp);\n\n    // Update direction of projection\n    this.computeOrthogonalAxes();\n\n    // Mark modified\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute camera view matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeViewMatrix = function() {\n    if (m_computeModelViewMatrixTime.getMTime() < this.getMTime()) {\n      mat4.lookAt(m_viewMatrix, m_position, m_focalPoint, m_viewUp);\n      m_computeModelViewMatrixTime.modified();\n    }\n    return m_viewMatrix;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute camera projection matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeProjectionMatrix = function() {\n    if (m_computeProjectMatrixTime.getMTime() < this.getMTime()) {\n      if (!m_enableParallelProjection) {\n        mat4.perspective(m_projectionMatrix, m_viewAngle, m_viewAspect, m_near, m_far);\n      } else {\n        console.log('paralle projection');\n        mat4.ortho(m_projectionMatrix,\n          m_left, m_right, m_bottom, m_top, m_near, m_far);\n      }\n\n      m_computeProjectMatrixTime.modified();\n    }\n\n    return m_projectionMatrix;\n  };\n\n  this.computeDirectionOfProjection();\n\n  return this;\n};\n\ninherit(vgl.camera, vgl.groupNode);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class interactorStyle\n *\n * @class vgl.interactorStyle\n * interactorStyle is a base class for all interactor styles\n * @returns {vgl.interactorStyle}\n */\n////////////////////////////////////////////////////////////////////////////\nvgl.interactorStyle = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.interactorStyle)) {\n    return new vgl.interactorStyle();\n  }\n  vgl.object.call(this);\n\n  // Private member variables\n  var m_that = this,\n      m_viewer = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return viewer referenced by the interactor style\n   *\n   * @returns {null}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewer = function() {\n    return m_viewer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set viewer for the interactor style\n   *\n   * @param viewer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setViewer = function(viewer) {\n    if (viewer !== m_viewer) {\n      m_viewer = viewer;\n      $(m_viewer).on(vgl.event.mousePress, m_that.handleMouseDown);\n      $(m_viewer).on(vgl.event.mouseRelease, m_that.handleMouseUp);\n      $(m_viewer).on(vgl.event.mouseMove, m_that.handleMouseMove);\n      $(m_viewer).on(vgl.event.mouseOut, m_that.handleMouseOut);\n      $(m_viewer).on(vgl.event.mouseWheel, m_that.handleMouseWheel);\n      $(m_viewer).on(vgl.event.keyPress, m_that.handleKeyPress);\n      $(m_viewer).on(vgl.event.mouseContextMenu, m_that.handleContextMenu);\n      $(m_viewer).on(vgl.event.click, m_that.handleClick);\n      $(m_viewer).on(vgl.event.dblClick, m_that.handleDoubleClick);\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse down event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseDown = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse up event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseUp = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseMove = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseOut = function(event) {\n    return true;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse wheel event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseWheel = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle click event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleClick = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle double click event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleDoubleClick = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle key press event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleKeyPress = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle context menu event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleContextMenu = function(event) {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Reset to default\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.reset = function() {\n    return true;\n  };\n\n  return this;\n};\n\ninherit(vgl.interactorStyle, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of trackballInteractorStyle\n *\n * @class vgl.trackballInteractorStyle\n * @returns {vgl.trackballInteractorStyle}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.trackballInteractorStyle = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.trackballInteractorStyle)) {\n    return new vgl.trackballInteractorStyle();\n  }\n  vgl.interactorStyle.call(this);\n  var m_that = this,\n      m_leftMouseBtnDown = false,\n      m_rightMouseBtnDown = false,\n      m_midMouseBtnDown = false,\n      m_outsideCanvas,\n      m_currPos = {x: 0, y: 0},\n      m_lastPos = {x: 0, y: 0};\n\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.handleMouseMove = function(event) {\n    var canvas = m_that.viewer().canvas(),\n        width = m_that.viewer().renderWindow().windowSize()[0],\n        height = m_that.viewer().renderWindow().windowSize()[1],\n        ren = m_that.viewer().renderWindow().activeRenderer(),\n        cam = ren.camera(), coords = m_that.viewer().relMouseCoords(event),\n        fp, fdp, fwp, dp1, dp2, wp1, wp2, coords, dx, dy, dz,\n        coords, m_zTrans;\n\n    m_outsideCanvas = false;\n    m_currPos = {x: 0, y: 0};\n\n    if ((coords.x < 0) || (coords.x > width)) {\n      m_currPos.x = 0;\n      m_outsideCanvas = true;\n    } else {\n      m_currPos.x = coords.x;\n    }\n    if ((coords.y < 0) || (coords.y > height)) {\n      m_currPos.y = 0;\n      m_outsideCanvas = true;\n    } else {\n      m_currPos.y = coords.y;\n    }\n    if (m_outsideCanvas === true) {\n      return;\n    }\n\n    fp = cam.focalPoint();\n    fwp = vec4.fromValues(fp[0], fp[1], fp[2], 1);\n    fdp = ren.worldToDisplay(fwp, cam.viewMatrix(),\n                              cam.projectionMatrix(), width, height);\n\n    dp1 = vec4.fromValues(m_currPos.x, m_currPos.y, fdp[2], 1.0);\n    dp2 = vec4.fromValues(m_lastPos.x, m_lastPos.y, fdp[2], 1.0);\n\n    wp1 = ren.displayToWorld(dp1, cam.viewMatrix(), cam.projectionMatrix(),\n                             width, height);\n    wp2 = ren.displayToWorld(dp2, cam.viewMatrix(), cam.projectionMatrix(),\n                             width, height);\n\n    dx = wp1[0] - wp2[0];\n    dy = wp1[1] - wp2[1];\n    dz = wp1[2] - wp2[2];\n\n    if (m_midMouseBtnDown) {\n      cam.pan(-dx, -dy, -dz);\n      m_that.viewer().render();\n    }\n    if (m_leftMouseBtnDown) {\n      cam.rotate((m_lastPos.x - m_currPos.x),\n      (m_lastPos.y - m_currPos.y));\n      ren.resetCameraClippingRange();\n      m_that.viewer().render();\n    }\n    if (m_rightMouseBtnDown) {\n      /// 2.0 is the speed up factor\n      m_zTrans = 2.0 * (m_currPos.y - m_lastPos.y) / height;\n\n      // Calculate zoom scale here\n      if (m_zTrans > 0) {\n        cam.zoom(1 - Math.abs(m_zTrans));\n      } else {\n        cam.zoom(1 + Math.abs(m_zTrans));\n      }\n      ren.resetCameraClippingRange();\n      m_that.viewer().render();\n    }\n    m_lastPos.x = m_currPos.x;\n    m_lastPos.y = m_currPos.y;\n    return false;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse down event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.handleMouseDown = function(event) {\n    var coords;\n\n    if (event.button === 0) {\n      m_leftMouseBtnDown = true;\n    }\n    if (event.button === 1) {\n      m_midMouseBtnDown = true;\n    }\n    if (event.button === 2) {\n      m_rightMouseBtnDown = true;\n    }\n    coords = m_that.view.relMouseCoords(event);\n    if (coords.x < 0) {\n      m_lastPos.x = 0;\n    } else {\n      m_lastPos.x = coords.x;\n    }\n    if (coords.y < 0) {\n      m_lastPos.y = 0;\n    } else {\n      m_lastPos.y = coords.y;\n    }\n    return false;\n  };\n\n  // @note We never get mouse up from scroll bar: See the bug report here\n  // http://bugs.jquery.com/ticket/8184\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse up event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.handleMouseUp = function(event) {\n    if (event.button === 0) {\n      m_leftMouseBtnDown = false;\n    }\n    if (event.button === 1) {\n      m_midMouseBtnDown = false;\n    }\n    if (event.button === 2) {\n      m_rightMouseBtnDown = false;\n    }\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse wheel event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseWheel = function(event) {\n    var ren = m_that.viewer().renderWindow().activeRenderer(),\n        cam = ren.camera();\n\n    // TODO Compute zoom factor intelligently\n    if (event.originalEvent.wheelDelta < 0) {\n      cam.zoom(0.9);\n    } else {\n      cam.zoom(1.1);\n    }\n    ren.resetCameraClippingRange();\n    m_that.viewer().render();\n    return true;\n  };\n\n  return this;\n};\ninherit(vgl.trackballInteractorStyle, vgl.interactorStyle);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of pvwInteractorStyle (for ParaViewWeb)\n *\n * @class vgl.pvwInteractorStyle\n * @returns {vgl.pvwInteractorStyle}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.pvwInteractorStyle = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.pvwInteractorStyle)) {\n    return new vgl.pvwInteractorStyle();\n  }\n  vgl.trackballInteractorStyle.call(this);\n  var m_that = this,\n      m_leftMouseButtonDown = false,\n      m_rightMouseButtonDown = false,\n      m_middleMouseButtonDown = false,\n      m_width,\n      m_height,\n      m_renderer,\n      m_camera,\n      m_outsideCanvas,\n      m_coords,\n      m_currentMousePos,\n      m_focalPoint,\n      m_focusWorldPt,\n      m_focusDisplayPt,\n      m_displayPt1,\n      m_displayPt2,\n      m_worldPt1,\n      m_worldPt2,\n      m_dx,\n      m_dy,\n      m_dz,\n      m_zTrans,\n      m_mouseLastPos = {\n        x: 0,\n        y: 0\n      };\n\n  function render() {\n    m_renderer.resetCameraClippingRange();\n    m_that.viewer().render();\n  }\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.handleMouseMove = function(event) {\n    var rens = [], i = null, secCameras = [], deltaxy = null;\n        m_width = m_that.viewer().renderWindow().windowSize()[0];\n        m_height = m_that.viewer().renderWindow().windowSize()[1];\n        m_renderer = m_that.viewer().renderWindow().activeRenderer();\n        m_camera = m_renderer.camera();\n        m_outsideCanvas = false;\n        m_coords = m_that.viewer().relMouseCoords(event);\n        m_currentMousePos = {\n          x: 0,\n          y: 0\n        };\n\n    // Get secondary cameras\n    rens = m_that.viewer().renderWindow().renderers();\n    for (i = 0; i < rens.length; ++i) {\n      if (m_renderer !== rens[i]) {\n        secCameras.push(rens[i].camera());\n      }\n    }\n\n    if ((m_coords.x < 0) || (m_coords.x > m_width)) {\n      m_currentMousePos.x = 0;\n      m_outsideCanvas = true;\n    } else {\n      m_currentMousePos.x = m_coords.x;\n    }\n    if ((m_coords.y < 0) || (m_coords.y > m_height)) {\n      m_currentMousePos.y = 0;\n      m_outsideCanvas = true;\n    } else {\n      m_currentMousePos.y = m_coords.y;\n    }\n    if (m_outsideCanvas === true) {\n      return;\n    }\n    m_focalPoint = m_camera.focalPoint();\n    m_focusWorldPt = vec4.fromValues(m_focalPoint[0], m_focalPoint[1], m_focalPoint[2], 1);\n    m_focusDisplayPt = m_renderer.worldToDisplay(m_focusWorldPt, m_camera.viewMatrix(),\n      m_camera.projectionMatrix(), m_width, m_height);\n    m_displayPt1 = vec4.fromValues(\n      m_currentMousePos.x, m_currentMousePos.y, m_focusDisplayPt[2], 1.0);\n    m_displayPt2 = vec4.fromValues(\n      m_mouseLastPos.x, m_mouseLastPos.y, m_focusDisplayPt[2], 1.0);\n    m_worldPt1 = m_renderer.displayToWorld(\n      m_displayPt1, m_camera.viewMatrix(), m_camera.projectionMatrix(), m_width, m_height);\n    m_worldPt2 = m_renderer.displayToWorld(\n      m_displayPt2, m_camera.viewMatrix(), m_camera.projectionMatrix(), m_width, m_height);\n\n    m_dx = m_worldPt1[0] - m_worldPt2[0];\n    m_dy = m_worldPt1[1] - m_worldPt2[1];\n    m_dz = m_worldPt1[2] - m_worldPt2[2];\n\n    if (m_middleMouseButtonDown) {\n      m_camera.pan(-m_dx, -m_dy, -m_dz);\n      render();\n    }\n    if (m_leftMouseButtonDown) {\n      deltaxy = [(m_mouseLastPos.x - m_currentMousePos.x),\n      (m_mouseLastPos.y - m_currentMousePos.y)];\n      m_camera.rotate(deltaxy[0], deltaxy[1]);\n\n      // Apply rotation to all other cameras\n      for (i = 0; i < secCameras.length; ++i) {\n        secCameras[i].rotate(deltaxy[0], deltaxy[1]);\n      }\n\n      // Apply rotation to all other cameras\n      for (i = 0; i < rens.length; ++i) {\n        rens[i].resetCameraClippingRange();\n      }\n      render();\n    }\n    if (m_rightMouseButtonDown) {\n      /// 2.0 is the speed up factor.\n      m_zTrans = 2.0 * (m_currentMousePos.y - m_mouseLastPos.y) / m_height;\n\n      // Calculate zoom scale here\n      if (m_zTrans > 0) {\n        m_camera.zoom(1 - Math.abs(m_zTrans));\n      } else {\n        m_camera.zoom(1 + Math.abs(m_zTrans));\n      }\n      render();\n    }\n    m_mouseLastPos.x = m_currentMousePos.x;\n    m_mouseLastPos.y = m_currentMousePos.y;\n    return false;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse down event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.handleMouseDown = function(event) {\n    if (event.button === 0) {\n      m_leftMouseButtonDown = true;\n    }\n    if (event.button === 1) {\n      m_middleMouseButtonDown = true;\n    }\n    if (event.button === 2) {\n      m_rightMouseButtonDown = true;\n    }\n    m_coords = m_that.viewer().relMouseCoords(event);\n    if (m_coords.x < 0) {\n      m_mouseLastPos.x = 0;\n    } else {\n      m_mouseLastPos.x = m_coords.x;\n    }\n    if (m_coords.y < 0) {\n      m_mouseLastPos.y = 0;\n    } else {\n      m_mouseLastPos.y = m_coords.y;\n    }\n    return false;\n  };\n\n  // @note We never get mouse up from scroll bar: See the bug report here\n  // http://bugs.jquery.com/ticket/8184\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse up event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.handleMouseUp = function(event) {\n    var canvas = m_that.viewer().canvas();\n    if (event.button === 0) {\n      m_leftMouseButtonDown = false;\n    }\n    if (event.button === 1) {\n      m_middleMouseButtonDown = false;\n    }\n    if (event.button === 2) {\n      m_rightMouseButtonDown = false;\n    }\n    return false;\n  };\n\n  return this;\n};\ninherit(vgl.pvwInteractorStyle, vgl.trackballInteractorStyle);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global window, vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class viewer\n *\n * @param canvas\n * @returns {vgl.viewer}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.viewer = function(canvas) {\n  'use strict';\n\n  if (!(this instanceof vgl.viewer)) {\n    return new vgl.viewer(canvas);\n  }\n\n  vgl.object.call(this);\n\n  var m_that = this,\n      m_canvas = canvas,\n      m_ready = true,\n      m_interactorStyle = null,\n      m_renderer = vgl.renderer(),\n      m_renderWindow = vgl.renderWindow(m_canvas);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get canvas of the viewer\n   *\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.canvas = function() {\n    return m_canvas;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return render window of the viewer\n   *\n   * @returns {vgl.renderWindow}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.renderWindow = function() {\n    return m_renderWindow;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize the viewer\n   *\n   * This is a must call or otherwise render context may not initialized\n   * properly.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.init = function() {\n    if (m_renderWindow !== null) {\n      m_renderWindow.createWindow();\n    }\n    else {\n      console.log(\"[ERROR] No render window attached\");\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get interactor style of the viewer\n   *\n   * @returns {vgl.interactorStyle}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.interactorStyle = function() {\n    return m_interactorStyle;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set interactor style to be used by the viewer\n   *\n   * @param {vgl.interactorStyle} style\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setInteractorStyle = function(style) {\n    if (style !== m_interactorStyle) {\n      m_interactorStyle = style;\n      m_interactorStyle.setViewer(this);\n      this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse down event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseDown = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      // Only prevent default action for right mouse button\n      if (event.button === 2) {\n        fixedEvent.preventDefault();\n      }\n      fixedEvent.state = 'down';\n      fixedEvent.type = vgl.event.mousePress;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse up event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseUp = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.state = 'up';\n      fixedEvent.type = vgl.event.mouseRelease;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseMove = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.mouseMove;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse wheel scroll\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseWheel = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.mouseWheel;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseOut = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.mouseOut;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle key press event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleKeyPress = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.keyPress;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle context menu event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleContextMenu = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.contextMenu;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle click event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleClick = function(event) {\n   if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.click;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle double click event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleDoubleClick = function(event) {\n    if (m_ready === true) {\n      var fixedEvent = $.event.fix(event || window.event);\n      fixedEvent.preventDefault();\n      fixedEvent.type = vgl.event.dblClick;\n      $(m_that).trigger(fixedEvent);\n    }\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get mouse coodinates related to canvas\n   *\n   * @param event\n   * @returns {{x: number, y: number}}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.relMouseCoords = function(event) {\n    if (event.pageX === undefined || event.pageY === undefined) {\n      throw \"Missing attributes pageX and pageY on the event\";\n    }\n\n    var totalOffsetX = 0,\n        totalOffsetY = 0,\n        canvasX = 0,\n        canvasY = 0,\n        currentElement = m_canvas;\n\n    do {\n      totalOffsetX += currentElement.offsetLeft - currentElement.scrollLeft;\n      totalOffsetY += currentElement.offsetTop - currentElement.scrollTop;\n    } while (currentElement = currentElement.offsetParent);\n\n    canvasX = event.pageX - totalOffsetX;\n    canvasY = event.pageY - totalOffsetY;\n\n    return {\n      x: canvasX,\n      y: canvasY\n    };\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.render = function() {\n    m_renderWindow.render();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind canvas mouse events to their default handlers\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bindEventHandlers = function() {\n    $(m_canvas).on('mousedown', this.handleMouseDown);\n    $(m_canvas).on('mouseup', this.handleMouseUp);\n    $(m_canvas).on('mousemove', this.handleMouseMove);\n    $(m_canvas).on('mousewheel', this.handleMouseWheel);\n    $(m_canvas).on('contextmenu', this.handleContextMenu);\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo earlier binded  handlers for canvas mouse events\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.unbindEventHandlers = function() {\n    $(m_canvas).off('mousedown', this.handleMouseDown);\n    $(m_canvas).off('mouseup', this.handleMouseUp);\n    $(m_canvas).off('mousemove', this.handleMouseMove);\n    $(m_canvas).off('mousewheel', this.handleMouseWheel);\n    $(m_canvas).off('contextmenu', this.handleContextMenu);\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function() {\n    this.bindEventHandlers();\n    m_renderWindow.addRenderer(m_renderer);\n  }\n\n  this._init();\n  return this;\n};\n\ninherit(vgl.viewer, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global gl, vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class shader\n *\n * @param type\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.shader = function(type) {\n  'use strict';\n\n  if (!(this instanceof vgl.shader)) {\n    return new vgl.shader(type);\n  }\n  vgl.object.call(this);\n\n  var m_shaderHandle = null,\n      m_compileTimestamp = vgl.timestamp(),\n      m_shaderType = type,\n      m_shaderSource = \"\";\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get shader handle\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.shaderHandle = function() {\n    return m_shaderHandle;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get type of the shader\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.shaderType = function() {\n    return m_shaderType;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get shader source\n   *\n   * @returns {string}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.shaderSource = function() {\n    return m_shaderSource;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set shader source\n   *\n   * @param {string} source\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setShaderSource = function(source) {\n    m_shaderSource = source;\n    this.modified();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compile the shader\n   *\n   * @returns {null}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.compile = function() {\n    if (this.getMTime() < m_compileTimestamp.getMTime()) {\n      return m_shaderHandle;\n    }\n\n    gl.deleteShader(m_shaderHandle);\n    m_shaderHandle = gl.createShader(m_shaderType);\n    gl.shaderSource(m_shaderHandle, m_shaderSource);\n    gl.compileShader(m_shaderHandle);\n\n    // See if it compiled successfully\n    if (!gl.getShaderParameter(m_shaderHandle, gl.COMPILE_STATUS)) {\n      console.log(\"[ERROR] An error occurred compiling the shaders: \"\n                  + gl.getShaderInfoLog(m_shaderHandle));\n      console.log(m_shaderSource);\n      gl.deleteShader(m_shaderHandle);\n      return null;\n    }\n\n    m_compileTimestamp.modified();\n\n    return m_shaderHandle;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Attach shader to the program\n   *\n   * @param programHandle\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.attachShader = function(programHandle) {\n    gl.attachShader(programHandle, m_shaderHandle);\n  };\n};\n\ninherit(vgl.shader, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, gl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instace of class shaderProgram\n *\n * @class\n * @returns {vgl.shaderProgram}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.shaderProgram = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.shaderProgram)) {\n    return new vgl.shaderProgram();\n  }\n  vgl.materialAttribute.call(\n    this, vgl.materialAttributeType.ShaderProgram);\n\n  /** @private */\n  var m_programHandle = 0,\n      m_compileTimestamp = vgl.timestamp(),\n      m_shaders = [],\n      m_uniforms = [],\n      m_vertexAttributes = {},\n      m_uniformNameToLocation = {},\n      m_vertexAttributeNameToLocation = {};\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Query uniform location in the program\n   *\n   * @param name\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.queryUniformLocation = function(name) {\n    return gl.getUniformLocation(m_programHandle, name);\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Query attribute location in the program\n   *\n   * @param name\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.queryAttributeLocation = function(name) {\n    return gl.getAttribLocation(m_programHandle, name);\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add a new shader to the program\n   *\n   * @param shader\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.addShader = function(shader) {\n    if (m_shaders.indexOf(shader) > -1) {\n      return false;\n    }\n\n    var i;\n    for (i = 0; i < m_shaders.length; ++i) {\n      if (m_shaders[i].shaderType() === shader.shaderType()) {\n        m_shaders.splice(m_shaders.indexOf(shader), 1);\n      }\n    }\n\n    m_shaders.push(shader);\n\n    this.modified();\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add a new uniform to the program\n   *\n   * @param uniform\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.addUniform = function(uniform) {\n    if (m_uniforms.indexOf(uniform) > -1) {\n      return false;\n    }\n\n    m_uniforms.push(uniform);\n    this.modified();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add a new vertex attribute to the program\n   *\n   * @param attr\n   * @param key\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.addVertexAttribute = function(attr, key) {\n    m_vertexAttributes[key] = attr;\n\n    this.modified();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get uniform location\n   *\n   * This method does not perform any query into the program but relies on\n   * the fact that it depends on a call to queryUniformLocation earlier.\n   *\n   * @param name\n   * @returns {number}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.uniformLocation = function(name) {\n    return m_uniformNameToLocation[name];\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get attribute location\n   *\n   * This method does not perform any query into the program but relies on the\n   * fact that it depends on a call to queryUniformLocation earlier.\n   *\n   * @param name\n   * @returns {number}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.attributeLocation = function(name) {\n    return m_vertexAttributeNameToLocation[name];\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get uniform object using name as the key\n   *\n   * @param name\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.uniform = function(name) {\n    var i;\n    for (i = 0; i < m_uniforms.length; ++i) {\n      if (m_uniforms[i].name() === name) {\n        return m_uniforms[i];\n      }\n    }\n\n    return null;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update all uniforms\n   *\n   * This method should be used directly unless required\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.updateUniforms = function() {\n    var i;\n\n    for (i = 0; i < m_uniforms.length; ++i) {\n      m_uniforms[i].callGL(m_uniformNameToLocation[m_uniforms[i].name()]);\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Link shader program\n   *\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.link = function() {\n    gl.linkProgram(m_programHandle);\n\n    // If creating the shader program failed, alert\n    if (!gl.getProgramParameter(m_programHandle, gl.LINK_STATUS)) {\n      console.log(\"[ERROR] Unable to initialize the shader program.\");\n      return false;\n    }\n\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Use the shader program\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.use = function() {\n    gl.useProgram(m_programHandle);\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Peform any clean up required when the program gets deleted\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.cleanUp = function() {\n    this.deleteVertexAndFragment();\n    this.deleteProgram();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Delete the shader program\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.deleteProgram = function() {\n    gl.deleteProgram(m_programHandle);\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Delete vertex and fragment shaders\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.deleteVertexAndFragment = function() {\n    var i;\n    for (i = 0; i < m_shaders.length; ++i) {\n      gl.deleteShader(m_shaders[i].shaderHandle());\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind the program with its shaders\n   *\n   * @param renderState\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.bind = function(renderState) {\n    var i = 0;\n\n    if (m_programHandle === 0\n        || (m_compileTimestamp.getMTime() < this.getMTime())) {\n      m_programHandle = gl.createProgram();\n\n      if (m_programHandle === 0) {\n        console.log(\"[ERROR] Cannot create Program Object\");\n        return false;\n      }\n\n      // Compile shaders\n      for (i = 0; i < m_shaders.length; ++i) {\n        m_shaders[i].compile();\n        m_shaders[i].attachShader(m_programHandle);\n      }\n\n      this.bindAttributes();\n\n      // link program\n      if (!this.link()) {\n        console.log(\"[ERROR] Failed to link Program\");\n        this.cleanUp();\n      }\n\n      this.use();\n      this.bindUniforms();\n      m_compileTimestamp.modified();\n    }\n    else {\n      this.use();\n    }\n\n    // Call update callback.\n    for (i = 0; i < m_uniforms.length; ++i) {\n      m_uniforms[i].update(renderState, this);\n    }\n\n    // Now update values to GL.\n    this.updateUniforms();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo binding of the shader program\n   *\n   * @param renderState\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.undoBind = function(renderState) {\n    // Do nothing\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind vertex data\n   *\n   * @param renderState\n   * @param key\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.bindVertexData = function(renderState, key) {\n    if (m_vertexAttributes.hasOwnProperty(key)) {\n      m_vertexAttributes[key].bindVertexData(renderState, key);\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo bind vetex data\n   *\n   * @param renderState\n   * @param key\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.undoBindVertexData = function(renderState, key) {\n    if (m_vertexAttributes.hasOwnProperty(key)) {\n      m_vertexAttributes[key].undoBindVertexData(renderState, key);\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind uniforms\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.bindUniforms = function() {\n    var i;\n    for (i = 0; i < m_uniforms.length; ++i) {\n      m_uniformNameToLocation[m_uniforms[i].name()] = this\n          .queryUniformLocation(m_uniforms[i].name());\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind vertex attributes\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.bindAttributes = function() {\n    var key, name;\n    for (key in m_vertexAttributes) {\n      name = m_vertexAttributes[key].name();\n      gl.bindAttribLocation(m_programHandle, key, name);\n      m_vertexAttributeNameToLocation[name] = key;\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.shaderProgram, vgl.materialAttribute);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global Uint8Array, vgl, gl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class texture\n *\n * @class\n * @returns {vgl.texture}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.texture = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.texture)) {\n    return new vgl.texture();\n  }\n  vgl.materialAttribute.call(\n    this, vgl.materialAttributeType.Texture);\n\n  this.m_width = 0;\n  this.m_height = 0;\n  this.m_depth = 0;\n\n  this.m_textureHandle = null;\n  this.m_textureUnit = 0;\n\n  this.m_pixelFormat = null;\n  this.m_pixelDataType = null;\n\n  this.m_internalFormat = null;\n\n  this.m_image = null;\n\n  var m_setupTimestamp = vgl.timestamp(),\n      m_that = this;\n\n  function activateTextureUnit() {\n    switch (m_that.m_textureUnit) {\n      case 0:\n        gl.activeTexture(gl.TEXTURE0);\n        break;\n      case 1:\n        gl.activeTexture(gl.TEXTURE1);\n        break;\n      case 2:\n        gl.activeTexture(gl.TEXTURE2);\n        break;\n      case 3:\n        gl.activeTexture(gl.TEXTURE3);\n        break;\n      case 4:\n        gl.activeTexture(gl.TEXTURE4);\n        break;\n      case 5:\n        gl.activeTexture(gl.TEXTURE5);\n        break;\n      case 6:\n        gl.activeTexture(gl.TEXTURE6);\n        break;\n      case 7:\n        gl.activeTexture(gl.TEXTURE7);\n        break;\n      case 8:\n        gl.activeTexture(gl.TEXTURE8);\n        break;\n      case 9:\n        gl.activeTexture(gl.TEXTURE9);\n        break;\n      case 10:\n        gl.activeTexture(gl.TEXTURE10);\n        break;\n      case 11:\n        gl.activeTexture(gl.TEXTURE11);\n        break;\n      case 12:\n        gl.activeTexture(gl.TEXTURE12);\n        break;\n      case 13:\n        gl.activeTexture(gl.TEXTURE13);\n        break;\n      case 14:\n        gl.activeTexture(gl.TEXTURE14);\n        break;\n      case 15:\n        gl.activeTexture(gl.TEXTURE15);\n        break;\n      default:\n        throw \"[error] Texture unit \"  + this.m_textureUnit +\n              \" is not supported\";\n    }\n  }\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create texture, update parameters, and bind data\n   *\n   * @param renderState\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setup = function(renderState) {\n    activateTextureUnit();\n\n    gl.deleteTexture(this.m_textureHandle);\n    this.m_textureHandle = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, this.m_textureHandle);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);\n\n    if (this.m_image !== null) {\n      this.updateDimensions();\n      this.computeInternalFormatUsingImage();\n\n      // console.log(\"m_internalFormat \" + this.m_internalFormat);\n      // console.log(\"m_pixelFormat \" + this.m_pixelFormat);\n      // console.log(\"m_pixelDataType \" + this.m_pixelDataType);\n\n      // FOR now support only 2D textures\n      gl.texImage2D(gl.TEXTURE_2D, 0, this.m_internalFormat,\n                    this.m_pixelFormat, this.m_pixelDataType, this.m_image);\n    }\n    else {\n      gl.texImage2D(gl.TEXTURE_2D, 0, this.m_internalFormat,\n                    this.m_pixelFormat, this.m_pixelDataType, null);\n    }\n\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    m_setupTimestamp.modified();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create texture and if already created use it\n   *\n   * @param renderState\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.bind = function(renderState) {\n    // TODO Call setup via material setup\n    if (this.getMTime() > m_setupTimestamp.getMTime()) {\n      this.setup(renderState);\n    }\n\n    activateTextureUnit();\n    gl.bindTexture(gl.TEXTURE_2D, this.m_textureHandle);\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Turn off the use of this texture\n   *\n   * @param renderState\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.undoBind = function(renderState) {\n    gl.bindTexture(gl.TEXTURE_2D, null);\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get image used by the texture\n   *\n   * @returns {vgl.image}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.image = function() {\n    return this.m_image;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set image for the texture\n   *\n   * @param {vgl.image} image\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setImage = function(image) {\n    if (image !== null) {\n      this.m_image = image;\n      this.updateDimensions();\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get texture unit of the texture\n   *\n   * @returns {number}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.textureUnit = function() {\n    return this.m_textureUnit;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set texture unit of the texture. Default is 0.\n   *\n   * @param {number} unit\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setTextureUnit = function(unit) {\n    if (this.m_textureUnit === unit) {\n      return false;\n    }\n\n    this.m_textureUnit = unit;\n    this.modified();\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get width of the texture\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.width = function() {\n    return this.m_width;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set width of the texture\n   *\n   * @param {number} width\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setWidth = function(width) {\n    if (this.m_image === null) {\n      return false;\n    }\n\n    this.m_width = width;\n    this.modified();\n\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get depth of the texture\n   *\n   * @returns {number}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.depth = function() {\n    return this.m_depth;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set depth of the texture\n   *\n   * @param {number} depth\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setDepth = function(depth) {\n    if (this.m_image === null) {\n      return false;\n    }\n\n    this.m_depth = depth;\n    this.modified();\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the texture handle (id) of the texture\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.textureHandle = function() {\n    return this.m_textureHandle;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get internal format of the texture\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.internalFormat = function() {\n    return this.m_internalFormat;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set internal format of the texture\n   *\n   * @param internalFormat\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setInternalFormat = function(internalFormat) {\n    if (this.m_internalFormat !== internalFormat) {\n      this.m_internalFormat = internalFormat;\n      this.modified();\n      return true;\n    }\n\n    return false;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get pixel format of the texture\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.pixelFormat = function() {\n    return this.m_pixelFormat;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set pixel format of the texture\n   *\n   * @param pixelFormat\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setPixelFormat = function(pixelFormat) {\n    if (this.m_image === null) {\n      return false;\n    }\n\n    this.m_pixelFormat = pixelFormat;\n    this.modified();\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get pixel data type\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.pixelDataType = function() {\n    return this.m_pixelDataType;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set pixel data type\n   *\n   * @param pixelDataType\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setPixelDataType = function(pixelDataType) {\n    if (this.m_image === null) {\n      return false;\n    }\n\n    this.m_pixelDataType = pixelDataType;\n\n    this.modified();\n\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute internal format of the texture\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.computeInternalFormatUsingImage = function() {\n    // Currently image does not define internal format\n    // and hence it's pixel format is the only way to query\n    // information on how color has been stored.\n    // switch (this.m_image.pixelFormat()) {\n    // case gl.RGB:\n    // this.m_internalFormat = gl.RGB;\n    // break;\n    // case gl.RGBA:\n    // this.m_internalFormat = gl.RGBA;\n    // break;\n    // case gl.Luminance:\n    // this.m_internalFormat = gl.Luminance;\n    // break;\n    // case gl.LuminanceAlpha:\n    // this.m_internalFormat = gl.LuminanceAlpha;\n    // break;\n    // // Do nothing when image pixel format is none or undefined.\n    // default:\n    // break;\n    // };\n\n    // TODO Fix this\n    this.m_internalFormat = gl.RGBA;\n    this.m_pixelFormat = gl.RGBA;\n    this.m_pixelDataType = gl.UNSIGNED_BYTE;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update texture dimensions\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.updateDimensions = function() {\n    if (this.m_image !== null) {\n      this.m_width = this.m_image.width;\n      this.m_height = this.m_image.height;\n      this.m_depth = 0; // Only 2D images are supported now\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.texture, vgl.materialAttribute);\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class lookupTable\n *\n * @class\n * @returns {vgl.lookupTable}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.lookupTable = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.lookupTable)) {\n    return new vgl.lookupTable();\n  }\n  vgl.texture.call(this);\n\n  var m_setupTimestamp = vgl.timestamp(),\n      m_range = [0,0];\n\n  this.m_colorTable = //paraview bwr colortable\n    [0.07514311,0.468049805,1,1,\n     0.247872569,0.498782363,1,1,\n     0.339526309,0.528909511,1,1,\n     0.409505078,0.558608486,1,1,\n     0.468487184,0.588057293,1,1,\n     0.520796675,0.617435078,1,1,\n     0.568724526,0.646924167,1,1,\n     0.613686735,0.676713218,1,1,\n     0.656658579,0.707001303,1,1,\n     0.698372844,0.738002964,1,1,\n     0.739424025,0.769954435,1,1,\n     0.780330104,0.803121429,1,1,\n     0.821573924,0.837809045,1,1,\n     0.863634967,0.874374691,1,1,\n     0.907017747,0.913245283,1,1,\n     0.936129275,0.938743558,0.983038586,1,\n     0.943467973,0.943498599,0.943398095,1,\n     0.990146732,0.928791426,0.917447482,1,\n     1,0.88332677,0.861943246,1,\n     1,0.833985467,0.803839606,1,\n     1,0.788626485,0.750707739,1,\n     1,0.746206642,0.701389973,1,\n     1,0.70590052,0.654994046,1,\n     1,0.667019783,0.610806959,1,\n     1,0.6289553,0.568237474,1,\n     1,0.591130233,0.526775617,1,\n     1,0.552955184,0.485962266,1,\n     1,0.513776083,0.445364274,1,\n     1,0.472800903,0.404551679,1,\n     1,0.428977855,0.363073592,1,\n     1,0.380759558,0.320428137,1,\n     0.961891484,0.313155629,0.265499262,1,\n     0.916482116,0.236630659,0.209939162,1].map(\n             function(x) {return x*255;});\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create lookup table, initialize parameters, and bind data to it\n   *\n   * @param {vgl.renderState} renderState\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setup = function(renderState) {\n    if (this.textureUnit() === 0) {\n      gl.activeTexture(gl.TEXTURE0);\n    } else if (this.textureUnit() === 1) {\n      gl.activeTexture(gl.TEXTURE1);\n    }\n\n    gl.deleteTexture(this.m_textureHandle);\n    this.m_textureHandle = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, this.m_textureHandle);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n    gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\n\n    this.m_width = this.m_colorTable.length/4;\n    this.m_height = 1;\n    this.m_depth = 0;\n    gl.texImage2D(gl.TEXTURE_2D,\n                  0, gl.RGBA, this.m_width, this.m_height, this.m_depth,\n                  gl.RGBA, gl.UNSIGNED_BYTE, new Uint8Array(this.m_colorTable));\n\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    m_setupTimestamp.modified();\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get color table used by the lookup table\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.colorTable = function() {\n    return this.m_colorTable;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set color table used by the lookup table\n   *\n   * @param colors\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setColorTable = function(colors) {\n    if (this.m_colorTable === colors) {\n      return false;\n    }\n\n    this.m_colorTable = colors;\n    this.modified();\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get scalar range\n   *\n   * @returns {Array}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.range = function() {\n    return m_range;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set scalar range for the lookup table\n   *\n   * @param range\n   * @returns {boolean}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.setRange = function(range) {\n    if (m_range === range) {\n      return false;\n    }\n    m_range = range;\n    this.modified();\n    return true;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Given a [min,max] range update the lookup table range\n   *\n   * @param range\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.updateRange = function(range) {\n    if (!(range instanceof Array)) {\n      console.log('[error] Invalid data type for range. Requires array [min,max]');\n    }\n\n    if (range[0] < m_range[0]) {\n      m_range[0] = range[0];\n      this.modified();\n    }\n\n    if (range[1] > m_range[1]) {\n      m_range[1] = range[1];\n      this.modified();\n    }\n  };\n\n  return this;\n};\n\ninherit(vgl.lookupTable, vgl.texture);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, gl, ogs, vec2, vec3, vec4, mat3, mat4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class uniform\n *\n * @param type\n * @param name\n * @returns {vgl.uniform} OpenGL uniform encapsulation\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.uniform = function(type, name) {\n  'use strict';\n\n  if (!(this instanceof vgl.uniform)) {\n    return new vgl.uniform();\n  }\n\n  this.getTypeNumberOfComponents = function(type) {\n    switch (type) {\n      case gl.FLOAT:\n      case gl.INT:\n      case gl.BOOL:\n        return 1;\n\n      case gl.FLOAT_VEC2:\n      case gl.INT_VEC2:\n      case gl.BOOL_VEC2:\n        return 2;\n\n      case gl.FLOAT_VEC3:\n      case gl.INT_VEC3:\n      case gl.BOOLT_VEC3:\n        return 3;\n\n      case gl.FLOAT_VEC4:\n      case gl.INT_VEC4:\n      case gl.BOOL_VEC4:\n        return 4;\n\n      case gl.FLOAT_MAT3:\n        return 9;\n\n      case gl.FLOAT_MAT4:\n        return 16;\n\n      default:\n        return 0;\n    }\n  };\n\n  var m_type = type,\n      m_name = name,\n      m_dataArray = [],\n      m_numberOfElements = 1;\n\n  m_dataArray.length = this.getTypeNumberOfComponents(m_type);\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get name of the uniform\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.name = function() {\n    return m_name;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get type of the uniform\n   *\n   * @returns {*}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.type = function() {\n    return m_type;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get value of the uniform\n   *\n   * @returns {Array}\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.get = function() {\n    return m_dataArray;\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set value of the uniform\n   *\n   * @param value\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.set = function(value) {\n    var i = 0;\n    if (m_dataArray.length === 16) {\n      for (i = 0; i < 16; ++i) {\n        m_dataArray[i] = value[i];\n      }\n    }\n    else if (m_dataArray.length === 9) {\n      for (i = 0; i < 9; ++i) {\n        m_dataArray[i] = value[i];\n      }\n    }\n    else if (m_dataArray.length === 4) {\n      for (i = 0; i < 4; ++i) {\n        m_dataArray[i] = value[i];\n      }\n    }\n    else if (m_dataArray.length === 3) {\n      for (i = 0; i < 3; ++i) {\n        m_dataArray[i] = value[i];\n      }\n    }\n    else if (m_dataArray.length === 2) {\n      for (i = 0; i < 2; ++i) {\n        m_dataArray[i] = value[i];\n      }\n    }\n    else {\n      m_dataArray[0] = value;\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Call GL and pass updated values to the current shader\n   *\n   * @param location\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.callGL = function(location) {\n    if (this.m_numberElements < 1) {\n      return;\n    }\n\n    switch (m_type) {\n      case gl.BOOL:\n      case gl.INT:\n        gl.uniform1iv(location, m_dataArray);\n        break;\n      case gl.FLOAT:\n        gl.uniform1fv(location, m_dataArray);\n        break;\n      case gl.FLOAT_VEC2:\n        gl.uniform2fv(location, m_dataArray);\n        break;\n      case gl.FLOAT_VEC3:\n        gl.uniform3fv(location, m_dataArray);\n        break;\n      case gl.FLOAT_VEC4:\n        gl.uniform4fv(location, m_dataArray);\n        break;\n      case gl.FLOAT_MAT3:\n        gl.uniformMatrix3fv(location, gl.FALSE, m_dataArray);\n        break;\n      case gl.FLOAT_MAT4:\n        gl.uniformMatrix4fv(location, gl.FALSE, m_dataArray);\n        break;\n      default:\n        break;\n    }\n  };\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Virtual method to update the uniform\n   *\n   * Should be implemented by the derived class.\n   *\n   * @param renderState\n   * @param program\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.update = function(renderState, program) {\n    // Should be implemented by the derived class\n  };\n\n  return this;\n};\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create new instance of class modelViewUniform\n *\n * @param name\n * @returns {vgl.modelViewUniform}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.modelViewUniform = function(name) {\n  'use strict';\n\n  if (!(this instanceof vgl.modelViewUniform)) {\n    return new vgl.modelViewUniform(name);\n  }\n\n  if (name.length === 0) {\n    name = \"modelViewMatrix\";\n  }\n\n  vgl.uniform.call(this, gl.FLOAT_MAT4, name);\n\n  this.set(mat4.create());\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update the uniform given a render state and shader program\n   *\n   * @param {vgl.renderState} renderState\n   * @param {vgl.shaderProgram} program\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.update = function(renderState, program) {\n    this.set(renderState.m_modelViewMatrix);\n  };\n\n  return this;\n};\n\ninherit(vgl.modelViewUniform, vgl.uniform);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class projectionUniform\n *\n * @param name\n * @returns {vgl.projectionUniform}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.projectionUniform = function(name) {\n  'use strict';\n\n  if (!(this instanceof vgl.projectionUniform)) {\n    return new vgl.projectionUniform(name);\n  }\n\n  if (name.length === 0) {\n    name = \"projectionMatrix\";\n  }\n\n  vgl.uniform.call(this, gl.FLOAT_MAT4, name);\n\n  this.set(mat4.create());\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update the uniform given a render state and shader program\n   *\n   * @param renderState\n   * @param program\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.update = function(renderState, program) {\n    this.set(renderState.m_projectionMatrix);\n  };\n\n  return this;\n};\n\ninherit(vgl.projectionUniform, vgl.uniform);\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class floatUniform\n *\n * @param name\n * @param value\n * @returns {vgl.floatUniform}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.floatUniform = function(name, value) {\n  'use strict';\n\n  if (!(this instanceof vgl.floatUniform)) {\n    return new vgl.floatUniform(name, value);\n  }\n\n  if (name.length === 0) {\n    name = \"floatUniform\";\n  }\n\n  value = value === undefined ? 1.0 : value;\n\n  vgl.uniform.call(this, gl.FLOAT, name);\n\n  this.set(value);\n};\n\ninherit(vgl.floatUniform, vgl.uniform);\n\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create new instance of class normalMatrixUniform\n *\n * @param name\n * @returns {vgl.normalMatrixUniform}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.normalMatrixUniform = function(name) {\n  'use strict';\n\n  if (!(this instanceof vgl.normalMatrixUniform)) {\n    return new vgl.normalMatrixUniform(name);\n  }\n\n  if (name.length === 0) {\n    name = \"normalMatrix\";\n  }\n\n  vgl.uniform.call(this, gl.FLOAT_MAT4, name);\n\n  this.set(mat4.create());\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update the uniform given a render state and shader program\n   *\n   * @param {vgl.renderState} renderState\n   * @param {vgl.shaderProgram} program\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.update = function(renderState, program) {\n    this.set(renderState.m_normalMatrix);\n  };\n\n  return this;\n};\n\ninherit(vgl.normalMatrixUniform, vgl.uniform);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, gl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Keys to identify vertex attributes\n *\n * @type {{Position: number, Normal: number, TextureCoordinate: number,\n *         Color: number, Scalar: number, Scalar2: number, Scalar3: number,\n *         Scalar4: number, Scalar5: number, Scalar6: number, Scalar7: number,\n *         CountAttributeIndex: number}}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.vertexAttributeKeys = {\n  \"Position\" : 0,\n  \"Normal\" : 1,\n  \"TextureCoordinate\" : 2,\n  \"Color\" : 3,\n  \"CountAttributeIndex\" : 4\n};\n\nvgl.vertexAttributeKeysIndexed = {\n  \"Zero\" : 0,\n  \"One\" : 1,\n  \"Two\" : 2,\n  \"Three\" : 3,\n  \"Four\" : 4,\n  \"Five\" : 5,\n  \"Six\" : 6,\n  \"Seven\" : 7,\n  \"Eight\" : 8,\n  \"Nine\" : 9\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of vertexAttribute\n *\n * @param {string} name\n * @returns {vgl.vertexAttribute}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.vertexAttribute = function(name) {\n  'use strict';\n\n  if (!(this instanceof vgl.vertexAttribute)) {\n    return new vgl.vertexAttribute(name);\n  }\n\n  var m_name = name;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get name of the vertex attribute\n   *\n   * @returns {string}\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.name = function() {\n    return m_name;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Bind vertex data to the given render state\n   *\n   * @param {vgl.renderState} renderState\n   * @param {vgl.vertexAttributeKeys} key\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.bindVertexData = function(renderState, key) {\n    var geometryData = renderState.m_mapper.geometryData(),\n        sourceData = geometryData.sourceData(key),\n        program = renderState.m_material.shaderProgram();\n\n    gl.vertexAttribPointer(program.attributeLocation(m_name), sourceData\n        .attributeNumberOfComponents(key), sourceData.attributeDataType(key),\n                           sourceData.normalized(key), sourceData\n                               .attributeStride(key), sourceData\n                               .attributeOffset(key));\n\n    gl.enableVertexAttribArray(program.attributeLocation(m_name));\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Undo bind vertex data for a given render state\n   *\n   * @param {vgl.renderState} renderState\n   * @param {vgl.vertexAttributeKeys} key\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.undoBindVertexData = function(renderState, key) {\n    var program = renderState.m_material.shaderProgram();\n\n    gl.disableVertexAttribArray(program.attributeLocation(m_name));\n  };\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n///////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class source\n *\n * @returns {vgl.source}\n */\n///////////////////////////////////////////////////////////////////////////////\nvgl.source = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.source)) {\n    return new vgl.source();\n  }\n\n  vgl.object.call(this);\n\n  /////////////////////////////////////////////////////////////////////////////\n  /**\n   * Virtual function to create a source instance\n   */\n  /////////////////////////////////////////////////////////////////////////////\n  this.create = function() {\n  };\n\n  return this;\n};\n\ninherit(vgl.source, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class planeSource\n *\n * @class\n * @returns {vgl.planeSource}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.planeSource = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.planeSource)) {\n    return new vgl.planeSource();\n  }\n  vgl.source.call(this);\n\n  var m_origin = [ 0.0, 0.0, 0.0 ],\n      m_point1 = [ 1.0, 0.0, 0.0 ],\n      m_point2 = [ 0.0, 1.0, 0.0 ],\n      m_normal = [ 0.0, 0.0, 1.0 ],\n      m_xresolution = 1,\n      m_yresolution = 1,\n      m_geom = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set origin of the plane\n   *\n   * @param x\n   * @param y\n   * @param z\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setOrigin = function(x, y, z) {\n    m_origin[0] = x;\n    m_origin[1] = y;\n    m_origin[2] = z;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set point that defines the first axis of the plane\n   *\n   * @param x\n   * @param y\n   * @param z\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setPoint1 = function(x, y, z) {\n    m_point1[0] = x;\n    m_point1[1] = y;\n    m_point1[2] = z;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set point that defines the first axis of the plane\n   *\n   * @param x\n   * @param y\n   * @param z\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setPoint2 = function(x, y, z) {\n    m_point2[0] = x;\n    m_point2[1] = y;\n    m_point2[2] = z;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create a plane geometry given input parameters\n   *\n   * @returns {null}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.create = function() {\n    m_geom = new vgl.geometryData();\n\n    var x = [], tc = [], v1 = [], v2 = [],\n        pts = [], i, j, k, ii, numPts, numPolys,\n        posIndex = 0, normIndex = 0, colorIndex = 0, texCoordIndex = 0,\n        positions = [], normals = [], colors = [],\n        texCoords = [], indices = [], tristrip = null,\n        sourcePositions = null, sourceColors = null, sourceTexCoords;\n\n    x.length = 3;\n    tc.length = 2;\n    v1.length = 3;\n    v2.length = 3;\n    pts.length = 3;\n\n    // Check input\n    for (i = 0; i < 3; i++) {\n      v1[i] = m_point1[i] - m_origin[i];\n      v2[i] = m_point2[i] - m_origin[i];\n    }\n\n    // TODO Compute center and normal\n    // Set things up; allocate memory\n    numPts = (m_xresolution + 1) * (m_yresolution + 1);\n    numPolys = m_xresolution * m_yresolution * 2;\n    positions.length = 3 * numPts;\n    normals.length = 3 * numPts;\n    texCoords.length = 2 * numPts;\n    indices.length = numPts;\n\n    for (k = 0, i = 0; i < (m_yresolution + 1); i++) {\n      tc[1] = i / m_yresolution;\n\n      for (j = 0; j < (m_xresolution + 1); j++) {\n        tc[0] = j / m_xresolution;\n\n        for (ii = 0; ii < 3; ii++) {\n          x[ii] = m_origin[ii] + tc[0] * v1[ii] + tc[1] * v2[ii];\n        }\n\n        positions[posIndex++] = x[0];\n        positions[posIndex++] = x[1];\n        positions[posIndex++] = x[2];\n\n        colors[colorIndex++] = 1.0;\n        colors[colorIndex++] = 1.0;\n        colors[colorIndex++] = 1.0;\n\n        normals[normIndex++] = m_normal[0];\n        normals[normIndex++] = m_normal[1];\n        normals[normIndex++] = m_normal[2];\n\n        texCoords[texCoordIndex++] = tc[0];\n        texCoords[texCoordIndex++] = tc[1];\n      }\n    }\n\n    /// Generate polygon connectivity\n    for (i = 0; i < m_yresolution; i++) {\n      for (j = 0; j < m_xresolution; j++) {\n        pts[0] = j + i * (m_xresolution + 1);\n        pts[1] = pts[0] + 1;\n        pts[2] = pts[0] + m_xresolution + 2;\n        pts[3] = pts[0] + m_xresolution + 1;\n      }\n    }\n\n    for (i = 0; i < numPts; ++i) {\n      indices[i] = i;\n    }\n\n    tristrip = new vgl.triangleStrip();\n    tristrip.setIndices(indices);\n\n    sourcePositions = vgl.sourceDataP3fv();\n    sourcePositions.pushBack(positions);\n\n    sourceColors = vgl.sourceDataC3fv();\n    sourceColors.pushBack(colors);\n\n    sourceTexCoords = vgl.sourceDataT2fv();\n    sourceTexCoords.pushBack(texCoords);\n\n    m_geom.addSource(sourcePositions);\n    m_geom.addSource(sourceColors);\n    m_geom.addSource(sourceTexCoords);\n    m_geom.addPrimitive(tristrip);\n\n    return m_geom;\n  };\n};\n\ninherit(vgl.planeSource, vgl.source);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class pointSource\n *\n * @class\n * @returns {vgl.pointSource}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.pointSource = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.pointSource)) {\n    return new vgl.pointSource();\n  }\n  vgl.source.call(this);\n\n  var m_this = this,\n      m_positions = [],\n      m_colors = [],\n      m_textureCoords = [],\n      m_size = [],\n      m_geom = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get positions for the points\n   *\n   * @param positions\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getPositions = function(positions) {\n    return m_positions;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set positions for the source\n   *\n   * @param positions\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setPositions = function(positions) {\n    if (positions instanceof Array) {\n      m_positions = positions;\n    }\n    else {\n      console\n          .log(\"[ERROR] Invalid data type for positions. Array is required.\");\n    }\n    m_this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get colors for the points\n   *\n   * @param positions\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getColors = function(positions) {\n    return m_colors;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set colors for the points\n   *\n   * @param colors\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setColors = function(colors) {\n    if (colors instanceof Array) {\n      m_colors = colors;\n    }\n    else {\n      console.log(\"[ERROR] Invalid data type for colors. Array is required.\");\n    }\n\n    m_this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get colors for the points\n   *\n   * @param positions\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getSize = function(positions) {\n    return m_size;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set colors for the points\n   *\n   * @param colors\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setSize = function(size) {\n    m_size = size;\n    this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set texture coordinates for the points\n   *\n   * @param texcoords\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setTextureCoordinates = function(texcoords) {\n    if (texcoords instanceof Array) {\n      m_textureCoords = texcoords;\n    }\n    else {\n      console.log(\"[ERROR] Invalid data type for \"\n                  + \"texture coordinates. Array is required.\");\n    }\n    m_this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create a point geometry given input parameters\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.create = function() {\n    m_geom = new vgl.geometryData();\n\n    if (m_positions.length % 3 !== 0) {\n      console.log(\"[ERROR] Invalid length of the points array\");\n      return;\n    }\n\n    var numPts = m_positions.length / 3,\n        i = 0,\n        indices = [],\n        pointsPrimitive,\n        sourcePositions,\n        sourceColors,\n        sourceTexCoords,\n        sourceSize;\n\n    indices.length = numPts;\n    for (i = 0; i < numPts; ++i) {\n      indices[i] = i;\n    }\n\n    /// Generate array of size if needed\n    sourceSize = vgl.sourceDataDf();\n    if (numPts !== m_size.length) {\n      for (i = 0; i < numPts; ++i) {\n       sourceSize.pushBack(m_size);\n      }\n    } else {\n      sourceSize.setData(m_size);\n    }\n    m_geom.addSource(sourceSize);\n\n    pointsPrimitive = new vgl.points();\n    pointsPrimitive.setIndices(indices);\n\n    sourcePositions = vgl.sourceDataP3fv();\n    sourcePositions.pushBack(m_positions);\n    m_geom.addSource(sourcePositions);\n\n    if ((m_colors.length > 0) && m_colors.length === m_positions.length) {\n      sourceColors = vgl.sourceDataC3fv();\n      sourceColors.pushBack(m_colors);\n      m_geom.addSource(sourceColors);\n    }\n    else if ((m_colors.length > 0) && m_colors.length !== m_positions.length) {\n      console\n          .log(\"[ERROR] Number of colors are different than number of points\");\n    }\n\n    if ((m_textureCoords.length > 0)\n        && m_textureCoords.length === m_positions.length) {\n      sourceTexCoords = vgl.sourceDataT2fv();\n      sourceTexCoords.pushBack(m_textureCoords);\n      m_geom.addSource(sourceTexCoords);\n    }\n    else if ((m_textureCoords.length > 0)\n             && (m_textureCoords.length / 2) !== (m_positions.length / 3)) {\n      console\n          .log(\"[ERROR] Number of texture coordinates are different than number of points\");\n    }\n\n\n    m_geom.addPrimitive(pointsPrimitive);\n\n    return m_geom;\n  };\n};\n\ninherit(vgl.pointSource, vgl.source);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class lineSource\n *\n * @class\n * @returns {vgl.lineSource}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.lineSource = function(positions, colors) {\n  'use strict';\n\n  if (!(this instanceof vgl.lineSource)) {\n    return new vgl.lineSource();\n  }\n  vgl.source.call(this);\n\n  var m_positions = positions,\n      m_colors = colors,\n      m_height = null,\n      m_geom = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set start positions for the lines\n   *\n   * @param positions\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setPositions = function(positions) {\n    if (positions instanceof Array) {\n      m_positions = positions;\n      this.modified();\n      return true;\n    }\n\n    console\n      .log(\"[ERROR] Invalid data type for positions. Array is required.\");\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set colors for the lines\n   *\n   * @param colors\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setColors = function(colors) {\n    if (colors instanceof Array) {\n      m_colors = colors;\n      this.modified();\n      return true;\n    }\n\n    console.log(\"[ERROR] Invalid data type for colors. Array is required.\");\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create a point geometry given input parameters\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.create = function() {\n    if (!m_positions) {\n      console.log(\"[error] Invalid positions\");\n      return;\n    }\n\n    if (m_positions.length % 3 !== 0) {\n      console.log(\"[error] Line source requires 3d points\");\n      return;\n    }\n\n    if (m_positions.length % 3 !== 0) {\n      console.log(\"[ERROR] Invalid length of the points array\");\n      return;\n    }\n\n    var m_geom = new vgl.geometryData(),\n        numPts = m_positions.length / 3,\n        i,\n        indices = [],\n        linesPrimitive,\n        sourcePositions,\n        sourceColors;\n\n    indices.length = numPts;\n\n    for (i = 0; i < numPts; ++i) {\n      indices[i] = i;\n    }\n\n    linesPrimitive = new vgl.lines();\n    linesPrimitive.setIndices(indices);\n\n    sourcePositions = vgl.sourceDataP3fv();\n    sourcePositions.pushBack(m_positions);\n    m_geom.addSource(sourcePositions);\n\n    if ( m_colors && (m_colors.length > 0) &&\n         m_colors.length === m_positions.length) {\n      sourceColors = vgl.sourceDataC3fv();\n      sourceColors.pushBack(m_colors);\n      m_geom.addSource(sourceColors);\n    }\n    else if (m_colors && (m_colors.length > 0) &&\n             m_colors.length !== m_positions.length) {\n      console\n        .log(\"[error] Number of colors are different than number of points\");\n    }\n\n    m_geom.addPrimitive(linesPrimitive);\n\n    return m_geom;\n  };\n};\n\ninherit(vgl.lineSource, vgl.source);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global document, vgl, gl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class utils\n *\n * Utility class provides helper functions such as functions to create\n * shaders, geometry etc.\n *\n * @returns {vgl.utils}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.utils)) {\n    return new vgl.utils();\n  }\n  vgl.object.call(this);\n\n  return this;\n};\n\ninherit(vgl.utils, vgl.object);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Helper function to compute power of 2 number\n *\n * @param value\n * @param pow\n *\n * @returns {number}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.computePowerOfTwo = function(value, pow) {\n  'use strict';\n  pow = pow || 1;\n  while (pow < value) {\n    pow *= 2;\n  }\n  return pow;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of default vertex shader that uses a texture\n *\n * Helper function to create default vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createTextureVertexShader = function(context) {\n  'use strict';\n  var vertexShaderSource = [\n        'attribute vec3 vertexPosition;',\n        'attribute vec3 textureCoord;',\n        'uniform mediump float pointSize;',\n        'uniform mat4 modelViewMatrix;',\n        'uniform mat4 projectionMatrix;',\n        'varying highp vec3 iTextureCoord;',\n        'void main(void)',\n        '{',\n        'gl_PointSize = pointSize;',\n        'gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);',\n        ' iTextureCoord = textureCoord;', '}' ].join('\\n'),\n      shader = new vgl.shader(gl.VERTEX_SHADER);\n  shader.setShaderSource(vertexShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of default fragment shader that uses a texture\n *\n * Helper function to create default fragment shader with sampler\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createTextureFragmentShader = function(context) {\n  'use strict';\n  var fragmentShaderSource = [\n        'varying highp vec3 iTextureCoord;',\n        'uniform sampler2D sampler2d;',\n        'uniform mediump float opacity;',\n        'void main(void) {',\n        'gl_FragColor = vec4(texture2D(sampler2d, vec2(iTextureCoord.s, iTextureCoord.t)).xyz, opacity);',\n        '}' ].join('\\n'),\n      shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create variation of createTextureFragmentShader which uses texture alpha\n *\n * Helper function to create default fragment shader with sampler\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createRgbaTextureFragmentShader = function(context) {\n  'use strict';\n  var fragmentShaderSource = [\n        'varying highp vec3 iTextureCoord;',\n        'uniform sampler2D sampler2d;',\n        'void main(void) {',\n        'gl_FragColor = vec4(texture2D(sampler2d, vec2(iTextureCoord.s, iTextureCoord.t)).xyzw);',\n        '}' ].join('\\n'),\n      shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of default vertex shader\n *\n * Helper function to create default vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createVertexShader = function(context) {\n  'use strict';\n  var vertexShaderSource = [\n        'attribute vec3 vertexPosition;',\n        'attribute vec3 vertexColor;',\n        'uniform mediump float pointSize;',\n        'uniform mat4 modelViewMatrix;',\n        'uniform mat4 projectionMatrix;',\n        'varying mediump vec3 iVertexColor;',\n        'varying highp vec3 iTextureCoord;',\n        'void main(void)',\n        '{',\n        'gl_PointSize = pointSize;',\n        'gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);',\n        ' iVertexColor = vertexColor;', '}' ].join('\\n'),\n      shader = new vgl.shader(gl.VERTEX_SHADER);\n\n  shader.setShaderSource(vertexShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of default vertex shader\n *\n * Helper function to create default vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPointVertexShader = function(context) {\n  'use strict';\n  var vertexShaderSource = [\n        'attribute vec3 vertexPosition;',\n        'attribute vec3 vertexColor;',\n        'attribute float vertexSize;',\n        'uniform mat4 modelViewMatrix;',\n        'uniform mat4 projectionMatrix;',\n        'varying mediump vec3 iVertexColor;',\n        'varying highp vec3 iTextureCoord;',\n        'void main(void)',\n        '{',\n        'gl_PointSize =  vertexSize;',\n        'gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);',\n        ' iVertexColor = vertexColor;', '}' ].join('\\n'),\n      shader = new vgl.shader(gl.VERTEX_SHADER);\n\n  shader.setShaderSource(vertexShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of vertex shader with a solid color\n *\n * Helper function to create default vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createVertexShaderSolidColor = function(context) {\n  'use strict';\n  var vertexShaderSource = [\n        'attribute vec3 vertexPosition;',\n        'uniform mediump float pointSize;',\n        'uniform mat4 modelViewMatrix;',\n        'uniform mat4 projectionMatrix;',\n        'void main(void)',\n        '{',\n        'gl_PointSize = pointSize;',\n        'gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);',\n        '}' ].join('\\n'),\n    shader = new vgl.shader(gl.VERTEX_SHADER);\n\n  shader.setShaderSource(vertexShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of vertex shader that passes values through\n * for color mapping\n *\n * Helper function to create default vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createVertexShaderColorMap = function(context, min, max) {\n  'use strict';\n  var vertexShaderSource = [\n        'attribute vec3 vertexPosition;',\n        'attribute float vertexScalar;',\n        'uniform mediump float pointSize;',\n        'uniform mat4 modelViewMatrix;',\n        'uniform mat4 projectionMatrix;',\n        'uniform float lutMin;',\n        'uniform float lutMax;',\n        'varying mediump float iVertexScalar;',\n        'void main(void)',\n        '{',\n        'gl_PointSize = pointSize;',\n        'gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition, 1.0);',\n        'iVertexScalar = (vertexScalar-lutMin)/(lutMax-lutMin);',\n        '}' ].join('\\n'),\n      shader = new vgl.shader(gl.VERTEX_SHADER);\n\n  shader.setShaderSource(vertexShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of default fragment shader\n *\n * Helper function to create default fragment shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createFragmentShader = function(context) {\n  'use strict';\n  var fragmentShaderSource = [ 'varying mediump vec3 iVertexColor;',\n                              'uniform mediump float opacity;',\n                              'void main(void) {',\n                              'gl_FragColor = vec4(iVertexColor, opacity);',\n                              '}' ].join('\\n'),\n      shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a Phong vertex shader\n *\n * Helper function to create Phong vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPhongVertexShader = function(context) {\n  'use strict';\n\n  var vertexShaderSource = [\n      'attribute highp vec3 vertexPosition;',\n      'attribute mediump vec3 vertexNormal;',\n      'attribute mediump vec3 vertexColor;',\n\n      'uniform highp mat4 projectionMatrix;',\n      'uniform mat4 modelViewMatrix;',\n      'uniform mat4 normalMatrix;',\n\n      'varying highp vec4 varPosition;',\n      'varying mediump vec3 varNormal;',\n      'varying mediump vec3 iVertexColor;',\n\n      'void main(void)',\n      '{',\n      'varPosition = modelViewMatrix * vec4(vertexPosition, 1.0);',\n      'gl_Position = projectionMatrix * varPosition;',\n      'varNormal = vec3(normalMatrix * vec4(vertexNormal, 0.0));',\n      'iVertexColor = vertexColor;',\n      '}' ].join('\\n'),\n\n      shader = new vgl.shader(gl.VERTEX_SHADER);\n\n  shader.setShaderSource(vertexShaderSource);\n\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of Phong fragment shader\n *\n * Helper function to create Phong fragment shader\n *\n * NOTE: Shader assumes directional light\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPhongFragmentShader = function(context) {\n  'use strict';\n  var fragmentShaderSource = [\n    'precision mediump float;',\n    'varying vec3 varNormal;',\n    'varying vec4 varPosition;',\n    'varying mediump vec3 iVertexColor;',\n    'const vec3 lightPos = vec3(0.0, 0.0,10000.0);',\n    'const vec3 ambientColor = vec3(0.01, 0.01, 0.01);',\n    'const vec3 specColor = vec3(1.0, 1.0, 1.0);',\n\n    'void main() {',\n    'vec3 normal = normalize(varNormal);',\n    'vec3 lightDir = normalize(lightPos);',\n    'vec3 reflectDir = -reflect(lightDir, normal);',\n    'vec3 viewDir = normalize(-varPosition.xyz);',\n\n    'float lambertian = max(dot(lightDir,normal), 0.0);',\n    'float specular = 0.0;',\n\n    'if(lambertian > 0.0) {',\n    'float specAngle = max(dot(reflectDir, viewDir), 0.0);',\n    'specular = pow(specAngle, 64.0);',\n    '}',\n    'gl_FragColor = vec4(ambientColor +',\n    'lambertian*iVertexColor +',\n    'specular*specColor, 1.0);',\n    '}' ].join('\\n'),\n    shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of fragment shader with an assigned constant color.\n *\n * Helper function to create default fragment shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createFragmentShaderSolidColor = function(context, color) {\n  'use strict';\n  var fragmentShaderSource = ['uniform mediump float opacity;',\n                              'void main(void) {',\n                              'gl_FragColor = vec4(' + color[0] + ',' + color[1] + ',' + color[2] + ', opacity);',\n                              '}' ].join('\\n'),\n      shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of fragment shader that maps values into colors bia lookup table\n *\n * Helper function to create default fragment shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createFragmentShaderColorMap = function(context) {\n  'use strict';\n  var fragmentShaderSource = [\n        'varying mediump float iVertexScalar;',\n        'uniform sampler2D sampler2d;',\n        'uniform mediump float opacity;',\n        'void main(void) {',\n        'gl_FragColor = vec4(texture2D(sampler2d, vec2(iVertexScalar, 0.0)).xyz, opacity);',\n        '}' ].join('\\n'),\n      shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of vertex shader for point sprites\n *\n * Helper function to create default point sprites vertex shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPointSpritesVertexShader = function(context) {\n  'use strict';\n  var vertexShaderSource = [\n        'attribute vec3 vertexPosition;',\n        'attribute vec3 vertexColor;',\n        'uniform mediump vec2 pointSize;',\n        'uniform mat4 modelViewMatrix;',\n        'uniform mat4 projectionMatrix;',\n        'uniform float height;',\n        'varying mediump vec3 iVertexColor;',\n        'varying highp float iVertexScalar;',\n        'void main(void)',\n        '{',\n        'mediump float realPointSize = pointSize.y;',\n        'if (pointSize.x > pointSize.y) {',\n        '  realPointSize = pointSize.x;}',\n        'gl_PointSize = realPointSize ;',\n        'iVertexScalar = vertexPosition.z;',\n        'gl_Position = projectionMatrix * modelViewMatrix * vec4(vertexPosition.xy, height, 1.0);',\n        ' iVertexColor = vertexColor;', '}' ].join('\\n'),\n      shader = new vgl.shader(gl.VERTEX_SHADER);\n  shader.setShaderSource(vertexShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of fragment shader for point sprites\n *\n * Helper function to create default point sprites fragment shader\n *\n * @param context\n * @returns {vgl.shader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPointSpritesFragmentShader = function(context) {\n  'use strict';\n  var fragmentShaderSource = [\n        'varying mediump vec3 iVertexColor;',\n        'varying highp float iVertexScalar;',\n        'uniform sampler2D opacityLookup;',\n        'uniform highp float lutMin;',\n        'uniform highp float lutMax;',\n        'uniform sampler2D scalarsToColors;',\n        'uniform int useScalarsToColors;',\n        'uniform int useVertexColors;',\n        'uniform mediump vec2 pointSize;',\n        'uniform mediump float vertexColorWeight;',\n        'void main(void) {',\n        'mediump vec2 realTexCoord;',\n        'if (pointSize.x > pointSize.y) {',\n        '  realTexCoord = vec2(1.0, pointSize.y/pointSize.x) * gl_PointCoord;',\n        '} else {',\n        '  realTexCoord = vec2(pointSize.x/pointSize.y, 1.0) * gl_PointCoord;',\n        '}',\n        'highp float texOpacity = texture2D(opacityLookup, realTexCoord).w;',\n        'if (useScalarsToColors == 1) {',\n        '  gl_FragColor = vec4(texture2D(scalarsToColors, vec2((iVertexScalar - lutMin)/(lutMax - lutMin), 0.0)).xyz, texOpacity);',\n        '} else if (useVertexColors == 1) {',\n        '  gl_FragColor = vec4(iVertexColor, texOpacity);',\n        '} else {',\n        '  gl_FragColor = vec4(texture2D(opacityLookup, realTexCoord).xyz, texOpacity);',\n        '}}'\n    ].join('\\n'),\n    shader = new vgl.shader(gl.FRAGMENT_SHADER);\n\n  shader.setShaderSource(fragmentShaderSource);\n  return shader;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of texture material\n *\n * Helper function to create a texture material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createTextureMaterial = function(isRgba) {\n  'use strict';\n  var mat = new vgl.material(),\n    blend = new vgl.blend(),\n    prog = new vgl.shaderProgram(),\n    vertexShader = vgl.utils.createTextureVertexShader(gl),\n    fragmentShader = null,\n    posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n    texCoordVertAttr = new vgl.vertexAttribute(\"textureCoord\"),\n    pointsizeUniform = new vgl.floatUniform(\"pointSize\", 5.0),\n    modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n    projectionUniform = new vgl.projectionUniform(\"projectionMatrix\"),\n    samplerUniform = new vgl.uniform(gl.INT, \"sampler2d\"),\n    opacityUniform = null;\n\n  samplerUniform.set(0);\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(texCoordVertAttr,\n                          vgl.vertexAttributeKeys.TextureCoordinate);\n  prog.addUniform(pointsizeUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n\n  if (isRgba) {\n    fragmentShader = vgl.utils.createRgbaTextureFragmentShader(gl);\n  } else {\n    fragmentShader = vgl.utils.createTextureFragmentShader(gl);\n    opacityUniform = new vgl.floatUniform(\"opacity\", 1.0);\n    prog.addUniform(opacityUniform);\n  }\n\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of geometry material\n *\n * Helper function to create geometry material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createGeometryMaterial = function() {\n  'use strict';\n   var mat = new vgl.material(),\n       blend = new vgl.blend(),\n       prog = new vgl.shaderProgram(),\n       pointSize = 5.0,\n       opacity = 0.5,\n       vertexShader = vgl.utils.createVertexShader(gl),\n       fragmentShader = vgl.utils.createFragmentShader(gl),\n       posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n       colorVertAttr = new vgl.vertexAttribute(\"vertexColor\"),\n       pointsizeUniform = new vgl.floatUniform(\"pointSize\", pointSize),\n       opacityUniform = new vgl.floatUniform(\"opacity\", opacity),\n       modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n       projectionUniform = new vgl.projectionUniform(\"projectionMatrix\");\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(colorVertAttr, vgl.vertexAttributeKeys.Color);\n  prog.addUniform(pointsizeUniform);\n  prog.addUniform(opacityUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of geometry material\n *\n * Helper function to create geometry material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPointGeometryMaterial = function(opacity) {\n  'use strict';\n   var mat = new vgl.material(),\n       blend = new vgl.blend(),\n       prog = new vgl.shaderProgram(),\n       opacity = opacity === undefined ? 1.0 : opacity,\n       vertexShader = vgl.utils.createPointVertexShader(gl),\n       fragmentShader = vgl.utils.createFragmentShader(gl),\n       posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n       colorVertAttr = new vgl.vertexAttribute(\"vertexColor\"),\n       sizeVertAttr = new vgl.vertexAttribute(\"vertexSize\"),\n       opacityUniform = new vgl.floatUniform(\"opacity\", opacity),\n       modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n       projectionUniform = new vgl.projectionUniform(\"projectionMatrix\");\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(colorVertAttr, vgl.vertexAttributeKeys.Color);\n  prog.addVertexAttribute(sizeVertAttr, vgl.vertexAttributeKeys.Scalar);\n  prog.addUniform(opacityUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  return mat;\n};\n\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of geometry material with the phong shader\n *\n * Helper function to create color phong shaded geometry material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPhongMaterial = function() {\n  'use strict';\n   var mat = new vgl.material(),\n       blend = new vgl.blend(),\n       prog = new vgl.shaderProgram(),\n       vertexShader = vgl.utils.createPhongVertexShader(gl),\n       fragmentShader = vgl.utils.createPhongFragmentShader(gl),\n       posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n       normalVertAttr = new vgl.vertexAttribute(\"vertexNormal\"),\n       colorVertAttr = new vgl.vertexAttribute(\"vertexColor\"),\n       opacityUniform = new vgl.floatUniform(\"opacity\", 1.0),\n       modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n       normalUniform = new vgl.normalMatrixUniform(\"normalMatrix\"),\n       projectionUniform = new vgl.projectionUniform(\"projectionMatrix\");\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(normalVertAttr, vgl.vertexAttributeKeys.Normal);\n  prog.addVertexAttribute(colorVertAttr, vgl.vertexAttributeKeys.Color);\n  prog.addUniform(opacityUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addUniform(normalUniform);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of colored geometry material\n *\n * Helper function to create color geometry material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createColorMaterial = function() {\n  'use strict';\n  var mat = new vgl.material(),\n      blend = new vgl.blend(),\n      prog = new vgl.shaderProgram(),\n      vertexShader = vgl.utils.createVertexShader(gl),\n      fragmentShader = vgl.utils.createFragmentShader(gl),\n      posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n      texCoordVertAttr = new vgl.vertexAttribute(\"textureCoord\"),\n      colorVertAttr = new vgl.vertexAttribute(\"vertexColor\"),\n      pointsizeUniform = new vgl.floatUniform(\"pointSize\", 5.0),\n      opacityUniform = new vgl.floatUniform(\"opacity\", 0.5),\n      modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n      projectionUniform = new vgl.projectionUniform(\"projectionMatrix\");\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(colorVertAttr, vgl.vertexAttributeKeys.Color);\n  prog.addVertexAttribute(texCoordVertAttr,\n                          vgl.vertexAttributeKeys.TextureCoordinate);\n  prog.addUniform(pointsizeUniform);\n  prog.addUniform(opacityUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of geometry material\n *\n * Helper function to create geometry material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createColorMappedMaterial = function(lut) {\n  'use strict';\n  if (!lut) {\n    lut = new vgl.lookupTable();\n  }\n\n  var scalarRange = lut.range(),\n      mat = new vgl.material(),\n      blend = new vgl.blend(),\n      prog = new vgl.shaderProgram(),\n      vertexShader = vgl.utils.createVertexShaderColorMap(\n        gl,scalarRange[0],scalarRange[1]),\n      fragmentShader = vgl.utils.createFragmentShaderColorMap(gl),\n      posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n      scalarVertAttr = new vgl.vertexAttribute(\"vertexScalar\"),\n      pointsizeUniform = new vgl.floatUniform(\"pointSize\", 5.0),\n      opacityUniform = new vgl.floatUniform(\"opacity\", 0.5),\n      lutMinUniform = new vgl.floatUniform(\"lutMin\", scalarRange[0]),\n      lutMaxUniform = new vgl.floatUniform(\"lutMax\", scalarRange[1]),\n      modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n      projectionUniform = new vgl.projectionUniform(\"projectionMatrix\"),\n      samplerUniform = new vgl.uniform(gl.FLOAT, \"sampler2d\"),\n      lookupTable = lut;\n\n  samplerUniform.set(0);\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(scalarVertAttr, vgl.vertexAttributeKeys.Scalar);\n  prog.addUniform(pointsizeUniform);\n  prog.addUniform(opacityUniform);\n  prog.addUniform(lutMinUniform);\n  prog.addUniform(lutMaxUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n  mat.addAttribute(lookupTable);\n\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Update color mapped material\n *\n * @param mat\n * @param scalarRange\n * @param lut\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.updateColorMappedMaterial = function(mat, lut) {\n  'use strict';\n  if (!mat) {\n    console.log('[warning] Invalid material. Nothing to update.');\n    return;\n  }\n\n  if (!lut) {\n    console.log('[warning] Invalid lookup table. Nothing to update.');\n    return;\n  }\n\n\n  var lutMin = mat.shaderProgram().uniform('lutMin'),\n      lutMax = mat.shaderProgram().uniform('lutMax');\n\n  lutMin.set(lut.range()[0]);\n  lutMax.set(lut.range()[1]);\n\n  // This will replace the existing lookup table\n  mat.setAttribute(lut);\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of solid color material\n *\n * Helper function to create geometry material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createSolidColorMaterial = function(color) {\n  'use strict';\n  if (!color) {\n    color = [1.0,1.0,1.0];\n  }\n\n  var mat = new vgl.material(),\n      blend = new vgl.blend(),\n      prog = new vgl.shaderProgram(),\n      vertexShader = vgl.utils.createVertexShaderSolidColor(gl),\n      fragmentShader = vgl.utils.createFragmentShaderSolidColor(gl, color),\n      posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n      pointsizeUniform = new vgl.floatUniform(\"pointSize\", 5.0),\n      opacityUniform = new vgl.floatUniform(\"opacity\", 1.0),\n      modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n      projectionUniform = new vgl.projectionUniform(\"projectionMatrix\");\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addUniform(pointsizeUniform);\n  prog.addUniform(opacityUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of point sprites material\n *\n * Helper function to create point sprites material\n *\n * @returns {vgl.material}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPointSpritesMaterial = function(image, lut) {\n  'use strict';\n  var scalarRange = lut === undefined ? [0, 1] : lut.range(),\n      mat = new vgl.material(),\n      blend = new vgl.blend(),\n      prog = new vgl.shaderProgram(),\n      vertexShader = vgl.utils.createPointSpritesVertexShader(gl),\n      fragmentShader = vgl.utils.createPointSpritesFragmentShader(gl),\n      posVertAttr = new vgl.vertexAttribute(\"vertexPosition\"),\n      colorVertAttr = new vgl.vertexAttribute(\"vertexColor\"),\n      heightUniform = new vgl.floatUniform(\"height\", 0.0),\n      vertexColorWeightUniform =\n        new vgl.floatUniform(\"vertexColorWeight\", 0.0),\n      lutMinUniform = new vgl.floatUniform(\"lutMin\", scalarRange[0]),\n      lutMaxUniform = new vgl.floatUniform(\"lutMax\", scalarRange[1]),\n      modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n      projectionUniform = new vgl.projectionUniform(\"projectionMatrix\"),\n      samplerUniform = new vgl.uniform(gl.INT, \"opacityLookup\"),\n      scalarsToColors = new vgl.uniform(gl.INT, \"scalarsToColors\"),\n      useScalarsToColors = new vgl.uniform(gl.INT, \"useScalarsToColors\"),\n      useVertexColors = new vgl.uniform(gl.INT, \"useVertexColors\"),\n      pointSize = new vgl.uniform(gl.FLOAT_VEC2, \"pointSize\"),\n      texture = new vgl.texture();\n\n  samplerUniform.set(0);\n  scalarsToColors.set(1);\n  useScalarsToColors.set(0);\n  useVertexColors.set(0);\n  pointSize.set([1.0, 1.0]);\n\n  prog.addVertexAttribute(posVertAttr, vgl.vertexAttributeKeys.Position);\n  prog.addVertexAttribute(colorVertAttr, vgl.vertexAttributeKeys.Color);\n  prog.addUniform(heightUniform);\n  prog.addUniform(vertexColorWeightUniform);\n  prog.addUniform(modelViewUniform);\n  prog.addUniform(projectionUniform);\n  prog.addUniform(samplerUniform);\n  prog.addUniform(useVertexColors);\n  prog.addUniform(useScalarsToColors);\n  prog.addUniform(pointSize);\n  prog.addShader(fragmentShader);\n  prog.addShader(vertexShader);\n  mat.addAttribute(prog);\n  mat.addAttribute(blend);\n\n  if (lut) {\n    prog.addUniform(scalarsToColors);\n    useScalarsToColors.set(1);\n    prog.addUniform(lutMinUniform);\n    prog.addUniform(lutMaxUniform);\n    lut.setTextureUnit(1);\n    mat.addAttribute(lut);\n  }\n\n  texture.setImage(image);\n  texture.setTextureUnit(0);\n  mat.addAttribute(texture);\n  return mat;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of an actor that contains a plane geometry\n *\n * Function to create a plane node This method will create a plane actor\n * with texture coordinates, eventually normal, and plane material.\n *\n * @returns {vgl.actor}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPlane = function(originX, originY, originZ,\n                                       point1X, point1Y, point1Z,\n                                       point2X, point2Y, point2Z) {\n  'use strict';\n  var mapper = new vgl.mapper(),\n      planeSource = new vgl.planeSource(),\n      mat = vgl.utils.createGeometryMaterial(),\n      actor = new vgl.actor();\n\n  planeSource.setOrigin(originX, originY, originZ);\n  planeSource.setPoint1(point1X, point1Y, point1Z);\n  planeSource.setPoint2(point2X, point2Y, point2Z);\n\n  mapper.setGeometryData(planeSource.create());\n  actor.setMapper(mapper);\n  actor.setMaterial(mat);\n\n  return actor;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of an actor that contains a texture plane geometry\n *\n * Helper function to create a plane textured node This method will create\n * a plane actor with texture coordinates, eventually normal, and plane\n * material.\n *\n * @returns {vgl.actor}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createTexturePlane = function(originX, originY, originZ,\n                                              point1X, point1Y, point1Z,\n                                              point2X, point2Y, point2Z,\n                                              isRgba) {\n  'use strict';\n  var mapper = new vgl.mapper(),\n      planeSource = new vgl.planeSource(),\n      mat = vgl.utils.createTextureMaterial(isRgba),\n      actor = new vgl.actor();\n\n  planeSource.setOrigin(originX, originY, originZ);\n  planeSource.setPoint1(point1X, point1Y, point1Z);\n  planeSource.setPoint2(point2X, point2Y, point2Z);\n  mapper.setGeometryData(planeSource.create());\n\n  actor.setMapper(mapper);\n  actor.setMaterial(mat);\n\n  return actor;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of an actor that contains points\n *\n * Helper function to create a point node This method will create a point\n * actor with texture coordinates, eventually normal, and plane material.\n *\n * @returns {vgl.actor}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPoints = function(positions, size, colors, texcoords, opacity) {\n  'use strict';\n  if (!positions) {\n    console.log(\"[ERROR] Cannot create points without positions\");\n    return null;\n  }\n\n  var opacity = opacity === undefined ? 1.0 : opacity,\n      mapper = new vgl.mapper(),\n      pointSource = new vgl.pointSource(),\n      mat = vgl.utils.createPointGeometryMaterial(opacity),\n      actor = new vgl.actor();\n\n  pointSource.setPositions(positions);\n  if (colors) {\n    pointSource.setColors(colors);\n  }\n\n  if (texcoords) {\n    pointSource.setTextureCoordinates(texcoords);\n  }\n\n  if (size) {\n    pointSource.setSize(size)\n  } else {\n    pointSource.setSize(1.0);\n  }\n\n  mapper.setGeometryData(pointSource.create());\n  actor.setMapper(mapper);\n  actor.setMaterial(mat);\n\n  return actor;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of an actor that contains point sprites\n *\n * Helper function to create a point sprites node This method will create\n * a point sprites actor with texture coordinates, normals, and a point sprites\n * material.\n *\n * @returns {vgl.actor}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createPointSprites = function(image, positions, colors,\n                                              texcoords) {\n  'use strict';\n  if (!image) {\n    console.log(\"[ERROR] Point sprites requires an image\");\n    return null;\n  }\n\n  if (!positions) {\n    console.log(\"[ERROR] Cannot create points without positions\");\n    return null;\n  }\n\n  var mapper = new vgl.mapper(),\n      pointSource = new vgl.pointSource(),\n      mat = vgl.utils.createPointSpritesMaterial(image),\n      actor = new vgl.actor();\n\n  pointSource.setPositions(positions);\n  if (colors) {\n    pointSource.setColors(colors);\n  }\n\n  if (texcoords) {\n    pointSource.setTextureCoordinates(texcoords);\n  }\n\n  mapper.setGeometryData(pointSource.create());\n  actor.setMapper(mapper);\n  actor.setMaterial(mat);\n\n  return actor;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create lines given positions, colors, and desired length\n *\n * @param positions\n * @param colors\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createLines = function(positions, colors) {\n  'use strict';\n  if (!positions) {\n    console.log(\"[ERROR] Cannot create points without positions\");\n    return null;\n  }\n\n  var mapper = new vgl.mapper(),\n      lineSource = new vgl.lineSource(),\n      mat = vgl.utils.createGeometryMaterial(),\n      actor = new vgl.actor();\n\n  lineSource.setPositions(positions);\n  if (colors) {\n    lineSource.setColors(colors);\n  }\n\n  mapper.setGeometryData(lineSource.create());\n  actor.setMapper(mapper);\n  actor.setMaterial(mat);\n\n  return actor;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create color legend\n *\n * @param lookupTable\n * @param width\n * @param height\n * @param origin\n * @param divs\n * @returns {Array}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.createColorLegend = function(varname, lookupTable, origin,\n                                             width, height, countMajor,\n                                             countMinor) {\n  'use strict';\n\n  if (!lookupTable) {\n    console.log('[error] Invalid lookup table');\n    return [];\n  }\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create labels for the legend\n   *\n   * @param ticks\n   * @param range\n   * @param divs\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  function createLabels(varname, positions, range) {\n    if (!positions) {\n      console.log('[error] Create labels requires positions (x,y,z) array');\n      return;\n    }\n\n    if (positions.length % 3 !== 0) {\n      console.log('[error] Create labels require positions array contain 3d points');\n      return;\n    }\n\n    if (!range) {\n      console.log('[error] Create labels requires Valid range');\n      return;\n    }\n\n    var actor = null,\n        size = vgl.utils.computePowerOfTwo(48),\n        index = 0,\n        actors = [],\n        origin = [],\n        pt1 = [],\n        pt2 = [],\n        delta = (positions[6] - positions[0]),\n        axisLabelOffset = 4, i;\n\n    origin.length = 3;\n    pt1.length = 3;\n    pt2.length = 3;\n\n    // For now just create labels for end points\n    for (i = 0; i < 2; ++i) {\n      index = i * (positions.length - 3);\n\n      origin[0] = positions[index] - delta;\n      origin[1] = positions[index + 1] - 2 * delta;\n      origin[2] = positions[index + 2];\n\n      pt1[0] = positions[index] + delta;\n      pt1[1] = origin[1];\n      pt1[2] = origin[2];\n\n      pt2[0] = origin[0];\n      pt2[1] = positions[1];\n      pt2[2] = origin[2];\n\n      actor = vgl.utils.createTexturePlane(\n        origin[0], origin[1], origin[2],\n        pt1[0], pt1[1], pt1[2],\n        pt2[0], pt2[1], pt2[2], true);\n\n      actor.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute);\n      actor.material().setBinNumber(vgl.material.RenderBin.Overlay);\n      actor.material().addAttribute(vgl.utils.create2DTexture(\n        range[i].toFixed(2).toString(), 12, null));\n      actors.push(actor);\n    }\n\n    // Create axis label\n    origin[0] = (positions[0] + positions[positions.length - 3]  - size) * 0.5;\n    origin[1] = positions[1] + axisLabelOffset;\n    origin[2] = positions[2];\n\n    pt1[0] = origin[0] + size;\n    pt1[1] = origin[1];\n    pt1[2] = origin[2];\n\n    pt2[0] = origin[0];\n    pt2[1] = origin[1] + size;\n    pt2[2] = origin[2];\n\n    actor = vgl.utils.createTexturePlane(\n      origin[0], origin[1], origin[2],\n      pt1[0], pt1[1], pt1[2],\n      pt2[0], pt2[1], pt2[2], true);\n    actor.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute);\n    actor.material().setBinNumber(vgl.material.RenderBin.Overlay);\n    actor.material().addAttribute(vgl.utils.create2DTexture(\n      varname, 24, null));\n    actors.push(actor);\n\n    return actors;\n  }\n\n  //////////////////////////////////////////////////////////////////////////////\n  // TODO Currently we assume that the ticks are laid on x-axis\n  // and this is on a 2D plane (ignoring Z axis. For now lets\n  // not draw minor ticks.\n  /**\n   * Create ticks and labels\n   *\n   * @param originX\n   * @param originY\n   * @param originZ\n   * @param pt1X\n   * @param pt1Y\n   * @param pt1Z\n   * @param pt2X\n   * @param pt2Y\n   * @param pt2Z\n   * @param divs\n   * @param heightMajor\n   * @param heightMinor\n   * @returns {Array} Returns array of vgl.actor\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  function createTicksAndLabels(varname, lut,\n                        originX, originY, originZ,\n                        pt1X, pt1Y, pt1Z,\n                        pt2X, pt2Y, pt2Z,\n                        countMajor, countMinor,\n                        heightMajor, heightMinor) {\n    var width = pt2X - pt1X,\n        index = null,\n        delta = width / countMajor,\n        positions = [],\n        actor = null,\n        actors = [];\n\n    for (index = 0; index <= countMajor; ++index) {\n      positions.push(pt1X + delta * index);\n      positions.push(pt1Y);\n      positions.push(pt1Z);\n\n      positions.push(pt1X + delta * index);\n      positions.push(pt1Y + heightMajor);\n      positions.push(pt1Z);\n    }\n\n    actor = vgl.utils.createLines(positions, null);\n    actor.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute);\n    actor.material().setBinNumber(vgl.material.RenderBin.Overlay);\n    actors.push(actor);\n\n    actors = actors.concat(createLabels(varname, positions, lut.range()));\n    return actors;\n  }\n\n  // TODO Currently we create only one type of legend\n  var pt1X = origin[0] + width,\n      pt1Y = origin[1],\n      pt1Z = 0.0,\n      pt2X = origin[0],\n      pt2Y = origin[1] + height,\n      pt2Z = 0.0,\n      actors = [],\n      actor = null,\n      mapper = null,\n      mat = null,\n      group = vgl.groupNode();\n\n  actor = vgl.utils.createTexturePlane(\n    origin[0], origin[1], origin[2],\n    pt1X, pt1Y, pt1Z,\n    pt2X, pt2Y, pt2Z\n  );\n\n  mat = actor.material();\n  mat.addAttribute(lookupTable);\n  actor.setMaterial(mat);\n  group.addChild(actor);\n  actor.setReferenceFrame(vgl.boundingObject.ReferenceFrame.Absolute);\n  actors.push(actor);\n  actors = actors.concat(createTicksAndLabels(\n                          varname,\n                          lookupTable,\n                          origin[0], origin[1], origin[1],\n                          pt2X, pt1Y, pt1Z,\n                          pt1X, pt1Y, pt1Z,\n                          countMajor, countMinor, 5, 3));\n\n  // TODO This needs to change so that we can return a group node\n  // which should get appended to the scene graph\n  return actors;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create 2D texture by rendering text using canvas2D context\n *\n * @param textToWrite\n * @param textSize\n * @param color\n * @returns {vgl.texture}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.utils.create2DTexture = function(textToWrite, textSize,\n  color, font, alignment, baseline, bold) {\n  'use strict';\n\n  var canvas = document.getElementById('textRendering'),\n      ctx = null,\n      texture = vgl.texture();\n\n  font = font || 'sans-serif';\n  alignment = alignment || 'center';\n  baseline = baseline || 'bottom';\n\n  if (typeof bold === 'undefined') {\n    bold = true;\n  }\n\n  if (!canvas) {\n    canvas = document.createElement('canvas');\n  }\n  ctx = canvas.getContext('2d');\n\n  canvas.setAttribute('id', 'textRendering');\n  canvas.style.display = 'none';\n\n  // Make width and height equal so that we get pretty looking text.\n  canvas.height = vgl.utils.computePowerOfTwo(8 * textSize);\n  canvas.width = canvas.height;\n\n  ctx.fillStyle = 'rgba(0, 0, 0, 0)';\n  ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\n  // This determines the text colour, it can take a hex value or rgba value (e.g. rgba(255,0,0,0.5))\n  ctx.fillStyle = 'rgba(200, 85, 10, 1.0)';\n\n  // This determines the alignment of text, e.g. left, center, right\n  ctx.textAlign = alignment;\n\n  // This determines the baseline of the text, e.g. top, middle, bottom\n  ctx.textBaseline = baseline;\n\n  // This determines the size of the text and the font family used\n  ctx.font = 4 * textSize + \"px \" + font;\n  if (bold) {\n    ctx.font = \"bold \" + ctx.font;\n  }\n\n  ctx.fillText(textToWrite, canvas.width/2, canvas.height/2, canvas.width);\n\n  texture.setImage(canvas);\n  texture.updateDimensions();\n\n  return texture;\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class picker\n *\n * @class vgl.picker\n * @returns {vgl.picker}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.picker = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.picker)) {\n    return new vgl.picker();\n  }\n  vgl.object.call(this);\n\n  /** @private */\n  var m_that = this,\n      m_tolerance = 0.025,\n      m_actors = [];\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get actors intersected\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getActors = function() {\n    return m_actors;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Perform pick operation\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.pick = function(selectionX, selectionY, renderer) {\n    // Check if variables are acceptable\n    if (typeof(selectionX) === \"undefined\"){\n      return 0;\n    }\n    if (typeof(selectionY) === \"undefined\"){\n      return 0;\n    }\n    if (typeof(renderer) === \"undefined\"){\n      return 0;\n    }\n\n    // Clean list of actors intersected previously\n    m_actors = [];\n\n    //\n    var camera = renderer.camera(),\n        width = renderer.width(),\n        height = renderer.height(),\n        fpoint = camera.focalPoint(),\n        focusWorldPt = vec4.fromValues(fpoint[0], fpoint[1], fpoint[2], 1.0),\n        focusDisplayPt = renderer.worldToDisplay(\n          focusWorldPt, camera.viewMatrix(),\n        camera.projectionMatrix(), width, height),\n        displayPt = vec4.fromValues(selectionX,\n                      selectionY, focusDisplayPt[2], 1.0),\n        // Convert selection point into world coordinates\n        worldPt = renderer.displayToWorld(displayPt, camera.viewMatrix(),\n                    camera.projectionMatrix(), width, height),\n        cameraPos = camera.position(), ray = [], actors, count, i, bb,\n        tmin, tmax, tymin, tymax, tzmin, tzmax, actor;\n\n    for (i = 0; i < 3; ++i){\n      ray[i] = worldPt[i] - cameraPos[i];\n    }\n\n    // Go through all actors and check if intersects\n    actors = renderer.sceneRoot().children();\n    count = 0;\n\n    for (i = 0; i < actors.length; ++i) {\n      actor = actors[i];\n      if (actor.visible() === true) {\n        bb = actor.bounds();\n        // Ray-aabb intersection - Smits' method\n        if (ray[0] >= 0){\n          tmin = (bb[0] - cameraPos[0])/ray[0];\n          tmax = (bb[1] - cameraPos[0])/ray[0];\n        } else {\n          tmin = (bb[1] - cameraPos[0])/ray[0];\n          tmax = (bb[0] - cameraPos[0])/ray[0];\n        }\n        if (ray[1] >= 0){\n          tymin = (bb[2] - cameraPos[1])/ray[1];\n          tymax = (bb[3] - cameraPos[1])/ray[1];\n        } else {\n          tymin = (bb[3] - cameraPos[1])/ray[1];\n          tymax = (bb[2] - cameraPos[1])/ray[1];\n        }\n        if ((tmin > tymax) || (tymin > tmax)) {\n          continue;\n        }\n\n\n        if (tymin > tmin) {\n          tmin = tymin;\n        }\n        if (tymax < tmax) {\n          tmax = tymax;\n        }\n        if (ray[2] >= 0) {\n          tzmin = (bb[4] - cameraPos[2])/ray[2];\n          tzmax = (bb[5] - cameraPos[2])/ray[2];\n        } else {\n          tzmin = (bb[5] - cameraPos[2])/ray[2];\n          tzmax = (bb[4] - cameraPos[2])/ray[2];\n        }\n        if ((tmin > tzmax) || (tzmin > tmax)) {\n          continue;\n        }\n        if (tzmin > tmin) {\n          tmin = tzmin;\n        }\n        if (tzmax < tmax) {\n          tmax = tzmax;\n        }\n\n        m_actors[count++] = actor;\n      }\n    }\n    return count;\n  };\n\n  return this;\n};\n\ninherit(vgl.picker, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2*/\n\n/*global vgl, ogs, vec4, inherit, $, Uint16Array*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of shapefile reader\n *\n * This contains code that reads a shapefile and produces vgl geometries\n *\n * @class\n * @returns {vgl.shapefileReader}\n */\n//////////////////////////////////////////////////////////////////////////////\nvgl.shapefileReader = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.shapefileReader)) {\n    return new vgl.shapefileReader();\n  }\n\n  var m_that = this;\n  var SHP_HEADER_LEN = 8;\n  var SHP_NULL = 0;\n  var SHP_POINT = 1;\n  var SHP_POLYGON = 5;\n  var SHP_POLYLINE = 3;\n\n  this.int8 = function (data, offset) {\n      return data.charCodeAt (offset);\n  };\n\n  this.bint32 = function (data, offset) {\n    return (\n      ((data.charCodeAt (offset) & 0xff) << 24) +\n        ((data.charCodeAt (offset + 1) & 0xff) << 16) +\n        ((data.charCodeAt (offset + 2) & 0xff) << 8) +\n        (data.charCodeAt (offset + 3) & 0xff)\n    );\n  };\n\n  this.lint32 = function (data, offset) {\n    return (\n      ((data.charCodeAt (offset + 3) & 0xff) << 24) +\n        ((data.charCodeAt (offset + 2) & 0xff) << 16) +\n        ((data.charCodeAt (offset + 1) & 0xff) << 8) +\n        (data.charCodeAt (offset) & 0xff)\n    );\n  };\n\n  this.bint16 = function (data, offset) {\n    return (\n      ((data.charCodeAt (offset) & 0xff) << 8) +\n        (data.charCodeAt (offset + 1) & 0xff)\n    );\n  };\n\n  this.lint16 = function (data, offset) {\n    return (\n      ((data.charCodeAt (offset + 1) & 0xff) << 8) +\n        (data.charCodeAt (offset) & 0xff)\n    );\n  };\n\n  this.ldbl64 = function (data, offset) {\n    var b0 = data.charCodeAt (offset) & 0xff;\n    var b1 = data.charCodeAt (offset + 1) & 0xff;\n    var b2 = data.charCodeAt (offset + 2) & 0xff;\n    var b3 = data.charCodeAt (offset + 3) & 0xff;\n    var b4 = data.charCodeAt (offset + 4) & 0xff;\n    var b5 = data.charCodeAt (offset + 5) & 0xff;\n    var b6 = data.charCodeAt (offset + 6) & 0xff;\n    var b7 = data.charCodeAt (offset + 7) & 0xff;\n\n    var sign = 1 - 2 * (b7 >> 7);\n    var exp = (((b7 & 0x7f) << 4) + ((b6 & 0xf0) >> 4)) - 1023;\n    //var frac = (b6 & 0x0f) * Math.pow (2, -4) + b5 * Math.pow (2, -12) + b4 *\n    // Math.pow (2, -20) + b3 * Math.pow (2, -28) + b2 * Math.pow (2, -36) + b1 *\n    // Math.pow (2, -44) + b0 * Math.pow (2, -52);\n\n    //return sign * (1 + frac) * Math.pow (2, exp);\n    var frac = (b6 & 0x0f) * Math.pow (2, 48) + b5 * Math.pow (2, 40) + b4 *\n                 Math.pow (2, 32) + b3 * Math.pow (2, 24) + b2 *\n                 Math.pow (2, 16) + b1 * Math.pow (2, 8) + b0;\n\n    return sign * (1 + frac * Math.pow (2, -52)) * Math.pow (2, exp);\n  };\n\n  this.lfloat32 = function (data, offset) {\n    var b0 = data.charCodeAt (offset) & 0xff;\n    var b1 = data.charCodeAt (offset + 1) & 0xff;\n    var b2 = data.charCodeAt (offset + 2) & 0xff;\n    var b3 = data.charCodeAt (offset + 3) & 0xff;\n\n    var sign = 1 - 2 * (b3 >> 7);\n    var exp = (((b3 & 0x7f) << 1) + ((b2 & 0xfe) >> 7)) - 127;\n    var frac = (b2 & 0x7f) * Math.pow (2, 16) + b1 * Math.pow (2, 8) + b0;\n\n    return sign * (1 + frac * Math.pow (2, -23)) * Math.pow (2, exp);\n  };\n\n  this.str = function (data, offset, length) {\n    var chars = [];\n    var index = offset;\n    while (index < offset + length) {\n      var c = data[index];\n      if (c.charCodeAt (0) !== 0)\n        chars.push (c);\n      else {\n        break;\n      }\n      index ++;\n    }\n    return chars.join ('');\n  };\n\n  this.readHeader = function (data) {\n    var code = this.bint32(data, 0);\n    var length = this.bint32(data, 24);\n    var version = this.lint32(data, 28);\n    var shapetype = this.lint32(data, 32);\n\n    var xmin = this.ldbl64(data, 36);\n    var ymin = this.ldbl64(data, 44);\n    var xmax = this.ldbl64(data, 52);\n    var ymax = this.ldbl64(data, 60);\n    return {\n      code: code,\n      length: length,\n      version: version,\n      shapetype: shapetype,\n      bounds: new Box (vect (xmin, ymin), vect (xmax, ymax))\n    };\n  };\n\n  this.loadShx = function (data) {\n    var indices = [];\n    var appendIndex = function (offset) {\n      indices.push (2 * m_that.bint32(data, offset));\n      return offset + 8;\n    };\n    var offset = 100;\n    while (offset < data.length) {\n      offset = appendIndex (offset);\n    }\n    return indices;\n  };\n\n  this.Shapefile = function (options) {\n    var path = options.path;\n    $.ajax ({\n      url: path + '.shx',\n      mimeType: 'text/plain; charset=x-user-defined',\n      success: function (data) {\n        var indices = this.loadShx(data);\n        $.ajax ({\n          url: path + '.shp',\n          mimeType: 'text/plain; charset=x-user-defined',\n          success: function (data) {\n            $.ajax ({\n              url: path + '.dbf',\n              mimeType: 'text/plain; charset=x-user-defined',\n              success: function (dbf_data) {\n                var layer = this.loadShp (data, dbf_data, indices, options);\n                options.success (layer);\n              }\n            });\n          }\n        });\n      }\n    });\n  };\n\n  this.localShapefile = function(options) {\n    var shxFile = options.shx;\n    var shpFile = options.shp;\n    var dbfFile = options.dbf;\n    var shxReader = new FileReader();\n    shxReader.onloadend = function() {\n      var indices = m_that.loadShx(shxReader.result);\n      var shpReader = new FileReader();\n\n      shpReader.onloadend = function() {\n        var shpData = shpReader.result;\n\n        var dbfReader = new FileReader();\n        dbfReader.onloadend = function() {\n          var dbfData = dbfReader.result;\n          var layer = m_that.loadShp(shpData, dbfData, indices, options);\n          options.success(layer);\n        };\n        dbfReader.readAsBinaryString(dbfFile);\n      };\n      shpReader.readAsBinaryString(shpFile);\n    };\n    shxReader.readAsBinaryString(shxFile);\n  };\n\n  this.loadDBF = function (data) {\n    var readHeader = function (offset) {\n      var name = m_that.str(data, offset, 10);\n      var type = m_that.str(data, offset + 11, 1);\n      var length = m_that.int8(data, offset + 16);\n      return {\n        name: name,\n        type: type,\n        length: length\n      };\n    };\n\n    // Level of the dBASE file\n    var level = m_that.int8(data, 0);\n    if (level == 4) {\n      throw \"Level 7 dBASE not supported\";\n    }\n\n    // Date of last update\n    var year = m_that.int8(data, 1);\n    var month = m_that.int8(data, 2);\n    var day = m_that.int8(data, 3);\n\n    var num_entries = m_that.lint32(data, 4);\n    var header_size = m_that.lint16(data, 8);\n    var record_size = m_that.lint16(data, 10);\n\n    var FIELDS_START = 32;\n    var HEADER_LENGTH = 32;\n\n    var header_offset = FIELDS_START;\n    var headers = [];\n    while (header_offset < header_size - 1) {\n      headers.push (readHeader(header_offset));\n      header_offset += HEADER_LENGTH;\n    }\n\n    var records = [];\n    var record_offset = header_size;\n    while (record_offset < header_size + num_entries * record_size) {\n      var declare = m_that.str(data, record_offset, 1);\n      if (declare == '*') {\n        // Record size in the header include the size of the delete indicator\n        record_offset += record_size;\n      }\n      else {\n        // Move offset to the start of the actual data\n        record_offset ++;\n        var record = {};\n        for (var i = 0; i < headers.length; i ++) {\n          var header = headers[i];\n          var value;\n          if (header.type == 'C') {\n              value = m_that.str(data, record_offset, header.length).trim ();\n          }\n          else if (header.type == 'N') {\n              value = parseFloat (m_that.str (data, record_offset, header.length));\n          }\n          record_offset += header.length;\n          record[header.name] = value;\n        }\n        records.push(record);\n      }\n    }\n    return records;\n  };\n\n  this.loadShp = function (data, dbf_data, indices, options) {\n    var features = [];\n    var readRing = function (offset, start, end) {\n      var ring = [];\n      for (var i = end - 1; i >= start; i --) {\n        var x = m_that.ldbl64(data, offset + 16 * i);\n        var y = m_that.ldbl64(data, offset + 16 * i + 8);\n        ring.push ([x, y]);\n      }\n      //if (ring.length <= 3)\n      // return [];\n      return ring;\n    };\n\n    var readRecord = function (offset) {\n      var index = m_that.bint32(data, offset);\n      var record_length = m_that.bint32(data, offset + 4);\n      var record_offset = offset + 8;\n      var geom_type = m_that.lint32(data, record_offset);\n\n      if (geom_type == SHP_NULL) {\n        console.log (\"NULL Shape\");\n        //return offset + 12;\n      }\n      else if (geom_type == SHP_POINT) {\n        var x = m_that.ldbl64(data, record_offset + 4);\n        var y = m_that.ldbl64(data, record_offset + 12);\n\n        features.push ({\n          type: 'Point',\n          attr: {},\n          geom: [[x, y]]\n        });\n      }\n      else if (geom_type == SHP_POLYGON) {\n        var num_parts = m_that.lint32(data, record_offset + 36);\n        var num_points = m_that.lint32(data, record_offset + 40);\n\n        var parts_start = offset + 52;\n        var points_start = offset + 52 + 4 * num_parts;\n\n        var rings = [];\n        for (var i = 0; i < num_parts; i ++) {\n          var start = m_that.lint32(data, parts_start + i * 4);\n          var end;\n          if (i + 1 < num_parts) {\n            end = m_that.lint32(data, parts_start + (i + 1) * 4);\n          }\n          else {\n            end = num_points;\n          }\n          var ring = readRing (points_start, start, end);\n          rings.push (ring);\n        }\n        features.push ({\n          type: 'Polygon',\n          attr: {},\n          geom: [rings]\n        });\n      }\n      else if (geom_type == SHP_POLYLINE) {\n        var num_parts = m_that.lint32(data, record_offset + 36);\n        var num_points = m_that.lint32(data, record_offset + 40);\n\n        var parts_start = offset + 52;\n        var points_start = offset + 52 + 4 * num_parts;\n\n        var rings = [];\n        for (var i = 0; i < num_parts; i ++) {\n          var start = m_that.lint32(data, parts_start + i * 4);\n          var end;\n          if (i + 1 < num_parts) {\n              end = m_that.lint32(data, parts_start + (i + 1) * 4);\n          }\n          else {\n              end = num_points;\n          }\n          var ring = readRing (points_start, start, end);\n          rings.push (ring);\n        }\n        features.push ({\n          type: 'Polyline',\n          attr: {},\n          geom: [rings]\n        });\n      }\n      else {\n        throw \"Not Implemented: \" + geom_type;\n      }\n      //return offset + 2 * record_length + SHP_HEADER_LEN;\n    };\n\n    var attr = this.loadDBF(dbf_data);\n\n    //var offset = 100;\n    //while (offset < length * 2) {\n    // offset = readRecord (offset);\n    //}\n    for (var i = 0; i < indices.length; i ++) {\n      var offset = indices[i];\n      readRecord (offset);\n    }\n\n    var layer = []; //new Layer ();\n\n    for (var i = 0; i < features.length; i ++) {\n      var feature = features[i];\n      feature.attr = attr[i];\n      layer.push (feature);\n    }\n    return layer;\n  };\n\n  return this;\n};","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module vgl\n */\n\n/*jslint devel: true, forin: true, newcap: true, plusplus: true*/\n/*jslint white: true, continue:true, indent: 2, bitwise: true*/\n\n\n/*global vgl, vec4, mat4, inherit, unescape*/\n/*global Float32Array, Int8Array, gl, Uint16Array, $*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n//\n// vbgModule.vtkReader class\n// This contains code that unpack a json base64 encoded vtkdataset,\n// such as those produced by ParaView's webGL exporter (where much\n// of the code originated from) and convert it to VGL representation.\n//\n//////////////////////////////////////////////////////////////////////////////\n\nvgl.vtkReader = function() {\n  'use strict';\n\n  if (!(this instanceof vgl.vtkReader)) {\n    return new vgl.vtkReader();\n  }\n\n  var m_base64Chars =\n    ['A','B','C','D','E','F','G','H','I','J','K','L','M',\n     'N','O','P','Q','R','S','T','U','V','W','X','Y','Z',\n     'a','b','c','d','e','f','g','h','i','j','k','l','m',\n     'n','o','p','q','r','s','t','u','v','w','x','y','z',\n     '0','1','2','3','4','5','6','7','8','9','+','/'],\n  m_reverseBase64Chars = [],\n  m_vtkObjectList = {},\n  m_vglObjects = {},\n  m_vtkRenderedList = {},\n  m_vtkObjHashList = {},\n  m_vtkObjectCount = 0,\n  m_vtkScene = null,\n  m_node = null,\n  END_OF_INPUT = -1,\n  m_base64Str = \"\",\n  m_base64Count = 0,\n  m_pos = 0,\n  m_viewer = null,\n  i = 0;\n\n  //initialize the array here if not already done.\n  if (m_reverseBase64Chars.length === 0) {\n    for ( i = 0; i < m_base64Chars.length; i++) {\n      m_reverseBase64Chars[m_base64Chars[i]] = i;\n    }\n  }\n\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * ntos\n   *\n   * @param n\n   * @returns unescaped n\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.ntos = function (n) {\n    var unN;\n\n    unN = n.toString(16);\n    if (unN.length === 1) {\n      unN = '0' + unN;\n    }\n    unN = '%' + unN;\n\n    return unescape(unN);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * readReverseBase64\n   *\n   * @returns\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readReverseBase64 = function () {\n    var nextCharacter;\n\n    if (!m_base64Str) {\n      return END_OF_INPUT;\n    }\n\n    while (true) {\n      if (m_base64Count >= m_base64Str.length) {\n        return END_OF_INPUT;\n      }\n      nextCharacter = m_base64Str.charAt(m_base64Count);\n      m_base64Count++;\n\n      if (m_reverseBase64Chars[nextCharacter]) {\n        return m_reverseBase64Chars[nextCharacter];\n      }\n      if (nextCharacter === 'A') {\n        return 0;\n      }\n    }\n\n    return END_OF_INPUT;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * decode64\n   *\n   * @param str\n   * @returns result\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.decode64 = function(str) {\n    var result = '',\n        inBuffer = new Array(4),\n        done = false;\n\n    m_base64Str = str;\n    m_base64Count = 0;\n\n    while (!done &&\n           (inBuffer[0] = this.readReverseBase64()) !== END_OF_INPUT &&\n           (inBuffer[1] = this.readReverseBase64()) !== END_OF_INPUT) {\n      inBuffer[2] = this.readReverseBase64();\n      inBuffer[3] = this.readReverseBase64();\n      result += this.ntos((((inBuffer[0] << 2) & 0xff) | inBuffer[1] >> 4));\n      if (inBuffer[2] !== END_OF_INPUT) {\n        result +=  this.ntos((((inBuffer[1] << 4) & 0xff) | inBuffer[2] >> 2));\n        if (inBuffer[3] !== END_OF_INPUT) {\n          result +=  this.ntos((((inBuffer[2] << 6) & 0xff) | inBuffer[3]));\n        } else {\n          done = true;\n        }\n      } else {\n        done = true;\n      }\n    }\n\n    return result;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * readNumber\n   *\n   * @param ss\n   * @returns v\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readNumber = function(ss) {\n    var v = ((ss[m_pos++]) +\n             (ss[m_pos++] << 8) +\n             (ss[m_pos++] << 16) +\n             (ss[m_pos++] << 24));\n    return v;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * readF3Array\n   *\n   * @param numberOfPoints\n   * @param ss\n   * @returns points\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readF3Array = function(numberOfPoints, ss) {\n    var size = numberOfPoints*4*3, test = new Int8Array(size),\n        points = null, i;\n\n    for(i = 0; i < size; i++) {\n      test[i] = ss[m_pos++];\n    }\n\n    points = new Float32Array(test.buffer);\n\n    return points;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * readColorArray\n   *\n   * @param numberOfPoints\n   * @param ss\n   * @param vglcolors\n   * @returns points\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.readColorArray = function (numberOfPoints, ss, vglcolors) {\n    var i,r,g,b,idx = 0, tmp = new Array(numberOfPoints*3);\n    for(i = 0; i < numberOfPoints; i++) {\n      tmp[idx++] = ss[m_pos++]/255.0;\n      tmp[idx++] = ss[m_pos++]/255.0;\n      tmp[idx++] = ss[m_pos++]/255.0;\n      m_pos++;\n    }\n    vglcolors.insert(tmp);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * parseObject\n   *\n   * @param buffer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parseObject = function(vtkObject) {\n    var geom = new vgl.geometryData(),\n        mapper = vgl.mapper(),\n        ss = [], type = null, data = null, size,\n        matrix = null, material = null,\n        actor = null, shaderProg, opacityUniform;\n\n    //dehexlify\n//    data = this.decode64(vtkObject.data);\n    data = atob(vtkObject.data);\n    for(i = 0; i < data.length; i++) {\n      ss[i] = data.charCodeAt(i) & 0xff;\n    }\n\n    //Determine the Object type\n    m_pos = 0;\n    size = this.readNumber(ss);\n    type = String.fromCharCode(ss[m_pos++]);\n    geom.setName(type);\n\n    // Lines\n    if (type === 'L') {\n      matrix = this.parseLineData(geom, ss);\n      material = vgl.utils.createGeometryMaterial();\n    }\n    // Mesh\n    else if (type === 'M') {\n      matrix = this.parseMeshData(geom, ss);\n      material = vgl.utils.createPhongMaterial();\n    }\n    // Points\n    else if (type === 'P'){\n      matrix = this.parsePointData(geom, ss);\n      material = vgl.utils.createGeometryMaterial();\n    }\n    // ColorMap\n    else if (type === 'C') {\n      matrix = this.parseColorMapData(geom, ss, size);\n      material = vgl.utils.createGeometryMaterial();\n    }\n    // Unknown\n    else {\n      console.log(\"Ignoring unrecognized encoded data type \" + type);\n    }\n\n    mapper.setGeometryData(geom);\n\n    //default opacity === solid. If were transparent, set it lower.\n    if (vtkObject.hasTransparency) {\n      shaderProg = material.shaderProgram();\n      opacityUniform = shaderProg.uniform(\"opacity\");\n      shaderProg.addUniform(new vgl.floatUniform(\"opacity\", 0.5));\n      material.setBinNumber(1000);\n    }\n\n    actor = vgl.actor();\n    actor.setMapper(mapper);\n    actor.setMaterial(material);\n    actor.setMatrix(mat4.transpose(mat4.create(), matrix));\n\n    return actor;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * parseLineData\n   *\n   * @param geom, ss\n   * @returns matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parseLineData = function(geom, ss) {\n    var vglpoints = null, vglcolors = null, vgllines = null,\n        matrix = mat4.create(),\n        numberOfIndex, numberOfPoints, points,\n        temp, index, size, m, i,\n        p = null, idx = 0;\n\n    numberOfPoints = this.readNumber(ss);\n    p = new Array(numberOfPoints*3);\n\n    //Getting Points\n    vglpoints = new vgl.sourceDataP3fv();\n    points = this.readF3Array(numberOfPoints, ss);\n\n    for(i = 0; i < numberOfPoints; i++) {\n      p[idx++] = points[i*3/*+0*/];\n      p[idx++] = points[i*3+1];\n      p[idx++] =  points[i*3+2];\n    }\n    vglpoints.insert(p);\n    geom.addSource(vglpoints);\n\n    //Getting Colors\n    vglcolors = new vgl.sourceDataC3fv();\n    this.readColorArray(numberOfPoints, ss, vglcolors);\n    geom.addSource(vglcolors);\n\n    //Getting connectivity\n    vgllines = new vgl.lines();\n    geom.addPrimitive(vgllines);\n    numberOfIndex = this.readNumber(ss);\n\n    temp = new Int8Array(numberOfIndex*2);\n    for(i = 0; i < numberOfIndex*2; i++) {\n      temp[i] = ss[m_pos++];\n    }\n\n    index = new Uint16Array(temp.buffer);\n    vgllines.setIndices(index);\n    vgllines.setPrimitiveType(gl.LINES);\n\n    //Getting Matrix\n    size = 16*4;\n    temp = new Int8Array(size);\n    for(i=0; i<size; i++) {\n      temp[i] = ss[m_pos++];\n    }\n\n    m = new Float32Array(temp.buffer);\n    mat4.copy(matrix, m);\n\n    return matrix;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * parseMeshData\n   *\n   * @param geom, ss\n   * @returns matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parseMeshData = function(geom, ss) {\n    var vglpoints = null, vglcolors = null, vgllines = null,\n        normals = null, matrix = mat4.create(), v1 = null,\n        vgltriangles = null, numberOfIndex, numberOfPoints,\n        points, temp, index, size, m, i, tcoord,\n        pn = null, idx = 0;\n\n    numberOfPoints = this.readNumber(ss);\n    pn = new Array(numberOfPoints*6);\n    //Getting Points\n    vglpoints = new vgl.sourceDataP3N3f();\n    points = this.readF3Array(numberOfPoints, ss);\n\n    //Getting Normals\n    normals = this.readF3Array(numberOfPoints, ss);\n    for(i = 0; i < numberOfPoints; i++) {\n      pn[idx++] = points[i*3/*+0*/];\n      pn[idx++] = points[i*3+1];\n      pn[idx++] = points[i*3+2];\n      pn[idx++] = normals[i*3/*+0*/];\n      pn[idx++] = normals[i*3+1];\n      pn[idx++] = normals[i*3+2];\n    }\n    vglpoints.insert(pn);\n    geom.addSource(vglpoints);\n\n    //Getting Colors\n    vglcolors = new vgl.sourceDataC3fv();\n    this.readColorArray(numberOfPoints, ss, vglcolors);\n    geom.addSource(vglcolors);\n\n    //Getting connectivity\n    temp = [];\n    vgltriangles = new vgl.triangles();\n    numberOfIndex = this.readNumber(ss);\n\n    temp = new Int8Array(numberOfIndex*2);\n    for(i = 0; i < numberOfIndex*2; i++) {\n      temp[i] = ss[m_pos++];\n    }\n\n    index = new Uint16Array(temp.buffer);\n    vgltriangles.setIndices(index);\n    geom.addPrimitive(vgltriangles);\n\n    //Getting Matrix\n    size = 16*4;\n    temp = new Int8Array(size);\n    for(i = 0; i < size; i++) {\n      temp[i] = ss[m_pos++];\n    }\n\n    m = new Float32Array(temp.buffer);\n    mat4.copy(matrix, m);\n\n    //Getting TCoord\n    //TODO: renderer is not doing anything with this yet\n    tcoord = null;\n\n    return matrix;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * parsePointData\n   *\n   * @param geom, ss\n   * @returns matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parsePointData = function(geom, ss) {\n    var numberOfPoints, points, indices, temp, size,\n        matrix = mat4.create(), vglpoints = null,\n        vglcolors = null, vglVertexes = null, m,\n        p = null, idx = 0;\n\n    numberOfPoints = this.readNumber(ss);\n    p = new Array(numberOfPoints*3);\n\n    //Getting Points and creating 1:1 connectivity\n    vglpoints = new vgl.sourceDataP3fv();\n    points = this.readF3Array(numberOfPoints, ss);\n\n    indices = new Uint16Array(numberOfPoints);\n\n    for (i = 0; i < numberOfPoints; i++) {\n      indices[i] = i;\n      p[idx++] = points[i*3/*+0*/];\n      p[idx++] = points[i*3+1];\n      p[idx++] = points[i*3+2];\n    }\n    vglpoints.insert(p);\n    geom.addSource(vglpoints);\n\n    //Getting Colors\n    vglcolors = new vgl.sourceDataC3fv();\n    this.readColorArray(numberOfPoints, ss, vglcolors);\n    geom.addSource(vglcolors);\n\n    //Getting connectivity\n    vglVertexes = new vgl.points();\n    vglVertexes.setIndices(indices);\n    geom.addPrimitive(vglVertexes);\n\n    //Getting matrix\n    size = 16*4;\n    temp = new Int8Array(size);\n    for(i = 0; i < size; i++) {\n      temp[i] = ss[m_pos++];\n    }\n\n    m = new Float32Array(temp.buffer);\n    mat4.copy(matrix, m);\n\n    return matrix;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * parseColorMapData\n   *\n   * @param geom, ss\n   * @returns matrix\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parseColorMapData = function(geom, ss, numColors) {\n\n/******* NOTE:,\n         This code is a copy of the webgl version, not yet implemented here.\n    var tmpArray, size, xrgb, i, c;\n\n\n    // Getting Position\n    size = 2 * 4;\n    tmpArray = new Int8Array(size);\n    for(i=0; i < size; i++) {\n      tmpArray[i] = ss[m_pos++];\n    }\n    obj.position = new Float32Array(tmpArray.buffer);\n\n    // Getting Size\n    size = 2 * 4;\n    tmpArray = new Int8Array(2*4);\n    for(i=0; i < size; i++) {\n      tmpArray[i] = binaryArray[cursor++];\n    }\n    obj.size = new Float32Array(tmpArray.buffer);\n\n    //Getting Colors\n    obj.colors = [];\n    for(c=0; c < obj.numOfColors; c++){\n      tmpArray = new Int8Array(4);\n      for(i=0; i < 4; i++) {\n        tmpArray[i] = binaryArray[cursor++];\n      }\n      xrgb = [\n        new Float32Array(tmpArray.buffer)[0],\n        binaryArray[cursor++],\n        binaryArray[cursor++],\n        binaryArray[cursor++]\n      ];\n      obj.colors[c] = xrgb;\n    }\n\n    obj.orientation = binaryArray[cursor++];\n    obj.numOfLabels = binaryArray[cursor++];\n    obj.title = \"\";\n    while(cursor < binaryArray.length) {\n      obj.title += String.fromCharCode(binaryArray[cursor++]);\n    }\n\n*/\n    return null;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * parseSceneMetadata\n   *\n   * @param data\n   * @returns renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.parseSceneMetadata = function(renderer, layer) {\n\n    var sceneRenderer = m_vtkScene.Renderers[layer],\n        camera = renderer.camera(), bgc, localWidth, localHeight;\n\n    localWidth = (sceneRenderer.size[0] - sceneRenderer.origin[0])*m_node.width;\n    localHeight = (sceneRenderer.size[1] - sceneRenderer.origin[1])*m_node.height;\n    renderer.resize(localWidth, localHeight);\n\n    /// We are setting the center to the focal point because of\n    /// a possible paraview web bug. The center of rotation isn't\n    /// getting updated correctly on resetCamera.\n    camera.setCenterOfRotation(\n      [sceneRenderer.LookAt[1], sceneRenderer.LookAt[2],\n       sceneRenderer.LookAt[3]]);\n    camera.setViewAngleDegrees(sceneRenderer.LookAt[0]);\n    camera.setPosition(\n      sceneRenderer.LookAt[7], sceneRenderer.LookAt[8],\n      sceneRenderer.LookAt[9]);\n    camera.setFocalPoint(\n      sceneRenderer.LookAt[1], sceneRenderer.LookAt[2],\n      sceneRenderer.LookAt[3]);\n    camera.setViewUpDirection(\n      sceneRenderer.LookAt[4], sceneRenderer.LookAt[5],\n      sceneRenderer.LookAt[6]);\n\n    if (layer === 0)\n    {\n      bgc = sceneRenderer.Background1;\n      renderer.setBackgroundColor(bgc[0], bgc[1], bgc[2], 1);\n    } else {\n        renderer.setResizable(false);\n    }\n    renderer.setLayer(layer);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * initScene\n   *\n   * @returns viewer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.initScene = function() {\n    var renderer, layer;\n\n    if ( m_vtkScene === null ) {\n      return m_viewer;\n    }\n    for(layer = m_vtkScene.Renderers.length - 1; layer >= 0; layer--) {\n\n      renderer = this.getRenderer(layer);\n      this.parseSceneMetadata(renderer, layer);\n    }\n\n    return m_viewer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * createViewer - Creates a viewer object.\n   *\n   * @param\n   *\n   * @returns viewer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.createViewer = function(node) {\n    var interactorStyle;\n\n    if(m_viewer === null) {\n      m_node = node;\n      m_viewer = vgl.viewer(node);\n      m_viewer.init();\n      m_vtkRenderedList[0] = m_viewer.renderWindow().activeRenderer();\n      m_viewer.renderWindow().resize(node.width, node.height);\n      interactorStyle = vgl.pvwInteractorStyle();\n      m_viewer.setInteractorStyle(interactorStyle);\n    }\n\n    return m_viewer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * deleteViewer - Deletes the viewer object associated with the reader.\n   *\n   * @returns void\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.deleteViewer = function() {\n      m_vtkRenderedList = {};\n      m_viewer = null;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * updateCanvas -\n   *\n   * @param\n   *\n   * @returns void\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.updateCanvas = function(node) {\n    m_node = node;\n    m_viewer.renderWindow().resize(node.width, node.height);\n\n    return m_viewer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * clearVtkObjectData - Clear out the list of VTK geometry data.\n   *\n   * @param void\n   * @returns void\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.numObjects = function() {\n    return m_vtkObjectCount;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * getRenderer - Gets (or creates) the renderer for a layer.\n   *\n   * @param layer\n   * @returns renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getRenderer = function(layer) {\n    var renderer;\n\n    renderer = m_vtkRenderedList[layer];\n    if (renderer === null || typeof renderer === 'undefined') {\n      renderer = new vgl.renderer();\n      renderer.setResetScene(false);\n      renderer.setResetClippingRange(false);\n      m_viewer.renderWindow().addRenderer(renderer);\n\n      if (layer !== 0) {\n          renderer.camera().setClearMask(vgl.GL.DepthBufferBit);\n      }\n\n      m_vtkRenderedList[layer] = renderer;\n    }\n\n    return renderer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * setVtkScene - Set the VTK scene data for camera initialization.\n   *\n   * @param scene\n   * @returns void\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setVtkScene = function(scene) {\n    m_vtkScene = scene;\n  };\n\n  return this;\n};\n","vgl.DataBuffers = function (initialSize) {\n    if (!(this instanceof vgl.DataBuffers)) {\n      return new vgl.DataBuffers(initialSize);\n    }\n\n    var data = {};\n\n    var size;\n    if (!initialSize)\n        size = 256;\n    else\n        size = initialSize;\n\n    var current = 0;\n\n    var copyArray = function (dst, src, start, count) {\n        if (!dst)\n            console.log ('ack');\n        if (!start)\n            start = 0;\n        if (!count)\n            count = src.length;\n        for (var i = 0; i < count; i ++) {\n            dst[start + i] = src[i];\n        }\n    };\n\n    var resize = function (min_expand) {\n        var new_size = size;\n        while (new_size < min_expand)\n            new_size *= 2;\n        size = new_size;\n        for (var name in data) {\n            var newArray = new Float32Array (new_size * data[name].len);\n            var oldArray = data[name].array;\n            copyArray (newArray, oldArray);\n            data[name].array = newArray;\n            data[name].dirty = true;\n        }\n    };\n\n    this.create = function (name, len) {\n        if (!len)\n            throw \"Length of buffer must be a positive integer\";\n        var array = new Float32Array (size * len);\n        data[name] = {\n            array: array,\n            len: len,\n            dirty: false\n        };\n    };\n\n    this.alloc = function (num) {\n        if ((current + num) >= size)\n            resize (current + num);\n        var start = current;\n        current += num;\n        return start;\n    };\n\n    this.get = function (name) {\n        return data[name].array;\n    };\n\n    this.write = function (name, array, start, count) {\n        copyArray (data[name].array, array, start * data[name].len, count * data[name].len);\n        data[name].dirty = true;\n    };\n\n    this.repeat = function (name, elem, start, count) {\n        for (var i = 0; i < count; i ++) {\n            copyArray (data[name].array, elem,\n                       (start + i) * data[name].len, data[name].len);\n        }\n        data[name].dirty = true;\n    };\n\n    this.count = function () {\n        return current;\n    };\n\n    this.data = function (name) {\n        return data[name].array;\n    };\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geojs\n */\n//////////////////////////////////////////////////////////////////////////////\n\n/* jshint ignore: start */\nvar ogs;\nif (!window || window.ogs === undefined) {\n  ogs = {};\n} else {\n  ogs = window.ogs;\n}\n/* jshint ignore: end */\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create namespace for the given name\n *\n * @param ns_string\n * @returns {*|{}}\n */\n//////////////////////////////////////////////////////////////////////////////\nogs.namespace = function (ns_string) {\n  \"use strict\";\n\n  var parts = ns_string.split(\".\"), parent = ogs, i;\n\n  // strip redundant leading global\n  if (parts[0] === \"ogs\") {\n    parts = parts.slice(1);\n  }\n  for (i = 0; i < parts.length; i += 1) {\n    // create a property if it doesn't exist\n    if (parent[parts[i]] === undefined) {\n      parent[parts[i]] = {};\n    }\n    parent = parent[parts[i]];\n  }\n  return parent;\n};\n\n/** geo namespace */\nvar geo = ogs.namespace(\"geo\"); // jshint ignore: line\nwindow.geo = geo; // jshint ignore: line\n\ngeo.renderers = {};\ngeo.features = {};\ngeo.fileReaders = {};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convenient function to define JS inheritance\n *\n * @param C\n * @param P\n */\n//////////////////////////////////////////////////////////////////////////////\ninherit = function (C, P) { // jshint ignore: line\n  \"use strict\";\n\n  var F = function () {\n  };\n  F.prototype = P.prototype;\n  C.prototype = new F();\n  C.uber = P.prototype;\n  C.prototype.constructor = C;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convenient function to get size of an object\n *\n * @param obj\n * @returns {number} *\n */\n//////////////////////////////////////////////////////////////////////////////\nObject.size = function (obj) { // jshint ignore: line\n  \"use strict\";\n\n  var size = 0, key = null;\n  for (key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      size += 1;\n    }\n  }\n  return size;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Register a new file reader type\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.registerFileReader = function (name, func) {\n  \"use strict\";\n\n  if (geo.fileReaders === undefined) {\n    geo.fileReaders = {};\n  }\n\n  geo.fileReaders[name] = func;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new file reader\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.createFileReader = function (name, opts) {\n  \"use strict\";\n\n  if (geo.fileReaders.hasOwnProperty(name)) {\n    return geo.fileReaders[name](opts);\n  }\n  return null;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Register a new renderer type\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.registerRenderer = function (name, func) {\n  \"use strict\";\n\n  if (geo.renderers === undefined) {\n    geo.renderers = {};\n  }\n\n  geo.renderers[name] = func;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create new instance of the renderer\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.createRenderer  = function (name, layer, canvas) {\n  \"use strict\";\n\n  if (geo.renderers.hasOwnProperty(name)) {\n    var ren = geo.renderers[name](\n      {\"layer\": layer, \"canvas\": canvas}\n    );\n    ren._init();\n    return ren;\n  }\n  return null;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Register a new feature type\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.registerFeature = function (category, name, func) {\n  \"use strict\";\n\n  if (geo.features === undefined) {\n    geo.features = {};\n  }\n\n  if (!(category in geo.features)) {\n    geo.features[category] = {};\n  }\n\n  // TODO Add warning if the name already exists\n  geo.features[category][name] = func;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create new instance of the renderer\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.createFeature  = function (name, layer, renderer, arg) {\n  \"use strict\";\n\n  var category = renderer.api(),\n      options = {\"layer\": layer, \"renderer\": renderer};\n  if (category in geo.features && name in geo.features[category]) {\n    if (arg !== undefined) {\n      $.extend(true, options, arg);\n    }\n    return geo.features[category][name](options);\n  }\n  return null;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Register a new layer type\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.registerLayer = function (name, func) {\n  \"use strict\";\n\n  if (geo.layers === undefined) {\n    geo.layers = {};\n  }\n\n  geo.layers[name] = func;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create new instance of the layer\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.createLayer = function (name, map, arg) {\n  \"use strict\";\n\n  /// Default renderer is vgl\n  var options = {\"map\": map, \"renderer\": \"vglRenderer\"},\n      layer = null;\n\n  if (name in geo.layers) {\n    if (arg !== undefined) {\n      $.extend(true, options, arg);\n    }\n    layer = geo.layers[name](options);\n    layer._init();\n    return layer;\n  } else {\n    return null;\n  }\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Generic utilities module\n */\n//////////////////////////////////////////////////////////////////////////////\n(function () {\n  \"use strict\";\n  geo.util = {\n    isFunction: function (f) {\n      return typeof f === \"function\";\n    },\n\n    /**\n     * Returns the argument if it is function, otherwise returns a function\n     * that returns the argument.\n     */\n    ensureFunction: function (f) {\n      if (geo.util.isFunction(f)) {\n        return f;\n      } else {\n        return function () { return f; };\n      }\n    }\n  };\n}());\n","/*global geo*/\n\ngeo.version = \"0.1.0\";\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class object\n *\n * @class\n * @returns {geo.object}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.object = function () {\n  \"use strict\";\n  if (!(this instanceof geo.object)) {\n    return new geo.object();\n  }\n\n  var m_this = this,\n      m_eventHandlers = {},\n      m_idleHandlers = [],\n      m_deferredCount = 0;\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Bind a handler that will be called once when all deferreds are resolved.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.onIdle = function (handler) {\n    if (m_deferredCount) {\n      m_idleHandlers.push(handler);\n    } else {\n      handler();\n    }\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Add a new deferred object preventing idle event handlers from being called.\n   *  Takes a $.Deferred object as an argument.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.addDeferred = function (defer) {\n    m_deferredCount += 1;\n    defer.done(function () {\n      m_deferredCount -= 1;\n      if (!m_deferredCount) {\n        m_idleHandlers.splice(0, m_idleHandlers.length)\n          .forEach(function (handler) {\n            handler();\n          });\n      }\n    });\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Bind an event handler to this object\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.on = function (event, handler) {\n    if (Array.isArray(event)) {\n      event.forEach(function (e) {\n        m_this.on(e, handler);\n      });\n      return m_this;\n    }\n    if (!m_eventHandlers.hasOwnProperty(event)) {\n      m_eventHandlers[event] = [];\n    }\n    m_eventHandlers[event].push(handler);\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Trigger an event (or events) on this object and call all handlers\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.trigger = function (event, args) {\n\n    // if we have an array of events, recall with single events\n    if (Array.isArray(event)) {\n      event.forEach(function (e) {\n        m_this.trigger(e, args);\n      });\n      return m_this;\n    }\n\n    if (m_eventHandlers.hasOwnProperty(event)) {\n      m_eventHandlers[event].forEach(function (handler) {\n        handler(args);\n      });\n    }\n\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Remove handlers from an event (or an array of events).\n   *\n   *  @param arg a function or array of functions to remove from the events\n   *             or if falsey remove all handlers from the events\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.off = function (event, arg) {\n    if (Array.isArray(event)) {\n      event.forEach(function (e) {\n        m_this.off(e, arg);\n      });\n      return m_this;\n    }\n    if (!arg) {\n      m_eventHandlers[event] = [];\n    } else if (Array.isArray(arg)) {\n      arg.forEach(function (handler) {\n        m_this.off(event, handler);\n      });\n      return m_this;\n    }\n    // What do we do if the handler is not already bound?\n    //   ignoring for now...\n    if (m_eventHandlers.hasOwnProperty(event)) {\n      m_eventHandlers[event] = m_eventHandlers[event].filter(function (f) {\n          return f !== arg;\n        }\n      );\n    }\n    return m_this;\n  };\n\n  vgl.object.call(this);\n\n  return this;\n};\n\ninherit(geo.object, vgl.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n\n/*jslint devel: true, unparam: true*/\n\n/*global geo, inherit*/\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class sceneObject, which extends the object's\n * event handling with a tree-based event propagation.\n *\n * @class\n * @returns {geo.sceneObject}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.sceneObject = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.sceneObject)) {\n    return new geo.sceneObject();\n  }\n  geo.object.call(this, arg);\n\n  var m_this = this,\n      m_parent = null,\n      m_children = [],\n      s_trigger = this.trigger,\n      s_addDeferred = this.addDeferred,\n      s_onIdle = this.onIdle;\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Override object.addDeferred to propagate up the scene tree.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.addDeferred = function (defer) {\n    if (m_parent) {\n      m_parent.addDeferred(defer);\n    } else {\n      s_addDeferred(defer);\n    }\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Override object.onIdle to propagate up the scene tree.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.onIdle = function (handler) {\n    if (m_parent) {\n      m_parent.onIdle(handler);\n    } else {\n      s_onIdle(handler);\n    }\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Get/set parent of the object\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.parent = function (arg) {\n    if (arg === undefined) {\n      return m_parent;\n    }\n    m_parent = arg;\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Add a child (or an array of children) to the object\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.addChild = function (child) {\n    if (Array.isArray(child)) {\n      child.forEach(m_this.addChild);\n      return m_this;\n    }\n    child.parent(m_this);\n    m_children.push(child);\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Remove a child (or array of children) from the object\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.removeChild = function (child) {\n    if (Array.isArray(child)) {\n      child.forEach(m_this.removeChild);\n      return m_this;\n    }\n    m_children = m_children.filter(function (c) { return c !== child; });\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Get an array of child objects\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.children = function () {\n    return m_children.slice();\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Force redraw of a scene object, to be implemented by subclasses.\n   *  Base class just calls draw of child objects.\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.draw = function (arg) {\n    m_this.children().forEach(function (child) {\n      child.draw(arg);\n    });\n    return m_this;\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   *  Trigger an event (or events) on this object and call all handlers.\n   *  @param {String} event the event to trigger\n   *  @param {Object} args arbitrary argument to pass to the handler\n   *  @param {Boolean} childrenOnly if true, only propagate down the tree\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.trigger = function (event, args, childrenOnly) {\n\n    var geoArgs;\n\n    args = args || {};\n    geoArgs = args.geo || {};\n    args.geo = geoArgs;\n\n    // If the event was not triggered by the parent, just propagate up the tree\n    if (!childrenOnly && m_parent && geoArgs._triggeredBy !== m_parent) {\n      geoArgs._triggeredBy = m_this;\n      m_parent.trigger(event, args);\n      return m_this;\n    }\n\n    // call the object's own handlers\n    s_trigger.call(m_this, event, args);\n\n    // stop propagation if requested by the handler\n    if (geoArgs.stopPropagation) {\n      return m_this;\n    }\n\n    // trigger the event on the children\n    m_children.forEach(function (child) {\n      geoArgs._triggeredBy = m_this;\n      child.trigger(event, args);\n    });\n\n    return m_this;\n  };\n\n  return this;\n};\n\ninherit(geo.sceneObject, geo.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class timestamp\n *\n * @class\n * @returns {geo.timestamp}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.timestamp = function () {\n  'use strict';\n  if (!(this instanceof geo.timestamp)) {\n    return new geo.timestamp();\n  }\n  vgl.timestamp.call(this);\n};\n\ninherit(geo.timestamp, vgl.timestamp);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create an instance of quadratic surface generator\n * in Cartesian coordinates by the equation\n * <code>(x / a)^2 + (y / b)^2 + (z / c)^2 = 1</code>. Used\n * primarily to create planetary bodies\n *\n * @constructor\n * @param {Number} [x=0]  Radius in X direction\n * @param {Number} [y=0]  Radius in Y direction\n * @param {Number} [z=0]  Radius in Z direction\n *\n * @returns {geo.ellipsoid}\n */\n //////////////////////////////////////////////////////////////////////////////\ngeo.ellipsoid = function (x, y, z) {\n  'use strict';\n  if (!(this instanceof geo.ellipsoid)) {\n    return new geo.ellipsoid(x, y, z);\n  }\n\n  x = vgl.defaultValue(x, 0.0);\n  y = vgl.defaultValue(y, 0.0);\n  z = vgl.defaultValue(z, 0.0);\n\n  if (x < 0.0 || y < 0.0 || z < 0.0) {\n    return console.log('[error] Al radii components must be greater than zero');\n  }\n\n  var m_this = this,\n      m_radii = new vec3.fromValues(x, y, z),\n      m_radiiSquared = new vec3.fromValues(\n        x * x, y * y, z * z),\n      m_minimumRadius = Math.min(x, y, z),\n      m_maximumRadius = Math.max(x, y, z);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return radii of ellipsoid\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.radii = function () {\n    return m_radii;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return squared radii of the ellipsoid\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.radiiSquared = function () {\n    return m_radiiSquared;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return maximum radius of the ellipsoid\n   *\n   * @return {Number} The maximum radius of the ellipsoid\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.maximumRadius = function () {\n    return m_maximumRadius;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return minimum radius of the ellipsoid\n   *\n   * @return {Number} The maximum radius of the ellipsoid\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.minimumRadius = function () {\n    return m_minimumRadius;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Computes the normal of the plane tangent to the surface of\n   * the ellipsoid at the provided position\n   *\n   * @param {Number} lat The cartographic latitude for which\n   *  to to determine the geodetic normal\n   * @param {Number} lon The cartographic longitude for which\n   *  to to determine the geodetic normal\n   *\n   * @return {vec3}\n   *\n   * @exception {DeveloperError} cartographic is required.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.computeGeodeticSurfaceNormal = function (lat, lon) {\n    if (typeof lat === 'undefined' || typeof lon === 'undefined') {\n      throw '[error] Valid latitude and longitude is required';\n    }\n\n    var cosLatitude = Math.cos(lat),\n        result = vec3.create();\n\n    result[0] = cosLatitude * Math.cos(lon);\n    result[1] = cosLatitude * Math.sin(lon);\n    result[2] = Math.sin(lat);\n\n    vec3.normalize(result, result);\n    return result;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Converts the provided geographic latitude, longitude,\n   * and height to WGS84 coordinate system\n   *\n   * @param {Number} lat Latitude in radians\n   * @param {Number} lon Longitude in radians\n   * @param {Number} elev Elevation\n   * @return {vec3} Position in the WGS84 coordinate system\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.transformPoint = function (lat, lon, elev) {\n    lat = lat *  (Math.PI / 180.0);\n    lon = lon * (Math.PI / 180.0);\n\n    var n = m_this.computeGeodeticSurfaceNormal(lat, lon),\n        k = vec3.create(),\n        gamma  = Math.sqrt(vec3.dot(n, k)),\n        result = vec3.create();\n\n    vec3.multiply(k, m_radiiSquared, n);\n    vec3.scale(k, k, 1 / gamma);\n    vec3.scale(n, n, elev);\n    vec3.add(result, n,  k);\n    return result;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Converts the provided geographic latitude, longitude,\n   * and height to WGS84 coordinate system\n   *\n   * @param {vgl.geometryData} geom\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.transformGeometry = function (geom) {\n    if (!geom) {\n      throw '[error] Failed to transform to cartesian. Invalid geometry.';\n    }\n\n    var sourceData = geom.sourceData(vgl.vertexAttributeKeys.Position),\n        sourceDataArray = sourceData.data(),\n        noOfComponents =  sourceData.attributeNumberOfComponents(\n          vgl.vertexAttributeKeys.Position),\n        stride = sourceData.attributeStride(\n          vgl.vertexAttributeKeys.Position),\n        offset = sourceData.attributeOffset(\n          vgl.vertexAttributeKeys.Position),\n        sizeOfDataType = sourceData.sizeOfAttributeDataType(\n          vgl.vertexAttributeKeys.Position),\n        index = null,\n        count = sourceDataArray.length * (1.0 / noOfComponents),\n        gamma = null,\n        n = null,\n        j = 0,\n        k = vec3.create(),\n        result = vec3.create();\n\n    stride /= sizeOfDataType;\n    offset /= sizeOfDataType;\n\n    if (noOfComponents !== 3) {\n      throw ('[error] Requires positions with three components');\n    }\n\n    for (j = 0; j < count; j += 1) {\n      index = j * stride + offset;\n\n      sourceDataArray[index] = sourceDataArray[index] * (Math.PI / 180.0);\n      sourceDataArray[index + 1] = sourceDataArray[index + 1] * (Math.PI / 180.0);\n\n      n = m_this.computeGeodeticSurfaceNormal(sourceDataArray[index + 1],\n                                            sourceDataArray[index]);\n      vec3.multiply(k, m_radiiSquared, n);\n      gamma = Math.sqrt(vec3.dot(n, k));\n      vec3.scale(k, k, 1 / gamma);\n      vec3.scale(n, n, sourceDataArray[index + 2]);\n      vec3.add(result, n,  k);\n\n      sourceDataArray[index] = result[0];\n      sourceDataArray[index + 1] = result[1];\n      sourceDataArray[index + 2] = result[2];\n    }\n  };\n\n  return m_this;\n};\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * An Ellipsoid instance initialized to the WGS84 standard.\n * @memberof ellipsoid\n *\n */\n////////////////////////////////////////////////////////////////////////////\ngeo.ellipsoid.WGS84 = vgl.freezeObject(\n  geo.ellipsoid(6378137.0, 6378137.0, 6356752.3142451793));\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * An Ellipsoid instance initialized to radii of (1.0, 1.0, 1.0).\n * @memberof ellipsoid\n */\n////////////////////////////////////////////////////////////////////////////\ngeo.ellipsoid.UNIT_SPHERE = vgl.freezeObject(\n  geo.ellipsoid(1.0, 1.0, 1.0));\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\ngeo.mercator = {\n  r_major: 6378137.0,  //Equatorial Radius, WGS84\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Returns the polar radius based on the projection.\n *\n * @method r_minor\n * @param {Boolean}\n * @returns {Number}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.r_minor = function (spherical) {\n  'use strict';\n\n  var r_minor;\n\n  spherical = spherical !== undefined ? spherical : false;\n\n  if (spherical) {\n    r_minor = 6378137.0;\n  }\n  else {\n    r_minor = 6356752.314245179;\n  }\n\n  return r_minor;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * 1/f=(a-b)/a , a=r_major, b=r_minor\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.f = function (spherical) {\n  'use strict';\n\n  return (geo.mercator.r_major - geo.mercator.r_minor(spherical)) / geo.mercator.r_major;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert longitude (Degree) to Tile X\n *\n *  @method long2tilex\n *  @param {float, integer}\n *  @returns {integer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.long2tilex = function (lon, z) {\n  'use strict';\n  var rad = (lon + 180.0) / 360.0,\n      f = Math.floor(rad * Math.pow(2.0, z));\n  return f;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert latitude (Degree) to Tile Y\n *\n *  @method lat2tiley\n *  @param {float, integer}\n *  @returns {integer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.lat2tiley = function (lat, z) {\n  'use strict';\n  var rad = lat * Math.PI / 180.0;\n  return Math.floor((1.0 - rad / Math.PI) / 2.0 * Math.pow(2.0, z));\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert Longitute (Degree) to Tile X and fraction.\n *\n *  @method long2tilex\n *  @param {float, integer}\n *  @returns {integer, float}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.long2tilex2 = function (lon, z) {\n  'use strict';\n  var rad = (lon + 180.0) / 360.0,\n      f = rad * Math.pow(2.0, z),\n      ret = Math.floor(f),\n      frac = f - ret;\n  return [ret, frac];\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert Latitude (Degree) to Tile Y and fraction\n *\n *  @method lat2tiley\n *  @param {float, integer}\n *  @returns {integer, float}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.lat2tiley2 = function (lat, z) {\n  'use strict';\n  var rad = lat * Math.PI / 180.0,\n      f = (1.0 - Math.log(Math.tan(rad) + 1.0 / Math.cos(rad)) /\n           Math.PI) / 2.0 * Math.pow(2.0, z),\n      ret = Math.floor(f),\n      frac = f - ret;\n  return [ret, frac];\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert Tile X to Longitute (Degree)\n *\n *  @method tilex2long\n *  @param {integer, integer}\n *  @returns {float}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.tilex2long = function (x, z) {\n  'use strict';\n  return x / Math.pow(2.0, z) * 360.0 - 180.0;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert Tile Y to Latitute (Degree)\n *\n *  @method tiley2lat\n *  @param {integer, integer}\n *  @returns {float}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.tiley2lat = function (y, z) {\n  'use strict';\n  var n = Math.PI - 2.0 * Math.PI * y / Math.pow(2.0, z);\n  return 180.0 / Math.PI * Math.atan(0.5 * (Math.exp(n) - Math.exp(-n)));\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert spherical mercator Y to latitude\n *\n *  @method y2lat\n *  @param {float}\n *  @returns {float}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.y2lat = function (a) {\n  'use strict';\n  return 180 / Math.PI * (2 * Math.atan(Math.exp(a * Math.PI / 180)) - Math.PI / 2);\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert latitude into Y position in spherical mercator\n *\n *  @method lat2y\n *  @param {float}\n *  @returns {float}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.lat2y = function (a) {\n  'use strict';\n  return 180 / Math.PI * Math.log(Math.tan(Math.PI / 4 + a * (Math.PI / 180) / 2));\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n *\n * @param d\n * @returns {number}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.deg2rad = function (d) {\n  'use strict';\n  var r = d * (Math.PI / 180.0);\n  return r;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert radian to degree\n *\n * @param r\n * @returns {number}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.rad2deg = function (r) {\n  'use strict';\n  var d = r / (Math.PI / 180.0);\n  return d;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert latlon to mercator\n *\n * @param lon\n * @param lat\n * @returns {{x: number, y: number}}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.ll2m = function (lon, lat, spherical) {\n  'use strict';\n\n  if (lat > 89.5) {\n    lat = 89.5;\n  }\n\n  if (lat < -89.5) {\n    lat = -89.5;\n  }\n\n  var x = this.r_major * this.deg2rad(lon),\n      temp = this.r_minor(spherical) / this.r_major,\n      es = 1.0 - (temp * temp),\n      eccent = Math.sqrt(es),\n      phi = this.deg2rad(lat),\n      sinphi = Math.sin(phi),\n      con = eccent * sinphi,\n      com = 0.5 * eccent,\n      con2 = Math.pow((1.0 - con) / (1.0 + con), com),\n      ts = Math.tan(0.5 * (Math.PI * 0.5 - phi)) / con2,\n      y = -this.r_major * Math.log(ts),\n      ret = {'x': x, 'y': y};\n\n  return ret;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Convert mercator to lat lon\n *\n * @param x\n * @param y\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.m2ll = function (x, y, spherical) {\n  'use strict';\n  var lon = this.rad2deg((x / this.r_major)),\n      temp = this.r_minor(spherical) / this.r_major,\n      e = Math.sqrt(1.0 - (temp * temp)),\n      lat = this.rad2deg(this.pjPhi2(Math.exp(-(y / this.r_major)), e)),\n      ret = {'lon': lon, 'lat': lat};\n\n  return ret;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * pjPhi2\n *\n * @param ts\n * @param e\n * @returns {number}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.mercator.pjPhi2 = function (ts, e) {\n  'use strict';\n  var N_ITER = 15,\n      HALFPI = Math.PI / 2,\n      TOL = 0.0000000001,\n      con, dphi,\n      i = N_ITER,\n      eccnth = 0.5 * e,\n      Phi = HALFPI - 2.0 * Math.atan(ts);\n\n  do\n  {\n    con = e * Math.sin(Phi);\n    dphi = HALFPI - 2.0 * Math.atan(ts * Math.pow(\n            (1.0 - con) / (1.0 + con), eccnth)) - Phi;\n    Phi += dphi;\n    i -= 1;\n  } while (Math.abs(dphi) > TOL && i);\n  return Phi;\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of latlng\n *\n * A latlng encapsulates geodesy coordinates defined by latitude and\n * longitude\n * @returns {geo.latlng}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.latlng = function (arg1, arg2) {\n  \"use strict\";\n  if (!(this instanceof geo.latlng)) {\n    return new geo.latlng(arg1, arg2);\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_lat = arg2 === undefined ? arg1.lat() : arg1,\n      m_lng = arg2 === undefined ? arg1.lng() : arg2;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return latitude\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.lat = function (val) {\n    if (val === undefined) {\n      return m_lat;\n    } else {\n      m_lat = val;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return longitude\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.lng = function (val) {\n    if (val === undefined) {\n      return m_lng;\n    } else {\n      m_lng = val;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return x coodinate\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.x = function (val) {\n    if (val === undefined) {\n      return m_this.lng();\n    } else {\n      m_lng = val;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return y coodinate\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  this.y = function (val) {\n    if (val === undefined) {\n      return m_this.lat();\n    } else {\n      m_lat = val;\n    }\n  };\n\n  return this;\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Layer options object specification\n *\n * @class geo.layerOptions\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.layerOptions = function () {\n  \"use strict\";\n\n  if (!(this instanceof geo.layerOptions)) {\n    return new geo.layerOptions();\n  }\n\n  this.opacity = 0.5;\n  this.showAttribution = true;\n  this.visible = true;\n  this.binNumber = vgl.material.RenderBin.Default;\n\n  return this;\n};\n\ngeo.newLayerId = (function () {\n    \"use strict\";\n    var currentId = 1;\n    return function () {\n      var id = currentId;\n      currentId += 1;\n      return id;\n    };\n  }()\n);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Base class for all layer types geo.layer represents any object that be\n * rendered on top of the map base. This could include image, points, line, and\n * polygons.\n *\n * @class geo.layer\n * @returns {geo.layer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.layer = function (arg) {\n  \"use strict\";\n\n  if (!(this instanceof geo.layer)) {\n    return new geo.layer(arg);\n  }\n  arg = arg || {};\n  geo.sceneObject.call(this, arg);\n\n  //////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  //////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_style = arg.style === undefined ? {\"opacity\" : 0.5,\n                                           \"color\" : [0.8, 0.8, 0.8],\n                                           \"visible\" : true,\n                                           \"bin\" : 100} : arg.style,\n      m_id = arg.id === undefined ? geo.newLayerId() : arg.id,\n      m_name = \"\",\n      m_gcs = \"EPSG:4326\",\n      m_timeRange = null,\n      m_source = arg.source || null,\n      m_map = arg.map === undefined ? null : arg.map,\n      m_isReference = false,\n      m_x = 0,\n      m_y = 0,\n      m_width = 0,\n      m_height = 0,\n      m_node = null,\n      m_canvas = null,\n      m_renderer = null,\n      m_initialized = false,\n      m_rendererName = arg.renderer  === undefined ? \"vglRenderer\" : arg.renderer,\n      m_dataTime = geo.timestamp(),\n      m_updateTime = geo.timestamp(),\n      m_drawTime = geo.timestamp(),\n      m_sticky = arg.sticky === undefined ? true : arg.sticky;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get whether or not the layer is sticky (navigates with the map).\n   *\n   * @returns {Boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.sticky = function () {\n    return m_sticky;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set root node of the layer\n   *\n   * @returns {div}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.node = function () {\n    return m_node;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set id of the layer\n   *\n   * @returns {String}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.id = function (val) {\n    if (val === undefined) {\n      return m_id;\n    }\n    m_id = geo.newLayerId();\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set name of the layer\n   *\n   * @returns {String}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.name = function (val) {\n    if (val === undefined) {\n      return m_name;\n    }\n    m_name = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set opacity of the layer\n   *\n   * @returns {Number}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.opacity = function (val) {\n    if (val === undefined) {\n      return m_style.opacity;\n    }\n    m_style.opacity = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set visibility of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.visible = function (val) {\n    if (val === undefined) {\n      return m_style.visible;\n    }\n    m_style.visible = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set bin of the layer\n   *\n   * @returns {Number}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bin = function (val) {\n    if (val === undefined) {\n      return m_style.bin;\n    }\n    m_style.bin = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set projection of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.gcs = function (val) {\n    if (val === undefined) {\n      return m_gcs;\n    }\n    m_gcs = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform layer to the reference layer gcs\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.transform = function (val) {\n    geo.transform.transformLayer(val, m_this, m_map.baseLayer());\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set time range of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.timeRange = function (val) {\n    if (val === undefined) {\n      return m_timeRange;\n    }\n    m_timeRange = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set source of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.source = function (val) {\n    if (val === undefined) {\n      return m_source;\n    }\n    m_source = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set map of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.map = function (val) {\n    if (val === undefined) {\n      return m_map;\n    }\n    m_map = val;\n    m_map.node().append(m_node);\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get renderer for the layer if any\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.renderer = function () {\n    return m_renderer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get canvas of the layer\n   *\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.canvas = function () {\n    return m_canvas;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get viewport of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.viewport = function () {\n    return [m_x, m_y, m_width, m_height];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return last time data got changed\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.dataTime = function () {\n    return m_dataTime;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the modified time for the last update that did something\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.updateTime = function () {\n    return m_updateTime;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the modified time for the last draw call that did something\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.drawTime = function () {\n    return m_drawTime;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Run query and return results for it\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.query = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set layer as the reference layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.referenceLayer = function (val) {\n    if (val !== undefined) {\n      m_isReference = val;\n      m_this.modified();\n      return m_this;\n    }\n    return m_isReference;\n  };\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set if the layer has been initialized\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.initialized = function (val) {\n    if (val !== undefined) {\n      m_initialized = val;\n      return m_this;\n    }\n    return m_initialized;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point or array of points in GCS space to\n   * local space of the layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.toLocal = function (input) {\n    return input;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point or array of points in local space to\n   * latitude-longitude space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.fromLocal = function (input) {\n    return input;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Init layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    if (m_initialized) {\n      return m_this;\n    }\n\n    // Create top level div for the layer\n    m_node = $(document.createElement(\"div\"));\n    m_node.attr(\"id\", m_name);\n    // TODO: need to position according to offsets from the map element\n    //       and maybe respond to events in case the map element moves\n    //       around the page.\n    m_node.css(\"position\", \"absolute\");\n\n    if (m_map) {\n      m_map.node().append(m_node);\n\n    }\n\n    // Share context if have valid one\n    if (m_canvas) {\n      m_renderer = geo.createRenderer(m_rendererName, m_this, m_canvas);\n    } else {\n      m_renderer = geo.createRenderer(m_rendererName, m_this);\n      m_canvas = m_renderer.canvas();\n    }\n    m_this.addChild(m_renderer);\n\n    m_initialized = true;\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Clean up resouces\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Respond to resize event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._resize = function (x, y, w, h) {\n    m_x = x;\n    m_y = y;\n    m_width = w;\n    m_height = h;\n    m_node.width(w);\n    m_node.height(h);\n\n    m_this.modified();\n    m_this.trigger(geo.event.resize,\n      {x: x, y: y, width: m_width, height: m_height});\n\n    return m_this;\n  };\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the width of the layer in pixels\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.width = function () {\n    return m_width;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the height of the layer in pixels\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.height = function () {\n    return m_height;\n  };\n\n  return this;\n};\n\ninherit(geo.layer, geo.sceneObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class featureLayer\n *\n * @class\n * @dec Layer to draw points, lines, and polygons on the map The polydata layer\n *      provide mechanisms to create and draw geometrical shapes such as points,\n *      lines, and polygons.\n * @returns {geo.featureLayer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.featureLayer = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.featureLayer)) {\n    return new geo.featureLayer(arg);\n  }\n  geo.layer.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_features = [],\n      s_init = this._init,\n      s_update = this._update,\n      s_draw = this.draw;\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create feature give a name\n   *\n   * @returns {geo.Feature} Will return a new feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.createFeature = function (featureName, arg) {\n\n    var newFeature = geo.createFeature(\n      featureName, m_this, m_this.renderer(), arg);\n\n    m_this.addChild(newFeature);\n    m_features.push(newFeature);\n    m_this.features(m_features);\n    m_this.modified();\n    return newFeature;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Delete feature\n   *\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.deleteFeature = function (feature) {\n    var i;\n\n    for (i = 0; i < m_features.length; i += 1) {\n      if (m_features[i] === feature) {\n        m_features[i]._exit();\n        m_this.dataTime().modified();\n        m_this.modified();\n        m_features.splice(i, 1);\n        return m_this;\n      }\n    }\n    m_this.removeChild(feature);\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set drawables\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.features = function (val) {\n    if (val === undefined) {\n      return m_features;\n    } else {\n      m_features = val.slice(0);\n      m_this.dataTime().modified();\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   *\n   * Do not call parent _init method as its already been executed\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    if (m_this.initialized()) {\n      return m_this;\n    }\n\n    /// Call super class init\n    s_init.call(m_this);\n\n    /// Bind events to handlers\n    m_this.on(geo.event.resize, function (event) {\n      m_this.renderer()._resize(event.x, event.y, event.width, event.height);\n      m_this._update({});\n      m_this.renderer()._render();\n    });\n\n    m_this.on(geo.event.pan, function (event) {\n      m_this._update({event: event});\n      m_this.renderer()._render();\n    });\n\n    m_this.on(geo.event.zoom, function (event) {\n      if (m_this.map()) {\n        m_this.map().zoom(event.curr_zoom);\n      }\n      m_this._update({event: event});\n      m_this.renderer()._render();\n    });\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function (request) {\n    var i;\n\n    if (!m_features.length) {\n      return m_this;\n    }\n\n    /// Call base class update\n    s_update.call(m_this, request);\n\n    if (!m_this.source() && m_features && m_features.length === 0) {\n      console.log(\"[info] No valid data source found.\");\n      return;\n    }\n\n    if (m_this.dataTime().getMTime() > m_this.updateTime().getMTime()) {\n      for (i = 0; i < m_features.length; i += 1) {\n        m_features[i].renderer(m_this.renderer());\n      }\n    }\n\n    for (i = 0; i < m_features.length; i += 1) {\n      m_features[i]._update();\n    }\n\n    m_this.updateTime().modified();\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Draw\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.draw = function () {\n    // Call sceneObject.draw, which calls draw on all child objects.\n    s_draw();\n\n    // Now call render on the renderer. In certain cases it may not do\n    // anything if the if the child objects are drawn on the screen already.\n    m_this.renderer()._render();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Clear all features in layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.clear = function () {\n    var i;\n\n    if (!m_features.length)\n      return m_this;\n\n    for (i = 0; i < m_features.length; i += 1) {\n      m_features[i]._exit();\n    }\n\n    m_this.dataTime().modified();\n    m_this.modified();\n    m_features = [];\n\n    return m_this;\n  };\n\n  return m_this;\n};\n\ninherit(geo.featureLayer, geo.layer);\n\n// Now register it\ngeo.registerLayer(\"feature\", geo.featureLayer);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class event\n *\n * @class\n * @returns {geo.event}\n */\n //////////////////////////////////////////////////////////////////////////////\ngeo.event = function () {\n  \"use strict\";\n  if (!(this instanceof geo.event)) {\n    return new geo.event();\n  }\n  vgl.event.call(this);\n\n  return this;\n};\n\ninherit(geo.event, vgl.event);\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Event types\n */\n//////////////////////////////////////////////////////////////////////////////\n\n// TODO Add documentation\ngeo.event.update = \"geo.update\";\ngeo.event.opacityUpdate = \"geo.opacityUpdate\";\ngeo.event.layerAdd = \"geo.layerAdd\";\ngeo.event.layerRemove = \"geo.layerRemove\";\ngeo.event.layerToggle = \"geo.layerToggle\";\ngeo.event.layerSelect = \"geo.layerSelect\";\ngeo.event.layerUnselect = \"geo.layerUnselect\";\ngeo.event.zoom = \"geo.zoom\";\ngeo.event.center = \"geo.center\";\ngeo.event.pan = \"geo.pan\";\ngeo.event.rotate = \"geo.rotate\";\ngeo.event.resize = \"geo.resize\";\ngeo.event.animate = \"geo.animate\";\ngeo.event.query = \"geo.query\";\ngeo.event.draw = \"geo.draw\";\ngeo.event.drawEnd = \"geo.drawEnd\";\ngeo.event.animationPause = \"geo.animationPause\";\ngeo.event.animationStop = \"geo.animationStop\";\ngeo.event.animationComplete = \"geo.animationComplete\";\n\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\ngeo.time = {};\n\ngeo.time.incrementTime = function (time, unit, delta) {\n  'use strict';\n\n  if (unit === 'days') {\n    time.setDate(time.getDate() + delta);\n  }\n  else if (unit === 'months') {\n    time.setMonth(time.getMonth() + delta);\n  }\n  else if (unit === 'years') {\n    time.setYear(time.getYear() + delta);\n  }\n  else if (unit === 'index') {\n    time = time + delta;\n  }\n\n  return time;\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class fileReader\n *\n * @class\n * @returns {geo.fileReader}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.fileReader = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.fileReader)) {\n    return new geo.fileReader(arg);\n  }\n  geo.object.call(this);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  arg = arg || {};\n\n  if (!(arg.layer instanceof geo.featureLayer)) {\n    throw \"fileReader must be given a feature layer\";\n  }\n\n  var m_layer = arg.layer;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the feature layer attached to the reader\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.layer = function () {\n    return m_layer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Tells the caller if it can handle the given file by returning a boolean.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.canRead = function () {\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Reads the file object and calls the done function when finished.  As an\n   * argument to done, provides a boolean that reports if the read was a\n   * success.  Possibly, it can call done with an object containing details\n   * of the read operation.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.read = function (file, done) {\n    done(false);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return a FileReader with handlers attached.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function newFileReader(done, progress) {\n    var reader = new FileReader();\n    if (progress) {\n      reader.onprogress = progress;\n    }\n    reader.onloadend = function () {\n      if (!reader.result) {\n        done(reader.error);\n      }\n      done(reader.result);\n    };\n    return reader;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Private method for reading a file object as a string.  Calls done with\n   * the string content when finished or an error object if unsuccessful.\n   * Optionally, the caller can provide a progress method that is called\n   * after reading each slice.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._getString = function (file, done, progress) {\n    var reader = newFileReader(done, progress);\n    reader.readAsText(file);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Like _getString, but returns an ArrayBuffer object.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._getArrayBuffer = function (file, done, progress) {\n    var reader = newFileReader(done, progress);\n    reader.readAsText(file);\n  };\n\n  return this;\n};\n\ninherit(geo.fileReader, geo.object);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n/*global File*/\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class jsonReader\n *\n * @class\n * @returns {geo.fileReader}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.jsonReader = function (arg) {\n  'use strict';\n  if (!(this instanceof geo.jsonReader)) {\n    return new geo.jsonReader(arg);\n  }\n\n  var m_this = this, m_style = arg.style || {};\n\n  geo.fileReader.call(this, arg);\n  \n  this.canRead = function (file) {\n    if (file instanceof File) {\n      return (file.type === 'application/json' || file.name.match(/\\.json$/));\n    } else if (typeof file === 'string') {\n      try {\n        JSON.parse(file);\n      } catch (e) {\n        return false;\n      }\n      return true;\n    }\n    try {\n      if (Array.isArray(m_this._featureArray(file))) {\n        return true;\n      }\n    } catch (e) {}\n    return false;\n  };\n\n  this._readObject = function (file, done, progress) {\n    var object;\n    function onDone(fileString) {\n      if (typeof fileString !== 'string') {\n        done(false);\n      }\n\n      try {\n        object = JSON.parse(fileString);\n      } catch (e) {\n        done(false);\n      }\n\n      done(object);\n    }\n    if (file instanceof File) {\n      m_this._getString(file, onDone, progress);\n    } else if (typeof file === 'string') {\n      onDone(file);\n    } else {\n      done(file);\n    }\n  };\n\n  this._featureArray = function (spec) {\n    if (spec.type === 'FeatureCollection') {\n      return spec.features || [];\n    }\n    if (spec.type === 'GeometryCollection') {\n      throw 'GeometryCollection not yet implemented.';\n    }\n    if (Array.isArray(spec.coordinates)) {\n      return spec;\n    }\n    throw 'Unsupported collection type: ' + spec.type;\n  };\n\n  this._featureType = function (spec) {\n    var geometry = spec.geometry || {};\n    if (geometry.type === 'Point' || geometry.type === 'MultiPoint') {\n      return 'point';\n    }\n    if (geometry.type === 'LineString') {\n      return 'line';\n    }\n    return null;\n  };\n\n  this._getCoordinates = function (spec) {\n    var geometry = spec.geometry || {},\n        coordinates = geometry.coordinates || [];\n\n    if ((coordinates.length === 2 || coordinates.length === 3) &&\n        (isFinite(coordinates[0]) && isFinite(coordinates[1]))) {\n\n      // special handling for single point coordinates\n      return [geo.latlng(coordinates[1], coordinates[0])];\n    }\n\n    // return an array of latlng's for LineString, MultiPoint, etc...\n    return coordinates.map(function (c) {\n      return geo.latlng(c[1], c[0]);\n    });\n  };\n\n  this._getStyle = function (spec) {\n    return spec.properties || {};\n  };\n\n  this.read = function (file, done, progress) {\n\n    function _done(object) {\n      var features, allFeatures = [];\n\n      features = m_this._featureArray(object);\n\n      features.forEach(function (feature) {\n        var type = m_this._featureType(feature),\n            coordinates = m_this._getCoordinates(feature),\n            style = m_this._getStyle(feature);\n        if (type) {\n          allFeatures.push(m_this._addFeature(type, coordinates, style));\n        } else {\n          console.log('unsupported feature type: ' + feature.geometry.type);\n        }\n      });\n\n      if (done) {\n        done(allFeatures);\n      }\n    }\n\n    m_this._readObject(file, _done, progress);\n  };\n\n  this._addFeature = function (type, coordinates, style) {\n    var _style = $.extend({}, m_style, style);\n    return m_this.layer().createFeature(type)\n      .positions(coordinates)\n      .style(_style);\n  };\n  \n};\n\ninherit(geo.jsonReader, geo.fileReader);\n\ngeo.registerFileReader('jsonReader', geo.jsonReader);\n","/////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class map\n *\n * @class Creates a new map inside of the given HTML layer (Typically DIV)\n * @returns {geo.map}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.map = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.map)) {\n    return new geo.map(arg);\n  }\n  arg = arg || {};\n  geo.sceneObject.call(this, arg);\n  arg.layers = arg.layers === undefined ? [] : arg.layers;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Private member variables\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_x = 0,\n      m_y = 0,\n      m_node = $(arg.node),\n      m_width = arg.width || m_node.width(),\n      m_height = arg.height || m_node.height(),\n      m_gcs = arg.gcs === undefined ? \"EPSG:4326\" : arg.gcs,\n      m_uigcs = arg.uigcs === undefined ? \"EPSG:4326\" : arg.uigcs,\n      m_center = arg.center === undefined ? [0.0, 0.0] :\n                 arg.center,\n      m_zoom = arg.zoom === undefined ? 10 : arg.zoom,\n      m_baseLayer = null,\n      toMillis, calculateGlobalAnimationRange, cloneTimestep,\n      m_animationState = {range: null, timestep: null, layers: null},\n      m_intervalMap = {},\n      m_pause,\n      m_stop,\n      m_fileReader = null;\n\n  m_intervalMap.milliseconds = 1;\n  m_intervalMap.seconds = m_intervalMap.milliseconds * 1000;\n  m_intervalMap.minutes = m_intervalMap.seconds * 60;\n  m_intervalMap.hours = m_intervalMap.minutes * 60;\n  m_intervalMap.days = m_intervalMap.hours * 24;\n  m_intervalMap.weeks = m_intervalMap.days * 7;\n  m_intervalMap.months = m_intervalMap.weeks * 4;\n  m_intervalMap.years = m_intervalMap.months * 12;\n\n  this.on(geo.event.animationPause, function () { m_pause = true; });\n  this.on(geo.event.animationStop, function () { m_stop = true; });\n\n  toMillis = function (delta) {\n    var deltaLowercase = delta.toLowerCase();\n    return m_intervalMap[deltaLowercase];\n  };\n\n  calculateGlobalAnimationRange = function (layers) {\n    var delta, deltaUnits, start = null, end = null, layerTimeRange, layerDelta,\n        indexTimestep = false, smallestDeltaInMillis = Number.MAX_VALUE, i;\n\n    for (i = 0; i < layers.length; i += 1) {\n      layerTimeRange = layers[i].timeRange();\n\n      if (!layerTimeRange) {\n        continue;\n      }\n\n      if (layerTimeRange.deltaUnits === \"index\") {\n        indexTimestep = true;\n        layerDelta = layerTimeRange.delta;\n      }\n      else {\n        if (indexTimestep) {\n          throw \"Can't mix index timesteps with time based timesteps\";\n        }\n\n        layerDelta = toMillis(layerTimeRange.deltaUnits) * layerTimeRange.delta;\n      }\n\n      if (layerDelta < smallestDeltaInMillis) {\n        delta = layerTimeRange.delta;\n        deltaUnits = layerTimeRange.deltaUnits;\n        smallestDeltaInMillis = layerDelta;\n      }\n\n      if (start === null || layerTimeRange.start < start) {\n        start = layerTimeRange.start;\n      }\n\n      if (end === null || layerTimeRange.end < end) {\n        end = layerTimeRange.end;\n      }\n    }\n\n    return {\n      \"start\": start,\n      \"end\": end,\n      \"delta\": delta,\n      \"deltaUnits\": deltaUnits\n    };\n  };\n\n  cloneTimestep = function (timestep) {\n\n    if (timestep instanceof Date) {\n      timestep = new Date(timestep.getTime());\n    }\n\n    return timestep;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get map gcs\n   *\n   * @returns {String EPSG format}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.gcs = function (arg) {\n    if (arg === undefined) {\n      return m_gcs;\n    }\n    m_gcs = arg;\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get map user interface GCS\n   *\n   * @returns {String EPSG format}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.uigcs = function () {\n    return m_uigcs;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get root node of the map\n   *\n   * @returns {jquery object}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.node = function () {\n    return m_node;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set zoom level of the map\n   *\n   * @returns {Number|geo.map}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.zoom = function (val) {\n    if (val === undefined) {\n      return m_zoom;\n    }\n\n    if (val !== m_zoom) {\n      m_zoom = val;\n      m_this.modified();\n    }\n\n    // TODO Fix this\n    //      m_this.trigger(geo.event.zoom);\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set center of the map\n   *\n   * @returns {Array|geo.map}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.center = function (val) {\n    if (val === undefined) {\n      return m_center;\n    }\n    m_center = val.slice;\n    // TODO Fix this\n    //      m_this.trigger(geo.event.center);\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Add layer to the map\n   *\n   * @method addLayer\n   * @param {geo.layer} layer to be added to the map\n   * @return {geom.map}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.createLayer = function (layerName, arg) {\n    var newLayer = geo.createLayer(\n      layerName, m_this, arg);\n\n    if (newLayer !== null || newLayer !== undefined) {\n      newLayer._resize(m_x, m_y, m_width, m_height);\n    } else {\n      return null;\n    }\n\n    if (newLayer.referenceLayer() || m_this.children().length === 0) {\n      m_this.baseLayer(newLayer);\n    }\n    m_this.addChild(newLayer);\n    m_this.modified();\n\n    m_this.trigger(geo.event.layerAdd, {\n      type: geo.event.layerAdd,\n      target: m_this,\n      layer: newLayer\n    });\n\n    return newLayer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Remove layer from the map\n   *\n   * @method removeLayer\n   * @param {geo.layer} layer that should be removed from the map\n   * @return {geo.map}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.deleteLayer = function (layer) {\n\n    if (layer !== null && layer !== undefined) {\n      layer._exit();\n\n      m_this.removeChild(layer);\n\n      m_this.modified();\n\n      m_this.trigger(geo.event.layerRemove, {\n        type: geo.event.layerRemove,\n        target: m_this,\n        layer: layer\n      });\n    }\n\n    /// Return deleted layer (similar to createLayer) as in the future\n    /// we may provide extension of this method to support deletion of\n    /// layer using id or some sort.\n    return layer;\n  };\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Toggle visibility of a layer\n   *\n   *  @method toggleLayer\n   *  @param {geo.layer} layer\n   *  @returns {Boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.toggle = function (layer) {\n    if (layer !== null && layer !== undefined) {\n      layer.visible(!layer.visible());\n      m_this.modified();\n\n      m_this.trigger(geo.event.layerToggle, {\n        type: geo.event.layerToggle,\n        target: m_this,\n        layer: layer\n      });\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Resize map\n   *\n   * @param {Number} x x-offset in display space\n   * @param {Number} y y-offset in display space\n   * @param {Number} w width in display space\n   * @param {Number} h height in display space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.resize = function (x, y, w, h) {\n    var i, layers = m_this.children();\n\n    m_x = x;\n    m_y  = y;\n    m_width = w;\n    m_height = h;\n\n    for (i = 0; i < layers.length; i += 1) {\n      layers[i]._resize(x, y, w, h);\n    }\n\n    m_this.trigger(geo.event.resize, {\n      type: geo.event.resize,\n      target: m_this,\n      x: m_x,\n      y: m_y,\n      width: w,\n      height: h\n    });\n\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert from gcs coordinates to display coordinates\n   *\n   * @param input {[geo.latlng], [{x:_x, y: _y}], [x1,y1, x2, y2]}\n   * @return [x:x1, y:y1, ...], [x1, y1, x2, y2]\n   *\n   * @note Currently only lat-lon inputs are supported\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.gcsToDisplay = function (input) {\n    var world, output;\n\n    /// Now handle different data types\n    if ((input instanceof Array &&\n         input.length > 0) || input instanceof Object) {\n      world = m_baseLayer.toLocal(input);\n      output = m_baseLayer.renderer().worldToDisplay(world);\n    } else {\n      /// Everything else\n      throw \"Conversion method latLonToDisplay does not handle \" + input;\n    }\n\n    return output;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert from display to latitude longitude coordinates\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToGcs = function (input) {\n    var output;\n\n    /// Now handle different data types\n    if ((input instanceof Array && input.length > 0) ||\n         input instanceof Object) {\n      output = m_baseLayer.renderer().displayToWorld(input);\n      output = m_baseLayer.fromLocal(output);\n    } else {\n      throw \"Conversion method latLonToDisplay does not handle \" + input;\n    }\n    return output;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Queries each layer for information at this location.\n   *\n   * @param location\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.query = function () {\n    // TODO Implement this\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Sets or gets base layer for this map\n   *\n   * @param {geo.layer} baseLayer optional\n   * @returns {geo.map|geo.layer}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.baseLayer = function (baseLayer) {\n    if (baseLayer !== undefined) {\n\n      // The GCS of the layer must match the map\n      if (m_gcs !== baseLayer.gcs()) {\n        m_this.gcs(baseLayer.gcs());\n      }\n\n      m_baseLayer = baseLayer;\n\n      // Set the layer as the reference layer\n      m_baseLayer.referenceLayer(true);\n\n      return m_this;\n    }\n    return m_baseLayer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Manually force to render map\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.draw = function () {\n    var i, layers = m_this.children();\n\n    m_this.trigger(geo.event.draw, {\n        type: geo.event.draw,\n        target: m_this\n      }\n    );\n\n    m_this._update();\n\n    for (i = 0; i < layers.length; i += 1) {\n      layers[i].draw();\n    }\n\n    m_this.trigger(geo.event.drawEnd, {\n        type: geo.event.drawEnd,\n        target: m_this\n      }\n    );\n\n    return m_this;\n  };\n\n  // TODO: Add documentation headers:\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.animate = function (layers) {\n    var animationRange;\n    layers = layers === undefined ? m_this.children() : layers;\n\n    if (m_animationState.timestep === null) {\n      animationRange = calculateGlobalAnimationRange(layers);\n\n      if (!animationRange.start || !animationRange.end) {\n        throw \"Animation range could not be calculated. \" +\n              \"Check that layers have ranges associated with them\";\n      }\n\n      m_animationState = {\n        range: animationRange,\n        timestep: cloneTimestep(animationRange.start),\n        \"layers\": layers\n      };\n    }\n\n    m_this._animate();\n    return m_this;\n  };\n\n  this.pauseAnimation = function () {\n    m_this.trigger(geo.event.animationPause);\n    return m_this;\n  };\n\n  this.stopAnimation = function () {\n    m_this.trigger(geo.event.animationStop);\n    m_animationState.timestep = null;\n    return m_this;\n  };\n\n  this.stepAnimationForward = function (layers) {\n    var animationRange;\n    layers = layers === undefined ? m_animationState.layers: layers;\n\n    if (layers === null) {\n      layers = m_this.children();\n    }\n\n    if (m_animationState.timestep === null) {\n      animationRange = calculateGlobalAnimationRange(layers);\n\n      m_animationState = {\n        range: animationRange,\n        timestep: cloneTimestep(animationRange.start),\n        \"layers\": layers\n      };\n    }\n\n    m_this._stepAnimationForward();\n    return m_this;\n  };\n\n  this.stepAnimationBackward = function (layers) {\n    var animationRange;\n    layers = layers === undefined ? m_animationState.layers: layers;\n\n    if (layers === null) {\n      layers = m_this.children();\n    }\n\n    if (m_animationState.timestep === null) {\n      animationRange = calculateGlobalAnimationRange(layers);\n\n      m_animationState = {\n        range: animationRange,\n        timestep: cloneTimestep(animationRange.end),\n        \"layers\": layers\n      };\n    }\n\n    m_this._stepAnimationBackward();\n    return m_this;\n  };\n\n  this._animate = function () {\n    var animationRange, nextTimestep, id;\n\n    animationRange = m_animationState.range;\n    nextTimestep = cloneTimestep(animationRange.start);\n    m_stop = false;\n    m_pause = false;\n\n    nextTimestep = geo.time.incrementTime(nextTimestep, animationRange.deltaUnits,\n      animationRange.delta);\n\n    if (nextTimestep > animationRange.end) {\n      throw \"Invalid time range\";\n    }\n\n    function renderTimestep() {\n      if (m_animationState.timestep > animationRange.end || m_stop) {\n        clearInterval(id);\n        m_animationState.timestep = null;\n        m_this.trigger(geo.event.animationComplete);\n      }\n      else if (m_pause) {\n        clearInterval(id);\n      }\n      else {\n        m_this._animateTimestep();\n        m_animationState.timestep = geo.time.incrementTime(m_animationState.timestep,\n            m_animationState.range.deltaUnits, m_animationState.range.delta);\n      }\n\n    }\n\n    id = setInterval(renderTimestep, 10);\n    return m_this;\n  };\n\n  this._animateTimestep = function () {\n\n    if (m_animationState) {\n\n      $.each(m_animationState.layers, function (i, layer) {\n        var timestep = m_animationState.timestep;\n\n        if (timestep instanceof Date) {\n          timestep = timestep.getTime();\n        }\n\n        layer._update({timestep: timestep});\n      });\n\n      m_this.trigger(\n        geo.event.animate, {\n        timestep: m_animationState.timestep\n      });\n      m_this.draw();\n    }\n\n    return m_this;\n  };\n\n  this._stepAnimationForward = function () {\n    var nextTimestep;\n\n    if (m_animationState.timestep === null) {\n      m_animationState.timestep = cloneTimestep(m_animationState.range.start);\n    }\n\n    nextTimestep = cloneTimestep(m_animationState.timestep);\n    nextTimestep = geo.time.incrementTime(nextTimestep, m_animationState.range.deltaUnits,\n        m_animationState.range.delta);\n\n    if (nextTimestep <= m_animationState.range.end) {\n      m_animationState.timestep = nextTimestep;\n      m_this._animateTimestep();\n    }\n\n    return m_this;\n  };\n\n  this._stepAnimationBackward = function () {\n    var previousTimestep;\n\n    if (m_animationState.timestep === null) {\n      m_animationState.timestep = cloneTimestep(m_animationState.range.end);\n    }\n\n    previousTimestep = cloneTimestep(m_animationState.timestep);\n    previousTimestep = geo.time.incrementTime(\n      previousTimestep,\n      m_animationState.range.deltaUnits,\n      -m_animationState.range.delta\n    );\n\n    if (previousTimestep < m_animationState.range.start) {\n      return;\n    }\n\n    m_animationState.timestep = previousTimestep;\n    m_this._animateTimestep();\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Attach a file reader to a layer in the map to be used as a drop target.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.fileReader = function (readerType, opts) {\n    var layer, renderer;\n    opts = opts || {};\n    if (!readerType) {\n      return m_fileReader;\n    }\n    layer = opts.layer;\n    if (!layer) {\n      renderer = opts.renderer;\n      if (!renderer) {\n        renderer = \"d3Renderer\";\n      }\n      layer = m_this.createLayer(\"feature\", {renderer: renderer});\n    }\n    opts.layer = layer;\n    opts.renderer = renderer;\n    m_fileReader = geo.createFileReader(readerType, opts);\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize the map\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    var i;\n\n    if (m_node === undefined || m_node === null) {\n      throw \"Map require DIV node\";\n    }\n\n    if (arg !== undefined && arg.layers !== undefined) {\n      for (i = 0; i < arg.layers.length; i += 1) {\n        if (i === 0) {\n          m_this.baseLayer(arg.layers[i]);\n        }\n\n        m_this.addLayer(arg.layers[i]);\n      }\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update map\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function (request) {\n    var i, layers = m_this.children();\n    for (i = 0; i < layers.length; i += 1) {\n      layers[i]._update(request);\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Exit this map\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    var i, layers = m_this.children();\n    for (i = 0; i < layers.length; i += 1) {\n      layers[i]._exit();\n    }\n  };\n\n  this._init(arg);\n\n  // set up drag/drop handling\n  this.node().on(\"dragover\", function (e) {\n    var evt = e.originalEvent;\n\n    if (m_this.fileReader()) {\n      evt.stopPropagation();\n      evt.preventDefault();\n      evt.dataTransfer.dropEffect = \"copy\";\n    }\n  })\n  .on(\"drop\", function (e) {\n    var evt = e.originalEvent, reader = m_this.fileReader(),\n        i, file;\n\n    function done() {\n      m_this.draw();\n    }\n\n    if (reader) {\n      evt.stopPropagation();\n      evt.preventDefault();\n\n      for (i = 0; i < evt.dataTransfer.files.length; i += 1) {\n        file = evt.dataTransfer.files[i];\n        if (reader.canRead(file)) {\n          reader.read(file, done); // to do: trigger event on done\n        }\n      }\n    }\n  });\n\n  return this;\n};\n\ninherit(geo.map, geo.sceneObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class feature\n *\n * @class\n * @returns {geo.feature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.feature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.feature)) {\n    return new geo.feature(arg);\n  }\n  geo.sceneObject.call(this);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  arg = arg || {};\n\n  var m_this = this,\n      m_style = {},\n      m_layer = arg.layer === undefined ? null : arg.layer,\n      m_gcs = arg.gcs === undefined ? \"EPSG:4326\" : arg.gcs,\n      m_visible = arg.visible === undefined ? true : arg.visible,\n      m_bin = arg.bin === undefined ? 0 : arg.bin,\n      m_renderer = arg.renderer === undefined ? null : arg.renderer,\n      m_data = [],\n      m_dataTime = geo.timestamp(),\n      m_buildTime = geo.timestamp(),\n      m_updateTime = geo.timestamp();\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set style used by the feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.style = function (arg1, arg2) {\n    if (arg1 === undefined) {\n      return m_style;\n    }  else if (arg2 === undefined) {\n      m_style = $.extend({}, m_style, arg1);\n      m_this.modified();\n      return m_this;\n    } else {\n      m_style[arg1] = arg2;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get layer referenced by the feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.layer = function () {\n    return m_layer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get renderer used by the feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.renderer = function () {\n    return m_renderer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get list of drawables or nodes that are context/api specific.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.drawables = function () {\n    return m_this._drawables();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set projection of the feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.gcs = function (val) {\n    if (val === undefined) {\n      return m_gcs;\n    } else {\n      m_gcs = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set visibility of the feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.visible = function (val) {\n    if (val === undefined) {\n      return m_visible;\n    } else {\n      m_visible = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set bin of the feature\n   *\n   * Bin number is typically used for sorting the order of rendering\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.bin = function (val) {\n    if (val === undefined) {\n      return m_bin;\n    } else {\n      m_bin = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set timestamp of data change\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.dataTime = function (val) {\n    if (val === undefined) {\n      return m_dataTime;\n    } else {\n      m_dataTime = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set timestamp of last time build happened\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.buildTime = function (val) {\n    if (val === undefined) {\n      return m_buildTime;\n    } else {\n      m_buildTime = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set timestamp of last time update happened\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.updateTime = function (val) {\n    if (val === undefined) {\n      return m_updateTime;\n    } else {\n      m_updateTime = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set data\n   *\n   * @returns {Array}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.data = function (data) {\n    if (data === undefined) {\n      return m_data;\n    } else {\n      m_data = data;\n      m_this.dataTime().modified();\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   *\n   * Derived class should implement this\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    if (!m_layer) {\n      throw \"Feature requires a valid layer\";\n    }\n    m_style = $.extend({},\n                {\"opacity\": 1.0}, arg.style === undefined ? {} :\n                arg.style);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   *\n   * Derived class should implement this\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get context specific drawables\n   *\n   * Derived class should implement this\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._drawables = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * Derived class should implement this\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Destroy\n   *\n   * Derived class should implement this\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.feature, geo.sceneObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class pointFeature\n *\n * @class\n * @returns {geo.pointFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.pointFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.pointFeature)) {\n    return new geo.pointFeature(arg);\n  }\n  arg = arg || {};\n  geo.feature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_position = arg.position === undefined ? function (d) { return d; } : arg.position,\n      s_init = this._init;\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set position\n   *\n   * @returns {geo.pointFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.position = function (val) {\n    if (val === undefined) {\n      return m_position;\n    } else {\n      m_position = val;\n      m_this.dataTime().modified();\n      m_this.modified();\n    }\n    return m_this;\n  };\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n\n    var defaultStyle = $.extend(\n      {},\n      {\n        radius: function () { return 10.0; },\n        stroke: function () { return true; },\n        strokeColor: function () { return { r: 0.0, g: 1.0, b: 0.0 }; },\n        strokeWidth: function () { return 2.0; },\n        strokeOpacity: function () { return 1.0; },\n        fillColor: function () { return { r: 1.0, g: 0.0, b: 0.0 }; },\n        fill: function () { return true; },\n        fillOpacity: function () { return 1.0; },\n        sprites: false,\n        sprites_image: null\n      },\n      arg.style === undefined ? {} : arg.style\n    );\n\n    m_this.style(defaultStyle);\n\n    if (m_position) {\n      m_this.dataTime().modified();\n    }\n  };\n\n  return m_this;\n};\n\ninherit(geo.pointFeature, geo.feature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class lineFeature\n *\n * @class\n * @returns {geo.lineFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.lineFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.lineFeature)) {\n    return new geo.lineFeature(arg);\n  }\n  arg = arg || {};\n  geo.feature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_position = arg.position === undefined ? [] : arg.position,\n      s_init = this._init;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set position\n   *\n   * @returns {geo.pointFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.position = function (val) {\n    if (val === undefined) {\n      return m_position;\n    } else {\n      m_position = val;\n      m_this.dataTime().modified();\n      m_this.modified();\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n\n    var defaultStyle = $.extend(\n      {},\n      {\n        \"strokeWidth\": function () { return 1.0; },\n        \"strokeColor\": function () { return {r: 1.0, g: 1.0, b: 1.0}; },\n        \"strokeStyle\": function () { return \"solid\"; },\n        \"strokeOpacity\": function () { return 1.0; }\n      },\n      arg.style === undefined ? {} : arg.style\n    );\n\n    m_this.style(defaultStyle);\n\n    if (m_position) {\n      m_this.dataTime().modified();\n    }\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.lineFeature, geo.feature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class pathFeature\n *\n * @class\n * @returns {geo.pathFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.pathFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.pathFeature)) {\n    return new geo.pathFeature(arg);\n  }\n  arg = arg || {};\n  geo.feature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_position = arg.position === undefined ? [] : arg.position,\n      s_init = this._init;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set positions\n   *\n   * @returns {geo.pathFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.position = function (val) {\n    if (val === undefined) {\n      return m_position;\n    }\n    // Copy incoming array of positions\n    m_position = val;\n    m_this.dataTime().modified();\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n\n    var defaultStyle = $.extend(\n      {},\n      {\n        \"strokeWidth\": function () { return 1; },\n        \"strokeColor\": function () { return { r: 1.0, g: 1.0, b: 1.0 }; },\n      },\n      arg.style === undefined ? {} : arg.style\n    );\n\n    m_this.style(defaultStyle);\n\n    if (m_position) {\n      m_this.dataTime().modified();\n    }\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.pathFeature, geo.feature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class polygonFeature\n *\n * @class\n * @returns {geo.polygonFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.polygonFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.polygonFeature)) {\n    return new geo.polygonFeature(arg);\n  }\n  arg = arg || {};\n  geo.feature.call(this, arg);\n\n  var m_this = this,\n      s_init = this._init;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n    var defaultStyle = $.extend(\n      {},\n      {\n        \"color\": [1.0, 1.0, 1.0],\n        \"fill_color\": [1.0, 1.0, 1.0],\n        \"fill\": true\n      },\n      arg.style === undefined ? {} : arg.style\n    );\n\n    m_this.style(defaultStyle);\n  };\n\n  m_this._init(arg);\n  return m_this;\n};\n\ninherit(geo.polygonFeature, geo.feature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class planeFeature\n *\n * @class\n * @returns {geo.planeFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.planeFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.planeFeature)) {\n    return new geo.planeFeature(arg);\n  }\n  arg = arg || {};\n\n  // Defaults\n  arg.ul = arg.ul === undefined ? [0.0, 1.0, 0.0] : arg.ul;\n  arg.lr = arg.lr === undefined ? [1.0, 0.0, 0.0] : arg.lr;\n  arg.depth = arg.depth === undefined ? 0.0 : arg.depth;\n\n  geo.polygonFeature.call(this, arg);\n\n  var m_this = this,\n      m_origin = [arg.ul.x, arg.lr.y, arg.depth],\n      m_upperLeft = [arg.ul.x, arg.ul.y, arg.depth],\n      m_lowerRight = [arg.lr.x, arg.lr.y, arg.depth],\n      m_defaultDepth = arg.depth,\n      m_drawOnAsyncResourceLoad = arg.drawOnAsyncResourceLoad === undefined ?\n                                    true : false,\n      s_init = this._init;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set origin\n   *\n   * @returns {geo.planeFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.origin = function (val) {\n    if (val === undefined) {\n      return m_origin;\n    } else if (val instanceof Array) {\n      if (val.length > 3 || val.length < 2) {\n        throw \"Upper left point requires point in 2 or 3 dimension\";\n      }\n      m_origin = val.slice(0);\n      if (m_origin.length === 2) {\n        m_origin[2] = m_defaultDepth;\n      }\n    } else if (val instanceof geo.latlng) {\n      m_origin = [val.x(), val.y(), m_defaultDepth];\n    }\n    m_this.dataTime().modified();\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set pt1\n   *\n   * @returns {geo.planeFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.upperLeft = function (val) {\n    if (val === undefined) {\n      return m_upperLeft;\n    } else if (val instanceof Array) {\n      if (val.length > 3 || val.length < 2) {\n        throw \"Upper left point requires point in 2 or 3 dimension\";\n      }\n      m_upperLeft = val.slice(0);\n      if (m_upperLeft.length === 2) {\n        m_upperLeft[2] = m_defaultDepth;\n      }\n    } else if (val instanceof geo.latlng) {\n      m_upperLeft = [val.x(), val.y(), m_defaultDepth];\n    }\n    m_this.dataTime().modified();\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set origin\n   *\n   * @returns {geo.planeFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.lowerRight = function (val) {\n    if (val === undefined) {\n      return m_lowerRight;\n    } else if (val instanceof Array) {\n      if (val.length > 3 || val.length < 2) {\n        throw \"Upper left point requires point in 2 or 3 dimension\";\n      }\n      m_lowerRight = val.slice(0);\n      if (m_lowerRight.length === 2) {\n        m_lowerRight[2] = m_defaultDepth;\n      }\n      m_this.dataTime().modified();\n    } else if (val instanceof geo.latlng) {\n      m_lowerRight = [val.x(), val.y(), m_defaultDepth];\n    }\n    m_this.dataTime().modified();\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set if draw should happen as soon as a async resource is loaded\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.drawOnAsyncResourceLoad = function (val) {\n    if (val === undefined) {\n      return m_drawOnAsyncResourceLoad;\n    } else {\n      m_drawOnAsyncResourceLoad = val;\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    var style = null;\n    s_init.call(m_this, arg);\n    style = m_this.style();\n    if (style.image === undefined) {\n      style.image = null;\n    }\n    m_this.style(style);\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.planeFeature, geo.polygonFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class geomFeature\n *\n * @class\n * @returns {geo.geomFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.geomFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof geo.geomFeature)) {\n    return new geo.geomFeature(arg);\n  }\n  arg = arg || {};\n  geo.feature.call(this, arg);\n\n  arg.style = arg.style === undefined ? $.extend({}, {\n    \"color\": [1.0, 1.0, 1.0],\n    \"point_sprites\": false,\n    \"point_sprites_image\": null\n  }, arg.style) : arg.style;\n\n  // Update style\n  this.style(arg.style);\n\n  return this;\n};\n\ninherit(geo.geomFeature, geo.feature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class graphFeature\n *\n * @class\n * @returns {geo.graphFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.graphFeature = function (arg) {\n  \"use strict\";\n\n  if (!(this instanceof geo.graphFeature)) {\n    return new geo.graphFeature(arg);\n  }\n  arg = arg || {};\n  geo.feature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_draw = this.draw,\n      s_style = this.style,\n      m_nodes = null,\n      m_points = null,\n      m_children = function (d) { return d.children; },\n      m_links = [],\n      s_init = this._init,\n      s_exit = this._exit;\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n\n    var defaultStyle = $.extend(true, {},\n      {\n        nodes: {\n          radius: function () { return 5.0; },\n          fill: function () { return true; },\n          fillColor: function () { return { r: 1.0, g: 0.0, b: 0.0 }; },\n          strokeColor: function () { return { r: 0, g: 0, b: 0 }; }\n        },\n        links: {\n          strokeColor: function () { return { r: 0.0, g: 0.0, b: 0.0 }; }\n        },\n        linkType: \"path\" /* 'path' || 'line' */\n      },\n      arg.style === undefined ? {} : arg.style\n    );\n\n    m_this.style(defaultStyle);\n    m_this.nodes(function (d) { return d; });\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Call child _build methods\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    m_this.children().forEach(function (child) {\n      child._build();\n    });\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Call child _update methods\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    m_this.children().forEach(function (child) {\n      child._update();\n    });\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Custom _exit method to remove all sub-features\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.nodes([]);\n    m_points._exit();\n    m_this.removeChild(m_points);\n    s_exit();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set style\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.style = function (arg) {\n    var out = s_style.call(m_this, arg);\n    if (out !== m_this) {\n      return out;\n    }\n    // set styles for sub-features\n    m_points.style(arg.nodes);\n    m_links.forEach(function (l) {\n      l.style(arg.links);\n    });\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set links accessor.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.links = function (arg) {\n    if (arg === undefined) {\n      return m_children;\n    }\n\n    m_children = geo.util.ensureFunction(arg);\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set nodes\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.nodes = function (val) {\n    if (val === undefined) {\n      return m_nodes;\n    }\n    m_nodes = val;\n    m_this.modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get internal node feature\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.nodeFeature = function () {\n    return m_points;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get internal link features\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.linkFeatures = function () {\n    return m_links;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build the feature for drawing\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.draw = function () {\n\n    var layer = m_this.layer(),\n        data = m_this.data(),\n        nLinks = 0,\n        style;\n\n    // get the feature style object\n    style = m_this.style();\n\n    // Bind data to the point nodes\n    m_points.data(data);\n    m_points.style(style.nodes);\n\n    // get links from node connections\n    data.forEach(function (source) {\n      (source.children || []).forEach(function (target) {\n        var link;\n        nLinks += 1;\n        if (m_links.length < nLinks) {\n          link = geo.createFeature(\n            style.linkType, layer, layer.renderer()\n          ).style(style.links);\n          m_this.addChild(link);\n          m_links.push(link);\n        }\n        m_links[nLinks - 1].data([source, target]);\n      });\n    });\n\n    m_links.splice(nLinks, m_links.length - nLinks).forEach(function (l) {\n      l._exit();\n      m_this.removeChild(l);\n    });\n\n    s_draw();\n    return m_this;\n  };\n\n  m_points = geo.createFeature(\n    \"point\",\n    this.layer(),\n    this.layer().renderer()\n  );\n  m_this.addChild(m_points);\n\n  if (arg.nodes) {\n    this.nodes(arg.nodes);\n  }\n\n  this._init(arg);\n  return this;\n};\n\ninherit(geo.graphFeature, geo.feature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Transform geometric data of a feature from source projection to destination\n * projection.\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.transform = {};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Custom transform for a feature used for OpenStreetMap\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.transform.osmTransformFeature = function (destGcs, feature, inplace) {\n  /// TODO\n  /// Currently we make assumption that incoming feature is in 4326\n  /// which may not be true.\n\n  \"use strict\";\n\n  if (!feature) {\n    console.log(\"[warning] Invalid (null) feature\");\n    return;\n  }\n\n  if (feature.gcs() === destGcs) {\n    return;\n  }\n\n  if (!(feature instanceof geo.pointFeature ||\n        feature instanceof geo.lineFeature)) {\n    throw \"Supports only point or line feature\";\n  }\n\n  var noOfComponents = null,\n      pointOffset = 0,\n      count = null,\n      inPos = null,\n      outPos = null,\n      srcGcs = feature.gcs(),\n      i,\n      yCoord;\n\n  inplace = !!inplace;\n  if (feature instanceof geo.pointFeature ||\n      feature instanceof geo.lineFeature) {\n\n    ///  If source GCS is not in 4326, transform it first into 4326\n    /// before we transform it for OSM.\n    if (srcGcs !== \"EPSG:4326\") {\n      geo.transform.transformFeature(\"EPSG:4326\", feature, true);\n    }\n\n    inPos = feature.positions();\n    count = inPos.length;\n\n    if (!(inPos instanceof Array)) {\n      throw \"Supports Array of 2D and 3D points\";\n    }\n\n    if (inPos.length > 0 && inPos[0] instanceof geo.latlng) {\n      noOfComponents = 2;\n      pointOffset = 1;\n    } else {\n      noOfComponents = (count % 2 === 0 ? 2 :\n                       (count % 3 === 0 ? 3 : null));\n      pointOffset = noOfComponents;\n    }\n\n    if (noOfComponents !== 2 && noOfComponents !== 3) {\n      throw \"Transform points require points in 2D or 3D\";\n    }\n\n    if (inplace) {\n      outPos = inPos;\n    } else {\n      outPos = inPos.slice(0);\n    }\n\n    for (i = 0; i < count; i += pointOffset) {\n\n      /// Y goes from 0 (top edge is 85.0511 N) to 2zoom  1\n      /// (bottom edge is 85.0511 S) in a Mercator projection.\n      if (inPos[i] instanceof geo.latlng) {\n        yCoord = inPos[i].lat();\n      } else {\n        yCoord = inPos[i + 1];\n      }\n\n      if (yCoord > 85.0511) {\n        yCoord = 85.0511;\n      }\n      if (yCoord < -85.0511) {\n        yCoord = -85.0511;\n      }\n      if (inPos[i] instanceof geo.latlng) {\n        outPos[i] = geo.latlng(geo.mercator.lat2y(yCoord), outPos[i].lng());\n      } else {\n        outPos[i + 1] = geo.mercator.lat2y(yCoord);\n      }\n    }\n\n    if (inplace) {\n      feature.positions(outPos);\n      feature.gcs(destGcs);\n    }\n    return outPos;\n  }\n\n  return null;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Transform a feature to destination GCS\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.transform.transformFeature = function (destGcs, feature, inplace) {\n  \"use strict\";\n\n  if (!feature) {\n    throw \"Invalid (null) feature\";\n  }\n\n  if (!(feature instanceof geo.pointFeature ||\n        feature instanceof geo.lineFeature)) {\n    throw \"Supports only point or line feature\";\n  }\n\n  if (feature.gcs() === destGcs) {\n    return feature.positions();\n  }\n\n  if (destGcs === \"EPSG:3857\") {\n    return geo.transform.osmTransformFeature(destGcs, feature, inplace);\n  }\n\n  var noOfComponents = null,\n      pointOffset = 0,\n      count = null,\n      inPos = null,\n      outPos = null,\n      projPoint = null,\n      srcGcs = feature.gcs(),\n      i,\n      projSrcGcs = new proj4.Proj(srcGcs),\n      projDestGcs = new proj4.Proj(destGcs);\n\n  inplace = !!inplace;\n  if (feature instanceof geo.pointFeature ||\n      feature instanceof geo.lineFeature) {\n    inPos = feature.positions();\n    count = inPos.length;\n\n    if (!(inPos instanceof Array)) {\n      throw \"Supports Array of 2D and 3D points\";\n    }\n\n    if (inPos.length > 0 && inPos[0] instanceof geo.latlng) {\n      noOfComponents = 2;\n      pointOffset = 1;\n    } else {\n      noOfComponents = (count % 2 === 0 ? 2 :\n                       (count % 3 === 0 ? 3 : null));\n      pointOffset = noOfComponents;\n    }\n\n    if (noOfComponents !== 2 && noOfComponents !== 3) {\n      throw \"Transform points require points in 2D or 3D\";\n    }\n\n    if (inplace) {\n      outPos = inPos;\n    } else {\n      outPos = [];\n      outPos.length = inPos.length;\n    }\n\n    for (i = 0; i < count; i += pointOffset) {\n      if (noOfComponents === 2) {\n        projPoint = new proj4.Point(inPos[i], inPos[i + 1], 0.0);\n      } else {\n        projPoint = new proj4.Point(inPos[i], inPos[i + 1], inPos[i + 2]);\n      }\n\n      proj4.transform(projSrcGcs, projDestGcs, projPoint);\n\n      if (noOfComponents === 2) {\n        outPos[i] =  projPoint.x;\n        outPos[i + 1] = projPoint.y;\n      } else {\n        outPos[i] = projPoint.x;\n        outPos[i + 1] = projPoint.y;\n        outPos[i + 2] = projPoint.z;\n      }\n    }\n\n    if (inplace) {\n      feature.positions(outPos);\n      feature.gcs(destGcs);\n    }\n\n    return outPos;\n  }\n\n  return null;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Transform geometric data of a layer from source projection to destination\n * projection.\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.transform.transformLayer = function (destGcs, layer, baseLayer) {\n  \"use strict\";\n\n  var features, count, i;\n\n  if (!layer) {\n    throw \"Requires valid layer for tranformation\";\n  }\n\n  if (!baseLayer) {\n    throw \"Requires baseLayer used by the map\";\n  }\n\n  if (layer === baseLayer) {\n    return;\n  }\n\n  if (layer instanceof geo.featureLayer) {\n    features = layer.features();\n    count = features.length;\n    i = 0;\n\n    for (i = 0; i < count; i += 1) {\n      if (destGcs === \"EPSG:3857\" && baseLayer instanceof geo.osmLayer) {\n        geo.transform.osmTransformFeature(\n          destGcs, features[i], true);\n      } else {\n        geo.transform.transformFeature(\n          destGcs, features[i], true);\n      }\n    }\n\n    layer.gcs(destGcs);\n  } else {\n    throw \"Only feature layer transformation is supported\";\n  }\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Transform position coordinates from source projection to destination\n * projection.\n *\n * @param srcGcs GCS of the coordinates\n * @param destGcs Desired GCS of the transformed coordinates\n * @param coordinates\n * @return {Array | geo.latlng} Transformed coordinates\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.transform.transformCoordinates = function (srcGcs, destGcs, coordinates,\n                                               numberOfComponents) {\n  \"use strict\";\n\n  var i, count, offset, xCoord, yCoord, zCoord, xAcc,\n      yAcc, zAcc, writer, output, projPoint,\n      projSrcGcs = new proj4.Proj(srcGcs),\n      projDestGcs = new proj4.Proj(destGcs);\n\n  /// Default Z accessor\n  zAcc = function () {\n    return 0.0;\n  };\n\n  if (destGcs === srcGcs) {\n    return coordinates;\n  }\n\n  /// TODO: Can we check for EPSG code?\n  if (!destGcs || !srcGcs) {\n    throw \"Invalid source or destination GCS\";\n  }\n\n  /// Helper methods\n  function handleLatLngCoordinates() {\n    if (coordinates[0] && coordinates[0] instanceof geo.latlng) {\n      xAcc = function (index) {\n        return coordinates[index].x();\n      };\n      yAcc = function (index) {\n        return coordinates[index].y();\n      };\n      writer = function (index, x, y) {\n        output[index] = geo.latlng(y, x);\n      };\n    } else {\n      xAcc = function () {\n        return coordinates.x();\n      };\n      yAcc = function () {\n        return coordinates.y();\n      };\n      writer = function (index, x, y) {\n        output = geo.latlng(y, x);\n      };\n    }\n  }\n\n  /// Helper methods\n  function handleArrayCoordinates() {\n    if (coordinates[0] instanceof Array) {\n      if (coordinates[0].length === 2) {\n        xAcc = function (index) {\n          return coordinates[index][0];\n        };\n        yAcc = function (index) {\n          return coordinates[index][1];\n        };\n        writer = function (index, x, y) {\n          output[index] = [x, y];\n        };\n      } else if (coordinates[0].length === 3) {\n        xAcc = function (index) {\n          return coordinates[index][0];\n        };\n        yAcc = function (index) {\n          return coordinates[index][1];\n        };\n        zAcc = function (index) {\n          return coordinates[index][2];\n        };\n        writer = function (index, x, y, z) {\n          output[index] = [x, y, z];\n        };\n      } else {\n        throw \"Invalid coordinates. Requires two or three components per array\";\n      }\n    } else {\n      if (coordinates.length === 2) {\n        offset = 2;\n\n        xAcc = function (index) {\n          return coordinates[index * offset];\n        };\n        yAcc = function (index) {\n          return coordinates[index * offset + 1];\n        };\n        writer = function (index, x, y) {\n          output[index] = x;\n          output[index + 1] = y;\n        };\n      } else if (coordinates.length === 3) {\n        offset = 3;\n\n        xAcc = function (index) {\n          return coordinates[index * offset];\n        };\n        yAcc = function (index) {\n          return coordinates[index * offset + 1];\n        };\n        zAcc = function (index) {\n          return coordinates[index * offset + 2];\n        };\n        writer = function (index, x, y, z) {\n          output[index] = x;\n          output[index + 1] = y;\n          output[index + 2] = z;\n        };\n      } else if (numberOfComponents) {\n        if (numberOfComponents === 2 || numberOfComponents || 3) {\n          offset = numberOfComponents;\n\n          xAcc = function (index) {\n            return coordinates[index];\n          };\n          yAcc = function (index) {\n            return coordinates[index + 1];\n          };\n          if (numberOfComponents === 2) {\n            writer = function (index, x, y) {\n              output[index] = x;\n              output[index + 1] = y;\n            };\n          } else {\n            zAcc = function (index) {\n              return coordinates[index + 2];\n            };\n            writer = function (index, x, y, z) {\n              output[index] = x;\n              output[index + 1] = y;\n              output[index + 2] = z;\n            };\n          }\n        } else {\n          throw \"Number of components should be two or three\";\n        }\n      } else {\n        throw \"Invalid coordinates\";\n      }\n    }\n  }\n\n  /// Helper methods\n  function handleObjectCoordinates() {\n    if (coordinates[0] &&\n        \"x\" in coordinates[0] &&\n        \"y\" in coordinates[0]) {\n      xAcc = function (index) {\n        return coordinates[index].x;\n      };\n      yAcc = function (index) {\n        return coordinates[index].y;\n      };\n\n      if (\"z\" in coordinates[0]) {\n        zAcc = function (index) {\n          return coordinates[index].z;\n        };\n        writer = function (index, x, y, z) {\n          output[i] = {x: x, y: y, z: z};\n        };\n      } else {\n        writer = function (index, x, y) {\n          output[index] = {x: x, y: y};\n        };\n      }\n    } else if (coordinates &&\n        \"x\" in coordinates && \"y\" in coordinates) {\n      xAcc = function () {\n        return coordinates.x;\n      };\n      yAcc = function () {\n        return coordinates.y;\n      };\n\n      if (\"z\" in coordinates) {\n        zAcc = function () {\n          return coordinates.z;\n        };\n        writer = function (index, x, y, z) {\n          output = {x: x, y: y, z: z};\n        };\n      } else {\n        writer = function (index, x, y) {\n          output = {x: x, y: y};\n        };\n      }\n    } else {\n      throw \"Invalid coordinates\";\n    }\n  }\n\n  if (coordinates instanceof Array) {\n    output = [];\n    output.length = coordinates.length;\n    count = coordinates.length;\n\n    if (coordinates[0] instanceof Array ||\n        coordinates[0] instanceof geo.latlng ||\n        coordinates[0] instanceof Object) {\n      offset = 1;\n\n      if (coordinates[0] instanceof Array) {\n        handleArrayCoordinates();\n      } else if (coordinates[0] instanceof geo.latlng) {\n        handleLatLngCoordinates();\n      } else if (coordinates[0] instanceof Object) {\n        handleObjectCoordinates();\n      }\n    } else {\n      handleArrayCoordinates();\n    }\n  } else if (coordinates && coordinates instanceof Object) {\n    count = 1;\n    offset = 1;\n    if (coordinates instanceof geo.latlng) {\n      handleLatLngCoordinates();\n    } else if (coordinates && \"x\" in coordinates && \"y\" in coordinates) {\n      handleObjectCoordinates();\n    } else {\n      throw \"Coordinates are not valid\";\n    }\n  }\n\n  if (destGcs === \"EPSG:3857\" && srcGcs === \"EPSG:4326\") {\n    for (i = 0; i < count; i += offset) {\n      /// Y goes from 0 (top edge is 85.0511 N) to 2zoom  1\n      /// (bottom edge is 85.0511 S) in a Mercator projection.\n      xCoord = xAcc(i);\n      yCoord = yAcc(i);\n      zCoord = zAcc(i);\n\n      if (yCoord > 85.0511) {\n        yCoord = 85.0511;\n      }\n      if (yCoord < -85.0511) {\n        yCoord = -85.0511;\n      }\n\n      writer(i, xCoord, geo.mercator.lat2y(yCoord), zCoord);\n    }\n\n    return output;\n  } else {\n    for (i = 0; i < count; i += offset) {\n      projPoint = new proj4.Point(xAcc(i), yAcc(i), zAcc(i));\n      proj4.transform(projSrcGcs, projDestGcs, projPoint);\n      writer(i, projPoint.x, projPoint.y, projPoint.z);\n      return output;\n    }\n  }\n};\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class renderer\n *\n * @param canvas\n * @returns {geo.renderer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.renderer = function (arg) {\n  \"use strict\";\n\n  if (!(this instanceof geo.renderer)) {\n    return new geo.renderer(arg);\n  }\n  geo.sceneObject.call(this);\n\n  arg = arg || {};\n  var m_this = this,\n      m_layer = arg.layer === undefined ? null : arg.layer,\n      m_canvas = arg.canvas === undefined ? null : arg.canvas,\n      m_initialized = false;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get layer of the renderer\n   *\n   * @returns {*}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.layer = function () {\n    return m_layer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get canvas for the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.canvas = function (val) {\n    if (val === undefined) {\n      return m_canvas;\n    } else {\n      m_canvas = val;\n      m_this.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get map that this renderer belongs to\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.map = function () {\n    if (m_layer) {\n      return m_layer.map();\n    } else {\n      return null;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get base layer that belongs to this renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.baseLayer = function () {\n    if (m_this.map()) {\n      return m_this.map().baseLayer();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set if renderer has been initialized\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.initialized = function (val) {\n    if (val === undefined) {\n      return m_initialized;\n    } else {\n      m_initialized = val;\n      return m_this;\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get render API used by the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.api = function () {\n    throw \"Should be implemented by derivied classes\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Reset to default\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.reset = function () {\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert array of points from world to GCS coordinate space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.worldToGcs = function () {\n    throw \"Should be implemented by derivied classes\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert array of points from display to GCS space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToGcs = function () {\n    throw \"Should be implemented by derivied classes\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert array of points from display to GCS space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.gcsToDisplay = function () {\n    throw \"Should be implemented by derivied classes\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert array of points from world to display space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.worldToDisplay = function () {\n    throw \"Should be implemented by derivied classes\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert array of points from display to world space\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToWorld = function () {\n    throw \"Should be implemented by derivied classes\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get mouse coodinates related to canvas\n   *\n   * @param event\n   * @returns {{x: number, y: number}}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.relMouseCoords = function (event) {\n    var totalOffsetX = 0,\n        totalOffsetY = 0,\n        canvasX = 0,\n        canvasY = 0,\n        currentElement = m_this.canvas();\n\n    do {\n      totalOffsetX += currentElement.offsetLeft - currentElement.scrollLeft;\n      totalOffsetY += currentElement.offsetTop - currentElement.scrollTop;\n      currentElement = currentElement.offsetParent;\n    } while (currentElement);\n\n    canvasX = event.pageX - totalOffsetX;\n    canvasY = event.pageY - totalOffsetY;\n\n    return {\n      x: canvasX,\n      y: canvasY\n    };\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle resize event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._resize = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._render = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Exit\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Connect mouse events to the map layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._connectMouseEvents = function () {\n\n  };\n\n  return this;\n};\n\ninherit(geo.renderer, geo.sceneObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of osmLayer\n */\n//////////////////////////////////////////////////////////////////////////////\ngeo.osmLayer = function (arg) {\n  \"use strict\";\n\n  if (!(this instanceof geo.osmLayer)) {\n    return new geo.osmLayer(arg);\n  }\n  geo.featureLayer.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Private member variables\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n    m_tiles = {},\n    m_hiddenBinNumber = 0,\n    m_lastVisibleBinNumber = 999,\n    m_visibleBinNumber = 1000,\n    m_pendingNewTiles = [],\n    m_pendingInactiveTiles = [],\n    m_numberOfCachedTiles = 0,\n    m_tileCacheSize = 100,\n    m_baseUrl = \"http://tile.openstreetmap.org/\",\n    m_imageFormat = \"png\",\n    m_updateTimerId = null,\n    m_lastVisibleZoom = null,\n    m_visibleTilesRange = {},\n    s_init = this._init,\n    m_pendingNewTilesStat = {},\n    s_update = this._update,\n    m_updateDefer = null;\n\n  if (arg && arg.baseUrl !== undefined) {\n    m_baseUrl = arg.baseUrl;\n  }\n\n  if (arg && arg.imageFormat !== undefined) {\n    m_imageFormat = arg.imageFormat;\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return zoom to be used for fetching the tiles\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function getModifiedMapZoom() {\n    if (m_this.map().zoom() < 18) {\n      return (m_this.map().zoom() + 1);\n    } else {\n      return m_this.map().zoom();\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if a tile is visible in current view\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function isTileVisible(tile) {\n    if (tile.zoom in m_visibleTilesRange) {\n      if (tile.index_x >= m_visibleTilesRange[tile.zoom].startX &&\n          tile.index_x <= m_visibleTilesRange[tile.zoom].endX &&\n          tile.index_y >= m_visibleTilesRange[tile.zoom].startY &&\n          tile.index_y <= m_visibleTilesRange[tile.zoom].endY) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Draw new tiles and remove the old ones\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function drawTiles() {\n    m_this._removeTiles();\n    m_this.draw();\n    delete m_pendingNewTilesStat[m_updateTimerId];\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set tile cache size\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.tileCacheSize = function (val) {\n    if (val === undefined) {\n      return m_tileCacheSize;\n    }\n    m_tileCacheSize = val;\n    m_this.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point or array of points in latitude-longitude-altitude\n   * space to local space of the layer\n   *\n   * @param input Input can be of following types:\n   * geo.latlng, [geo.latlng], [x1,y1, x2, y2], [[x,y]], {x:val: y:val, z:val},\n   * [{x:val: y:val}]\n   *\n   * @returns geo.latlng, [geo.latlng], or {x:lon, y:lat}, [{x:lon, y:lat}]\n   * [x1,y1, x2, y2], [[x,y]]\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.toLocal = function (input) {\n    var i, output, delta;\n\n    /// Now handle different data types\n    if (input instanceof Array && input.length > 0) {\n      output = [];\n      output.length = input.length;\n\n      /// Input is array of geo.latlng\n      if (input[0] instanceof geo.latlng) {\n        for (i = 0; i < input.length; i += 1) {\n          output[i] = geo.latlng(input[i]);\n          output[i].lat(geo.mercator.lat2y(output[i].lat()));\n        }\n      } else if (input[0] instanceof Array) {\n        delta = input % 3 === 0 ? 3 : 2;\n\n        if (delta === 2) {\n          for (i = 0; i < input.length; i += delta) {\n            output[i] = input[i];\n            output[i + 1] = geo.mercator.lat2y(input[i + 1]);\n          }\n        } else {\n          for (i = 0; i < input.length; i += delta) {\n            output[i] = input[i];\n            output[i + 1] = geo.mercator.lat2y(input[i + 1]);\n            output[i + 2] = input[i + 2];\n          }\n        }\n      } else if (input[0] instanceof Object &&\n                 \"x\" in input[0] && \"y\" in input[0] && \"z\" in input[0]) {\n        /// Input is array of object\n        output[i] = { x: input[i].x, y: geo.mercator.lat2y(input[i].y),\n                      z: input[i].z };\n      } else if (input[0] instanceof Object &&\n                 \"x\" in input[0] && \"y\" in input[0] && \"z\" in input[0]) {\n        /// Input is array of object\n        output[i] = { x: input[i].x, y: geo.mercator.lat2y(input[i].y)};\n      } else if (input.length >= 2) {\n        output = input.slice(0);\n        output[1] = geo.mercator.lat2y(input[1]);\n      }\n    } else if (input instanceof geo.latlng) {\n      output = {};\n      output.x = input.x();\n      output.y = geo.mercator.lat2y(input.y());\n    } else {\n      output = {};\n      output.x = input.x;\n      output.y = geo.mercator.lat2y(input.y);\n    }\n\n    return output;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Transform a point or array of points in local space to\n   * latitude-longitude space\n   *\n   * @input Input An object, array, of array of objects/array representing 2D\n   * point in space. [x,y], [[x,y]], [{x:val: y:val}], {x:val, y:val}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.fromLocal = function (input) {\n    var i, output;\n\n    if (input instanceof Array && input.length > 0) {\n      output = [];\n      output.length = input.length;\n\n      if (input[0] instanceof Object) {\n        for (i = 0; i < input.length; i += 1) {\n          output[i] = {};\n          output[i].x = input[i].x;\n          output[i].y = geo.mercator.y2lat(input[i].y);\n        }\n      } else if (input[0] instanceof Array) {\n        for (i = 0; i < input.length; i += 1) {\n          output[i] = input[i];\n          output[i][1] = geo.mercator.y2lat(input[i][1]);\n        }\n      } else {\n        for (i = 0; i < input.length; i += 1) {\n          output[i] = input[i];\n          output[i + 1] = geo.mercator.y2lat(input[i + 1]);\n        }\n      }\n    }\n    else {\n      output = {};\n      output.x = input.x;\n      output.y = geo.mercator.y2lat(input.y);\n    }\n\n    return output;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Check if a tile exists in the cache\n   *\n   * @param zoom {number} The zoom value for the map [1-17]\n   * @param x {number} X axis tile index\n   * @param y {number} Y axis tile index\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._hasTile = function (zoom, x, y) {\n    if (!m_tiles[zoom]) {\n      return false;\n    }\n    if (!m_tiles[zoom][x]) {\n      return false;\n    }\n    if (!m_tiles[zoom][x][y]) {\n      return false;\n    }\n    return true;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create a new tile\n   * @param x {number} X axis tile index\n   * @param y {number} Y axis tile index\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._addTile = function (request, zoom, x, y) {\n    if (!m_tiles[zoom]) {\n      m_tiles[zoom] = {};\n    }\n    if (!m_tiles[zoom][x]) {\n      m_tiles[zoom][x] = {};\n    }\n    if (m_tiles[zoom][x][y]) {\n      return;\n    }\n\n    /// Compute corner points\n    var noOfTilesX = Math.max(1, Math.pow(2, zoom)),\n        noOfTilesY = Math.max(1, Math.pow(2, zoom)),\n        /// Convert into mercator\n        totalLatDegrees = 360.0,\n        lonPerTile = 360.0 / noOfTilesX,\n        latPerTile = totalLatDegrees / noOfTilesY,\n        llx = -180.0 + x * lonPerTile,\n        lly = -totalLatDegrees * 0.5 + y * latPerTile,\n        urx = -180.0 + (x + 1) * lonPerTile,\n        ury = -totalLatDegrees * 0.5 + (y + 1) * latPerTile,\n        tile = new Image();\n\n    tile.LOADING = true;\n    tile.LOADED = false;\n    tile.REMOVED = false;\n    tile.REMOVING = false;\n\n    tile.crossOrigin = \"anonymous\";\n    tile.zoom = zoom;\n    tile.index_x = x;\n    tile.index_y = y;\n    tile.llx = llx;\n    tile.lly = lly;\n    tile.urx = urx;\n    tile.ury = ury;\n    tile.lastused = new Date();\n\n    // tile.src = \"http://tile.openstreetmap.org/\" + zoom + \"/\" + (x)\n    //   + \"/\" + (Math.pow(2,zoom) - 1 - y) + \".png\";\n    tile.src = m_baseUrl + zoom + \"/\" +\n      (x) + \"/\" + (Math.pow(2, zoom) - 1 - y) + \".\" + m_imageFormat;\n\n    m_tiles[zoom][x][y] = tile;\n    m_pendingNewTiles.push(tile);\n    m_numberOfCachedTiles += 1;\n    return tile;\n  };\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Clear tiles that are no longer required\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  /* jshint -W089 */\n  this._removeTiles = function () {\n    var i, x, y, tile, zoom, currZoom = getModifiedMapZoom(),\n        lastZoom = m_lastVisibleZoom;\n\n    if (!m_tiles) {\n      return m_this;\n    }\n\n    for (zoom in m_tiles) {\n      for (x in m_tiles[zoom]) {\n        for (y in m_tiles[zoom][x]) {\n          tile = m_tiles[zoom][x][y];\n          if (tile) {\n            tile.REMOVING = true;\n            m_pendingInactiveTiles.push(tile);\n          }\n        }\n      }\n    }\n\n    /// First remove the tiles if we have cached more than max cached limit\n    m_pendingInactiveTiles.sort(function (a, b) {\n      return a.lastused - b.lastused;\n    });\n\n    i = 0;\n\n    /// Get rid of tiles if we have reached our threshold. However,\n    /// If the tile is required for current zoom, then do nothing.\n    /// Also don\"t delete the tile if its from the previous zoom\n    while (m_numberOfCachedTiles > m_tileCacheSize &&\n      i < m_pendingInactiveTiles.length) {\n      tile = m_pendingInactiveTiles[i];\n\n      if (isTileVisible(tile)) {\n        i += 1;\n        continue;\n      }\n      m_this.deleteFeature(tile.feature);\n      delete m_tiles[tile.zoom][tile.index_x][tile.index_y];\n      m_pendingInactiveTiles.splice(i, 1);\n      m_numberOfCachedTiles -= 1;\n    }\n\n    for (i = 0; i < m_pendingInactiveTiles.length; i += 1) {\n      tile = m_pendingInactiveTiles[i];\n      tile.REMOVING = false;\n      tile.REMOVED = false;\n      if (tile.zoom !== currZoom && tile.zoom === lastZoom) {\n        tile.feature.bin(m_lastVisibleBinNumber);\n      } else if (tile.zoom !== currZoom) {\n        tile.feature.bin(m_hiddenBinNumber);\n      } else {\n        tile.lastused = new Date();\n        tile.feature.bin(m_visibleBinNumber);\n      }\n      tile.feature._update();\n    }\n    m_pendingInactiveTiles = [];\n\n    return m_this;\n  };\n  /* jshint +W089 */\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create / delete tiles as necessary\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._addTiles = function (request) {\n    var feature, ren = m_this.renderer(),\n        zoom = getModifiedMapZoom(),\n        /// First get corner points\n        /// In display coordinates the origin is on top left corner (0, 0)\n        llx = 0.0, lly = m_this.height(), urx = m_this.width(), ury = 0.0,\n        temp = null, tile = null, tile1x = null, tile1y = null, tile2x = null,\n        tile2y = null, invJ = null, i = 0, j = 0, lastStartX, lastStartY,\n        lastEndX, lastEndY, currStartX, currStartY, currEndX, currEndY,\n        worldPt1 = ren.displayToWorld([llx, lly]),\n        worldPt2 = ren.displayToWorld([urx, ury]);\n\n    worldPt1[0] = Math.max(worldPt1[0], -180.0);\n    worldPt1[0] = Math.min(worldPt1[0],  180.0);\n    worldPt1[1] = Math.max(worldPt1[1], -180.0);\n    worldPt1[1] = Math.min(worldPt1[1],  180.0);\n\n    worldPt2[0] = Math.max(worldPt2[0], -180.0);\n    worldPt2[0] = Math.min(worldPt2[0],  180.0);\n    worldPt2[1] = Math.max(worldPt2[1], -180.0);\n    worldPt2[1] = Math.min(worldPt2[1],  180.0);\n\n    /// Compute tilex and tiley\n    tile1x = geo.mercator.long2tilex(worldPt1[0], zoom);\n    tile1y = geo.mercator.lat2tiley(worldPt1[1], zoom);\n\n    tile2x = geo.mercator.long2tilex(worldPt2[0], zoom);\n    tile2y = geo.mercator.lat2tiley(worldPt2[1], zoom);\n\n    /// Clamp tilex and tiley\n    tile1x = Math.max(tile1x, 0);\n    tile1x = Math.min(Math.pow(2, zoom) - 1, tile1x);\n    tile1y = Math.max(tile1y, 0);\n    tile1y = Math.min(Math.pow(2, zoom) - 1, tile1y);\n\n    tile2x = Math.max(tile2x, 0);\n    tile2x = Math.min(Math.pow(2, zoom) - 1, tile2x);\n    tile2y = Math.max(tile2y, 0);\n    tile2y = Math.min(Math.pow(2, zoom) - 1, tile2y);\n\n    /// Check and update variables appropriately if view\n    /// direction is flipped. This should not happen but\n    /// just in case.\n    if (tile1x > tile2x) {\n      temp = tile1x;\n      tile1x = tile2x;\n      tile2x = temp;\n    }\n    if (tile2y > tile1y) {\n      temp = tile1y;\n      tile1y = tile2y;\n      tile2y = temp;\n    }\n\n    /// Compute current tile indices\n    currStartX = tile1x;\n    currEndX = tile2x;\n    currStartY = (Math.pow(2, zoom) - 1 - tile1y);\n    currEndY = (Math.pow(2, zoom) - 1 - tile2y);\n    if (currEndY < currStartY) {\n      temp = currStartY;\n      currStartY = currEndY;\n      currEndY = temp;\n    }\n\n    /// Compute last tile indices\n    lastStartX = geo.mercator.long2tilex(worldPt1[0],\n                   m_lastVisibleZoom);\n    lastStartY = geo.mercator.lat2tiley(worldPt1[1],\n                   m_lastVisibleZoom);\n    lastEndX = geo.mercator.long2tilex(worldPt2[0],\n                   m_lastVisibleZoom);\n    lastEndY = geo.mercator.lat2tiley(worldPt2[1],\n                   m_lastVisibleZoom);\n    lastStartY = Math.pow(2, m_lastVisibleZoom) - 1 - lastStartY;\n    lastEndY   = Math.pow(2, m_lastVisibleZoom) - 1 - lastEndY;\n    if (lastEndY < lastStartY) {\n      temp = lastStartY;\n      lastStartY = lastEndY;\n      lastEndY = temp;\n    }\n\n    m_visibleTilesRange = {};\n    m_visibleTilesRange[zoom] = { startX: currStartX, endX: currEndX,\n                                  startY: currStartY, endY: currEndY };\n\n    m_visibleTilesRange[m_lastVisibleZoom] =\n                                { startX: lastStartX, endX: lastEndX,\n                                  startY: lastStartY, endY: lastEndY };\n    m_pendingNewTilesStat[m_updateTimerId] = { total:\n      ((tile2x - tile1x + 1) * (tile1y - tile2y + 1)), count: 0 };\n\n    for (i = tile1x; i <= tile2x; i += 1) {\n      for (j = tile2y; j <= tile1y; j += 1) {\n        invJ = (Math.pow(2, zoom) - 1 - j);\n        if  (!m_this._hasTile(zoom, i, invJ)) {\n          tile = m_this._addTile(request, zoom, i, invJ);\n        } else {\n          tile = m_tiles[zoom][i][invJ];\n          tile.feature.bin(m_visibleBinNumber);\n          if (tile.LOADED && m_updateTimerId in m_pendingNewTilesStat) {\n            m_pendingNewTilesStat[m_updateTimerId].count += 1;\n          }\n          tile.lastused = new Date();\n          tile.feature._update();\n        }\n        tile.updateTimerId = m_updateTimerId;\n      }\n    }\n\n    // define a function here to set tile properties after it is loaded\n    function tileOnLoad(tile) {\n      var defer = $.Deferred();\n      m_this.addDeferred(defer);\n\n      return function () {\n        tile.LOADING = false;\n        tile.LOADED = true;\n        if ((tile.REMOVING || tile.REMOVED) &&\n          tile.feature &&\n          tile.zoom !== getModifiedMapZoom()) {\n          tile.feature.bin(m_hiddenBinNumber);\n          tile.REMOVING = false;\n          tile.REMOVED = true;\n        } else {\n          tile.REMOVED = false;\n          tile.lastused = new Date();\n          tile.feature.bin(m_visibleBinNumber);\n        }\n\n        if (tile.updateTimerId === m_updateTimerId &&\n            m_updateTimerId in m_pendingNewTilesStat) {\n          tile.feature.bin(m_visibleBinNumber);\n          m_pendingNewTilesStat[m_updateTimerId].count += 1;\n        } else {\n          tile.REMOVED = true;\n          tile.feature.bin(m_hiddenBinNumber);\n        }\n        tile.feature._update();\n\n        if (m_updateTimerId in m_pendingNewTilesStat &&\n            m_pendingNewTilesStat[m_updateTimerId].count >=\n            m_pendingNewTilesStat[m_updateTimerId].total) {\n          drawTiles();\n        }\n        defer.resolve();\n      };\n    }\n\n    /// And now finally add them\n    for (i = 0; i < m_pendingNewTiles.length; i += 1) {\n      tile = m_pendingNewTiles[i];\n      feature = m_this.createFeature(\"plane\", {drawOnAsyncResourceLoad: false,\n                    onload: tileOnLoad(tile)})\n                  .origin([tile.llx, tile.lly])\n                  .upperLeft([tile.llx, tile.ury])\n                  .lowerRight([tile.urx, tile.lly])\n                  .gcs(\"EPSG:3857\")\n                  .style(\"image\", tile);\n      tile.feature = feature;\n      tile.feature._update();\n    }\n    m_pendingNewTiles = [];\n\n    if (m_updateTimerId in m_pendingNewTilesStat &&\n        m_pendingNewTilesStat[m_updateTimerId].count >=\n        m_pendingNewTilesStat[m_updateTimerId].total) {\n      drawTiles();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update OSM tiles as needed\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function updateOSMTiles(request) {\n    if (request === undefined) {\n      request = {};\n    }\n\n    var zoom = getModifiedMapZoom();\n\n    if (!m_lastVisibleZoom) {\n      m_lastVisibleZoom = zoom;\n    }\n\n    /// Add tiles that are currently visible\n    m_this._addTiles(request);\n\n    /// Update the zoom\n    if (m_lastVisibleZoom !== zoom) {\n      m_lastVisibleZoom = zoom;\n    }\n\n    m_this.updateTime().modified();\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create / delete tiles as necessary\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._updateTiles = function (request) {\n    var defer = $.Deferred();\n    m_this.addDeferred(defer);\n\n    if (m_updateTimerId !== null) {\n      clearTimeout(m_updateTimerId);\n      m_updateDefer.resolve();\n      m_updateDefer = defer;\n      if (m_updateTimerId in m_pendingNewTilesStat) {\n        delete m_pendingNewTilesStat[m_updateTimerId];\n      }\n      /// Set timeout for 60 ms. 60 ms seems to playing well\n      /// with the events. Also, 60ms corresponds to 15 FPS.\n      m_updateTimerId = setTimeout(function () {\n        updateOSMTiles(request);\n        m_updateDefer.resolve();\n      }, 100);\n    } else {\n      m_updateDefer = defer;\n      m_updateTimerId = setTimeout(function () {\n        updateOSMTiles(request);\n        m_updateDefer.resolve();\n      }, 0);\n    }\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   *\n   * Do not call parent _init method as its already been executed\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    s_init.call(m_this);\n    this.gcs(\"EPSG:3857\");\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function (request) {\n    /// Update tiles (create new / delete old etc...)\n    m_this._updateTiles(request);\n\n    /// Now call base class update\n    s_update.call(m_this, request);\n  };\n\n  return this;\n};\n\ninherit(geo.osmLayer, geo.featureLayer);\n\ngeo.registerLayer(\"osm\", geo.osmLayer);\n","/**\n * @module geo.gl\n */\nggl = ogs.namespace('geo.gl'); // jshint ignore: line\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module ggl\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class vglRenderer\n *\n * @param canvas\n * @returns {ggl.vglRenderer}\n */\n//////////////////////////////////////////////////////////////////////////////\nggl.renderer = function (arg) {\n  'use strict';\n\n  if (!(this instanceof ggl.renderer)) {\n    return new ggl.renderer(arg);\n  }\n  geo.renderer.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get context specific renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.contextRenderer = function () {\n    throw 'Should be implemented by derived classes';\n  };\n\n  return this;\n};\n\ninherit(ggl.renderer, geo.renderer);\n\ngeo.registerRenderer('vglRenderer', ggl.vglRenderer);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo.gl\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of lineFeature\n *\n * @class\n * @returns {ggl.lineFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\nggl.lineFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof ggl.lineFeature)) {\n    return new ggl.lineFeature(arg);\n  }\n  arg = arg || {};\n  geo.lineFeature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_actor = null,\n      s_init = this._init,\n      s_update = this._update;\n\n  function createVertexShader() {\n      var vertexShaderSource = [\n        \"attribute vec3 pos;\",\n        \"attribute vec3 strokeColor;\",\n        \"attribute float strokeOpacity;\",\n        \"attribute float strokeWidth;\",\n        \"uniform mat4 modelViewMatrix;\",\n        \"uniform mat4 projectionMatrix;\",\n        \"varying vec3 strokeColorVar;\",\n        \"varying float strokeWidthVar;\",\n        \"varying float strokeOpacityVar;\",\n        \"void main(void)\",\n        \"{\",\n        \"  strokeColorVar = strokeColor;\",\n        \"  strokeWidthVar = strokeWidth;\",\n        \"  strokeOpacityVar = strokeOpacity;\",\n        \"  vec4 p = (projectionMatrix * modelViewMatrix * vec4(pos, 1.0)).xyzw;\",\n        \"  if (p.w != 0.0) {\",\n        \"    p = p/p.w;\",\n        \"  }\",\n        \"  gl_Position = p;\",\n        \"}\"\n      ].join(\"\\n\"),\n      shader = new vgl.shader(gl.VERTEX_SHADER);\n      shader.setShaderSource(vertexShaderSource);\n      return shader;\n    }\n\n  function createFragmentShader() {\n    var fragmentShaderSource = [\n      \"#ifdef GL_ES\",\n      \"  precision highp float;\",\n      \"#endif\",\n      \"varying vec3 strokeColorVar;\",\n      \"varying float strokeWidthVar;\",\n      \"varying float strokeOpacityVar;\",\n      \"void main () {\",\n      \"  gl_FragColor = vec4 (strokeColorVar, strokeOpacityVar);\",\n      \"}\"\n    ],\n    shader = new vgl.shader(gl.FRAGMENT_SHADER);\n    shader.setShaderSource(fragmentShaderSource);\n    return shader;\n  }\n\n  function createGLLines() {\n    var i, numPts = m_this.data().length,\n        start, position = [], strokeWidth = [],\n        strokeColor = [], strokeOpacity = [], posFunc, strokeWidthFunc,\n        strokeColorFunc, strokeOpacityFunc,\n        buffers = vgl.DataBuffers(1024),\n        sourcePositions = vgl.sourceDataP3fv(),\n        sourceStokeWidth = vgl.sourceDataAnyfv(1,\n          vgl.vertexAttributeKeys.CountAttributeIndex + 1),\n        sourceStrokeColor = vgl.sourceDataAnyfv(3,\n          vgl.vertexAttributeKeys.CountAttributeIndex + 2),\n        sourceStrokeOpacity = vgl.sourceDataAnyfv(1,\n          vgl.vertexAttributeKeys.CountAttributeIndex + 3),\n        linesPrimitive = vgl.lines(),\n        mat = vgl.material(),\n        blend = vgl.blend(),\n        prog = vgl.shaderProgram(),\n        vertexShader = createVertexShader(),\n        fragmentShader = createFragmentShader(),\n        posAttr = vgl.vertexAttribute(\"pos\"),\n        stokeWidthAttr = vgl.vertexAttribute(\"strokeWidth\"),\n        strokeColorAttr = vgl.vertexAttribute(\"strokeColor\"),\n        strokeOpacityAttr = vgl.vertexAttribute(\"strokeOpacity\"),\n        modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n        projectionUniform = new vgl.projectionUniform(\"projectionMatrix\"),\n        geom = vgl.geometryData(),\n        mapper = vgl.mapper();\n\n    posFunc = m_this.position();\n    strokeWidthFunc = m_this.style().strokeWidth;\n    strokeColorFunc = m_this.style().strokeColor;\n    strokeOpacityFunc = m_this.style().strokeOpacity;\n\n    m_this.data().forEach(function (item) {\n      var p = posFunc(item);\n      position.push([p.x, p.y, p.z || 0]);\n      strokeWidth.push(strokeWidthFunc(item));\n      strokeColor.push(strokeColorFunc(item));\n      strokeOpacity.push(strokeOpacityFunc(item));\n    });\n\n    position = geo.transform.transformCoordinates(\n                  m_this.gcs(), m_this.layer().map().gcs(),\n                  position, 3);\n\n    buffers.create(\"pos\", 3);\n    buffers.create(\"indices\", 1);\n    buffers.create(\"strokeWidth\", 1);\n    buffers.create(\"strokeColor\", 3);\n    buffers.create(\"strokeOpacity\", 1);\n\n    // TODO: Right now this is ugly but we will fix it.\n    prog.addVertexAttribute(posAttr, vgl.vertexAttributeKeys.Position);\n    prog.addVertexAttribute(\n      stokeWidthAttr,\n      vgl.vertexAttributeKeys.CountAttributeIndex + 1\n    );\n    prog.addVertexAttribute(\n      strokeColorAttr,\n      vgl.vertexAttributeKeys.CountAttributeIndex + 2\n    );\n    prog.addVertexAttribute(\n      strokeOpacityAttr,\n      vgl.vertexAttributeKeys.CountAttributeIndex + 3\n    );\n\n    prog.addUniform(modelViewUniform);\n    prog.addUniform(projectionUniform);\n\n    prog.addShader(fragmentShader);\n    prog.addShader(vertexShader);\n\n    mat.addAttribute(prog);\n    mat.addAttribute(blend);\n\n    m_actor = vgl.actor();\n    m_actor.setMaterial(mat);\n\n    start = buffers.alloc(numPts);\n    for (i = 0; i < numPts; i += 1) {\n      buffers.write(\"pos\", position[i], start + i, 1);\n      buffers.write(\"indices\", [i], start + i, 1);\n      buffers.write(\"strokeWidth\", [strokeWidth[i]], start + i * 1, 1);\n      buffers.write(\"strokeColor\", strokeColor[i], start + i * 1, 1);\n      buffers.write(\"strokeOpacity\", [strokeOpacity[i]], start + i * 1, 1);\n    }\n\n    sourcePositions.pushBack(buffers.get(\"pos\"));\n    geom.addSource(sourcePositions);\n\n    sourceStokeWidth.pushBack(buffers.get(\"strokeWidth\"));\n    geom.addSource(sourceStokeWidth);\n\n    sourceStrokeColor.pushBack(buffers.get(\"strokeColor\"));\n    geom.addSource(sourceStrokeColor);\n\n    sourceStrokeOpacity.pushBack(buffers.get(\"strokeOpacity\"));\n    geom.addSource(sourceStrokeOpacity);\n\n    linesPrimitive.setIndices(buffers.get(\"indices\"));\n    geom.addPrimitive(linesPrimitive);\n\n    mapper.setGeometryData(geom);\n\n    m_actor.setMapper(mapper);\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    if (m_actor) {\n      m_this.renderer().contextRenderer().removeActor(m_actor);\n    }\n\n    createGLLines();\n\n    m_this.renderer().contextRenderer().addActor(m_actor);\n    m_this.buildTime().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    s_update.call(m_this);\n\n    if (m_this.dataTime().getMTime() >= m_this.buildTime().getMTime() ||\n        m_this.updateTime().getMTime() <= m_this.getMTime()) {\n      m_this._build();\n    }\n\n    m_actor.setVisible(m_this.visible());\n    m_actor.material().setBinNumber(m_this.bin());\n    m_this.updateTime().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Destroy\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.renderer().contextRenderer().removeActor(m_actor);\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(ggl.lineFeature, geo.lineFeature);\n\n// Now register it\ngeo.registerFeature(\"vgl\", \"line\", ggl.lineFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo.gl\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of pointFeature\n *\n * @class\n * @returns {ggl.pointFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\nggl.pointFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof ggl.pointFeature)) {\n    return new ggl.pointFeature(arg);\n  }\n  arg = arg || {};\n  geo.pointFeature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      m_actor = null,\n      s_init = this._init,\n      s_update = this._update;\n\n  function createVertexShader() {\n    var vertexShaderSource = [\n        \"attribute vec3 pos;\",\n        \"attribute vec2 unit;\",\n        \"attribute float rad;\",\n        \"attribute vec3 fillColor;\",\n        \"attribute vec3 strokeColor;\",\n        \"attribute float fillOpacity;\",\n        \"attribute float strokeWidth;\",\n        \"attribute float strokeOpacity;\",\n        \"attribute float fill;\",\n        \"attribute float stroke;\",\n        \"uniform float pixelWidth;\",\n        \"uniform float aspect;\",\n        \"uniform mat4 modelViewMatrix;\",\n        \"uniform mat4 projectionMatrix;\",\n        \"varying vec3 unitVar;\",\n        \"varying vec4 fillColorVar;\",\n        \"varying vec4 strokeColorVar;\",\n        \"varying float radiusVar;\",\n        \"varying float strokeWidthVar;\",\n        \"varying float fillVar;\",\n        \"varying float strokeVar;\",\n        \"void main(void)\",\n        \"{\",\n        \"  unitVar = vec3 (unit, 1.0);\",\n        \"  fillColorVar = vec4 (fillColor, fillOpacity);\",\n        \"  strokeColorVar = vec4 (strokeColor, strokeOpacity);\",\n        \"  strokeWidthVar = strokeWidth;\",\n        \"  fillVar = fill;\",\n        \"  strokeVar = stroke;\",\n        \"  radiusVar = rad;\",\n        \"  vec4 p = (projectionMatrix * modelViewMatrix * vec4(pos, 1.0)).xyzw;\",\n        \"  if (p.w != 0.0) {\",\n        \"    p = p/p.w;\",\n        \"  }\",\n        \"  p += (rad + strokeWidth) * \",\n        \"vec4 (unit.x * pixelWidth, unit.y * pixelWidth * aspect, 0.0, 1.0);\",\n        \"  gl_Position = vec4(p.xyz, 1.0);\",\n        \"}\"\n      ].join(\"\\n\"),\n        shader = new vgl.shader(gl.VERTEX_SHADER);\n\n    shader.setShaderSource(vertexShaderSource);\n    return shader;\n  }\n\n  function createFragmentShader() {\n    var fragmentShaderSource = [\n        \"#ifdef GL_ES\",\n        \"  precision highp float;\",\n        \"#endif\",\n        \"uniform float aspect;\",\n        \"varying vec3 unitVar;\",\n        \"varying vec4 fillColorVar;\",\n        \"varying vec4 strokeColorVar;\",\n        \"varying float radiusVar;\",\n        \"varying float strokeWidthVar;\",\n        \"varying float fillVar;\",\n        \"varying float strokeVar;\",\n        \"bool to_bool (in float value) {\",\n        \"  if (value < 1.0)\",\n        \"    return false;\",\n        \"  else\",\n        \"    return true;\",\n        \"}\",\n        \"void main () {\",\n        \"  bool fill = to_bool (fillVar);\",\n        \"  bool stroke = to_bool (strokeVar);\",\n        \"  vec4 strokeColor, fillColor;\",\n        \"  // No stroke or fill implies nothing to draw\",\n        \"  if (!fill && !stroke)\",\n        \"    discard;\",\n        \"  // Get normalized texture coordinates and polar r coordinate\",\n        \"  vec2 tex = (unitVar.xy + 1.0) / 2.0;\",\n        \"  float rad = length (unitVar.xy);\",\n        \"  // If there is no stroke, the fill region should transition to nothing\",\n        \"  if (!stroke)\",\n        \"    strokeColor = vec4 (fillColorVar.rgb, 0.0);\",\n        \"  else\",\n        \"    strokeColor = strokeColorVar;\",\n        \"  // Likewise, if there is no fill, the stroke should transition to nothing\",\n        \"  if (!fill)\",\n        \"    fillColor = vec4 (strokeColor.rgb, 0.0);\",\n        \"  else\",\n        \"    fillColor = fillColorVar;\",\n        \"  float radiusWidth = radiusVar;\",\n        \"  // Distance to antialias over\",\n        \"  float antialiasDist = 3.0 / (2.0 * radiusVar);\",\n        \"  if (rad < (radiusWidth / (radiusWidth + strokeWidthVar))) {\",\n        \"    float endStep = radiusWidth / (radiusWidth + strokeWidthVar);\",\n        \"    float step = smoothstep (endStep - antialiasDist, endStep, rad);\",\n        \"    gl_FragColor = mix (fillColorVar, strokeColorVar, step);\",\n        \"  }\",\n        \"  else {\",\n        \"    float step = smoothstep (1.0 - antialiasDist, 1.0, rad);\",\n        \"    gl_FragColor = mix (strokeColor, vec4 (strokeColor.rgb, 0.0), step);\",\n        \"  }\",\n        \"}\"\n      ].join(\"\\n\"),\n        shader = new vgl.shader(gl.FRAGMENT_SHADER);\n    shader.setShaderSource(fragmentShaderSource);\n    return shader;\n  }\n\n  var rect = function (x, y, w, h) {\n    var verts = [\n        x - w, y + h,\n        x - w, y - h,\n        x + w, y + h,\n        x - w, y - h,\n        x + w, y - h,\n        x + w, y + h\n      ];\n    return verts;\n  };\n\n  function createGLPoints() {\n    var i, numPts = m_this.data().length,\n        start, unit = rect(0, 0, 1, 1),\n        position = [], radius = [], strokeWidth = [],\n        fillColor = [], fill = [], strokeColor = [], stroke = [],\n        fillOpacity = [], strokeOpacity = [], posFunc, radFunc, strokeWidthFunc,\n        fillColorFunc, fillFunc, strokeColorFunc, strokeFunc, fillOpacityFunc,\n        strokeOpactityFunc, buffers = vgl.DataBuffers(1024),\n        sourcePositions = vgl.sourceDataP3fv(),\n        sourceUnits = vgl.sourceDataAnyfv(2, vgl.vertexAttributeKeysIndexed.One),\n        sourceRadius = vgl.sourceDataAnyfv(1, vgl.vertexAttributeKeysIndexed.Two),\n        sourceStokeWidth = vgl.sourceDataAnyfv(1, vgl.vertexAttributeKeysIndexed.Three),\n        sourceFillColor = vgl.sourceDataAnyfv(3, vgl.vertexAttributeKeysIndexed.Four),\n        sourceFill = vgl.sourceDataAnyfv(1, vgl.vertexAttributeKeysIndexed.Five),\n        sourceStrokeColor = vgl.sourceDataAnyfv(3, vgl.vertexAttributeKeysIndexed.Six),\n        sourceStroke = vgl.sourceDataAnyfv(1, vgl.vertexAttributeKeysIndexed.Seven),\n        sourceAlpha = vgl.sourceDataAnyfv(1, vgl.vertexAttributeKeysIndexed.Eight),\n        sourceStrokeOpacity = vgl.sourceDataAnyfv(1, vgl.vertexAttributeKeysIndexed.Nine),\n        trianglesPrimitive = vgl.triangles(),\n        mat = vgl.material(),\n        blend = vgl.blend(),\n        prog = vgl.shaderProgram(),\n        vertexShader = createVertexShader(),\n        fragmentShader = createFragmentShader(),\n        posAttr = vgl.vertexAttribute(\"pos\"),\n        unitAttr = vgl.vertexAttribute(\"unit\"),\n        radAttr = vgl.vertexAttribute(\"rad\"),\n        stokeWidthAttr = vgl.vertexAttribute(\"strokeWidth\"),\n        fillColorAttr = vgl.vertexAttribute(\"fillColor\"),\n        fillAttr = vgl.vertexAttribute(\"fill\"),\n        strokeColorAttr = vgl.vertexAttribute(\"strokeColor\"),\n        strokeAttr = vgl.vertexAttribute(\"stroke\"),\n        fillOpacityAttr = vgl.vertexAttribute(\"fillOpacity\"),\n        strokeOpacityAttr = vgl.vertexAttribute(\"strokeOpacity\"),\n        pixelWidthUniform = new vgl.floatUniform(\"pixelWidth\",\n                              2.0 / m_this.renderer().width()),\n        aspectUniform = new vgl.floatUniform(\"aspect\",\n                          m_this.renderer().width() / m_this.renderer().height()),\n        modelViewUniform = new vgl.modelViewUniform(\"modelViewMatrix\"),\n        projectionUniform = new vgl.projectionUniform(\"projectionMatrix\"),\n        geom = vgl.geometryData(),\n        mapper = vgl.mapper();\n\n    posFunc = m_this.position();\n    radFunc = m_this.style().radius;\n    strokeWidthFunc = m_this.style().strokeWidth;\n    fillColorFunc = m_this.style().fillColor;\n    fillFunc = m_this.style().fill;\n    strokeColorFunc = m_this.style().strokeColor;\n    strokeFunc = m_this.style().stroke;\n    fillOpacityFunc = m_this.style().fillOpacity;\n    strokeOpactityFunc = m_this.style().strokeOpacity;\n\n    m_this.data().forEach(function (item) {\n      var p = posFunc(item), c;\n\n      position.push([p.x, p.y, p.z || 0]);\n      radius.push(radFunc(item));\n      strokeWidth.push(strokeWidthFunc(item));\n      fill.push(fillFunc(item) ? 1.0 : 0.0);\n\n      c = fillColorFunc(item);\n      fillColor.push([ c.r, c.g, c.b ]);\n\n      c = strokeColorFunc(item);\n      strokeColor.push([ c.r, c.g, c.b ]);\n\n      stroke.push(strokeFunc(item) ? 1.0 : 0.0);\n      fillOpacity.push(fillOpacityFunc(item));\n      strokeOpacity.push(strokeOpactityFunc(item));\n    });\n\n    position = geo.transform.transformCoordinates(\n                  m_this.gcs(), m_this.layer().map().gcs(),\n                  position, 3);\n\n    buffers.create(\"pos\", 3);\n    buffers.create(\"indices\", 1);\n    buffers.create(\"unit\", 2);\n    buffers.create(\"rad\", 1);\n    buffers.create(\"strokeWidth\", 1);\n    buffers.create(\"fillColor\", 3);\n    buffers.create(\"fill\", 1);\n    buffers.create(\"strokeColor\", 3);\n    buffers.create(\"stroke\", 1);\n    buffers.create(\"fillOpacity\", 1);\n    buffers.create(\"strokeOpacity\", 1);\n\n    // TODO: Right now this is ugly but we will fix it.\n    prog.addVertexAttribute(posAttr, vgl.vertexAttributeKeys.Position);\n    prog.addVertexAttribute(unitAttr, vgl.vertexAttributeKeysIndexed.One);\n    prog.addVertexAttribute(radAttr, vgl.vertexAttributeKeysIndexed.Two);\n    prog.addVertexAttribute(stokeWidthAttr, vgl.vertexAttributeKeysIndexed.Three);\n    prog.addVertexAttribute(fillColorAttr, vgl.vertexAttributeKeysIndexed.Four);\n    prog.addVertexAttribute(fillAttr, vgl.vertexAttributeKeysIndexed.Five);\n    prog.addVertexAttribute(strokeColorAttr, vgl.vertexAttributeKeysIndexed.Six);\n    prog.addVertexAttribute(strokeAttr, vgl.vertexAttributeKeysIndexed.Seven);\n    prog.addVertexAttribute(fillOpacityAttr, vgl.vertexAttributeKeysIndexed.Eight);\n    prog.addVertexAttribute(strokeOpacityAttr, vgl.vertexAttributeKeysIndexed.Nine);\n\n    prog.addUniform(pixelWidthUniform);\n    prog.addUniform(aspectUniform);\n    prog.addUniform(modelViewUniform);\n    prog.addUniform(projectionUniform);\n\n    prog.addShader(fragmentShader);\n    prog.addShader(vertexShader);\n\n    mat.addAttribute(prog);\n    mat.addAttribute(blend);\n\n    m_actor = vgl.actor();\n    m_actor.setMaterial(mat);\n\n    start = buffers.alloc(6 * numPts);\n    for (i = 0; i < numPts; i += 1) {\n      buffers.repeat(\"pos\", position[i],\n                      start + i * 6, 6);\n      buffers.write(\"unit\", unit, start + i * 6, 6);\n      buffers.write(\"indices\", [i], start + i, 1);\n      buffers.repeat(\"rad\", [radius[i]], start + i * 6, 6);\n      buffers.repeat(\"strokeWidth\", [strokeWidth[i]], start + i * 6, 6);\n      buffers.repeat(\"fillColor\", fillColor[i], start + i * 6, 6);\n      buffers.repeat(\"fill\", [fill[i]], start + i * 6, 6);\n      buffers.repeat(\"strokeColor\", strokeColor[i], start + i * 6, 6);\n      buffers.repeat(\"stroke\", [stroke[i]], start + i * 6, 6);\n      buffers.repeat(\"fillOpacity\", [fillOpacity[i]], start + i * 6, 6);\n      buffers.repeat(\"strokeOpacity\", [strokeOpacity[i]], start + i * 6, 6);\n    }\n\n    sourcePositions.pushBack(buffers.get(\"pos\"));\n    geom.addSource(sourcePositions);\n\n    sourceUnits.pushBack(buffers.get(\"unit\"));\n    geom.addSource(sourceUnits);\n\n    sourceRadius.pushBack(buffers.get(\"rad\"));\n    geom.addSource(sourceRadius);\n\n    sourceStokeWidth.pushBack(buffers.get(\"strokeWidth\"));\n    geom.addSource(sourceStokeWidth);\n\n    sourceFillColor.pushBack(buffers.get(\"fillColor\"));\n    geom.addSource(sourceFillColor);\n\n    sourceFill.pushBack(buffers.get(\"fill\"));\n    geom.addSource(sourceFill);\n\n    sourceStrokeColor.pushBack(buffers.get(\"strokeColor\"));\n    geom.addSource(sourceStrokeColor);\n\n    sourceStroke.pushBack(buffers.get(\"stroke\"));\n    geom.addSource(sourceStroke);\n\n    sourceAlpha.pushBack(buffers.get(\"fillOpacity\"));\n    geom.addSource(sourceAlpha);\n\n    sourceStrokeOpacity.pushBack(buffers.get(\"strokeOpacity\"));\n    geom.addSource(sourceStrokeOpacity);\n\n    trianglesPrimitive.setIndices(buffers.get(\"indices\"));\n    geom.addPrimitive(trianglesPrimitive);\n\n    mapper.setGeometryData(geom);\n\n    m_actor.setMapper(mapper);\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    s_init.call(m_this, arg);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n\n    if (m_actor) {\n      m_this.renderer().contextRenderer().removeActor(m_actor);\n    }\n\n    createGLPoints();\n\n    m_this.renderer().contextRenderer().addActor(m_actor);\n    m_this.renderer().contextRenderer().render();\n    m_this.buildTime().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n\n    s_update.call(m_this);\n\n    // For now build if the data or style changes. In the future we may\n    // we able to partially update the data using dynamic gl buffers.\n    if (m_this.dataTime().getMTime() >= m_this.buildTime().getMTime() ||\n        m_this.updateTime().getMTime() < m_this.getMTime()) {\n      m_this._build();\n    }\n\n    m_actor.setVisible(m_this.visible());\n    m_actor.material().setBinNumber(m_this.bin());\n\n    m_this.updateTime().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Destroy\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.renderer().contextRenderer().removeActor(m_actor);\n  };\n\n  m_this._init();\n  return this;\n};\n\ninherit(ggl.pointFeature, geo.pointFeature);\n\n// Now register it\ngeo.registerFeature(\"vgl\", \"point\", ggl.pointFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of geomFeature\n *\n * @class\n * Create a geometry feature given a geometry {vgl.geometryData}\n *\n * @param arg {\"geom\": vgl.geometryData}\n * @returns {ggl.geomFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\nggl.geomFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof ggl.geomFeature)) {\n    return new ggl.geomFeature(arg);\n  }\n  arg = arg || {};\n  geo.geomFeature.call(this, arg);\n\n  // Initialize\n  var m_this = this,\n      m_geom = arg.geom || null,\n      m_actor = vgl.actor(),\n      m_mapper = vgl.mapper(),\n      m_material = null,\n      m_scalar = null,\n      m_color = arg.color || [1.0, 1.0, 1.0],\n      m_buildTime = null,\n      m_noOfPrimitives = 0;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    var style = m_this.style();\n\n    // Vertex color gets the preference\n    if (m_geom !== null) {\n      m_scalar = m_geom.sourceData(vgl.vertexAttributeKeys.Scalar);\n      m_color = m_geom.sourceData(vgl.vertexAttributeKeys.Color);\n      m_mapper.setGeometryData(m_geom);\n    }\n\n    this.setMapper(m_mapper);\n\n    if (style.point_sprites !== undefined && style.point_sprites &&\n        style.point_sprites_image !== undefined &&\n        style.point_sprites_image !== null &&\n        m_noOfPrimitives === 1 &&\n        m_geom.primitive(0).primitiveType() === gl.POINTS) {\n      m_material = vgl.utils.createPointSpritesMaterial(\n                     style.point_sprites_image);\n    }\n    else if (m_scalar) {\n      if (m_color instanceof vgl.lookupTable) {\n        m_color.updateRange(m_scalar.scalarRange());\n        m_material = vgl.utils.createColorMappedMaterial(m_color);\n      } else {\n        m_color = vgl.lookupTable();\n        m_color.updateRange(m_scalar.scalarRange());\n        m_material = vgl.utils.createColorMappedMaterial(m_color);\n      }\n    } else if (m_color) {\n      m_material = vgl.utils.createColorMaterial();\n    } else {\n      m_material = vgl.utils.createSolidColorMaterial();\n    }\n    m_actor.setMaterial(m_material);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @private\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    if (m_buildTime &&\n        m_buildTime.getMTime() < m_this.getMTime()) {\n      if (m_color instanceof vgl.lookupTable) {\n        vgl.utils.updateColorMappedMaterial(m_this.material(),\n          m_this.style.color);\n      } else {\n        // TODO\n      }\n    } else {\n      m_buildTime = vgl.timestamp();\n      m_buildTime.modified();\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get/Set geometry\n   *\n   * @returns {ggl.geomFeature}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.geometry = function (val) {\n    if (val === undefined) {\n      return m_geom;\n    } else {\n      m_geom = val;\n      m_this.modified();\n      return m_this;\n    }\n  };\n\n  return this;\n};\n\ninherit(ggl.geomFeature, geo.geomFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of planeFeature\n *\n * @class\n * Create a plane feature given a lower left corner point {geo.latlng}\n * and and upper right corner point {geo.latlng}\n * @param lowerleft\n * @param upperright\n * @returns {geo.planeFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\nggl.planeFeature = function (arg) {\n  \"use strict\";\n  if (!(this instanceof ggl.planeFeature)) {\n    return new ggl.planeFeature(arg);\n  }\n  geo.planeFeature.call(this, arg);\n\n  var m_this = this,\n      m_actor = null,\n      m_onloadCallback = arg.onload === undefined ? null : arg.onload;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Gets the coordinates for this plane\n   *\n   * @returns {Array} [[origin], [upper left] [lower right]]\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.coords = function () {\n    return [m_this.origin(), m_this.upperLeft(), m_this.lowerRight()];\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build this feature\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    var or = m_this.origin(),\n        ul = m_this.upperLeft(),\n        lr = m_this.lowerRight(),\n        /// img could be a source or an Image\n        img = m_this.style().image,\n        image = null,\n        texture = null;\n\n    /// TODO If for some reason base layer changes its gcs at run time\n    /// then we need to trigger an event to rebuild every feature\n    or = geo.transform.transformCoordinates(m_this.gcs(),\n                                            m_this.layer().map().gcs(),\n                                            or);\n    ul = geo.transform.transformCoordinates(m_this.gcs(),\n                                            m_this.layer().map().gcs(),\n                                            ul);\n    lr = geo.transform.transformCoordinates(m_this.gcs(),\n                                            m_this.layer().map().gcs(),\n                                            lr);\n\n    m_this.buildTime().modified();\n\n    if (m_actor) {\n      m_this.renderer().contextRenderer().removeActor(m_actor);\n    }\n\n    if (img && img instanceof Image) {\n      image = img;\n    } else if (img) {\n      image = new Image();\n      image.src = img;\n    }\n\n    if (!image) {\n      m_actor = vgl.utils.createPlane(or[0], or[1], or[2],\n        ul[0], ul[1], ul[2],\n        lr[0], lr[1], lr[2]);\n\n      m_this.renderer().contextRenderer().addActor(m_actor);\n\n    } else {\n      m_actor = vgl.utils.createTexturePlane(or[0], or[1], or[2],\n        lr[0], lr[1], lr[2],\n        ul[0], ul[1], ul[2], true);\n      texture = vgl.texture();\n      m_this.visible(false);\n\n      /// TODO: Is there a reliable way to make sure that image is loaded already?\n      m_this.renderer().contextRenderer().addActor(m_actor);\n\n      if (image.complete) {\n        texture.setImage(image);\n        m_actor.material().addAttribute(texture);\n        /// NOTE Currently we assume that we want to show the feature as\n        /// soon as the image gets loaded. However, there might be a case\n        /// where we want to lock down the visibility. We will deal with that\n        /// later.\n        m_this.visible(true);\n\n        if (m_onloadCallback) {\n          m_onloadCallback.call(m_this);\n        }\n        //}\n      } else {\n        image.onload = function () {\n          texture.setImage(image);\n          m_actor.material().addAttribute(texture);\n          /// NOTE Currently we assume that we want to show the feature as\n          /// soon as the image gets loaded. However, there might be a case\n          /// where we want to lock down the visibility. We will deal with that\n          /// later.\n          m_this.visible(true);\n\n          if (m_onloadCallback) {\n            m_onloadCallback.call(m_this);\n          }\n\n          if (m_this.drawOnAsyncResourceLoad()) {\n            m_this._update();\n            m_this.layer()._draw();\n          }\n        };\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    if (m_this.buildTime().getMTime() <= m_this.dataTime().getMTime()) {\n      m_this._build();\n    }\n\n    if (m_this.updateTime().getMTime() <= m_this.getMTime()) {\n      m_actor.setVisible(m_this.visible());\n      m_actor.material().setBinNumber(m_this.bin());\n    }\n\n    m_this.updateTime().modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Destroy\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_this.renderer().contextRenderer().removeActor(m_actor);\n  };\n\n  return this;\n};\n\ninherit(ggl.planeFeature, geo.planeFeature);\n\n// Now register it\ngeo.registerFeature(\"vgl\", \"plane\", ggl.planeFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module ggl\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of mapInteractorStyle\n *\n * @class geo.mapInteractorStyle\n * @returns {geo.mapInteractorStyle}\n */\n//////////////////////////////////////////////////////////////////////////////\nggl.mapInteractorStyle = function () {\n  \"use strict\";\n  if (!(this instanceof ggl.mapInteractorStyle)) {\n    return new ggl.mapInteractorStyle();\n  }\n  vgl.interactorStyle.call(this);\n  var m_map,\n    m_this = this,\n    m_leftMouseButtonDown = false,\n    m_rightMouseButtonDown = false,\n    m_middileMouseButtonDown = false,\n    m_initRightBtnMouseDown = false,\n    m_drawRegionMode = false,\n    m_drawRegionLayer,\n    m_clickLatLng,\n    m_width,\n    m_height,\n    m_renderer,\n    m_renderWindow,\n    m_camera,\n    m_currentMousePos = { x : 0, y : 0 },\n    m_focusDisplayPoint,\n    m_zTrans,\n    m_coords,\n    m_lastMousePos = { x : 0, y : 0 },\n    m_useLastDirection = false,\n    m_lastDirection = null,\n    m_picker = new vgl.picker(),\n    m_updateRenderParamsTime = vgl.timestamp();\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Sets or gets map for this interactor, adds draw region layer if needed\n   *\n   * @param {geo.map} newMap optional\n   * @returns {geo.mapInteractorStyle|geo.map}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.map = function (val) {\n    if (val !== undefined) {\n      m_map = val;\n      return m_this;\n    }\n    return m_map;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Sets or gets drawRegionMode for this interactor\n   *\n   * @param {Boolean} newValue optional\n   * @returns {geo.mapInteractorStyle|Boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.drawRegionMode = function (val) {\n    if (val !== undefined) {\n      m_drawRegionMode = val;\n      if (m_drawRegionLayer) {\n        m_drawRegionLayer.setVisible(val);\n      }\n      m_map.draw();\n      return m_this;\n    }\n    return m_drawRegionMode;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Internal function to pan a camera associated with a renderer.\n   *\n   * @param {vgl.renderer} the renderer whose camera should be panned.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._panCamera = function (renderer) {\n    var worldPt1, worldPt2, dx, dy, dz, focusDisplayPoint = renderer.focusDisplayPoint();\n\n    worldPt1 = m_renderWindow.displayToWorld(m_currentMousePos.x,\n      m_currentMousePos.y, focusDisplayPoint, renderer);\n    worldPt2 = m_renderWindow.displayToWorld(m_lastMousePos.x,\n      m_lastMousePos.y, focusDisplayPoint, renderer);\n\n    dx = worldPt1[0] - worldPt2[0];\n    dy = worldPt1[1] - worldPt2[1];\n    dz = worldPt1[2] - worldPt2[2];\n\n    renderer.camera().pan(-dx, -dy, -dz);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse move event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseMove = function (event) {\n    /// Local vars\n    var mouseWorldPoint,\n        lastWorldPos,\n        currWorldPos,\n        evt,\n        i,\n        renderers;\n\n    /// Update render params\n    m_this.updateRenderParams();\n\n    /// Compute current mouse position\n    m_this._computeCurrentMousePos(event);\n\n    if (m_leftMouseButtonDown) {\n      if (m_drawRegionMode) {\n        mouseWorldPoint = m_map.displayToMap(m_currentMousePos.x,\n          m_currentMousePos.y);\n        m_this.setDrawRegion(m_clickLatLng.lat(), m_clickLatLng.lng(),\n          mouseWorldPoint.y, mouseWorldPoint.x);\n      } else {\n        lastWorldPos = m_camera.position();\n        // Pan all cameras associated with the render window.\n        renderers = m_renderWindow.renderers();\n        for (i = 0; i < renderers.length; i += 1) {\n          m_this._panCamera(renderers[i]);\n        }\n        currWorldPos = m_camera.position();\n\n        // TODO Do we need to emit an event for each ?\n        evt = {type: geo.event.pan,\n               last_display_pos: m_lastMousePos,\n               curr_display_pos: m_currentMousePos,\n               last_world_pos: lastWorldPos,\n               curr_world_pos: currWorldPos};\n\n        $(m_this).trigger(evt);\n      }\n    }\n    if (m_middileMouseButtonDown) {\n      /// DO NOTHING AS OF NOW\n    }\n    if (m_rightMouseButtonDown && m_height > 0) {\n      if (m_lastDirection !== null) {\n        m_useLastDirection = true;\n      }\n\n      m_this.zoom();\n    }\n\n    m_lastMousePos.x = m_currentMousePos.x;\n    m_lastMousePos.y = m_currentMousePos.y;\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse down event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseDown = function (event) {\n    var point;\n\n    /// Update render parameters\n    m_this.updateRenderParams();\n\n     /// Compute current mouse position\n    m_this._computeCurrentMousePos(event);\n\n    if (event.button === 0) {\n      m_leftMouseButtonDown = true;\n    }\n    if (event.button === 1) {\n      m_middileMouseButtonDown = true;\n    }\n    if (event.button === 2) {\n      m_rightMouseButtonDown = true;\n    }\n\n    m_coords = m_this.viewer().relMouseCoords(event);\n    if (m_coords.x < 0) {\n      m_lastMousePos.x = 0;\n    } else {\n      m_lastMousePos.x = m_coords.x;\n    }\n    if (m_coords.y < 0) {\n      m_lastMousePos.y = 0;\n    } else {\n      m_lastMousePos.y = m_coords.y;\n    }\n\n    if (m_drawRegionMode && m_leftMouseButtonDown) {\n      point = m_map.displayToMap(m_lastMousePos.x, m_lastMousePos.y);\n      m_clickLatLng = geo.latlng(point.y, point.x);\n      m_this.setDrawRegion(point.y, point.x, point.y, point.x);\n    }\n\n    m_lastMousePos.x = m_currentMousePos.x;\n    m_lastMousePos.y = m_currentMousePos.y;\n\n    $(document).on(\"mousemove\", function (evt) {\n      m_this.handleMouseMove(evt);\n      evt.preventDefault();\n      evt.stopPropagation();\n    });\n    $(document).on(\"mouseup\", function (evt) {\n      m_this.handleMouseUp(evt);\n      $(document).off(\"mousemove\");\n      $(document).off(\"mouseup\");\n      evt.preventDefault();\n      evt.stopPropagation();\n    });\n\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @NOTE We never get mouse up from scroll bar: See the bug report here\n   * http://bugs.jquery.com/ticket/8184\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseUp = function (event) {\n    var width = null,\n        height = null,\n        num = null;\n\n    /// Update render params\n    m_this.updateRenderParams();\n\n    if (event.button === 0) {\n      m_leftMouseButtonDown = false;\n      width = m_this.viewer().renderWindow().windowSize()[0];\n      height = m_this.viewer().renderWindow().windowSize()[1];\n      m_renderer = m_this.viewer().renderWindow().activeRenderer();\n      if (m_lastMousePos.x >= 0 && m_lastMousePos.x <= width &&\n          m_lastMousePos.y >= 0 && m_lastMousePos.y <= height) {\n        num = m_picker.pick(m_lastMousePos.x, m_lastMousePos.y, m_renderer);\n      }\n    }\n    if (event.button === 1) {\n      m_middileMouseButtonDown = false;\n    }\n    if (event.button === 2) {\n      m_rightMouseButtonDown = false;\n      m_initRightBtnMouseDown = false;\n      m_useLastDirection = false;\n      m_lastDirection = null;\n\n      /// Compute current mouse position\n      m_this._computeCurrentMousePos(event);\n    }\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle mouse wheel event\n   *\n   * @param event\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleMouseWheel = function (event) {\n    /// Update render params\n    m_this.updateRenderParams();\n\n    var delta = event.originalEvent.wheelDeltaY / 120.0, deltaIsPositive,\n                speed = 0.05;\n    deltaIsPositive = delta >= 0.0 ? true : false;\n\n    delta = Math.pow(1 + Math.abs(delta) / 2, delta > 0 ? -1 : 1);\n\n    delta *= speed;\n\n    /// Compute current mouse position\n    m_this._computeCurrentMousePos(event);\n\n    m_this.zoom(delta, !deltaIsPositive);\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle double click event\n   *\n   * @returns {boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.handleDoubleClick = function () {\n    m_this.zoom(0.5, false);\n    return false;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Internal function to zoom cameras\n   * @param {Number} optional value to zoom by\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._syncZoom = function (val, dir) {\n    var i, renderers, pos, fp, cam, clipRange, gap, minGap = 0.01;\n\n    /// Make sure we are uptodate with renderer and render window\n    m_this.updateRenderParams();\n\n    if (val) {\n      m_camera.zoom(val, dir);\n      if (dir) {\n        pos = m_camera.position();\n        fp = m_camera.focalPoint();\n        m_camera.setFocalPoint(pos[0], pos[1], fp[2]);\n      }\n      m_renderer.resetCameraClippingRange();\n    }\n\n    pos = m_camera.position();\n    fp = m_camera.focalPoint();\n    gap = vec3.distance(pos, fp);\n\n    if (!dir) {\n      dir = m_camera.directionOfProjection();\n    }\n\n    clipRange = m_camera.clippingRange();\n\n    if ((vec3.dot(dir, m_camera.directionOfProjection()) > 0) &&\n        (Math.abs(gap) < minGap || clipRange[0] < minGap)) {\n      pos[0] = fp[0] + minGap * dir[0];\n      pos[1] = fp[1] + minGap * dir[1];\n      pos[2] = fp[2] - minGap * dir[2];\n      m_camera.setPosition(pos[0], pos[1], pos[2]);\n      m_camera.setFocalPoint(pos[0], pos[1], fp[2]);\n      m_renderer.resetCameraClippingRange();\n    }\n\n    pos = m_camera.position();\n    fp = m_camera.focalPoint();\n\n    renderers = m_renderWindow.renderers();\n    for (i = 0; i < renderers.length; i += 1) {\n      cam = renderers[i].camera();\n      if (cam !== m_camera) {\n        cam.setPosition(pos[0], pos[1], pos[2]);\n        cam.setFocalPoint(fp[0], fp[1], fp[2]);\n        renderers[i].resetCameraClippingRange();\n        renderers[i].render();\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Internal function to zoom cameras\n   * @param {Number} optional value to zoom by\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._syncReset = function () {\n    var i, renderers, pos, fp, zoom, center, cam, clippingRange;\n\n    /// Make sure we are uptodate with renderer and render window\n    m_this.updateRenderParams();\n\n    zoom = m_map.zoom();\n    center = m_map.center();\n    fp = m_camera.focalPoint();\n\n    /// TODO: Call base layer - reference layer\n    center = m_map.baseLayer().toLocal(geo.latlng(center[0], center[1]));\n\n    if (center instanceof Object &&\n        \"x\" in center &&\n        \"y\" in center &&\n        m_map.baseLayer() instanceof geo.osmLayer) {\n\n      m_camera.setPosition(center.x, center.y, computeCameraDistance(zoom));\n      m_camera.setFocalPoint(center.x, center.y, fp[2]);\n      m_renderer.resetCameraClippingRange();\n    }\n\n    fp = m_camera.focalPoint();\n    pos = m_camera.position();\n    clippingRange = m_camera.clippingRange();\n\n    renderers = m_renderWindow.renderers();\n\n    /// TODO Check if we are allowed to transfrom the camera for this renderer\n    for (i = 0; i < renderers.length; i += 1) {\n      cam = renderers[i].camera();\n      if (cam !== m_camera) {\n        cam.setPosition(pos[0], pos[1], pos[2]);\n        cam.setFocalPoint(fp[0], fp[1], fp[2]);\n        cam.setClippingRange(clippingRange[0], clippingRange[1]);\n        renderers[i].render();\n      }\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Internal function to zoom cameras\n   * @param {Number} optional value to zoom by\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._syncPan = function () {\n    /// TODO: Implement this\n    // var i, renderers;\n    // m_camera.zoom(val);\n    // m_renderer.resetCameraClippingRange();\n\n    // renderers = m_renderWindow.renderers();\n    // for (i = 0; i < renderers.length; i++) {\n    //   if (renderers[i].camera() !== m_camera) {\n    //     renderers[i].camera().zoom(val);\n    //     renderers[i].resetCameraClippingRange();\n    //   }\n    // }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update view in response to a zoom request\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.zoom = function (val, zoomOut) {\n    var evt, newZoomLevel, oldZoomLevel, cameraPos, cameraFp, newPos, clickedWorldPoint,\n        direction, focusDisplayPoint, maxZoomedOutDist = 0, maxZoomedOut = false;\n\n    /// Update render params\n    m_this.updateRenderParams();\n\n    m_zTrans = (m_currentMousePos.y - m_lastMousePos.y) / m_height;\n\n    if (val === undefined) {\n      val = 2.0 * Math.abs(m_zTrans);\n    }\n\n    oldZoomLevel = computeZoomLevel();\n\n    focusDisplayPoint = m_renderer.focusDisplayPoint();\n    clickedWorldPoint = m_renderWindow.displayToWorld(m_currentMousePos.x,\n                        m_currentMousePos.y, focusDisplayPoint, m_renderer);\n    cameraPos = m_camera.position();\n    cameraFp = m_camera.focalPoint();\n    direction = [clickedWorldPoint[0] - cameraPos[0],\n                 clickedWorldPoint[1] - cameraPos[1],\n                 clickedWorldPoint[2] - cameraPos[2]];\n\n    vec3.normalize(direction, direction);\n\n    if (m_useLastDirection) {\n      direction = m_lastDirection.slice(0);\n    } else {\n      m_lastDirection = direction.slice(0);\n    }\n\n    if ((m_lastMousePos.y - m_currentMousePos.y) < 0 || zoomOut) {\n      direction[0] = -direction[0];\n      direction[1] = -direction[1];\n      direction[2] = -direction[2];\n    }\n\n    if (cameraPos[2] * Math.sin(m_camera.viewAngle()) >= 360.0 && zoomOut) {\n      maxZoomedOut = true;\n    } else {\n      this._syncZoom(val, direction);\n\n      /// Compute meters per pixel here and based on that decide the\n      /// zoom level\n      newZoomLevel = computeZoomLevel();\n    }\n\n    /// Check again here:\n    cameraPos = m_camera.position();\n    cameraFp = m_camera.focalPoint();\n\n    if (maxZoomedOut || (cameraPos[2] * Math.sin(m_camera.viewAngle()) >= 360.0)) {\n      maxZoomedOut = false;\n      maxZoomedOutDist = computeCameraDistance(0);\n\n      /// Compute x and y positions based off the max zoomed out distance\n      newPos = [(maxZoomedOutDist - cameraPos[2]) * direction[0] / direction[2],\n                (maxZoomedOutDist - cameraPos[2]) * direction[1] / direction[2]];\n\n      m_camera.setPosition(cameraPos[0] + newPos[0],\n                           cameraPos[1] + newPos[1], maxZoomedOutDist);\n      m_camera.setFocalPoint(cameraPos[0] + newPos[0],\n                             cameraPos[1] + newPos[1], cameraFp[2]);\n      m_renderer.resetCameraClippingRange();\n\n      newZoomLevel = 0;\n\n      /// Sync all other camera again.\n      this._syncZoom();\n    }\n\n    evt = { type: geo.event.zoom,\n            curr_zoom: newZoomLevel,\n            last_zoom: oldZoomLevel };\n    $(m_this).trigger(evt);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Sets or gets the lastMousePosition for this interactor\n   *\n   * @param newPosition optional\n   * @param {Number} newPosition.x\n   * @param {Number} newPosition.y\n   * @returns {geo.mapInteractorStyle|Object}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.lastMousePosition = function (newPosition) {\n    if (newPosition !== undefined) {\n      m_lastMousePos = newPosition;\n      return m_this;\n    }\n    return m_lastMousePos;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Sets or gets leftMouseDown for this interactor\n   *\n   * @param {Boolean} newValue optional\n   * @returns {geo.mapInteractorStyle|Boolean}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.leftMouseDown = function (newValue) {\n    if (newValue !== undefined) {\n      m_leftMouseButtonDown = newValue;\n      return m_this;\n    }\n    return m_leftMouseButtonDown;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Sets the draw region coordinates for this interactor\n   *\n   * @param {Number} lat1\n   * @param {Number} lon1\n   * @param {Number} lat2\n   * @param {Number} lon2\n   * @returns {geo.mapInteractorStyle}\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.setDrawRegion = function (lat1, lon1, lat2, lon2) {\n    // TODO\n    // Use z-indexing or some other technique for the offsetting\n    var evt, plane = geo.planeFeature(\n      geo.latlng(lat1, lon1),\n      geo.latlng(lat2, lon2),\n      99\n    );\n\n    m_map.removeLayer(m_drawRegionLayer);\n\n    m_drawRegionLayer = geo.featureLayer({\n      \"opacity\": 0.5,\n      \"showAttribution\": 1\n    }, plane);\n\n    m_map.addLayer(m_drawRegionLayer);\n\n    /// TODO pass bounding box\n    evt = jQuery.Event(geo.event.updateDrawRegionEvent);\n    $(m_this).trigger(geo.command.updateDrawRegionEvent, evt);\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Gets the draw region coordinates for this interactor\n   *\n   * @returns {Array} [lat1, lon1, lat2, lon2]\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.getDrawRegion = function () {\n    return m_drawRegionLayer.features()[0].getCoords();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute current mouse position\n   *\n   * @protected\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._computeCurrentMousePos = function (event) {\n    if (event.pageX === undefined || event.pageY === undefined) {\n      return;\n    }\n\n    /// Update render params\n    m_this.updateRenderParams();\n    m_coords = m_this.viewer().relMouseCoords(event);\n\n    m_currentMousePos.x = m_coords.x;\n    m_currentMousePos.y = m_coords.y;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute current mouse position\n   *\n   * @protected\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.updateRenderParams = function () {\n    m_renderWindow = m_this.viewer().renderWindow();\n    m_width = m_renderWindow.windowSize()[0];\n    m_height = m_renderWindow.windowSize()[1];\n    m_renderer = m_this.viewer().renderWindow().activeRenderer();\n    m_camera = m_renderer.camera();\n    m_focusDisplayPoint = m_renderWindow.focusDisplayPoint();\n    m_updateRenderParamsTime.modified();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Reset to default\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.reset = function () {\n    var evt, zoom;\n\n    if (!m_map) {\n      return;\n    }\n\n    zoom = m_map.zoom();\n\n    m_this._syncReset();\n\n    evt = { type: geo.event.zoom,\n            curr_zoom: zoom,\n            last_zoom: zoom };\n    $(m_this).trigger(evt);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute zoom level\n   *\n   * @param deltaMerc mercator/per pixel\n   * @returns {Number} zoom level\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function computeZoomLevel() {\n    var i, pos = m_camera.position(),\n        width = (pos[2] * Math.sin(m_camera.viewAngle()));\n    for (i = 0; i < 20; i += 1) {\n      if (width >= (360.0 / Math.pow(2, i))) {\n        /// We are forcing the minimum zoom level to 2 so that we can get\n        /// high res imagery even at the zoom level 0 distance\n        return i;\n      }\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Compute camera distance for a given zoom level\n   *\n   * @returns {Number} camera distance from the map\n   *\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function computeCameraDistance(zoomLevel) {\n    var deg = 360.0 / Math.pow(2, zoomLevel);\n    return (deg / Math.sin(m_camera.viewAngle()));\n  }\n\n  return this;\n};\n\ninherit(ggl.mapInteractorStyle, vgl.interactorStyle);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module ggl\n */\n//////////////////////////////////////////////////////////////////////////////\n\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Single VGL viewer\n *\n * This singleton instance is used to share a single GL context across multiple\n * vlgRenderer and therefore layers.\n */\n//////////////////////////////////////////////////////////////////////////////\nggl._vglViewerInstance = null;\n\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Retrives the singleton, lazily constructs as necessary.\n *\n * @return {vgl.viewer} the single viewer instance.\n */\n//////////////////////////////////////////////////////////////////////////////\n\nggl.vglViewerInstance = function () {\n  \"use strict\";\n  var canvas;\n\n  if (ggl._vglViewerInstance === null) {\n    canvas = $(document.createElement(\"canvas\"));\n    canvas.attr(\"class\", \".webgl-canvas\");\n    ggl._vglViewerInstance = vgl.viewer(canvas.get(0));\n    ggl._vglViewerInstance.renderWindow().removeRenderer(\n      ggl._vglViewerInstance.renderWindow().activeRenderer());\n    ggl._vglViewerInstance.setInteractorStyle(ggl.mapInteractorStyle());\n    ggl._vglViewerInstance.init();\n  }\n\n  return ggl._vglViewerInstance;\n};\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class vglRenderer\n *\n * @param canvas\n * @returns {ggl.vglRenderer}\n */\n//////////////////////////////////////////////////////////////////////////////\nggl.vglRenderer = function (arg) {\n  \"use strict\";\n\n  if (!(this instanceof ggl.vglRenderer)) {\n    return new ggl.vglRenderer(arg);\n  }\n  ggl.renderer.call(this, arg);\n\n  var m_this = this,\n      m_viewer = ggl.vglViewerInstance(),\n      m_contextRenderer = vgl.renderer(),\n      m_width = 0,\n      m_height = 0,\n      s_init = this._init;\n\n  m_contextRenderer.setResetScene(false);\n\n  /// TODO: Move this API to the base class\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return width of the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.width = function () {\n    return m_width;\n  };\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return height of the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.height = function () {\n    return m_height;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return width of the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert input data in display space to world space\n   *\n   * @param input {x:val, y:val}, [{x:val, y:val}],\n   * [{x:val, y:val}], [x1,y1], [[x,y]]\n   *\n   * @returns {x:val, y:val, z:val, w:val}, [{x:val, y:val, z:val, w:val}],\n              [[x, y, z, w]], [x1,y1,z1,w]\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToWorld = function (input) {\n    var i,\n        delta,\n        ren = m_this.contextRenderer(),\n        cam = ren.camera(),\n        fdp = ren.focusDisplayPoint(),\n        output,\n        temp,\n        point;\n\n    /// Handle if the input is an array [...]\n    if (input instanceof Array && input.length > 0) {\n      output = [];\n    /// Input is array of object {x:val, y:val}\n      if (input[0] instanceof Object) {\n        delta = 1;\n        for (i = 0; i < input.length; i += delta) {\n          point = input[i];\n          temp = ren.displayToWorld(vec4.fromValues(\n                   point.x, point.y, fdp[2], 1.0),\n                   cam.viewMatrix(), cam.projectionMatrix(),\n                   m_width, m_height);\n          output.push({x: temp[0], y: temp[1], z: temp[2], w: temp[3]});\n        }\n    /// Input is array of 2d array [[x,y], [x,y]]\n      } else if (input[0] instanceof Array) {\n        delta = 1;\n        for (i = 0; i < input.length; i += delta) {\n          point = input[i];\n          temp = ren.displayToWorld(vec4.fromValues(\n                   point[0], point[1], fdp[2], 1.0),\n                   cam.viewMatrix(), cam.projectionMatrix(),\n                   m_width, m_height);\n          output.push(temp);\n        }\n    /// Input is flat array [x1,y1,x2,y2]\n      } else {\n        delta = input.length % 3 === 0 ? 3 : 2;\n        for (i = 0; i < input.length; i += delta) {\n          temp = ren.displayToWorld(vec4.fromValues(\n            input[i],\n            input[i + 1],\n            fdp[2],\n            1.0), cam.viewMatrix(), cam.projectionMatrix(),\n            m_width, m_height);\n          output.push(temp[0]);\n          output.push(temp[1]);\n          output.push(temp[2]);\n          output.push(temp[3]);\n        }\n      }\n    /// Input is object {x:val, y:val}\n    } else if (input instanceof Object) {\n      output = {};\n      temp = ren.displayToWorld(vec4.fromValues(\n               input.x, input.y, fdp[2], 1.0),\n               cam.viewMatrix(), cam.projectionMatrix(),\n               m_width, m_height);\n      output = {x: temp[0], y: temp[1], z: temp[2], w: temp[3]};\n    } else {\n      throw \"Display to world conversion requires array of 2D/3D points\";\n    }\n    return output;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert input data in world space to display space\n   *\n   * @param input {x:val, y:val} or {x:val, y:val, z:val} or [{x:val, y:val}]\n   * [{x:val, y:val, z:val}] or [[x,y]] or  [[x,y,z]] or [x1,y1,z1, x2, y2, z2]\n   *\n   * @returns {x:val, y:val} or [{x:val, y:val}] or [[x,y]] or\n   * [x1,y1, x2, y2]\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.worldToDisplay = function (input) {\n    var i, temp, delta,\n        ren = m_this.contextRenderer(), cam = ren.camera(),\n        fp = cam.focalPoint(), output = [];\n\n    /// Input is an array\n    if (input instanceof Array && input.length > 0) {\n      output = [];\n\n      /// Input is an array of objects\n      if (input[0] instanceof Object) {\n        delta = 1;\n        for (i = 0; i < input.length; i += delta) {\n          temp = ren.worldToDisplay(vec4.fromValues(\n                   input[i].x, input[i].y, fp[2], 1.0), cam.viewMatrix(),\n                   cam.projectionMatrix(),\n                   m_width, m_height);\n          output[i] = { x: temp[0], y: temp[1], z: temp[2] };\n        }\n      } else if (input[0] instanceof Array) {\n        /// Input is an array of array\n        delta = 1;\n        for (i = 0; i < input.length; i += delta) {\n          temp = ren.worldToDisplay(\n                   vec4.fromValues(input[i][0], input[i][1], fp[2], 1.0),\n                   cam.viewMatrix(), cam.projectionMatrix(), m_width, m_height);\n          output[i].push(temp);\n        }\n      } else {\n        /// Input is a flat array of 2 or 3 dimension\n        delta = input.length % 3 === 0 ? 3 : 2;\n        if (delta === 2)  {\n          for (i = 0; i < input.length; i += delta) {\n            temp = ren.worldToDisplay(vec4.fromValues(\n                     input[i], input[i + 1], fp[2], 1.0), cam.viewMatrix(),\n                     cam.projectionMatrix(),\n                     m_width, m_height);\n            output.push(temp[0]);\n            output.push(temp[1]);\n            output.push(temp[2]);\n          }\n        } else {\n          for (i = 0; i < input.length; i += delta) {\n            temp = ren.worldToDisplay(vec4.fromValues(\n                         input[i], input[i + 1], input[i + 2], 1.0), cam.viewMatrix(),\n                         cam.projectionMatrix(),\n                         m_width, m_height);\n            output.push(temp[0]);\n            output.push(temp[1]);\n            output.push(temp[2]);\n          }\n        }\n      }\n    } else if (input instanceof Object) {\n      temp = ren.worldToDisplay(vec4.fromValues(\n               input.x, input.y, fp[2], 1.0), cam.viewMatrix(),\n               cam.projectionMatrix(),\n               m_width, m_height);\n\n      output = {x: temp[0], y: temp[1], z: temp[2]};\n    } else {\n      throw \"World to display conversion requires array of 2D/3D points\";\n    }\n\n    return output;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get context specific renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.contextRenderer = function () {\n    return m_contextRenderer;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get API used by the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.api = function () {\n    return \"vgl\";\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Reset to default\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.reset = function () {\n    m_viewer.interactorStyle().reset();\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    if (m_this.initialized()) {\n      return m_this;\n    }\n\n    s_init.call(m_this);\n\n    m_this.canvas($(m_viewer.canvas()));\n    if (m_viewer.renderWindow().renderers().length > 0) {\n      m_contextRenderer.setLayer(m_viewer.renderWindow().renderers().length);\n      m_contextRenderer.setResetScene(false);\n    }\n    m_viewer.renderWindow().addRenderer(m_contextRenderer);\n\n    m_this.layer().node().append(m_this.canvas());\n\n    /// VGL uses jquery trigger on methods\n    $(m_viewer.interactorStyle()).on(geo.event.pan, function (event) {\n      m_this.trigger(geo.event.pan, event);\n    });\n\n    $(m_viewer.interactorStyle()).on(geo.event.zoom, function (event) {\n      m_this.trigger(geo.event.zoom, event);\n    });\n\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Connect events to the map layer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._connectMapEvents = function () {\n\n    // Only connect up events if this renderer is associated with the\n    // reference/base layer.\n    if (m_this.layer().referenceLayer()) {\n\n      /// https://developer.mozilla.org/en-US/docs/Web/Events/wheel\n      var map = $(m_this.layer().map().node()),\n          wheel = \"onwheel\" in map.get(0) ? \"wheel\" :\n                  document.onmousewheel !== undefined ? \"mousewheel\" :\n                  \"MozMousePixelScroll\",\n          wheelDelta = (wheel === \"wheel\") ? function (evt) {\n            return evt.originalEvent.deltaY *\n              (evt.originalEvent.deltaMode ? 120 : 1);\n          } : wheel === \"mousewheel\" ? function (evt) {\n            return evt.originalEvent.wheelDelta;\n          } : function (evt) {\n            return -evt.originalEvent.detail;\n          };\n\n      m_viewer.unbindEventHandlers();\n\n      map.on(wheel, function (event) {\n        event.originalEvent.wheelDeltaY = wheelDelta(event);\n        event.originalEvent.wheelDelta = event.originalEvent.wheelDeltaY;\n        m_viewer.handleMouseWheel(event);\n      });\n\n      map.on(\"mousedown\", function (event) {\n        m_viewer.handleMouseDown(event);\n      });\n\n      map.on(\"keypress\", function (event) {\n        m_viewer.handleKeyPress(event);\n      });\n\n      map.on(\"contextmenu\", function (event) {\n        m_viewer.handleContextMenu(event);\n      });\n\n      map.on(\"click\", function (event) {\n        m_viewer.handleClick(event);\n      });\n\n      map.on(\"dblclick\", function (event) {\n        m_viewer.handleDoubleClick(event);\n      });\n    }\n\n    m_viewer.interactorStyle().map(m_this.layer().map());\n    m_viewer.interactorStyle().reset();\n  };\n\n  this.on(geo.event.layerAdd, function (event) {\n    if (event.layer === m_this.layer()) {\n      m_this._connectMapEvents();\n    }\n  });\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle resize event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._resize = function (x, y, w, h) {\n    m_width = w;\n    m_height = h;\n    m_this.canvas().attr(\"width\", w);\n    m_this.canvas().attr(\"height\", h);\n    m_viewer.renderWindow().positionAndResize(x, y, w, h);\n    m_this._render();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Render\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._render = function () {\n    m_viewer.render();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Exit\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n  };\n\n  return this;\n};\n\ninherit(ggl.vglRenderer, ggl.renderer);\n\ngeo.registerRenderer(\"vglRenderer\", ggl.vglRenderer);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo.d3\n */\n//////////////////////////////////////////////////////////////////////////////\ngd3 = ogs.namespace('geo.d3'); // jshint ignore: line\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Get a random string to use as a div ID\n */\n//////////////////////////////////////////////////////////////////////////////\n(function (gd3) {\n  'use strict';\n\n  var chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz',\n    strLength = 8;\n\n  gd3.uniqueID = function () {\n    var strArray = [],\n        i;\n    strArray.length = strLength;\n    for (i = 0; i < strLength; i += 1) {\n      strArray[i] = chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return strArray.join('');\n  };\n\n  // event propagated when the d3 renderer rescales its group element\n  geo.event.d3Rescale = 'geo.d3.rescale';\n}(gd3));\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo.d3\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * D3 specific subclass of object which adds an id property for d3 selections\n * on groups of objects by class id.\n */\n//////////////////////////////////////////////////////////////////////////////\n\ngd3.object = function (arg) {\n  'use strict';\n  // this is used to extend other geojs classes, so only generate\n  // a new object when that is not the case... like if this === window\n  if (!(this instanceof geo.object)) {\n    return new gd3.object(arg);\n  }\n  geo.sceneObject.call(this);\n\n  var m_id = 'd3-' + gd3.uniqueID(),\n      m_this = this,\n      s_draw = this.draw;\n\n  this._d3id = function () {\n    return m_id;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Returns a d3 selection for the feature elements\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this.select = function () {\n    return m_this.renderer().select(m_this._d3id());\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Redraw the object.\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this.draw = function () {\n    m_this._update();\n    s_draw();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Removes the element from the svg and the renderer\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    return m_this.renderer()._removeFeature(m_this._d3id());\n  };\n\n  return this;\n};\n\ninherit(gd3.object, geo.sceneObject);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo.d3\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of pointFeature\n *\n * @class\n * @returns {gd3.pointFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngd3.pointFeature = function (arg) {\n  'use strict';\n  if (!(this instanceof gd3.pointFeature)) {\n    return new gd3.pointFeature(arg);\n  }\n  arg = arg || {};\n  geo.pointFeature.call(this, arg);\n  gd3.object.call(this);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_init = this._init,\n      s_update = this._update,\n      m_buildTime = geo.timestamp(),\n      m_style = {},\n      m_sticky;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n    m_sticky = m_this.layer().sticky();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    var data = m_this.data(),\n        s_style = m_this.style(),\n        m_renderer = m_this.renderer(),\n        pos_func = m_this.position();\n\n    // call super-method\n    s_update.call(m_this);\n\n    // default to empty data array\n    if (!data) { data = []; }\n\n    // fill in d3 renderer style object defaults\n    m_style.id = m_this._d3id();\n    m_style.data = data;\n    m_style.append = 'circle';\n    m_style.attributes = {\n      r: m_renderer._convertScale(s_style.radius),\n      cx: function (d) {\n        return m_renderer.worldToDisplay(pos_func(d)).x;\n      },\n      cy: function (d) {\n        return m_renderer.worldToDisplay(pos_func(d)).y;\n      }\n    };\n    m_style.style = s_style;\n    m_style.classes = [ 'd3PointFeature' ];\n\n    // pass to renderer to draw\n    m_this.renderer()._drawFeatures(m_style);\n\n    // update time stamps\n    m_buildTime.modified();\n    m_this.updateTime().modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    s_update.call(m_this);\n\n    if (m_this.dataTime().getMTime() >= m_buildTime.getMTime()) {\n      m_this._build();\n    }\n\n    return m_this;\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(gd3.pointFeature, geo.pointFeature);\n\n// Now register it\ngeo.registerFeature('d3', 'point', gd3.pointFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class lineFeature\n *\n * @class\n * @returns {gd3.lineFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngd3.lineFeature = function (arg) {\n  'use strict';\n  if (!(this instanceof gd3.lineFeature)) {\n    return new gd3.lineFeature(arg);\n  }\n  arg = arg || {};\n  geo.lineFeature.call(this, arg);\n  gd3.object.call(this);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_init = this._init,\n      m_buildTime = geo.timestamp(),\n      s_update = this._update,\n      m_style = {};\n\n  m_style.style = {};\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    var data = m_this.data() || [],\n        s_style = m_this.style(),\n        m_renderer = m_this.renderer(),\n        pos_func = m_this.position(),\n        line = d3.svg.line()\n                .x(function (d) { return m_renderer.worldToDisplay(pos_func(d)).x; })\n                .y(function (d) { return m_renderer.worldToDisplay(pos_func(d)).y; });\n    s_update.call(m_this);\n\n    // set the style object for the renderer\n    m_style.data = data;\n    m_style.attributes = {\n      d: line\n    };\n\n    m_style.id = m_this._d3id();\n    m_style.append = 'path';\n    m_style.classes = [ 'd3LineFeature' ];\n    m_style.style = $.extend({\n      fill: function () { return false; },\n      fillColor: function () { return { r: 0, g: 0, b: 0 }; }\n    }, s_style);\n\n    m_renderer._drawFeatures(m_style);\n\n    m_buildTime.modified();\n    m_this.updateTime().modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    s_update.call(m_this);\n\n    if (m_this.dataTime().getMTime() >= m_buildTime.getMTime()) {\n      m_this._build();\n    }\n\n    return m_this;\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(gd3.lineFeature, geo.lineFeature);\n\ngeo.registerFeature('d3', 'line', gd3.lineFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module geo\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class pathFeature\n *\n * @class\n * @returns {gd3.pathFeature}\n */\n//////////////////////////////////////////////////////////////////////////////\ngd3.pathFeature = function (arg) {\n  'use strict';\n  if (!(this instanceof gd3.pathFeature)) {\n    return new gd3.pathFeature(arg);\n  }\n  arg = arg || {};\n  geo.pathFeature.call(this, arg);\n  gd3.object.call(this);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  var m_this = this,\n      s_init = this._init,\n      m_buildTime = geo.timestamp(),\n      s_update = this._update,\n      m_style = {};\n\n  m_style.style = {};\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function (arg) {\n    s_init.call(m_this, arg);\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Build\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._build = function () {\n    var data = m_this.data() || [],\n        s_style = m_this.style(),\n        m_renderer = m_this.renderer(),\n        tmp, diag;\n    s_update.call(m_this);\n\n    diag = function (d) {\n        var p = {\n          source: d.source,\n          target: d.target\n        };\n        return d3.svg.diagonal()(p);\n      };\n    tmp = [];\n    data.forEach(function (d, i) {\n      var src, trg;\n      if (i < data.length - 1) {\n        src = d;\n        trg = data[i + 1];\n        tmp.push({\n          source: m_renderer.worldToDisplay(src),\n          target: m_renderer.worldToDisplay(trg)\n        });\n      }\n    });\n    m_style.data = tmp;\n    m_style.attributes = {\n      d: diag\n    };\n\n    m_style.id = m_this._d3id();\n    m_style.append = 'path';\n    m_style.classes = [ 'd3PathFeature' ];\n    m_style.style = $.extend({\n      'fill': function () { return false; },\n      'fillColor': function () { return { r: 0, g: 0, b: 0 }; }\n    }, s_style);\n\n    m_this.renderer()._drawFeatures(m_style);\n\n    m_buildTime.modified();\n    m_this.updateTime().modified();\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update\n   *\n   * @override\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n    s_update.call(m_this);\n\n    if (m_this.dataTime().getMTime() >= m_buildTime.getMTime()) {\n      m_this._build();\n    }\n\n    return m_this;\n  };\n\n  this._init(arg);\n  return this;\n};\n\ninherit(gd3.pathFeature, geo.pathFeature);\n\ngeo.registerFeature('d3', 'path', gd3.pathFeature);\n","gd3.graphFeature = function (arg) {\n  'use strict';\n\n  var m_this = this;\n\n  if (!(this instanceof gd3.graphFeature)) {\n    return new gd3.graphFeature(arg);\n  }\n  geo.graphFeature.call(this, arg);\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Returns a d3 selection for the graph elements\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this.select = function () {\n    var renderer = m_this.renderer(),\n        selection = {},\n        node = m_this.nodeFeature(),\n        links = m_this.linkFeatures();\n    selection.nodes = renderer.select(node._d3id());\n    selection.links = links.map(function (link) {\n      return renderer.select(link._d3id());\n    });\n    return selection;\n  };\n\n  return this;\n};\n\ninherit(gd3.graphFeature, geo.graphFeature);\n\ngeo.registerFeature('d3', 'graph', gd3.graphFeature);\n","//////////////////////////////////////////////////////////////////////////////\n/**\n * @module gd3\n */\n//////////////////////////////////////////////////////////////////////////////\n\n//////////////////////////////////////////////////////////////////////////////\n/**\n * Create a new instance of class d3Renderer\n *\n * @param canvas\n * @returns {gd3.d3Renderer}\n */\n//////////////////////////////////////////////////////////////////////////////\ngd3.d3Renderer = function (arg) {\n  'use strict';\n\n  if (!(this instanceof gd3.d3Renderer)) {\n    return new gd3.d3Renderer(arg);\n  }\n  geo.renderer.call(this, arg);\n  gd3.object.call(this, arg);\n\n  arg = arg || {};\n\n  var m_this = this,\n      m_sticky = null,\n      m_features = {},\n      m_corners = null,\n      m_width = null,\n      m_height = null,\n      m_scale = 1,\n      m_dx = 0,\n      m_dy = 0,\n      m_svg = null;\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set attributes to a d3 selection.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function setAttrs(select, attrs) {\n    var key;\n    for (key in attrs) {\n      if (attrs.hasOwnProperty(key)) {\n        select.attr(key, attrs[key]);\n      }\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Meta functions for converting from geojs styles to d3.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._convertColor = function (f, g) {\n    g = g || function () { return true; };\n    return function (d) {\n      var c;\n      if (g(d)) {\n        c = f(d);\n        return d3.rgb(255 * c.r, 255 * c.g, 255 * c.b);\n      } else {\n        return 'none';\n      }\n    };\n  };\n\n  this._convertPosition = function (f) {\n    return function (d) {\n      return m_this.worldToDisplay(f(d));\n    };\n  };\n\n  this._convertScale = function (f) {\n    return function (d) {\n      return f(d) / m_scale;\n    };\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set styles to a d3 selection. Ignores unkown style keys.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function setStyles(select, styles) {\n    var key, k, f;\n    function returnNone() {\n      return 'none';\n    }\n    for (key in styles) {\n      if (styles.hasOwnProperty(key)) {\n        f = null;\n        k = null;\n        if (key === 'strokeColor') {\n          k = 'stroke';\n          f = m_this._convertColor(styles[key], styles.stroke);\n        } else if (key === 'stroke' && styles[key]) {\n          f = returnNone;\n        } else if (key === 'strokeWidth') {\n          k = 'stroke-width';\n          f = m_this._convertScale(styles[key]);\n        } else if (key === 'strokeOpacity') {\n          k = 'stroke-opacity';\n          f = styles[key];\n        } else if (key === 'fillColor') {\n          k = 'fill';\n          f = m_this._convertColor(styles[key], styles.fill);\n        } else if (key === 'fill' && styles[key]) {\n          f = returnNone;\n        } else if (key === 'fillOpacity') {\n          k = 'fill-opacity';\n          f = styles[key];\n        }\n        if (k) {\n          select.style(k, f);\n        }\n      }\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the map instance or return null if not connected to a map.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function getMap() {\n    var layer = m_this.layer();\n    if (!layer) {\n      return null;\n    }\n    return layer.map();\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get the svg group element associated with this renderer instance.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function getGroup() {\n    return m_svg.select('.group-' + m_this._d3id());\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set the initial lat-lon coordinates of the map view.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function initCorners() {\n    var layer = m_this.layer(),\n        map = layer.map(),\n        width = m_this.layer().width(),\n        height = m_this.layer().height();\n\n    m_width = width;\n    m_height = height;\n    if (!m_width || !m_height) {\n      throw 'Map layer has size 0';\n    }\n    m_corners = {\n      'upperLeft': map.displayToGcs({'x': 0, 'y': 0}),\n      'lowerRight': map.displayToGcs({'x': width, 'y': height})\n    };\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Set the translation, scale, and zoom for the current view.\n   * @note rotation not yet supported\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function setTransform() {\n\n    if (!m_corners) {\n      initCorners();\n    }\n\n    if (!m_sticky) {\n      return;\n    }\n\n    var layer = m_this.layer(),\n        map = layer.map(),\n        upperLeft = map.gcsToDisplay(m_corners.upperLeft),\n        lowerRight = map.gcsToDisplay(m_corners.lowerRight),\n        group = getGroup(),\n        dx, dy, scale;\n\n    // calculate the translation\n    dx = upperLeft.x;\n    dy = upperLeft.y;\n\n    // calculate the scale\n    scale = (lowerRight.y - upperLeft.y) / m_height;\n\n    // set the group transform property\n    group.attr('transform', 'matrix(' + [scale, 0, 0, scale, dx, dy].join() + ')');\n\n    // set internal variables\n    m_scale = scale;\n    m_dx = dx;\n    m_dy = dy;\n  }\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert from screen pixel coordinates to the local coordinate system\n   * in the SVG group element taking into account the transform.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function baseToLocal(pt) {\n    return {\n      x: (pt.x - m_dx) / m_scale,\n      y: (pt.y - m_dy) / m_scale\n    };\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert from the local coordinate system in the SVG group element\n   * to screen pixel coordinates.\n   * @private\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  function localToBase(pt) {\n    return {\n      x: pt.x * m_scale + m_dx,\n      y: pt.y * m_scale + m_dy\n    };\n  }\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Initialize\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._init = function () {\n    if (!m_this.canvas()) {\n      var canvas;\n      m_svg = d3.select(m_this.layer().node().get(0)).append('svg');\n\n      canvas = m_svg.append('g');\n\n      m_sticky = m_this.layer().sticky();\n      m_svg.attr('class', m_this._d3id());\n      m_svg.attr('width', m_this.layer().node().width());\n      m_svg.attr('height', m_this.layer().node().height());\n\n      canvas.attr('class', 'group-' + m_this._d3id());\n\n      m_this.canvas(canvas);\n    }\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert from coordinates in the svg group element to lat/lon.\n   * Supports objects or arrays of objects.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.displayToWorld = function (pt) {\n    var map = getMap();\n    if (!map) {\n      throw 'Cannot project until this layer is connected to a map.';\n    }\n    if (Array.isArray(pt)) {\n      pt = pt.map(function (x) {\n        return map.displayToGcs(localToBase(x));\n      });\n    } else {\n      pt = map.displayToGcs(localToBase(pt));\n    }\n    return pt;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Convert from lat/lon to pixel coordinates in the svg group element.\n   * Supports objects or arrays of objects.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.worldToDisplay = function (pt) {\n    var map = getMap();\n    if (!map) {\n      throw 'Cannot project until this layer is connected to a map.';\n    }\n    var v;\n    if (Array.isArray(pt)) {\n      v = pt.map(function (x) {\n        return baseToLocal(map.gcsToDisplay(x));\n      });\n    } else {\n      v = baseToLocal(map.gcsToDisplay(pt));\n    }\n    return v;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Get API used by the renderer\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.api = function () {\n    return 'd3';\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Return the current scaling factor to build features that shouldn't\n   * change size during zooms.  For example:\n   *\n   *  selection.append('circle')\n   *    .attr('r', r0 / renderer.scaleFactor());\n   *\n   * This will create a circle element with radius r0 independent of the\n   * current zoom level.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this.scaleFactor = function () {\n    return m_scale;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Handle resize event\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._resize = function (x, y, w, h) {\n    if (!m_corners) {\n      initCorners();\n    }\n    m_svg.attr('width', w);\n    m_svg.attr('height', h);\n    setTransform();\n    m_this.layer().trigger(geo.event.d3Rescale, { scale: m_scale }, true);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Update noop for gd3.object api.\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._update = function () {\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Exit\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._exit = function () {\n    m_features = {};\n    m_this.canvas().remove();\n  };\n\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n   * Create a new feature element from an object that describes the feature\n   * attributes.  To be called from feature classes only.\n   *\n   * Input:\n   *  {\n   *    id:         A unique string identifying the feature.\n   *    data:       Array of data objects used in a d3 data method.\n   *    index:      A function that returns a unique id for each data element.\n   *    style:      An object containing element CSS styles.\n   *    attributes: An object containing element attributes.\n   *    classes:    An array of classes to add to the elements.\n   *    append:     The element type as used in d3 append methods.\n   *  }\n   */\n  ////////////////////////////////////////////////////////////////////////////\n  this._drawFeatures = function (arg) {\n    m_features[arg.id] = {\n      data: arg.data,\n      index: arg.dataIndex,\n      style: arg.style,\n      attributes: arg.attributes,\n      classes: arg.classes,\n      append: arg.append\n    };\n    return m_this._render(arg.id);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Updates a feature by performing a d3 data join.  If no input id is\n  *  provided then this method will update all features.\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this._render = function (id) {\n    var key;\n    if (id === undefined) {\n      for (key in m_features) {\n        if (m_features.hasOwnProperty(key)) {\n          m_this._render(key);\n        }\n      }\n      return m_this;\n    }\n    var data = m_features[id].data,\n        index = m_features[id].index,\n        style = m_features[id].style,\n        attributes = m_features[id].attributes,\n        classes = m_features[id].classes,\n        append = m_features[id].append,\n        selection = m_this.select(id).data(data, index);\n    selection.enter().append(append);\n    selection.exit().remove();\n    setAttrs(selection, attributes);\n    selection.attr('class', classes.concat([id]).join(' '));\n    setStyles(selection, style);\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Returns a d3 selection for the given feature id.\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this.select = function (id) {\n    return getGroup().selectAll('.' + id);\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Removes a feature from the layer.\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this._removeFeature = function (id) {\n    m_this.select(id).remove();\n    delete m_features[id];\n    return m_this;\n  };\n\n  ////////////////////////////////////////////////////////////////////////////\n  /**\n  *  Override draw method to do nothing.\n  */\n  ////////////////////////////////////////////////////////////////////////////\n  this.draw = function () {\n  };\n\n  // connect to pan event\n  this.on(geo.event.pan, setTransform);\n\n  // connect to zoom event\n  this.on(geo.event.zoom, function () {\n    setTransform();\n    m_this._render();\n    m_this.layer().trigger(geo.event.d3Rescale, { scale: m_scale }, true);\n  });\n\n  this.on(geo.event.resize, function (event) {\n    m_this._resize(event.x, event.y, event.width, event.height);\n  });\n\n  this._init(arg);\n  return this;\n};\n\ninherit(gd3.d3Renderer, geo.renderer);\n\ngeo.registerRenderer('d3Renderer', gd3.d3Renderer);\n"]}